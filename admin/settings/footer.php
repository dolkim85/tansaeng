<?php
session_start();
require_once __DIR__ . '/../../config/database.php';

$isAdmin = (isset($_SESSION['role']) && $_SESSION['role'] === 'admin') ||
          (isset($_SESSION['user_level']) && $_SESSION['user_level'] == 9);

if (!$isAdmin) {
    header('Location: /pages/auth/login.php?redirect=/admin/settings/footer.php');
    exit;
}

$success = '';
$error = '';

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    try {
        $pdo = DatabaseConfig::getConnection();

        // Î©îÎâ¥ Îç∞Ïù¥ÌÑ∞Î•º JSON ÌòïÏãùÏúºÎ°ú Î≥ÄÌôò (name|url ÌòïÏãù)
        function parseMenuInput($input) {
            $lines = array_filter(array_map('trim', explode("\n", $input)));
            $menu = [];
            foreach ($lines as $line) {
                $parts = explode('|', $line, 2);
                $menu[] = [
                    'name' => trim($parts[0]),
                    'url' => isset($parts[1]) ? trim($parts[1]) : '#'
                ];
            }
            return json_encode($menu);
        }

        $settings = [
            'footer_company_desc' => trim($_POST['footer_company_desc'] ?? ''),
            'footer_address' => trim($_POST['footer_address'] ?? ''),
            'footer_phone' => trim($_POST['footer_phone'] ?? ''),
            'footer_fax' => trim($_POST['footer_fax'] ?? ''),
            'footer_email' => trim($_POST['footer_email'] ?? ''),
            'footer_business_hours_weekday' => trim($_POST['footer_business_hours_weekday'] ?? ''),
            'footer_business_hours_saturday' => trim($_POST['footer_business_hours_saturday'] ?? ''),
            'footer_business_hours_holiday' => trim($_POST['footer_business_hours_holiday'] ?? ''),
            'footer_copyright' => trim($_POST['footer_copyright'] ?? ''),
            'footer_social_facebook' => trim($_POST['footer_social_facebook'] ?? ''),
            'footer_social_instagram' => trim($_POST['footer_social_instagram'] ?? ''),
            'footer_social_youtube' => trim($_POST['footer_social_youtube'] ?? ''),
            'footer_social_blog' => trim($_POST['footer_social_blog'] ?? ''),
            'footer_menu_products' => parseMenuInput($_POST['footer_menu_products'] ?? ''),
            'footer_menu_services' => parseMenuInput($_POST['footer_menu_services'] ?? ''),
            'footer_menu_company' => parseMenuInput($_POST['footer_menu_company'] ?? ''),
            'footer_menu_legal' => parseMenuInput($_POST['footer_menu_legal'] ?? '')
        ];

        foreach ($settings as $key => $value) {
            $sql = "INSERT INTO site_settings (setting_key, setting_value) VALUES (?, ?)
                    ON DUPLICATE KEY UPDATE setting_value = VALUES(setting_value)";
            $stmt = $pdo->prepare($sql);
            $stmt->execute([$key, $value]);
        }

        $success = 'Ìë∏ÌÑ∞ ÏÑ§Ï†ïÏù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.';
    } catch (Exception $e) {
        $error = 'Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' . $e->getMessage();
    }
}

$currentSettings = [];
try {
    $pdo = DatabaseConfig::getConnection();
    $sql = "SELECT setting_key, setting_value FROM site_settings";
    $stmt = $pdo->query($sql);
    while ($row = $stmt->fetch()) {
        $currentSettings[$row['setting_key']] = $row['setting_value'];
    }
} catch (Exception $e) {
    $error = 'Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.';
}

// JSON Î∞∞Ïó¥ÏùÑ ÌÖçÏä§Ìä∏Î°ú Î≥ÄÌôòÌïòÎäî Ìï®Ïàò (ÏÉà ÌòïÏãù: name|url)
function jsonToText($jsonString) {
    if (empty($jsonString)) return '';
    $array = json_decode($jsonString, true);
    if (!is_array($array)) return '';

    $lines = [];
    foreach ($array as $item) {
        if (is_array($item) && isset($item['name'])) {
            // ÏÉà ÌòïÏãù: {"name": "Î©îÎâ¥Î™Ö", "url": "/path"}
            $lines[] = $item['name'] . '|' . ($item['url'] ?? '#');
        } else if (is_string($item)) {
            // Íµ¨ ÌòïÏãù: "Î©îÎâ¥Î™Ö"
            $lines[] = $item . '|#';
        }
    }
    return implode("\n", $lines);
}
?>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ìë∏ÌÑ∞ Í¥ÄÎ¶¨ - ÌÉÑÏÉù Í¥ÄÎ¶¨Ïûê</title>
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/admin.css">
    <style>
        .footer-editor-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .editor-panel {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow-y: auto;
            max-height: calc(100vh - 200px);
        }

        .editor-panel h3 {
            margin-top: 0;
            margin-bottom: 20px;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .preview-panel {
            background: #f8f9fa;
            position: sticky;
            top: 20px;
        }

        .preview-footer {
            background: #2c3e50;
            color: white;
            padding: 40px 20px 20px;
            border-radius: 10px;
            font-size: 14px;
        }

        .preview-footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .preview-footer-section h3 {
            color: white;
            font-size: 16px;
            margin-bottom: 15px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }

        .preview-footer-section p,
        .preview-footer-section ul {
            margin: 8px 0;
            line-height: 1.6;
        }

        .preview-footer-section ul {
            list-style: none;
            padding: 0;
        }

        .preview-footer-section li {
            margin: 5px 0;
        }

        .preview-footer-section a {
            color: #ecf0f1;
            text-decoration: none;
            transition: color 0.3s;
        }

        .preview-footer-section a:hover {
            color: #3498db;
        }

        .preview-footer-social {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .preview-footer-social a {
            background: rgba(255,255,255,0.1);
            padding: 8px 12px;
            border-radius: 5px;
            transition: background 0.3s;
        }

        .preview-footer-social a:hover {
            background: rgba(52, 152, 219, 0.3);
        }

        .preview-footer-bottom {
            border-top: 1px solid rgba(255,255,255,0.1);
            padding-top: 20px;
            text-align: center;
            font-size: 12px;
            color: #95a5a6;
        }

        .preview-info {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .toolbar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .btn-success {
            background: #2ecc71;
            color: white;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-outline {
            background: white;
            color: #3498db;
            border: 2px solid #3498db;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .alert-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        @media (max-width: 1200px) {
            .footer-editor-container {
                grid-template-columns: 1fr;
            }

            .preview-panel {
                position: static;
            }
        }
    </style>
</head>
<body class="admin-body">
    <?php include '../includes/admin_header.php'; ?>

    <div class="admin-container">
        <?php include '../includes/admin_sidebar.php'; ?>

        <main class="admin-main">
            <div class="admin-content">
                <div class="settings-header">
                    <h1>üîó Ìë∏ÌÑ∞ Í¥ÄÎ¶¨</h1>
                    <p>Ï¢åÏ∏°ÏóêÏÑú Ìë∏ÌÑ∞ ÎÇ¥Ïö©ÏùÑ ÏàòÏ†ïÌïòÎ©¥, Ïö∞Ï∏°ÏóêÏÑú Ïã§ÏãúÍ∞ÑÏúºÎ°ú ÎØ∏Î¶¨Î≥¥Í∏∞Îê©ÎãàÎã§</p>
                </div>

                <div class="toolbar">
                    <button class="btn btn-success" onclick="document.getElementById('footerForm').submit()">üíæ Î™®Îëê Ï†ÄÏû•</button>
                    <button class="btn btn-primary" onclick="refreshPreview()">üîÑ ÎØ∏Î¶¨Î≥¥Í∏∞ ÏÉàÎ°úÍ≥†Ïπ®</button>
                    <a href="/" target="_blank" class="btn btn-outline">üåê Ïã§Ï†ú ÏÇ¨Ïù¥Ìä∏ Î≥¥Í∏∞</a>
                </div>

                <div id="alertArea">
                    <?php if ($success): ?>
                        <div class="alert alert-success"><?= htmlspecialchars($success) ?></div>
                    <?php endif; ?>

                    <?php if ($error): ?>
                        <div class="alert alert-error"><?= htmlspecialchars($error) ?></div>
                    <?php endif; ?>
                </div>

                <div class="footer-editor-container">
                    <!-- ÏôºÏ™Ω: Ìé∏Ïßë Ìå®ÎÑê -->
                    <div class="editor-panel">
                        <h3>üìù Ìë∏ÌÑ∞ ÎÇ¥Ïö© Ìé∏Ïßë</h3>

                <form method="post" class="admin-form" id="footerForm">
                    <div class="form-section">
                        <h3>ÌöåÏÇ¨ Ï†ïÎ≥¥</h3>

                        <div class="form-group">
                            <label for="footer_company_desc">ÌöåÏÇ¨ ÏÑ§Î™Ö</label>
                            <textarea id="footer_company_desc" name="footer_company_desc" class="form-control" rows="3" oninput="updatePreview()"><?= htmlspecialchars($currentSettings['footer_company_desc'] ?? 'Ïä§ÎßàÌä∏Ìåú Î∞∞ÏßÄ Ï†úÏ°∞ Ï†ÑÎ¨∏ÌöåÏÇ¨Î°úÏÑú ÏµúÍ≥† ÌíàÏßàÏùò Ï†úÌíàÍ≥º ÌòÅÏã†Ï†ÅÏù∏ AI Í∏∞Ïà†ÏùÑ ÌÜµÌï¥ ÎØ∏Îûò ÎÜçÏóÖÏùÑ ÏÑ†ÎèÑÌï©ÎãàÎã§.') ?></textarea>
                        </div>

                        <div class="form-group">
                            <label for="footer_address">Ï£ºÏÜå</label>
                            <input type="text" id="footer_address" name="footer_address"
                                   value="<?= htmlspecialchars($currentSettings['footer_address'] ?? 'ÏÑúÏö∏ÌäπÎ≥ÑÏãú Í∞ïÎÇ®Íµ¨ ÌÖåÌó§ÎûÄÎ°ú 123') ?>"
                                   oninput="updatePreview()">
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="footer_phone">Ï†ÑÌôîÎ≤àÌò∏</label>
                                <input type="tel" id="footer_phone" name="footer_phone"
                                       value="<?= htmlspecialchars($currentSettings['footer_phone'] ?? '02-0000-0000') ?>"
                                       oninput="updatePreview()">
                            </div>

                            <div class="form-group">
                                <label for="footer_fax">Ìå©Ïä§</label>
                                <input type="tel" id="footer_fax" name="footer_fax"
                                       value="<?= htmlspecialchars($currentSettings['footer_fax'] ?? '02-0000-0001') ?>"
                                       oninput="updatePreview()">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="footer_email">Ïù¥Î©îÏùº</label>
                            <input type="email" id="footer_email" name="footer_email"
                                   value="<?= htmlspecialchars($currentSettings['footer_email'] ?? 'info@tansaeng.com') ?>"
                                   oninput="updatePreview()">
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Ïö¥ÏòÅ ÏãúÍ∞Ñ</h3>

                        <div class="form-group">
                            <label for="footer_business_hours_weekday">ÌèâÏùº</label>
                            <input type="text" id="footer_business_hours_weekday" name="footer_business_hours_weekday"
                                   value="<?= htmlspecialchars($currentSettings['footer_business_hours_weekday'] ?? 'ÌèâÏùº: 09:00 - 18:00') ?>">
                        </div>

                        <div class="form-group">
                            <label for="footer_business_hours_saturday">ÌÜ†ÏöîÏùº</label>
                            <input type="text" id="footer_business_hours_saturday" name="footer_business_hours_saturday"
                                   value="<?= htmlspecialchars($currentSettings['footer_business_hours_saturday'] ?? 'ÌÜ†ÏöîÏùº: 09:00 - 13:00') ?>">
                        </div>

                        <div class="form-group">
                            <label for="footer_business_hours_holiday">ÏùºÏöîÏùº/Í≥µÌú¥Ïùº</label>
                            <input type="text" id="footer_business_hours_holiday" name="footer_business_hours_holiday"
                                   value="<?= htmlspecialchars($currentSettings['footer_business_hours_holiday'] ?? 'ÏùºÏöîÏùº/Í≥µÌú¥Ïùº: Ìú¥Î¨¥') ?>">
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>ÏÜåÏÖú ÎØ∏ÎîîÏñ¥</h3>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="footer_social_facebook">Facebook</label>
                                <input type="url" id="footer_social_facebook" name="footer_social_facebook"
                                       value="<?= htmlspecialchars($currentSettings['footer_social_facebook'] ?? 'https://facebook.com/tansaeng') ?>">
                            </div>

                            <div class="form-group">
                                <label for="footer_social_instagram">Instagram</label>
                                <input type="url" id="footer_social_instagram" name="footer_social_instagram"
                                       value="<?= htmlspecialchars($currentSettings['footer_social_instagram'] ?? 'https://instagram.com/tansaeng') ?>">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="footer_social_youtube">YouTube</label>
                                <input type="url" id="footer_social_youtube" name="footer_social_youtube"
                                       value="<?= htmlspecialchars($currentSettings['footer_social_youtube'] ?? 'https://youtube.com/@tansaeng') ?>">
                            </div>

                            <div class="form-group">
                                <label for="footer_social_blog">Î∏îÎ°úÍ∑∏</label>
                                <input type="url" id="footer_social_blog" name="footer_social_blog"
                                       value="<?= htmlspecialchars($currentSettings['footer_social_blog'] ?? 'https://blog.tansaeng.com') ?>">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Ìë∏ÌÑ∞ Î©îÎâ¥</h3>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="footer_menu_products">Ï†úÌíà Î©îÎâ¥</label>
                                <textarea id="footer_menu_products" name="footer_menu_products" class="form-control" rows="6" placeholder="Î©îÎâ¥Î™Ö|URL ÌòïÏãùÏúºÎ°ú ÏûÖÎ†•ÌïòÏÑ∏Ïöî&#10;Ïòà: ÏΩîÏΩîÌîºÌä∏ Î∞∞ÏßÄ|/pages/products/coco.php" oninput="updatePreview()"><?= htmlspecialchars(jsonToText($currentSettings['footer_menu_products'] ?? '') ?: "ÏΩîÏΩîÌîºÌä∏ Î∞∞ÏßÄ|/pages/products/coco.php\nÌéÑÎùºÏù¥Ìä∏ Î∞∞ÏßÄ|/pages/products/perlite.php\nÌòºÌï© Î∞∞ÏßÄ|/pages/products/mixed.php\nÏ†úÌíà ÎπÑÍµê|/pages/products/compare.php") ?></textarea>
                                <small>ÌòïÏãù: <code>Î©îÎâ¥Î™Ö|URL</code> (Ìïú Ï§ÑÏóê ÌïòÎÇòÏî©, URL ÏóÜÏúºÎ©¥ # Ï≤òÎ¶¨Îê®)</small>
                            </div>

                            <div class="form-group">
                                <label for="footer_menu_services">ÏÑúÎπÑÏä§ Î©îÎâ¥</label>
                                <textarea id="footer_menu_services" name="footer_menu_services" class="form-control" rows="6" placeholder="Î©îÎâ¥Î™Ö|URL ÌòïÏãùÏúºÎ°ú ÏûÖÎ†•ÌïòÏÑ∏Ïöî&#10;Ïòà: AI ÏãùÎ¨ºÎ∂ÑÏÑù|/pages/plant_analysis/" oninput="updatePreview()"><?= htmlspecialchars(jsonToText($currentSettings['footer_menu_services'] ?? '') ?: "AI ÏãùÎ¨ºÎ∂ÑÏÑù|/pages/plant_analysis/\nFAQ|/pages/support/faq.php\nÍ∏∞Ïà†ÏßÄÏõê|/pages/support/technical.php\n1:1 Î¨∏Ïùò|/pages/support/inquiry.php") ?></textarea>
                                <small>ÌòïÏãù: <code>Î©îÎâ¥Î™Ö|URL</code> (Ìïú Ï§ÑÏóê ÌïòÎÇòÏî©, URL ÏóÜÏúºÎ©¥ # Ï≤òÎ¶¨Îê®)</small>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="footer_menu_company">ÌöåÏÇ¨ Î©îÎâ¥</label>
                                <textarea id="footer_menu_company" name="footer_menu_company" class="form-control" rows="4" placeholder="Î©îÎâ¥Î™Ö|URL ÌòïÏãùÏúºÎ°ú ÏûÖÎ†•ÌïòÏÑ∏Ïöî&#10;Ïòà: ÌöåÏÇ¨ÏÜåÍ∞ú|/pages/company/about.php" oninput="updatePreview()"><?= htmlspecialchars(jsonToText($currentSettings['footer_menu_company'] ?? '') ?: "ÌöåÏÇ¨ÏÜåÍ∞ú|/pages/company/about.php\nÏó∞ÌòÅ|/pages/company/history.php\nÏò§ÏãúÎäîÍ∏∏|/pages/company/location.php\nÍ≥µÏßÄÏÇ¨Ìï≠|/pages/board/") ?></textarea>
                                <small>ÌòïÏãù: <code>Î©îÎâ¥Î™Ö|URL</code> (Ìïú Ï§ÑÏóê ÌïòÎÇòÏî©, URL ÏóÜÏúºÎ©¥ # Ï≤òÎ¶¨Îê®)</small>
                            </div>

                            <div class="form-group">
                                <label for="footer_menu_legal">Î≤ïÏ†Å Ï†ïÎ≥¥</label>
                                <textarea id="footer_menu_legal" name="footer_menu_legal" class="form-control" rows="4" placeholder="Î©îÎâ¥Î™Ö|URL ÌòïÏãùÏúºÎ°ú ÏûÖÎ†•ÌïòÏÑ∏Ïöî&#10;Ïòà: Í∞úÏù∏Ï†ïÎ≥¥Ï≤òÎ¶¨Î∞©Ïπ®|/pages/legal/privacy.php" oninput="updatePreview()"><?= htmlspecialchars(jsonToText($currentSettings['footer_menu_legal'] ?? '') ?: "Í∞úÏù∏Ï†ïÎ≥¥Ï≤òÎ¶¨Î∞©Ïπ®|/pages/legal/privacy.php\nÏù¥Ïö©ÏïΩÍ¥Ä|/pages/legal/terms.php\nÏÇ¨Ïù¥Ìä∏Îßµ|/sitemap.php") ?></textarea>
                                <small>ÌòïÏãù: <code>Î©îÎâ¥Î™Ö|URL</code> (Ìïú Ï§ÑÏóê ÌïòÎÇòÏî©, URL ÏóÜÏúºÎ©¥ # Ï≤òÎ¶¨Îê®)</small>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Ï†ÄÏûëÍ∂å Ï†ïÎ≥¥</h3>

                        <div class="form-group">
                            <label for="footer_copyright">Ï†ÄÏûëÍ∂å ÌëúÏãú</label>
                            <input type="text" id="footer_copyright" name="footer_copyright"
                                   value="<?= htmlspecialchars($currentSettings['footer_copyright'] ?? '¬© 2024 ÌÉÑÏÉù(Tansaeng). All rights reserved.') ?>"
                                   oninput="updatePreview()">
                        </div>
                    </div>
                </form>
                    </div>

                    <!-- Ïò§Î•∏Ï™Ω: Ïã§ÏãúÍ∞Ñ ÎØ∏Î¶¨Î≥¥Í∏∞ Ìå®ÎÑê -->
                    <div class="editor-panel preview-panel">
                        <h3>üëÅÔ∏è Ïã§ÏãúÍ∞Ñ ÎØ∏Î¶¨Î≥¥Í∏∞</h3>

                        <div class="preview-footer">
                            <div class="preview-footer-content">
                                <div class="preview-footer-section">
                                    <h3 id="preview_company_name">ÌÉÑÏÉù</h3>
                                    <p id="preview_company_desc" class="footer-company-desc"></p>
                                    <div class="footer-contact">
                                        <p id="preview_address">üìç </p>
                                        <p id="preview_phone">üìû </p>
                                        <p id="preview_email">‚úâÔ∏è </p>
                                    </div>
                                    <div class="preview-footer-social" id="preview_social">
                                        <!-- Social links will be dynamically added -->
                                    </div>
                                </div>

                                <div class="preview-footer-section">
                                    <h3>Ï†úÌíà</h3>
                                    <ul id="preview_products_menu">
                                        <!-- Product menu items will be dynamically added -->
                                    </ul>
                                </div>

                                <div class="preview-footer-section">
                                    <h3>ÏÑúÎπÑÏä§</h3>
                                    <ul id="preview_services_menu">
                                        <!-- Services menu items will be dynamically added -->
                                    </ul>
                                </div>

                                <div class="preview-footer-section">
                                    <h3>ÌöåÏÇ¨Ï†ïÎ≥¥</h3>
                                    <ul id="preview_company_menu">
                                        <!-- Company menu items will be dynamically added -->
                                    </ul>
                                </div>
                            </div>

                            <div class="preview-footer-bottom">
                                <p id="preview_copyright"></p>
                            </div>
                        </div>

                        <div class="preview-info">
                            <h4>üí° ÎØ∏Î¶¨Î≥¥Í∏∞ Ï†ïÎ≥¥</h4>
                            <p>ÏôºÏ™Ω ÌèºÏóêÏÑú ÎÇ¥Ïö©ÏùÑ ÏàòÏ†ïÌïòÎ©¥ Ïù¥ ÎØ∏Î¶¨Î≥¥Í∏∞Í∞Ä Ïã§ÏãúÍ∞ÑÏúºÎ°ú ÏóÖÎç∞Ïù¥Ìä∏Îê©ÎãàÎã§.</p>
                            <p style="margin-top: 10px; padding: 10px; background: #fff3cd; border-radius: 5px; font-size: 13px;">
                                <strong>Tip:</strong> Î≥ÄÍ≤ΩÏÇ¨Ìï≠ÏùÑ Ï†ÄÏû•ÌïòÎ†§Î©¥ ÏÉÅÎã®Ïùò "üíæ Î™®Îëê Ï†ÄÏû•" Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî!
                            </p>
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <script>
        // HTML Ïù¥Ïä§ÏºÄÏù¥ÌîÑ Ìï®Ïàò
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Î©îÎâ¥ ÌÖçÏä§Ìä∏ ÌååÏã± Ìï®Ïàò (name|url ÌòïÏãù)
        function parseMenuText(text) {
            if (!text) return [];
            const lines = text.split('\n').filter(line => line.trim());
            return lines.map(line => {
                const parts = line.split('|');
                return {
                    name: parts[0] ? parts[0].trim() : '',
                    url: parts[1] ? parts[1].trim() : '#'
                };
            });
        }

        // ÎØ∏Î¶¨Î≥¥Í∏∞ ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò
        function updatePreview() {
            // ÌöåÏÇ¨ Ï†ïÎ≥¥
            const companyDesc = document.getElementById('footer_company_desc').value;
            const address = document.getElementById('footer_address').value;
            const phone = document.getElementById('footer_phone').value;
            const email = document.getElementById('footer_email').value;
            const copyright = document.getElementById('footer_copyright').value;

            document.getElementById('preview_company_desc').textContent = companyDesc;
            document.getElementById('preview_address').innerHTML = 'üìç ' + escapeHtml(address);
            document.getElementById('preview_phone').innerHTML = 'üìû ' + escapeHtml(phone);
            document.getElementById('preview_email').innerHTML = '‚úâÔ∏è ' + escapeHtml(email);
            document.getElementById('preview_copyright').textContent = copyright;

            // Ï†úÌíà Î©îÎâ¥
            const productsText = document.getElementById('footer_menu_products').value;
            const productsMenu = parseMenuText(productsText);
            const productsHtml = productsMenu.map(item =>
                `<li><a href="${escapeHtml(item.url)}">${escapeHtml(item.name)}</a></li>`
            ).join('');
            document.getElementById('preview_products_menu').innerHTML = productsHtml || '<li style="color: #999;">Î©îÎâ¥ Ìï≠Î™© ÏóÜÏùå</li>';

            // ÏÑúÎπÑÏä§ Î©îÎâ¥
            const servicesText = document.getElementById('footer_menu_services').value;
            const servicesMenu = parseMenuText(servicesText);
            const servicesHtml = servicesMenu.map(item =>
                `<li><a href="${escapeHtml(item.url)}">${escapeHtml(item.name)}</a></li>`
            ).join('');
            document.getElementById('preview_services_menu').innerHTML = servicesHtml || '<li style="color: #999;">Î©îÎâ¥ Ìï≠Î™© ÏóÜÏùå</li>';

            // ÌöåÏÇ¨ Î©îÎâ¥
            const companyText = document.getElementById('footer_menu_company').value;
            const companyMenu = parseMenuText(companyText);
            const companyHtml = companyMenu.map(item =>
                `<li><a href="${escapeHtml(item.url)}">${escapeHtml(item.name)}</a></li>`
            ).join('');
            document.getElementById('preview_company_menu').innerHTML = companyHtml || '<li style="color: #999;">Î©îÎâ¥ Ìï≠Î™© ÏóÜÏùå</li>';

            // ÏÜåÏÖú ÎØ∏ÎîîÏñ¥ (Ïã§Ï†ú Í∞íÏùÄ ÌòÑÏû¨ Ï†ÄÏû•Îêú Í∞í ÏÇ¨Ïö©)
            updateSocialLinks();
        }

        // ÏÜåÏÖú ÎßÅÌÅ¨ ÏóÖÎç∞Ïù¥Ìä∏ (Ï†ÄÏû•Îêú Í∞íÏóêÏÑú)
        function updateSocialLinks() {
            const social = document.getElementById('preview_social');
            let socialHtml = '';

            <?php if (!empty($currentSettings['footer_social_youtube'])): ?>
                socialHtml += '<a href="<?= htmlspecialchars($currentSettings['footer_social_youtube']) ?>" target="_blank">üì∫</a>';
            <?php endif; ?>

            <?php if (!empty($currentSettings['footer_social_instagram'])): ?>
                socialHtml += '<a href="<?= htmlspecialchars($currentSettings['footer_social_instagram']) ?>" target="_blank">üì∏</a>';
            <?php endif; ?>

            <?php if (!empty($currentSettings['footer_social_facebook'])): ?>
                socialHtml += '<a href="<?= htmlspecialchars($currentSettings['footer_social_facebook']) ?>" target="_blank">üë•</a>';
            <?php endif; ?>

            <?php if (!empty($currentSettings['footer_social_blog'])): ?>
                socialHtml += '<a href="<?= htmlspecialchars($currentSettings['footer_social_blog']) ?>" target="_blank">üìù</a>';
            <?php endif; ?>

            social.innerHTML = socialHtml || '<span style="color: #999; font-size: 12px;">ÏÜåÏÖú ÎßÅÌÅ¨ ÏóÜÏùå</span>';
        }

        // ÎØ∏Î¶¨Î≥¥Í∏∞ ÏÉàÎ°úÍ≥†Ïπ®
        function refreshPreview() {
            updatePreview();
            showAlert('ÎØ∏Î¶¨Î≥¥Í∏∞Í∞Ä ÏÉàÎ°úÍ≥†Ïπ®ÎêòÏóàÏäµÎãàÎã§', 'success');
        }

        // ÏïåÎ¶º ÌëúÏãú
        function showAlert(message, type) {
            const alertArea = document.getElementById('alertArea');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;

            alertArea.innerHTML = '';
            alertArea.appendChild(alert);

            setTimeout(() => {
                alert.remove();
            }, 3000);
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÎØ∏Î¶¨Î≥¥Í∏∞ Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', function() {
            updatePreview();
        });
    </script>
</body>
</html>