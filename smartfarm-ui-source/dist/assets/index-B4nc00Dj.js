(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=t(n);fetch(n.href,s)}})();var nd={exports:{}},Uo={};var $b;function gR(){if($b)return Uo;$b=1;var l=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(r,n,s){var a=null;if(s!==void 0&&(a=""+s),n.key!==void 0&&(a=""+n.key),"key"in n){s={};for(var u in n)u!=="key"&&(s[u]=n[u])}else s=n;return n=s.ref,{$$typeof:l,type:r,key:a,ref:n!==void 0?n:null,props:s}}return Uo.Fragment=e,Uo.jsx=t,Uo.jsxs=t,Uo}var Gb;function mR(){return Gb||(Gb=1,nd.exports=gR()),nd.exports}var V=mR(),sd={exports:{}},lt={};var Hb;function yR(){if(Hb)return lt;Hb=1;var l=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),n=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),a=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.for("react.activity"),m=Symbol.iterator;function v(U){return U===null||typeof U!="object"?null:(U=m&&U[m]||U["@@iterator"],typeof U=="function"?U:null)}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},b=Object.assign,E={};function x(U,N,W){this.props=U,this.context=N,this.refs=E,this.updater=W||y}x.prototype.isReactComponent={},x.prototype.setState=function(U,N){if(typeof U!="object"&&typeof U!="function"&&U!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,U,N,"setState")},x.prototype.forceUpdate=function(U){this.updater.enqueueForceUpdate(this,U,"forceUpdate")};function T(){}T.prototype=x.prototype;function A(U,N,W){this.props=U,this.context=N,this.refs=E,this.updater=W||y}var L=A.prototype=new T;L.constructor=A,b(L,x.prototype),L.isPureReactComponent=!0;var w=Array.isArray;function C(){}var I={H:null,A:null,T:null,S:null},O=Object.prototype.hasOwnProperty;function B(U,N,W){var ue=W.ref;return{$$typeof:l,type:U,key:N,ref:ue!==void 0?ue:null,props:W}}function P(U,N){return B(U.type,N,U.props)}function $(U){return typeof U=="object"&&U!==null&&U.$$typeof===l}function F(U){var N={"=":"=0",":":"=2"};return"$"+U.replace(/[=:]/g,function(W){return N[W]})}var Z=/\/+/g;function X(U,N){return typeof U=="object"&&U!==null&&U.key!=null?F(""+U.key):N.toString(36)}function q(U){switch(U.status){case"fulfilled":return U.value;case"rejected":throw U.reason;default:switch(typeof U.status=="string"?U.then(C,C):(U.status="pending",U.then(function(N){U.status==="pending"&&(U.status="fulfilled",U.value=N)},function(N){U.status==="pending"&&(U.status="rejected",U.reason=N)})),U.status){case"fulfilled":return U.value;case"rejected":throw U.reason}}throw U}function H(U,N,W,ue,ne){var Ee=typeof U;(Ee==="undefined"||Ee==="boolean")&&(U=null);var se=!1;if(U===null)se=!0;else switch(Ee){case"bigint":case"string":case"number":se=!0;break;case"object":switch(U.$$typeof){case l:case e:se=!0;break;case d:return se=U._init,H(se(U._payload),N,W,ue,ne)}}if(se)return ne=ne(U),se=ue===""?"."+X(U,0):ue,w(ne)?(W="",se!=null&&(W=se.replace(Z,"$&/")+"/"),H(ne,N,W,"",function(ce){return ce})):ne!=null&&($(ne)&&(ne=P(ne,W+(ne.key==null||U&&U.key===ne.key?"":(""+ne.key).replace(Z,"$&/")+"/")+se)),N.push(ne)),1;se=0;var J=ue===""?".":ue+":";if(w(U))for(var me=0;me<U.length;me++)ue=U[me],Ee=J+X(ue,me),se+=H(ue,N,W,Ee,ne);else if(me=v(U),typeof me=="function")for(U=me.call(U),me=0;!(ue=U.next()).done;)ue=ue.value,Ee=J+X(ue,me++),se+=H(ue,N,W,Ee,ne);else if(Ee==="object"){if(typeof U.then=="function")return H(q(U),N,W,ue,ne);throw N=String(U),Error("Objects are not valid as a React child (found: "+(N==="[object Object]"?"object with keys {"+Object.keys(U).join(", ")+"}":N)+"). If you meant to render a collection of children, use an array instead.")}return se}function K(U,N,W){if(U==null)return U;var ue=[],ne=0;return H(U,ue,"","",function(Ee){return N.call(W,Ee,ne++)}),ue}function z(U){if(U._status===-1){var N=U._result;N=N(),N.then(function(W){(U._status===0||U._status===-1)&&(U._status=1,U._result=W)},function(W){(U._status===0||U._status===-1)&&(U._status=2,U._result=W)}),U._status===-1&&(U._status=0,U._result=N)}if(U._status===1)return U._result.default;throw U._result}var ie=typeof reportError=="function"?reportError:function(U){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var N=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof U=="object"&&U!==null&&typeof U.message=="string"?String(U.message):String(U),error:U});if(!window.dispatchEvent(N))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",U);return}console.error(U)},Y={map:K,forEach:function(U,N,W){K(U,function(){N.apply(this,arguments)},W)},count:function(U){var N=0;return K(U,function(){N++}),N},toArray:function(U){return K(U,function(N){return N})||[]},only:function(U){if(!$(U))throw Error("React.Children.only expected to receive a single React element child.");return U}};return lt.Activity=p,lt.Children=Y,lt.Component=x,lt.Fragment=t,lt.Profiler=n,lt.PureComponent=A,lt.StrictMode=r,lt.Suspense=f,lt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=I,lt.__COMPILER_RUNTIME={__proto__:null,c:function(U){return I.H.useMemoCache(U)}},lt.cache=function(U){return function(){return U.apply(null,arguments)}},lt.cacheSignal=function(){return null},lt.cloneElement=function(U,N,W){if(U==null)throw Error("The argument must be a React element, but you passed "+U+".");var ue=b({},U.props),ne=U.key;if(N!=null)for(Ee in N.key!==void 0&&(ne=""+N.key),N)!O.call(N,Ee)||Ee==="key"||Ee==="__self"||Ee==="__source"||Ee==="ref"&&N.ref===void 0||(ue[Ee]=N[Ee]);var Ee=arguments.length-2;if(Ee===1)ue.children=W;else if(1<Ee){for(var se=Array(Ee),J=0;J<Ee;J++)se[J]=arguments[J+2];ue.children=se}return B(U.type,ne,ue)},lt.createContext=function(U){return U={$$typeof:a,_currentValue:U,_currentValue2:U,_threadCount:0,Provider:null,Consumer:null},U.Provider=U,U.Consumer={$$typeof:s,_context:U},U},lt.createElement=function(U,N,W){var ue,ne={},Ee=null;if(N!=null)for(ue in N.key!==void 0&&(Ee=""+N.key),N)O.call(N,ue)&&ue!=="key"&&ue!=="__self"&&ue!=="__source"&&(ne[ue]=N[ue]);var se=arguments.length-2;if(se===1)ne.children=W;else if(1<se){for(var J=Array(se),me=0;me<se;me++)J[me]=arguments[me+2];ne.children=J}if(U&&U.defaultProps)for(ue in se=U.defaultProps,se)ne[ue]===void 0&&(ne[ue]=se[ue]);return B(U,Ee,ne)},lt.createRef=function(){return{current:null}},lt.forwardRef=function(U){return{$$typeof:u,render:U}},lt.isValidElement=$,lt.lazy=function(U){return{$$typeof:d,_payload:{_status:-1,_result:U},_init:z}},lt.memo=function(U,N){return{$$typeof:c,type:U,compare:N===void 0?null:N}},lt.startTransition=function(U){var N=I.T,W={};I.T=W;try{var ue=U(),ne=I.S;ne!==null&&ne(W,ue),typeof ue=="object"&&ue!==null&&typeof ue.then=="function"&&ue.then(C,ie)}catch(Ee){ie(Ee)}finally{N!==null&&W.types!==null&&(N.types=W.types),I.T=N}},lt.unstable_useCacheRefresh=function(){return I.H.useCacheRefresh()},lt.use=function(U){return I.H.use(U)},lt.useActionState=function(U,N,W){return I.H.useActionState(U,N,W)},lt.useCallback=function(U,N){return I.H.useCallback(U,N)},lt.useContext=function(U){return I.H.useContext(U)},lt.useDebugValue=function(){},lt.useDeferredValue=function(U,N){return I.H.useDeferredValue(U,N)},lt.useEffect=function(U,N){return I.H.useEffect(U,N)},lt.useEffectEvent=function(U){return I.H.useEffectEvent(U)},lt.useId=function(){return I.H.useId()},lt.useImperativeHandle=function(U,N,W){return I.H.useImperativeHandle(U,N,W)},lt.useInsertionEffect=function(U,N){return I.H.useInsertionEffect(U,N)},lt.useLayoutEffect=function(U,N){return I.H.useLayoutEffect(U,N)},lt.useMemo=function(U,N){return I.H.useMemo(U,N)},lt.useOptimistic=function(U,N){return I.H.useOptimistic(U,N)},lt.useReducer=function(U,N,W){return I.H.useReducer(U,N,W)},lt.useRef=function(U){return I.H.useRef(U)},lt.useState=function(U){return I.H.useState(U)},lt.useSyncExternalStore=function(U,N,W){return I.H.useSyncExternalStore(U,N,W)},lt.useTransition=function(){return I.H.useTransition()},lt.version="19.2.0",lt}var Kb;function om(){return Kb||(Kb=1,sd.exports=yR()),sd.exports}var Le=om(),ad={exports:{}},Bo={},od={exports:{}},ld={};var Vb;function vR(){return Vb||(Vb=1,(function(l){function e(H,K){var z=H.length;H.push(K);e:for(;0<z;){var ie=z-1>>>1,Y=H[ie];if(0<n(Y,K))H[ie]=K,H[z]=Y,z=ie;else break e}}function t(H){return H.length===0?null:H[0]}function r(H){if(H.length===0)return null;var K=H[0],z=H.pop();if(z!==K){H[0]=z;e:for(var ie=0,Y=H.length,U=Y>>>1;ie<U;){var N=2*(ie+1)-1,W=H[N],ue=N+1,ne=H[ue];if(0>n(W,z))ue<Y&&0>n(ne,W)?(H[ie]=ne,H[ue]=z,ie=ue):(H[ie]=W,H[N]=z,ie=N);else if(ue<Y&&0>n(ne,z))H[ie]=ne,H[ue]=z,ie=ue;else break e}}return K}function n(H,K){var z=H.sortIndex-K.sortIndex;return z!==0?z:H.id-K.id}if(l.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;l.unstable_now=function(){return s.now()}}else{var a=Date,u=a.now();l.unstable_now=function(){return a.now()-u}}var f=[],c=[],d=1,p=null,m=3,v=!1,y=!1,b=!1,E=!1,x=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,A=typeof setImmediate<"u"?setImmediate:null;function L(H){for(var K=t(c);K!==null;){if(K.callback===null)r(c);else if(K.startTime<=H)r(c),K.sortIndex=K.expirationTime,e(f,K);else break;K=t(c)}}function w(H){if(b=!1,L(H),!y)if(t(f)!==null)y=!0,C||(C=!0,F());else{var K=t(c);K!==null&&q(w,K.startTime-H)}}var C=!1,I=-1,O=5,B=-1;function P(){return E?!0:!(l.unstable_now()-B<O)}function $(){if(E=!1,C){var H=l.unstable_now();B=H;var K=!0;try{e:{y=!1,b&&(b=!1,T(I),I=-1),v=!0;var z=m;try{t:{for(L(H),p=t(f);p!==null&&!(p.expirationTime>H&&P());){var ie=p.callback;if(typeof ie=="function"){p.callback=null,m=p.priorityLevel;var Y=ie(p.expirationTime<=H);if(H=l.unstable_now(),typeof Y=="function"){p.callback=Y,L(H),K=!0;break t}p===t(f)&&r(f),L(H)}else r(f);p=t(f)}if(p!==null)K=!0;else{var U=t(c);U!==null&&q(w,U.startTime-H),K=!1}}break e}finally{p=null,m=z,v=!1}K=void 0}}finally{K?F():C=!1}}}var F;if(typeof A=="function")F=function(){A($)};else if(typeof MessageChannel<"u"){var Z=new MessageChannel,X=Z.port2;Z.port1.onmessage=$,F=function(){X.postMessage(null)}}else F=function(){x($,0)};function q(H,K){I=x(function(){H(l.unstable_now())},K)}l.unstable_IdlePriority=5,l.unstable_ImmediatePriority=1,l.unstable_LowPriority=4,l.unstable_NormalPriority=3,l.unstable_Profiling=null,l.unstable_UserBlockingPriority=2,l.unstable_cancelCallback=function(H){H.callback=null},l.unstable_forceFrameRate=function(H){0>H||125<H?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):O=0<H?Math.floor(1e3/H):5},l.unstable_getCurrentPriorityLevel=function(){return m},l.unstable_next=function(H){switch(m){case 1:case 2:case 3:var K=3;break;default:K=m}var z=m;m=K;try{return H()}finally{m=z}},l.unstable_requestPaint=function(){E=!0},l.unstable_runWithPriority=function(H,K){switch(H){case 1:case 2:case 3:case 4:case 5:break;default:H=3}var z=m;m=H;try{return K()}finally{m=z}},l.unstable_scheduleCallback=function(H,K,z){var ie=l.unstable_now();switch(typeof z=="object"&&z!==null?(z=z.delay,z=typeof z=="number"&&0<z?ie+z:ie):z=ie,H){case 1:var Y=-1;break;case 2:Y=250;break;case 5:Y=1073741823;break;case 4:Y=1e4;break;default:Y=5e3}return Y=z+Y,H={id:d++,callback:K,priorityLevel:H,startTime:z,expirationTime:Y,sortIndex:-1},z>ie?(H.sortIndex=z,e(c,H),t(f)===null&&H===t(c)&&(b?(T(I),I=-1):b=!0,q(w,z-ie))):(H.sortIndex=Y,e(f,H),y||v||(y=!0,C||(C=!0,F()))),H},l.unstable_shouldYield=P,l.unstable_wrapCallback=function(H){var K=m;return function(){var z=m;m=K;try{return H.apply(this,arguments)}finally{m=z}}}})(ld)),ld}var zb;function bR(){return zb||(zb=1,od.exports=vR()),od.exports}var ud={exports:{}},Er={};var qb;function ER(){if(qb)return Er;qb=1;var l=om();function e(f){var c="https://react.dev/errors/"+f;if(1<arguments.length){c+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)c+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+f+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var r={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},n=Symbol.for("react.portal");function s(f,c,d){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:n,key:p==null?null:""+p,children:f,containerInfo:c,implementation:d}}var a=l.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(f,c){if(f==="font")return"";if(typeof c=="string")return c==="use-credentials"?c:""}return Er.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Er.createPortal=function(f,c){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11)throw Error(e(299));return s(f,c,null,d)},Er.flushSync=function(f){var c=a.T,d=r.p;try{if(a.T=null,r.p=2,f)return f()}finally{a.T=c,r.p=d,r.d.f()}},Er.preconnect=function(f,c){typeof f=="string"&&(c?(c=c.crossOrigin,c=typeof c=="string"?c==="use-credentials"?c:"":void 0):c=null,r.d.C(f,c))},Er.prefetchDNS=function(f){typeof f=="string"&&r.d.D(f)},Er.preinit=function(f,c){if(typeof f=="string"&&c&&typeof c.as=="string"){var d=c.as,p=u(d,c.crossOrigin),m=typeof c.integrity=="string"?c.integrity:void 0,v=typeof c.fetchPriority=="string"?c.fetchPriority:void 0;d==="style"?r.d.S(f,typeof c.precedence=="string"?c.precedence:void 0,{crossOrigin:p,integrity:m,fetchPriority:v}):d==="script"&&r.d.X(f,{crossOrigin:p,integrity:m,fetchPriority:v,nonce:typeof c.nonce=="string"?c.nonce:void 0})}},Er.preinitModule=function(f,c){if(typeof f=="string")if(typeof c=="object"&&c!==null){if(c.as==null||c.as==="script"){var d=u(c.as,c.crossOrigin);r.d.M(f,{crossOrigin:d,integrity:typeof c.integrity=="string"?c.integrity:void 0,nonce:typeof c.nonce=="string"?c.nonce:void 0})}}else c==null&&r.d.M(f)},Er.preload=function(f,c){if(typeof f=="string"&&typeof c=="object"&&c!==null&&typeof c.as=="string"){var d=c.as,p=u(d,c.crossOrigin);r.d.L(f,d,{crossOrigin:p,integrity:typeof c.integrity=="string"?c.integrity:void 0,nonce:typeof c.nonce=="string"?c.nonce:void 0,type:typeof c.type=="string"?c.type:void 0,fetchPriority:typeof c.fetchPriority=="string"?c.fetchPriority:void 0,referrerPolicy:typeof c.referrerPolicy=="string"?c.referrerPolicy:void 0,imageSrcSet:typeof c.imageSrcSet=="string"?c.imageSrcSet:void 0,imageSizes:typeof c.imageSizes=="string"?c.imageSizes:void 0,media:typeof c.media=="string"?c.media:void 0})}},Er.preloadModule=function(f,c){if(typeof f=="string")if(c){var d=u(c.as,c.crossOrigin);r.d.m(f,{as:typeof c.as=="string"&&c.as!=="script"?c.as:void 0,crossOrigin:d,integrity:typeof c.integrity=="string"?c.integrity:void 0})}else r.d.m(f)},Er.requestFormReset=function(f){r.d.r(f)},Er.unstable_batchedUpdates=function(f,c){return f(c)},Er.useFormState=function(f,c,d){return a.H.useFormState(f,c,d)},Er.useFormStatus=function(){return a.H.useHostTransitionStatus()},Er.version="19.2.0",Er}var Yb;function SR(){if(Yb)return ud.exports;Yb=1;function l(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(l)}catch(e){console.error(e)}}return l(),ud.exports=ER(),ud.exports}var Wb;function TR(){if(Wb)return Bo;Wb=1;var l=bR(),e=om(),t=SR();function r(i){var o="https://react.dev/errors/"+i;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var h=2;h<arguments.length;h++)o+="&args[]="+encodeURIComponent(arguments[h])}return"Minified React error #"+i+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function s(i){var o=i,h=i;if(i.alternate)for(;o.return;)o=o.return;else{i=o;do o=i,(o.flags&4098)!==0&&(h=o.return),i=o.return;while(i)}return o.tag===3?h:null}function a(i){if(i.tag===13){var o=i.memoizedState;if(o===null&&(i=i.alternate,i!==null&&(o=i.memoizedState)),o!==null)return o.dehydrated}return null}function u(i){if(i.tag===31){var o=i.memoizedState;if(o===null&&(i=i.alternate,i!==null&&(o=i.memoizedState)),o!==null)return o.dehydrated}return null}function f(i){if(s(i)!==i)throw Error(r(188))}function c(i){var o=i.alternate;if(!o){if(o=s(i),o===null)throw Error(r(188));return o!==i?null:i}for(var h=i,g=o;;){var S=h.return;if(S===null)break;var _=S.alternate;if(_===null){if(g=S.return,g!==null){h=g;continue}break}if(S.child===_.child){for(_=S.child;_;){if(_===h)return f(S),i;if(_===g)return f(S),o;_=_.sibling}throw Error(r(188))}if(h.return!==g.return)h=S,g=_;else{for(var k=!1,G=S.child;G;){if(G===h){k=!0,h=S,g=_;break}if(G===g){k=!0,g=S,h=_;break}G=G.sibling}if(!k){for(G=_.child;G;){if(G===h){k=!0,h=_,g=S;break}if(G===g){k=!0,g=_,h=S;break}G=G.sibling}if(!k)throw Error(r(189))}}if(h.alternate!==g)throw Error(r(190))}if(h.tag!==3)throw Error(r(188));return h.stateNode.current===h?i:o}function d(i){var o=i.tag;if(o===5||o===26||o===27||o===6)return i;for(i=i.child;i!==null;){if(o=d(i),o!==null)return o;i=i.sibling}return null}var p=Object.assign,m=Symbol.for("react.element"),v=Symbol.for("react.transitional.element"),y=Symbol.for("react.portal"),b=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),x=Symbol.for("react.profiler"),T=Symbol.for("react.consumer"),A=Symbol.for("react.context"),L=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),C=Symbol.for("react.suspense_list"),I=Symbol.for("react.memo"),O=Symbol.for("react.lazy"),B=Symbol.for("react.activity"),P=Symbol.for("react.memo_cache_sentinel"),$=Symbol.iterator;function F(i){return i===null||typeof i!="object"?null:(i=$&&i[$]||i["@@iterator"],typeof i=="function"?i:null)}var Z=Symbol.for("react.client.reference");function X(i){if(i==null)return null;if(typeof i=="function")return i.$$typeof===Z?null:i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case b:return"Fragment";case x:return"Profiler";case E:return"StrictMode";case w:return"Suspense";case C:return"SuspenseList";case B:return"Activity"}if(typeof i=="object")switch(i.$$typeof){case y:return"Portal";case A:return i.displayName||"Context";case T:return(i._context.displayName||"Context")+".Consumer";case L:var o=i.render;return i=i.displayName,i||(i=o.displayName||o.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case I:return o=i.displayName||null,o!==null?o:X(i.type)||"Memo";case O:o=i._payload,i=i._init;try{return X(i(o))}catch{}}return null}var q=Array.isArray,H=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,K=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,z={pending:!1,data:null,method:null,action:null},ie=[],Y=-1;function U(i){return{current:i}}function N(i){0>Y||(i.current=ie[Y],ie[Y]=null,Y--)}function W(i,o){Y++,ie[Y]=i.current,i.current=o}var ue=U(null),ne=U(null),Ee=U(null),se=U(null);function J(i,o){switch(W(Ee,o),W(ne,i),W(ue,null),o.nodeType){case 9:case 11:i=(i=o.documentElement)&&(i=i.namespaceURI)?cb(i):0;break;default:if(i=o.tagName,o=o.namespaceURI)o=cb(o),i=fb(o,i);else switch(i){case"svg":i=1;break;case"math":i=2;break;default:i=0}}N(ue),W(ue,i)}function me(){N(ue),N(ne),N(Ee)}function ce(i){i.memoizedState!==null&&W(se,i);var o=ue.current,h=fb(o,i.type);o!==h&&(W(ne,i),W(ue,h))}function he(i){ne.current===i&&(N(ue),N(ne)),se.current===i&&(N(se),ko._currentValue=z)}var pe,Fe;function Re(i){if(pe===void 0)try{throw Error()}catch(h){var o=h.stack.trim().match(/\n( *(at )?)/);pe=o&&o[1]||"",Fe=-1<h.stack.indexOf(`
    at`)?" (<anonymous>)":-1<h.stack.indexOf("@")?"@unknown:0:0":""}return`
`+pe+i+Fe}var ee=!1;function te(i,o){if(!i||ee)return"";ee=!0;var h=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var g={DetermineComponentFrameRoot:function(){try{if(o){var He=function(){throw Error()};if(Object.defineProperty(He.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(He,[])}catch(Oe){var we=Oe}Reflect.construct(i,[],He)}else{try{He.call()}catch(Oe){we=Oe}i.call(He.prototype)}}else{try{throw Error()}catch(Oe){we=Oe}(He=i())&&typeof He.catch=="function"&&He.catch(function(){})}}catch(Oe){if(Oe&&we&&typeof Oe.stack=="string")return[Oe.stack,we.stack]}return[null,null]}};g.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var S=Object.getOwnPropertyDescriptor(g.DetermineComponentFrameRoot,"name");S&&S.configurable&&Object.defineProperty(g.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var _=g.DetermineComponentFrameRoot(),k=_[0],G=_[1];if(k&&G){var oe=k.split(`
`),_e=G.split(`
`);for(S=g=0;g<oe.length&&!oe[g].includes("DetermineComponentFrameRoot");)g++;for(;S<_e.length&&!_e[S].includes("DetermineComponentFrameRoot");)S++;if(g===oe.length||S===_e.length)for(g=oe.length-1,S=_e.length-1;1<=g&&0<=S&&oe[g]!==_e[S];)S--;for(;1<=g&&0<=S;g--,S--)if(oe[g]!==_e[S]){if(g!==1||S!==1)do if(g--,S--,0>S||oe[g]!==_e[S]){var Be=`
`+oe[g].replace(" at new "," at ");return i.displayName&&Be.includes("<anonymous>")&&(Be=Be.replace("<anonymous>",i.displayName)),Be}while(1<=g&&0<=S);break}}}finally{ee=!1,Error.prepareStackTrace=h}return(h=i?i.displayName||i.name:"")?Re(h):""}function ge(i,o){switch(i.tag){case 26:case 27:case 5:return Re(i.type);case 16:return Re("Lazy");case 13:return i.child!==o&&o!==null?Re("Suspense Fallback"):Re("Suspense");case 19:return Re("SuspenseList");case 0:case 15:return te(i.type,!1);case 11:return te(i.type.render,!1);case 1:return te(i.type,!0);case 31:return Re("Activity");default:return""}}function Ie(i){try{var o="",h=null;do o+=ge(i,h),h=i,i=i.return;while(i);return o}catch(g){return`
Error generating stack: `+g.message+`
`+g.stack}}var Ce=Object.prototype.hasOwnProperty,Ue=l.unstable_scheduleCallback,le=l.unstable_cancelCallback,Ne=l.unstable_shouldYield,Ke=l.unstable_requestPaint,Ae=l.unstable_now,nt=l.unstable_getCurrentPriorityLevel,R=l.unstable_ImmediatePriority,D=l.unstable_UserBlockingPriority,j=l.unstable_NormalPriority,ae=l.unstable_LowPriority,ye=l.unstable_IdlePriority,De=l.log,ze=l.unstable_setDisableYieldValue,de=null,Te=null;function Ze(i){if(typeof De=="function"&&ze(i),Te&&typeof Te.setStrictMode=="function")try{Te.setStrictMode(de,i)}catch{}}var We=Math.clz32?Math.clz32:ai,at=Math.log,ut=Math.LN2;function ai(i){return i>>>=0,i===0?32:31-(at(i)/ut|0)|0}var _r=256,Yt=262144,Ar=4194304;function Dr(i){var o=i&42;if(o!==0)return o;switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return i&261888;case 262144:case 524288:case 1048576:case 2097152:return i&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return i&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return i}}function wr(i,o,h){var g=i.pendingLanes;if(g===0)return 0;var S=0,_=i.suspendedLanes,k=i.pingedLanes;i=i.warmLanes;var G=g&134217727;return G!==0?(g=G&~_,g!==0?S=Dr(g):(k&=G,k!==0?S=Dr(k):h||(h=G&~i,h!==0&&(S=Dr(h))))):(G=g&~_,G!==0?S=Dr(G):k!==0?S=Dr(k):h||(h=g&~i,h!==0&&(S=Dr(h)))),S===0?0:o!==0&&o!==S&&(o&_)===0&&(_=S&-S,h=o&-o,_>=h||_===32&&(h&4194048)!==0)?o:S}function rr(i,o){return(i.pendingLanes&~(i.suspendedLanes&~i.pingedLanes)&o)===0}function $s(i,o){switch(i){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Gi(){var i=Ar;return Ar<<=1,(Ar&62914560)===0&&(Ar=4194304),i}function Hi(i){for(var o=[],h=0;31>h;h++)o.push(i);return o}function Q(i,o){i.pendingLanes|=o,o!==268435456&&(i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0)}function re(i,o,h,g,S,_){var k=i.pendingLanes;i.pendingLanes=h,i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0,i.expiredLanes&=h,i.entangledLanes&=h,i.errorRecoveryDisabledLanes&=h,i.shellSuspendCounter=0;var G=i.entanglements,oe=i.expirationTimes,_e=i.hiddenUpdates;for(h=k&~h;0<h;){var Be=31-We(h),He=1<<Be;G[Be]=0,oe[Be]=-1;var we=_e[Be];if(we!==null)for(_e[Be]=null,Be=0;Be<we.length;Be++){var Oe=we[Be];Oe!==null&&(Oe.lane&=-536870913)}h&=~He}g!==0&&Ve(i,g,0),_!==0&&S===0&&i.tag!==0&&(i.suspendedLanes|=_&~(k&~o))}function Ve(i,o,h){i.pendingLanes|=o,i.suspendedLanes&=~o;var g=31-We(o);i.entangledLanes|=o,i.entanglements[g]=i.entanglements[g]|1073741824|h&261930}function qe(i,o){var h=i.entangledLanes|=o;for(i=i.entanglements;h;){var g=31-We(h),S=1<<g;S&o|i[g]&o&&(i[g]|=o),h&=~S}}function Qe(i,o){var h=o&-o;return h=(h&42)!==0?1:Ft(h),(h&(i.suspendedLanes|o))!==0?0:h}function Ft(i){switch(i){case 2:i=1;break;case 8:i=4;break;case 32:i=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:i=128;break;case 268435456:i=134217728;break;default:i=0}return i}function ir(i){return i&=-i,2<i?8<i?(i&134217727)!==0?32:268435456:8:2}function Or(){var i=K.p;return i!==0?i:(i=window.event,i===void 0?32:Mb(i.type))}function wn(i,o){var h=K.p;try{return K.p=i,o()}finally{K.p=h}}var kr=Math.random().toString(36).slice(2),jt="__reactFiber$"+kr,nr="__reactProps$"+kr,Mr="__reactContainer$"+kr,Pr="__reactEvents$"+kr,Ai="__reactListeners$"+kr,Ki="__reactHandles$"+kr,zr="__reactResources$"+kr,Rr="__reactMarker$"+kr;function Wc(i){delete i[jt],delete i[nr],delete i[Pr],delete i[Ai],delete i[Ki]}function Gs(i){var o=i[jt];if(o)return o;for(var h=i.parentNode;h;){if(o=h[Mr]||h[jt]){if(h=o.alternate,o.child!==null||h!==null&&h.child!==null)for(i=vb(i);i!==null;){if(h=i[jt])return h;i=vb(i)}return o}i=h,h=i.parentNode}return null}function Hs(i){if(i=i[jt]||i[Mr]){var o=i.tag;if(o===5||o===6||o===13||o===31||o===26||o===27||o===3)return i}return null}function Ya(i){var o=i.tag;if(o===5||o===26||o===27||o===6)return i.stateNode;throw Error(r(33))}function Ks(i){var o=i[zr];return o||(o=i[zr]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function lr(i){i[Rr]=!0}var Zm=new Set,Jm={};function cs(i,o){Vs(i,o),Vs(i+"Capture",o)}function Vs(i,o){for(Jm[i]=o,i=0;i<o.length;i++)Zm.add(o[i])}var a1=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),e0={},t0={};function o1(i){return Ce.call(t0,i)?!0:Ce.call(e0,i)?!1:a1.test(i)?t0[i]=!0:(e0[i]=!0,!1)}function fl(i,o,h){if(o1(o))if(h===null)i.removeAttribute(o);else{switch(typeof h){case"undefined":case"function":case"symbol":i.removeAttribute(o);return;case"boolean":var g=o.toLowerCase().slice(0,5);if(g!=="data-"&&g!=="aria-"){i.removeAttribute(o);return}}i.setAttribute(o,""+h)}}function hl(i,o,h){if(h===null)i.removeAttribute(o);else{switch(typeof h){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(o);return}i.setAttribute(o,""+h)}}function Vi(i,o,h,g){if(g===null)i.removeAttribute(h);else{switch(typeof g){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(h);return}i.setAttributeNS(o,h,""+g)}}function oi(i){switch(typeof i){case"bigint":case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function r0(i){var o=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function l1(i,o,h){var g=Object.getOwnPropertyDescriptor(i.constructor.prototype,o);if(!i.hasOwnProperty(o)&&typeof g<"u"&&typeof g.get=="function"&&typeof g.set=="function"){var S=g.get,_=g.set;return Object.defineProperty(i,o,{configurable:!0,get:function(){return S.call(this)},set:function(k){h=""+k,_.call(this,k)}}),Object.defineProperty(i,o,{enumerable:g.enumerable}),{getValue:function(){return h},setValue:function(k){h=""+k},stopTracking:function(){i._valueTracker=null,delete i[o]}}}}function Qc(i){if(!i._valueTracker){var o=r0(i)?"checked":"value";i._valueTracker=l1(i,o,""+i[o])}}function i0(i){if(!i)return!1;var o=i._valueTracker;if(!o)return!0;var h=o.getValue(),g="";return i&&(g=r0(i)?i.checked?"true":"false":i.value),i=g,i!==h?(o.setValue(i),!0):!1}function dl(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}var u1=/[\n"\\]/g;function li(i){return i.replace(u1,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function Xc(i,o,h,g,S,_,k,G){i.name="",k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"?i.type=k:i.removeAttribute("type"),o!=null?k==="number"?(o===0&&i.value===""||i.value!=o)&&(i.value=""+oi(o)):i.value!==""+oi(o)&&(i.value=""+oi(o)):k!=="submit"&&k!=="reset"||i.removeAttribute("value"),o!=null?Zc(i,k,oi(o)):h!=null?Zc(i,k,oi(h)):g!=null&&i.removeAttribute("value"),S==null&&_!=null&&(i.defaultChecked=!!_),S!=null&&(i.checked=S&&typeof S!="function"&&typeof S!="symbol"),G!=null&&typeof G!="function"&&typeof G!="symbol"&&typeof G!="boolean"?i.name=""+oi(G):i.removeAttribute("name")}function n0(i,o,h,g,S,_,k,G){if(_!=null&&typeof _!="function"&&typeof _!="symbol"&&typeof _!="boolean"&&(i.type=_),o!=null||h!=null){if(!(_!=="submit"&&_!=="reset"||o!=null)){Qc(i);return}h=h!=null?""+oi(h):"",o=o!=null?""+oi(o):h,G||o===i.value||(i.value=o),i.defaultValue=o}g=g??S,g=typeof g!="function"&&typeof g!="symbol"&&!!g,i.checked=G?i.checked:!!g,i.defaultChecked=!!g,k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"&&(i.name=k),Qc(i)}function Zc(i,o,h){o==="number"&&dl(i.ownerDocument)===i||i.defaultValue===""+h||(i.defaultValue=""+h)}function zs(i,o,h,g){if(i=i.options,o){o={};for(var S=0;S<h.length;S++)o["$"+h[S]]=!0;for(h=0;h<i.length;h++)S=o.hasOwnProperty("$"+i[h].value),i[h].selected!==S&&(i[h].selected=S),S&&g&&(i[h].defaultSelected=!0)}else{for(h=""+oi(h),o=null,S=0;S<i.length;S++){if(i[S].value===h){i[S].selected=!0,g&&(i[S].defaultSelected=!0);return}o!==null||i[S].disabled||(o=i[S])}o!==null&&(o.selected=!0)}}function s0(i,o,h){if(o!=null&&(o=""+oi(o),o!==i.value&&(i.value=o),h==null)){i.defaultValue!==o&&(i.defaultValue=o);return}i.defaultValue=h!=null?""+oi(h):""}function a0(i,o,h,g){if(o==null){if(g!=null){if(h!=null)throw Error(r(92));if(q(g)){if(1<g.length)throw Error(r(93));g=g[0]}h=g}h==null&&(h=""),o=h}h=oi(o),i.defaultValue=h,g=i.textContent,g===h&&g!==""&&g!==null&&(i.value=g),Qc(i)}function qs(i,o){if(o){var h=i.firstChild;if(h&&h===i.lastChild&&h.nodeType===3){h.nodeValue=o;return}}i.textContent=o}var c1=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function o0(i,o,h){var g=o.indexOf("--")===0;h==null||typeof h=="boolean"||h===""?g?i.setProperty(o,""):o==="float"?i.cssFloat="":i[o]="":g?i.setProperty(o,h):typeof h!="number"||h===0||c1.has(o)?o==="float"?i.cssFloat=h:i[o]=(""+h).trim():i[o]=h+"px"}function l0(i,o,h){if(o!=null&&typeof o!="object")throw Error(r(62));if(i=i.style,h!=null){for(var g in h)!h.hasOwnProperty(g)||o!=null&&o.hasOwnProperty(g)||(g.indexOf("--")===0?i.setProperty(g,""):g==="float"?i.cssFloat="":i[g]="");for(var S in o)g=o[S],o.hasOwnProperty(S)&&h[S]!==g&&o0(i,S,g)}else for(var _ in o)o.hasOwnProperty(_)&&o0(i,_,o[_])}function Jc(i){if(i.indexOf("-")===-1)return!1;switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var f1=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),h1=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function pl(i){return h1.test(""+i)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":i}function zi(){}var ef=null;function tf(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var Ys=null,Ws=null;function u0(i){var o=Hs(i);if(o&&(i=o.stateNode)){var h=i[nr]||null;e:switch(i=o.stateNode,o.type){case"input":if(Xc(i,h.value,h.defaultValue,h.defaultValue,h.checked,h.defaultChecked,h.type,h.name),o=h.name,h.type==="radio"&&o!=null){for(h=i;h.parentNode;)h=h.parentNode;for(h=h.querySelectorAll('input[name="'+li(""+o)+'"][type="radio"]'),o=0;o<h.length;o++){var g=h[o];if(g!==i&&g.form===i.form){var S=g[nr]||null;if(!S)throw Error(r(90));Xc(g,S.value,S.defaultValue,S.defaultValue,S.checked,S.defaultChecked,S.type,S.name)}}for(o=0;o<h.length;o++)g=h[o],g.form===i.form&&i0(g)}break e;case"textarea":s0(i,h.value,h.defaultValue);break e;case"select":o=h.value,o!=null&&zs(i,!!h.multiple,o,!1)}}}var rf=!1;function c0(i,o,h){if(rf)return i(o,h);rf=!0;try{var g=i(o);return g}finally{if(rf=!1,(Ys!==null||Ws!==null)&&(tu(),Ys&&(o=Ys,i=Ws,Ws=Ys=null,u0(o),i)))for(o=0;o<i.length;o++)u0(i[o])}}function Wa(i,o){var h=i.stateNode;if(h===null)return null;var g=h[nr]||null;if(g===null)return null;h=g[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(g=!g.disabled)||(i=i.type,g=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!g;break e;default:i=!1}if(i)return null;if(h&&typeof h!="function")throw Error(r(231,o,typeof h));return h}var qi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),nf=!1;if(qi)try{var Qa={};Object.defineProperty(Qa,"passive",{get:function(){nf=!0}}),window.addEventListener("test",Qa,Qa),window.removeEventListener("test",Qa,Qa)}catch{nf=!1}var Rn=null,sf=null,gl=null;function f0(){if(gl)return gl;var i,o=sf,h=o.length,g,S="value"in Rn?Rn.value:Rn.textContent,_=S.length;for(i=0;i<h&&o[i]===S[i];i++);var k=h-i;for(g=1;g<=k&&o[h-g]===S[_-g];g++);return gl=S.slice(i,1<g?1-g:void 0)}function ml(i){var o=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&o===13&&(i=13)):i=o,i===10&&(i=13),32<=i||i===13?i:0}function yl(){return!0}function h0(){return!1}function Nr(i){function o(h,g,S,_,k){this._reactName=h,this._targetInst=S,this.type=g,this.nativeEvent=_,this.target=k,this.currentTarget=null;for(var G in i)i.hasOwnProperty(G)&&(h=i[G],this[G]=h?h(_):_[G]);return this.isDefaultPrevented=(_.defaultPrevented!=null?_.defaultPrevented:_.returnValue===!1)?yl:h0,this.isPropagationStopped=h0,this}return p(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var h=this.nativeEvent;h&&(h.preventDefault?h.preventDefault():typeof h.returnValue!="unknown"&&(h.returnValue=!1),this.isDefaultPrevented=yl)},stopPropagation:function(){var h=this.nativeEvent;h&&(h.stopPropagation?h.stopPropagation():typeof h.cancelBubble!="unknown"&&(h.cancelBubble=!0),this.isPropagationStopped=yl)},persist:function(){},isPersistent:yl}),o}var fs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},vl=Nr(fs),Xa=p({},fs,{view:0,detail:0}),d1=Nr(Xa),af,of,Za,bl=p({},Xa,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:uf,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==Za&&(Za&&i.type==="mousemove"?(af=i.screenX-Za.screenX,of=i.screenY-Za.screenY):of=af=0,Za=i),af)},movementY:function(i){return"movementY"in i?i.movementY:of}}),d0=Nr(bl),p1=p({},bl,{dataTransfer:0}),g1=Nr(p1),m1=p({},Xa,{relatedTarget:0}),lf=Nr(m1),y1=p({},fs,{animationName:0,elapsedTime:0,pseudoElement:0}),v1=Nr(y1),b1=p({},fs,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),E1=Nr(b1),S1=p({},fs,{data:0}),p0=Nr(S1),T1={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},x1={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},_1={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function A1(i){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(i):(i=_1[i])?!!o[i]:!1}function uf(){return A1}var w1=p({},Xa,{key:function(i){if(i.key){var o=T1[i.key]||i.key;if(o!=="Unidentified")return o}return i.type==="keypress"?(i=ml(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?x1[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:uf,charCode:function(i){return i.type==="keypress"?ml(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?ml(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),R1=Nr(w1),I1=p({},bl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),g0=Nr(I1),L1=p({},Xa,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:uf}),C1=Nr(L1),D1=p({},fs,{propertyName:0,elapsedTime:0,pseudoElement:0}),O1=Nr(D1),k1=p({},bl,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),M1=Nr(k1),P1=p({},fs,{newState:0,oldState:0}),N1=Nr(P1),U1=[9,13,27,32],cf=qi&&"CompositionEvent"in window,Ja=null;qi&&"documentMode"in document&&(Ja=document.documentMode);var B1=qi&&"TextEvent"in window&&!Ja,m0=qi&&(!cf||Ja&&8<Ja&&11>=Ja),y0=" ",v0=!1;function b0(i,o){switch(i){case"keyup":return U1.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function E0(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var Qs=!1;function F1(i,o){switch(i){case"compositionend":return E0(o);case"keypress":return o.which!==32?null:(v0=!0,y0);case"textInput":return i=o.data,i===y0&&v0?null:i;default:return null}}function j1(i,o){if(Qs)return i==="compositionend"||!cf&&b0(i,o)?(i=f0(),gl=sf=Rn=null,Qs=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return m0&&o.locale!=="ko"?null:o.data;default:return null}}var $1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function S0(i){var o=i&&i.nodeName&&i.nodeName.toLowerCase();return o==="input"?!!$1[i.type]:o==="textarea"}function T0(i,o,h,g){Ys?Ws?Ws.push(g):Ws=[g]:Ys=g,o=lu(o,"onChange"),0<o.length&&(h=new vl("onChange","change",null,h,g),i.push({event:h,listeners:o}))}var eo=null,to=null;function G1(i){nb(i,0)}function El(i){var o=Ya(i);if(i0(o))return i}function x0(i,o){if(i==="change")return o}var _0=!1;if(qi){var ff;if(qi){var hf="oninput"in document;if(!hf){var A0=document.createElement("div");A0.setAttribute("oninput","return;"),hf=typeof A0.oninput=="function"}ff=hf}else ff=!1;_0=ff&&(!document.documentMode||9<document.documentMode)}function w0(){eo&&(eo.detachEvent("onpropertychange",R0),to=eo=null)}function R0(i){if(i.propertyName==="value"&&El(to)){var o=[];T0(o,to,i,tf(i)),c0(G1,o)}}function H1(i,o,h){i==="focusin"?(w0(),eo=o,to=h,eo.attachEvent("onpropertychange",R0)):i==="focusout"&&w0()}function K1(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return El(to)}function V1(i,o){if(i==="click")return El(o)}function z1(i,o){if(i==="input"||i==="change")return El(o)}function q1(i,o){return i===o&&(i!==0||1/i===1/o)||i!==i&&o!==o}var qr=typeof Object.is=="function"?Object.is:q1;function ro(i,o){if(qr(i,o))return!0;if(typeof i!="object"||i===null||typeof o!="object"||o===null)return!1;var h=Object.keys(i),g=Object.keys(o);if(h.length!==g.length)return!1;for(g=0;g<h.length;g++){var S=h[g];if(!Ce.call(o,S)||!qr(i[S],o[S]))return!1}return!0}function I0(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function L0(i,o){var h=I0(i);i=0;for(var g;h;){if(h.nodeType===3){if(g=i+h.textContent.length,i<=o&&g>=o)return{node:h,offset:o-i};i=g}e:{for(;h;){if(h.nextSibling){h=h.nextSibling;break e}h=h.parentNode}h=void 0}h=I0(h)}}function C0(i,o){return i&&o?i===o?!0:i&&i.nodeType===3?!1:o&&o.nodeType===3?C0(i,o.parentNode):"contains"in i?i.contains(o):i.compareDocumentPosition?!!(i.compareDocumentPosition(o)&16):!1:!1}function D0(i){i=i!=null&&i.ownerDocument!=null&&i.ownerDocument.defaultView!=null?i.ownerDocument.defaultView:window;for(var o=dl(i.document);o instanceof i.HTMLIFrameElement;){try{var h=typeof o.contentWindow.location.href=="string"}catch{h=!1}if(h)i=o.contentWindow;else break;o=dl(i.document)}return o}function df(i){var o=i&&i.nodeName&&i.nodeName.toLowerCase();return o&&(o==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||o==="textarea"||i.contentEditable==="true")}var Y1=qi&&"documentMode"in document&&11>=document.documentMode,Xs=null,pf=null,io=null,gf=!1;function O0(i,o,h){var g=h.window===h?h.document:h.nodeType===9?h:h.ownerDocument;gf||Xs==null||Xs!==dl(g)||(g=Xs,"selectionStart"in g&&df(g)?g={start:g.selectionStart,end:g.selectionEnd}:(g=(g.ownerDocument&&g.ownerDocument.defaultView||window).getSelection(),g={anchorNode:g.anchorNode,anchorOffset:g.anchorOffset,focusNode:g.focusNode,focusOffset:g.focusOffset}),io&&ro(io,g)||(io=g,g=lu(pf,"onSelect"),0<g.length&&(o=new vl("onSelect","select",null,o,h),i.push({event:o,listeners:g}),o.target=Xs)))}function hs(i,o){var h={};return h[i.toLowerCase()]=o.toLowerCase(),h["Webkit"+i]="webkit"+o,h["Moz"+i]="moz"+o,h}var Zs={animationend:hs("Animation","AnimationEnd"),animationiteration:hs("Animation","AnimationIteration"),animationstart:hs("Animation","AnimationStart"),transitionrun:hs("Transition","TransitionRun"),transitionstart:hs("Transition","TransitionStart"),transitioncancel:hs("Transition","TransitionCancel"),transitionend:hs("Transition","TransitionEnd")},mf={},k0={};qi&&(k0=document.createElement("div").style,"AnimationEvent"in window||(delete Zs.animationend.animation,delete Zs.animationiteration.animation,delete Zs.animationstart.animation),"TransitionEvent"in window||delete Zs.transitionend.transition);function ds(i){if(mf[i])return mf[i];if(!Zs[i])return i;var o=Zs[i],h;for(h in o)if(o.hasOwnProperty(h)&&h in k0)return mf[i]=o[h];return i}var M0=ds("animationend"),P0=ds("animationiteration"),N0=ds("animationstart"),W1=ds("transitionrun"),Q1=ds("transitionstart"),X1=ds("transitioncancel"),U0=ds("transitionend"),B0=new Map,yf="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");yf.push("scrollEnd");function bi(i,o){B0.set(i,o),cs(o,[i])}var Sl=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)},ui=[],Js=0,vf=0;function Tl(){for(var i=Js,o=vf=Js=0;o<i;){var h=ui[o];ui[o++]=null;var g=ui[o];ui[o++]=null;var S=ui[o];ui[o++]=null;var _=ui[o];if(ui[o++]=null,g!==null&&S!==null){var k=g.pending;k===null?S.next=S:(S.next=k.next,k.next=S),g.pending=S}_!==0&&F0(h,S,_)}}function xl(i,o,h,g){ui[Js++]=i,ui[Js++]=o,ui[Js++]=h,ui[Js++]=g,vf|=g,i.lanes|=g,i=i.alternate,i!==null&&(i.lanes|=g)}function bf(i,o,h,g){return xl(i,o,h,g),_l(i)}function ps(i,o){return xl(i,null,null,o),_l(i)}function F0(i,o,h){i.lanes|=h;var g=i.alternate;g!==null&&(g.lanes|=h);for(var S=!1,_=i.return;_!==null;)_.childLanes|=h,g=_.alternate,g!==null&&(g.childLanes|=h),_.tag===22&&(i=_.stateNode,i===null||i._visibility&1||(S=!0)),i=_,_=_.return;return i.tag===3?(_=i.stateNode,S&&o!==null&&(S=31-We(h),i=_.hiddenUpdates,g=i[S],g===null?i[S]=[o]:g.push(o),o.lane=h|536870912),_):null}function _l(i){if(50<wo)throw wo=0,Ih=null,Error(r(185));for(var o=i.return;o!==null;)i=o,o=i.return;return i.tag===3?i.stateNode:null}var ea={};function Z1(i,o,h,g){this.tag=i,this.key=h,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=g,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Yr(i,o,h,g){return new Z1(i,o,h,g)}function Ef(i){return i=i.prototype,!(!i||!i.isReactComponent)}function Yi(i,o){var h=i.alternate;return h===null?(h=Yr(i.tag,o,i.key,i.mode),h.elementType=i.elementType,h.type=i.type,h.stateNode=i.stateNode,h.alternate=i,i.alternate=h):(h.pendingProps=o,h.type=i.type,h.flags=0,h.subtreeFlags=0,h.deletions=null),h.flags=i.flags&65011712,h.childLanes=i.childLanes,h.lanes=i.lanes,h.child=i.child,h.memoizedProps=i.memoizedProps,h.memoizedState=i.memoizedState,h.updateQueue=i.updateQueue,o=i.dependencies,h.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},h.sibling=i.sibling,h.index=i.index,h.ref=i.ref,h.refCleanup=i.refCleanup,h}function j0(i,o){i.flags&=65011714;var h=i.alternate;return h===null?(i.childLanes=0,i.lanes=o,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=h.childLanes,i.lanes=h.lanes,i.child=h.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=h.memoizedProps,i.memoizedState=h.memoizedState,i.updateQueue=h.updateQueue,i.type=h.type,o=h.dependencies,i.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),i}function Al(i,o,h,g,S,_){var k=0;if(g=i,typeof i=="function")Ef(i)&&(k=1);else if(typeof i=="string")k=iR(i,h,ue.current)?26:i==="html"||i==="head"||i==="body"?27:5;else e:switch(i){case B:return i=Yr(31,h,o,S),i.elementType=B,i.lanes=_,i;case b:return gs(h.children,S,_,o);case E:k=8,S|=24;break;case x:return i=Yr(12,h,o,S|2),i.elementType=x,i.lanes=_,i;case w:return i=Yr(13,h,o,S),i.elementType=w,i.lanes=_,i;case C:return i=Yr(19,h,o,S),i.elementType=C,i.lanes=_,i;default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case A:k=10;break e;case T:k=9;break e;case L:k=11;break e;case I:k=14;break e;case O:k=16,g=null;break e}k=29,h=Error(r(130,i===null?"null":typeof i,"")),g=null}return o=Yr(k,h,o,S),o.elementType=i,o.type=g,o.lanes=_,o}function gs(i,o,h,g){return i=Yr(7,i,g,o),i.lanes=h,i}function Sf(i,o,h){return i=Yr(6,i,null,o),i.lanes=h,i}function $0(i){var o=Yr(18,null,null,0);return o.stateNode=i,o}function Tf(i,o,h){return o=Yr(4,i.children!==null?i.children:[],i.key,o),o.lanes=h,o.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},o}var G0=new WeakMap;function ci(i,o){if(typeof i=="object"&&i!==null){var h=G0.get(i);return h!==void 0?h:(o={value:i,source:o,stack:Ie(o)},G0.set(i,o),o)}return{value:i,source:o,stack:Ie(o)}}var ta=[],ra=0,wl=null,no=0,fi=[],hi=0,In=null,wi=1,Ri="";function Wi(i,o){ta[ra++]=no,ta[ra++]=wl,wl=i,no=o}function H0(i,o,h){fi[hi++]=wi,fi[hi++]=Ri,fi[hi++]=In,In=i;var g=wi;i=Ri;var S=32-We(g)-1;g&=~(1<<S),h+=1;var _=32-We(o)+S;if(30<_){var k=S-S%5;_=(g&(1<<k)-1).toString(32),g>>=k,S-=k,wi=1<<32-We(o)+S|h<<S|g,Ri=_+i}else wi=1<<_|h<<S|g,Ri=i}function xf(i){i.return!==null&&(Wi(i,1),H0(i,1,0))}function _f(i){for(;i===wl;)wl=ta[--ra],ta[ra]=null,no=ta[--ra],ta[ra]=null;for(;i===In;)In=fi[--hi],fi[hi]=null,Ri=fi[--hi],fi[hi]=null,wi=fi[--hi],fi[hi]=null}function K0(i,o){fi[hi++]=wi,fi[hi++]=Ri,fi[hi++]=In,wi=o.id,Ri=o.overflow,In=i}var dr=null,Pt=null,vt=!1,Ln=null,di=!1,Af=Error(r(519));function Cn(i){var o=Error(r(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw so(ci(o,i)),Af}function V0(i){var o=i.stateNode,h=i.type,g=i.memoizedProps;switch(o[jt]=i,o[nr]=g,h){case"dialog":gt("cancel",o),gt("close",o);break;case"iframe":case"object":case"embed":gt("load",o);break;case"video":case"audio":for(h=0;h<Io.length;h++)gt(Io[h],o);break;case"source":gt("error",o);break;case"img":case"image":case"link":gt("error",o),gt("load",o);break;case"details":gt("toggle",o);break;case"input":gt("invalid",o),n0(o,g.value,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name,!0);break;case"select":gt("invalid",o);break;case"textarea":gt("invalid",o),a0(o,g.value,g.defaultValue,g.children)}h=g.children,typeof h!="string"&&typeof h!="number"&&typeof h!="bigint"||o.textContent===""+h||g.suppressHydrationWarning===!0||lb(o.textContent,h)?(g.popover!=null&&(gt("beforetoggle",o),gt("toggle",o)),g.onScroll!=null&&gt("scroll",o),g.onScrollEnd!=null&&gt("scrollend",o),g.onClick!=null&&(o.onclick=zi),o=!0):o=!1,o||Cn(i,!0)}function z0(i){for(dr=i.return;dr;)switch(dr.tag){case 5:case 31:case 13:di=!1;return;case 27:case 3:di=!0;return;default:dr=dr.return}}function ia(i){if(i!==dr)return!1;if(!vt)return z0(i),vt=!0,!1;var o=i.tag,h;if((h=o!==3&&o!==27)&&((h=o===5)&&(h=i.type,h=!(h!=="form"&&h!=="button")||Hh(i.type,i.memoizedProps)),h=!h),h&&Pt&&Cn(i),z0(i),o===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(r(317));Pt=yb(i)}else if(o===31){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(r(317));Pt=yb(i)}else o===27?(o=Pt,Kn(i.type)?(i=Yh,Yh=null,Pt=i):Pt=o):Pt=dr?gi(i.stateNode.nextSibling):null;return!0}function ms(){Pt=dr=null,vt=!1}function wf(){var i=Ln;return i!==null&&(jr===null?jr=i:jr.push.apply(jr,i),Ln=null),i}function so(i){Ln===null?Ln=[i]:Ln.push(i)}var Rf=U(null),ys=null,Qi=null;function Dn(i,o,h){W(Rf,o._currentValue),o._currentValue=h}function Xi(i){i._currentValue=Rf.current,N(Rf)}function If(i,o,h){for(;i!==null;){var g=i.alternate;if((i.childLanes&o)!==o?(i.childLanes|=o,g!==null&&(g.childLanes|=o)):g!==null&&(g.childLanes&o)!==o&&(g.childLanes|=o),i===h)break;i=i.return}}function Lf(i,o,h,g){var S=i.child;for(S!==null&&(S.return=i);S!==null;){var _=S.dependencies;if(_!==null){var k=S.child;_=_.firstContext;e:for(;_!==null;){var G=_;_=S;for(var oe=0;oe<o.length;oe++)if(G.context===o[oe]){_.lanes|=h,G=_.alternate,G!==null&&(G.lanes|=h),If(_.return,h,i),g||(k=null);break e}_=G.next}}else if(S.tag===18){if(k=S.return,k===null)throw Error(r(341));k.lanes|=h,_=k.alternate,_!==null&&(_.lanes|=h),If(k,h,i),k=null}else k=S.child;if(k!==null)k.return=S;else for(k=S;k!==null;){if(k===i){k=null;break}if(S=k.sibling,S!==null){S.return=k.return,k=S;break}k=k.return}S=k}}function na(i,o,h,g){i=null;for(var S=o,_=!1;S!==null;){if(!_){if((S.flags&524288)!==0)_=!0;else if((S.flags&262144)!==0)break}if(S.tag===10){var k=S.alternate;if(k===null)throw Error(r(387));if(k=k.memoizedProps,k!==null){var G=S.type;qr(S.pendingProps.value,k.value)||(i!==null?i.push(G):i=[G])}}else if(S===se.current){if(k=S.alternate,k===null)throw Error(r(387));k.memoizedState.memoizedState!==S.memoizedState.memoizedState&&(i!==null?i.push(ko):i=[ko])}S=S.return}i!==null&&Lf(o,i,h,g),o.flags|=262144}function Rl(i){for(i=i.firstContext;i!==null;){if(!qr(i.context._currentValue,i.memoizedValue))return!0;i=i.next}return!1}function vs(i){ys=i,Qi=null,i=i.dependencies,i!==null&&(i.firstContext=null)}function pr(i){return q0(ys,i)}function Il(i,o){return ys===null&&vs(i),q0(i,o)}function q0(i,o){var h=o._currentValue;if(o={context:o,memoizedValue:h,next:null},Qi===null){if(i===null)throw Error(r(308));Qi=o,i.dependencies={lanes:0,firstContext:o},i.flags|=524288}else Qi=Qi.next=o;return h}var J1=typeof AbortController<"u"?AbortController:function(){var i=[],o=this.signal={aborted:!1,addEventListener:function(h,g){i.push(g)}};this.abort=function(){o.aborted=!0,i.forEach(function(h){return h()})}},ew=l.unstable_scheduleCallback,tw=l.unstable_NormalPriority,Zt={$$typeof:A,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Cf(){return{controller:new J1,data:new Map,refCount:0}}function ao(i){i.refCount--,i.refCount===0&&ew(tw,function(){i.controller.abort()})}var oo=null,Df=0,sa=0,aa=null;function rw(i,o){if(oo===null){var h=oo=[];Df=0,sa=Mh(),aa={status:"pending",value:void 0,then:function(g){h.push(g)}}}return Df++,o.then(Y0,Y0),o}function Y0(){if(--Df===0&&oo!==null){aa!==null&&(aa.status="fulfilled");var i=oo;oo=null,sa=0,aa=null;for(var o=0;o<i.length;o++)(0,i[o])()}}function iw(i,o){var h=[],g={status:"pending",value:null,reason:null,then:function(S){h.push(S)}};return i.then(function(){g.status="fulfilled",g.value=o;for(var S=0;S<h.length;S++)(0,h[S])(o)},function(S){for(g.status="rejected",g.reason=S,S=0;S<h.length;S++)(0,h[S])(void 0)}),g}var W0=H.S;H.S=function(i,o){Ov=Ae(),typeof o=="object"&&o!==null&&typeof o.then=="function"&&rw(i,o),W0!==null&&W0(i,o)};var bs=U(null);function Of(){var i=bs.current;return i!==null?i:Dt.pooledCache}function Ll(i,o){o===null?W(bs,bs.current):W(bs,o.pool)}function Q0(){var i=Of();return i===null?null:{parent:Zt._currentValue,pool:i}}var oa=Error(r(460)),kf=Error(r(474)),Cl=Error(r(542)),Dl={then:function(){}};function X0(i){return i=i.status,i==="fulfilled"||i==="rejected"}function Z0(i,o,h){switch(h=i[h],h===void 0?i.push(o):h!==o&&(o.then(zi,zi),o=h),o.status){case"fulfilled":return o.value;case"rejected":throw i=o.reason,ey(i),i;default:if(typeof o.status=="string")o.then(zi,zi);else{if(i=Dt,i!==null&&100<i.shellSuspendCounter)throw Error(r(482));i=o,i.status="pending",i.then(function(g){if(o.status==="pending"){var S=o;S.status="fulfilled",S.value=g}},function(g){if(o.status==="pending"){var S=o;S.status="rejected",S.reason=g}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw i=o.reason,ey(i),i}throw Ss=o,oa}}function Es(i){try{var o=i._init;return o(i._payload)}catch(h){throw h!==null&&typeof h=="object"&&typeof h.then=="function"?(Ss=h,oa):h}}var Ss=null;function J0(){if(Ss===null)throw Error(r(459));var i=Ss;return Ss=null,i}function ey(i){if(i===oa||i===Cl)throw Error(r(483))}var la=null,lo=0;function Ol(i){var o=lo;return lo+=1,la===null&&(la=[]),Z0(la,i,o)}function uo(i,o){o=o.props.ref,i.ref=o!==void 0?o:null}function kl(i,o){throw o.$$typeof===m?Error(r(525)):(i=Object.prototype.toString.call(o),Error(r(31,i==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":i)))}function ty(i){function o(ve,fe){if(i){var xe=ve.deletions;xe===null?(ve.deletions=[fe],ve.flags|=16):xe.push(fe)}}function h(ve,fe){if(!i)return null;for(;fe!==null;)o(ve,fe),fe=fe.sibling;return null}function g(ve){for(var fe=new Map;ve!==null;)ve.key!==null?fe.set(ve.key,ve):fe.set(ve.index,ve),ve=ve.sibling;return fe}function S(ve,fe){return ve=Yi(ve,fe),ve.index=0,ve.sibling=null,ve}function _(ve,fe,xe){return ve.index=xe,i?(xe=ve.alternate,xe!==null?(xe=xe.index,xe<fe?(ve.flags|=67108866,fe):xe):(ve.flags|=67108866,fe)):(ve.flags|=1048576,fe)}function k(ve){return i&&ve.alternate===null&&(ve.flags|=67108866),ve}function G(ve,fe,xe,Ge){return fe===null||fe.tag!==6?(fe=Sf(xe,ve.mode,Ge),fe.return=ve,fe):(fe=S(fe,xe),fe.return=ve,fe)}function oe(ve,fe,xe,Ge){var rt=xe.type;return rt===b?Be(ve,fe,xe.props.children,Ge,xe.key):fe!==null&&(fe.elementType===rt||typeof rt=="object"&&rt!==null&&rt.$$typeof===O&&Es(rt)===fe.type)?(fe=S(fe,xe.props),uo(fe,xe),fe.return=ve,fe):(fe=Al(xe.type,xe.key,xe.props,null,ve.mode,Ge),uo(fe,xe),fe.return=ve,fe)}function _e(ve,fe,xe,Ge){return fe===null||fe.tag!==4||fe.stateNode.containerInfo!==xe.containerInfo||fe.stateNode.implementation!==xe.implementation?(fe=Tf(xe,ve.mode,Ge),fe.return=ve,fe):(fe=S(fe,xe.children||[]),fe.return=ve,fe)}function Be(ve,fe,xe,Ge,rt){return fe===null||fe.tag!==7?(fe=gs(xe,ve.mode,Ge,rt),fe.return=ve,fe):(fe=S(fe,xe),fe.return=ve,fe)}function He(ve,fe,xe){if(typeof fe=="string"&&fe!==""||typeof fe=="number"||typeof fe=="bigint")return fe=Sf(""+fe,ve.mode,xe),fe.return=ve,fe;if(typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case v:return xe=Al(fe.type,fe.key,fe.props,null,ve.mode,xe),uo(xe,fe),xe.return=ve,xe;case y:return fe=Tf(fe,ve.mode,xe),fe.return=ve,fe;case O:return fe=Es(fe),He(ve,fe,xe)}if(q(fe)||F(fe))return fe=gs(fe,ve.mode,xe,null),fe.return=ve,fe;if(typeof fe.then=="function")return He(ve,Ol(fe),xe);if(fe.$$typeof===A)return He(ve,Il(ve,fe),xe);kl(ve,fe)}return null}function we(ve,fe,xe,Ge){var rt=fe!==null?fe.key:null;if(typeof xe=="string"&&xe!==""||typeof xe=="number"||typeof xe=="bigint")return rt!==null?null:G(ve,fe,""+xe,Ge);if(typeof xe=="object"&&xe!==null){switch(xe.$$typeof){case v:return xe.key===rt?oe(ve,fe,xe,Ge):null;case y:return xe.key===rt?_e(ve,fe,xe,Ge):null;case O:return xe=Es(xe),we(ve,fe,xe,Ge)}if(q(xe)||F(xe))return rt!==null?null:Be(ve,fe,xe,Ge,null);if(typeof xe.then=="function")return we(ve,fe,Ol(xe),Ge);if(xe.$$typeof===A)return we(ve,fe,Il(ve,xe),Ge);kl(ve,xe)}return null}function Oe(ve,fe,xe,Ge,rt){if(typeof Ge=="string"&&Ge!==""||typeof Ge=="number"||typeof Ge=="bigint")return ve=ve.get(xe)||null,G(fe,ve,""+Ge,rt);if(typeof Ge=="object"&&Ge!==null){switch(Ge.$$typeof){case v:return ve=ve.get(Ge.key===null?xe:Ge.key)||null,oe(fe,ve,Ge,rt);case y:return ve=ve.get(Ge.key===null?xe:Ge.key)||null,_e(fe,ve,Ge,rt);case O:return Ge=Es(Ge),Oe(ve,fe,xe,Ge,rt)}if(q(Ge)||F(Ge))return ve=ve.get(xe)||null,Be(fe,ve,Ge,rt,null);if(typeof Ge.then=="function")return Oe(ve,fe,xe,Ol(Ge),rt);if(Ge.$$typeof===A)return Oe(ve,fe,xe,Il(fe,Ge),rt);kl(fe,Ge)}return null}function Je(ve,fe,xe,Ge){for(var rt=null,bt=null,et=fe,ft=fe=0,yt=null;et!==null&&ft<xe.length;ft++){et.index>ft?(yt=et,et=null):yt=et.sibling;var Et=we(ve,et,xe[ft],Ge);if(Et===null){et===null&&(et=yt);break}i&&et&&Et.alternate===null&&o(ve,et),fe=_(Et,fe,ft),bt===null?rt=Et:bt.sibling=Et,bt=Et,et=yt}if(ft===xe.length)return h(ve,et),vt&&Wi(ve,ft),rt;if(et===null){for(;ft<xe.length;ft++)et=He(ve,xe[ft],Ge),et!==null&&(fe=_(et,fe,ft),bt===null?rt=et:bt.sibling=et,bt=et);return vt&&Wi(ve,ft),rt}for(et=g(et);ft<xe.length;ft++)yt=Oe(et,ve,ft,xe[ft],Ge),yt!==null&&(i&&yt.alternate!==null&&et.delete(yt.key===null?ft:yt.key),fe=_(yt,fe,ft),bt===null?rt=yt:bt.sibling=yt,bt=yt);return i&&et.forEach(function(Wn){return o(ve,Wn)}),vt&&Wi(ve,ft),rt}function it(ve,fe,xe,Ge){if(xe==null)throw Error(r(151));for(var rt=null,bt=null,et=fe,ft=fe=0,yt=null,Et=xe.next();et!==null&&!Et.done;ft++,Et=xe.next()){et.index>ft?(yt=et,et=null):yt=et.sibling;var Wn=we(ve,et,Et.value,Ge);if(Wn===null){et===null&&(et=yt);break}i&&et&&Wn.alternate===null&&o(ve,et),fe=_(Wn,fe,ft),bt===null?rt=Wn:bt.sibling=Wn,bt=Wn,et=yt}if(Et.done)return h(ve,et),vt&&Wi(ve,ft),rt;if(et===null){for(;!Et.done;ft++,Et=xe.next())Et=He(ve,Et.value,Ge),Et!==null&&(fe=_(Et,fe,ft),bt===null?rt=Et:bt.sibling=Et,bt=Et);return vt&&Wi(ve,ft),rt}for(et=g(et);!Et.done;ft++,Et=xe.next())Et=Oe(et,ve,ft,Et.value,Ge),Et!==null&&(i&&Et.alternate!==null&&et.delete(Et.key===null?ft:Et.key),fe=_(Et,fe,ft),bt===null?rt=Et:bt.sibling=Et,bt=Et);return i&&et.forEach(function(pR){return o(ve,pR)}),vt&&Wi(ve,ft),rt}function It(ve,fe,xe,Ge){if(typeof xe=="object"&&xe!==null&&xe.type===b&&xe.key===null&&(xe=xe.props.children),typeof xe=="object"&&xe!==null){switch(xe.$$typeof){case v:e:{for(var rt=xe.key;fe!==null;){if(fe.key===rt){if(rt=xe.type,rt===b){if(fe.tag===7){h(ve,fe.sibling),Ge=S(fe,xe.props.children),Ge.return=ve,ve=Ge;break e}}else if(fe.elementType===rt||typeof rt=="object"&&rt!==null&&rt.$$typeof===O&&Es(rt)===fe.type){h(ve,fe.sibling),Ge=S(fe,xe.props),uo(Ge,xe),Ge.return=ve,ve=Ge;break e}h(ve,fe);break}else o(ve,fe);fe=fe.sibling}xe.type===b?(Ge=gs(xe.props.children,ve.mode,Ge,xe.key),Ge.return=ve,ve=Ge):(Ge=Al(xe.type,xe.key,xe.props,null,ve.mode,Ge),uo(Ge,xe),Ge.return=ve,ve=Ge)}return k(ve);case y:e:{for(rt=xe.key;fe!==null;){if(fe.key===rt)if(fe.tag===4&&fe.stateNode.containerInfo===xe.containerInfo&&fe.stateNode.implementation===xe.implementation){h(ve,fe.sibling),Ge=S(fe,xe.children||[]),Ge.return=ve,ve=Ge;break e}else{h(ve,fe);break}else o(ve,fe);fe=fe.sibling}Ge=Tf(xe,ve.mode,Ge),Ge.return=ve,ve=Ge}return k(ve);case O:return xe=Es(xe),It(ve,fe,xe,Ge)}if(q(xe))return Je(ve,fe,xe,Ge);if(F(xe)){if(rt=F(xe),typeof rt!="function")throw Error(r(150));return xe=rt.call(xe),it(ve,fe,xe,Ge)}if(typeof xe.then=="function")return It(ve,fe,Ol(xe),Ge);if(xe.$$typeof===A)return It(ve,fe,Il(ve,xe),Ge);kl(ve,xe)}return typeof xe=="string"&&xe!==""||typeof xe=="number"||typeof xe=="bigint"?(xe=""+xe,fe!==null&&fe.tag===6?(h(ve,fe.sibling),Ge=S(fe,xe),Ge.return=ve,ve=Ge):(h(ve,fe),Ge=Sf(xe,ve.mode,Ge),Ge.return=ve,ve=Ge),k(ve)):h(ve,fe)}return function(ve,fe,xe,Ge){try{lo=0;var rt=It(ve,fe,xe,Ge);return la=null,rt}catch(et){if(et===oa||et===Cl)throw et;var bt=Yr(29,et,null,ve.mode);return bt.lanes=Ge,bt.return=ve,bt}finally{}}}var Ts=ty(!0),ry=ty(!1),On=!1;function Mf(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Pf(i,o){i=i.updateQueue,o.updateQueue===i&&(o.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,callbacks:null})}function kn(i){return{lane:i,tag:0,payload:null,callback:null,next:null}}function Mn(i,o,h){var g=i.updateQueue;if(g===null)return null;if(g=g.shared,(St&2)!==0){var S=g.pending;return S===null?o.next=o:(o.next=S.next,S.next=o),g.pending=o,o=_l(i),F0(i,null,h),o}return xl(i,g,o,h),_l(i)}function co(i,o,h){if(o=o.updateQueue,o!==null&&(o=o.shared,(h&4194048)!==0)){var g=o.lanes;g&=i.pendingLanes,h|=g,o.lanes=h,qe(i,h)}}function Nf(i,o){var h=i.updateQueue,g=i.alternate;if(g!==null&&(g=g.updateQueue,h===g)){var S=null,_=null;if(h=h.firstBaseUpdate,h!==null){do{var k={lane:h.lane,tag:h.tag,payload:h.payload,callback:null,next:null};_===null?S=_=k:_=_.next=k,h=h.next}while(h!==null);_===null?S=_=o:_=_.next=o}else S=_=o;h={baseState:g.baseState,firstBaseUpdate:S,lastBaseUpdate:_,shared:g.shared,callbacks:g.callbacks},i.updateQueue=h;return}i=h.lastBaseUpdate,i===null?h.firstBaseUpdate=o:i.next=o,h.lastBaseUpdate=o}var Uf=!1;function fo(){if(Uf){var i=aa;if(i!==null)throw i}}function ho(i,o,h,g){Uf=!1;var S=i.updateQueue;On=!1;var _=S.firstBaseUpdate,k=S.lastBaseUpdate,G=S.shared.pending;if(G!==null){S.shared.pending=null;var oe=G,_e=oe.next;oe.next=null,k===null?_=_e:k.next=_e,k=oe;var Be=i.alternate;Be!==null&&(Be=Be.updateQueue,G=Be.lastBaseUpdate,G!==k&&(G===null?Be.firstBaseUpdate=_e:G.next=_e,Be.lastBaseUpdate=oe))}if(_!==null){var He=S.baseState;k=0,Be=_e=oe=null,G=_;do{var we=G.lane&-536870913,Oe=we!==G.lane;if(Oe?(mt&we)===we:(g&we)===we){we!==0&&we===sa&&(Uf=!0),Be!==null&&(Be=Be.next={lane:0,tag:G.tag,payload:G.payload,callback:null,next:null});e:{var Je=i,it=G;we=o;var It=h;switch(it.tag){case 1:if(Je=it.payload,typeof Je=="function"){He=Je.call(It,He,we);break e}He=Je;break e;case 3:Je.flags=Je.flags&-65537|128;case 0:if(Je=it.payload,we=typeof Je=="function"?Je.call(It,He,we):Je,we==null)break e;He=p({},He,we);break e;case 2:On=!0}}we=G.callback,we!==null&&(i.flags|=64,Oe&&(i.flags|=8192),Oe=S.callbacks,Oe===null?S.callbacks=[we]:Oe.push(we))}else Oe={lane:we,tag:G.tag,payload:G.payload,callback:G.callback,next:null},Be===null?(_e=Be=Oe,oe=He):Be=Be.next=Oe,k|=we;if(G=G.next,G===null){if(G=S.shared.pending,G===null)break;Oe=G,G=Oe.next,Oe.next=null,S.lastBaseUpdate=Oe,S.shared.pending=null}}while(!0);Be===null&&(oe=He),S.baseState=oe,S.firstBaseUpdate=_e,S.lastBaseUpdate=Be,_===null&&(S.shared.lanes=0),Fn|=k,i.lanes=k,i.memoizedState=He}}function iy(i,o){if(typeof i!="function")throw Error(r(191,i));i.call(o)}function ny(i,o){var h=i.callbacks;if(h!==null)for(i.callbacks=null,i=0;i<h.length;i++)iy(h[i],o)}var ua=U(null),Ml=U(0);function sy(i,o){i=on,W(Ml,i),W(ua,o),on=i|o.baseLanes}function Bf(){W(Ml,on),W(ua,ua.current)}function Ff(){on=Ml.current,N(ua),N(Ml)}var Wr=U(null),pi=null;function Pn(i){var o=i.alternate;W(Wt,Wt.current&1),W(Wr,i),pi===null&&(o===null||ua.current!==null||o.memoizedState!==null)&&(pi=i)}function jf(i){W(Wt,Wt.current),W(Wr,i),pi===null&&(pi=i)}function ay(i){i.tag===22?(W(Wt,Wt.current),W(Wr,i),pi===null&&(pi=i)):Nn()}function Nn(){W(Wt,Wt.current),W(Wr,Wr.current)}function Qr(i){N(Wr),pi===i&&(pi=null),N(Wt)}var Wt=U(0);function Pl(i){for(var o=i;o!==null;){if(o.tag===13){var h=o.memoizedState;if(h!==null&&(h=h.dehydrated,h===null||zh(h)||qh(h)))return o}else if(o.tag===19&&(o.memoizedProps.revealOrder==="forwards"||o.memoizedProps.revealOrder==="backwards"||o.memoizedProps.revealOrder==="unstable_legacy-backwards"||o.memoizedProps.revealOrder==="together")){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===i)break;for(;o.sibling===null;){if(o.return===null||o.return===i)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var Zi=0,ct=null,wt=null,Jt=null,Nl=!1,ca=!1,xs=!1,Ul=0,po=0,fa=null,nw=0;function Vt(){throw Error(r(321))}function $f(i,o){if(o===null)return!1;for(var h=0;h<o.length&&h<i.length;h++)if(!qr(i[h],o[h]))return!1;return!0}function Gf(i,o,h,g,S,_){return Zi=_,ct=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,H.H=i===null||i.memoizedState===null?Hy:ih,xs=!1,_=h(g,S),xs=!1,ca&&(_=ly(o,h,g,S)),oy(i),_}function oy(i){H.H=yo;var o=wt!==null&&wt.next!==null;if(Zi=0,Jt=wt=ct=null,Nl=!1,po=0,fa=null,o)throw Error(r(300));i===null||er||(i=i.dependencies,i!==null&&Rl(i)&&(er=!0))}function ly(i,o,h,g){ct=i;var S=0;do{if(ca&&(fa=null),po=0,ca=!1,25<=S)throw Error(r(301));if(S+=1,Jt=wt=null,i.updateQueue!=null){var _=i.updateQueue;_.lastEffect=null,_.events=null,_.stores=null,_.memoCache!=null&&(_.memoCache.index=0)}H.H=Ky,_=o(h,g)}while(ca);return _}function sw(){var i=H.H,o=i.useState()[0];return o=typeof o.then=="function"?go(o):o,i=i.useState()[0],(wt!==null?wt.memoizedState:null)!==i&&(ct.flags|=1024),o}function Hf(){var i=Ul!==0;return Ul=0,i}function Kf(i,o,h){o.updateQueue=i.updateQueue,o.flags&=-2053,i.lanes&=~h}function Vf(i){if(Nl){for(i=i.memoizedState;i!==null;){var o=i.queue;o!==null&&(o.pending=null),i=i.next}Nl=!1}Zi=0,Jt=wt=ct=null,ca=!1,po=Ul=0,fa=null}function Ir(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Jt===null?ct.memoizedState=Jt=i:Jt=Jt.next=i,Jt}function Qt(){if(wt===null){var i=ct.alternate;i=i!==null?i.memoizedState:null}else i=wt.next;var o=Jt===null?ct.memoizedState:Jt.next;if(o!==null)Jt=o,wt=i;else{if(i===null)throw ct.alternate===null?Error(r(467)):Error(r(310));wt=i,i={memoizedState:wt.memoizedState,baseState:wt.baseState,baseQueue:wt.baseQueue,queue:wt.queue,next:null},Jt===null?ct.memoizedState=Jt=i:Jt=Jt.next=i}return Jt}function Bl(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function go(i){var o=po;return po+=1,fa===null&&(fa=[]),i=Z0(fa,i,o),o=ct,(Jt===null?o.memoizedState:Jt.next)===null&&(o=o.alternate,H.H=o===null||o.memoizedState===null?Hy:ih),i}function Fl(i){if(i!==null&&typeof i=="object"){if(typeof i.then=="function")return go(i);if(i.$$typeof===A)return pr(i)}throw Error(r(438,String(i)))}function zf(i){var o=null,h=ct.updateQueue;if(h!==null&&(o=h.memoCache),o==null){var g=ct.alternate;g!==null&&(g=g.updateQueue,g!==null&&(g=g.memoCache,g!=null&&(o={data:g.data.map(function(S){return S.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),h===null&&(h=Bl(),ct.updateQueue=h),h.memoCache=o,h=o.data[o.index],h===void 0)for(h=o.data[o.index]=Array(i),g=0;g<i;g++)h[g]=P;return o.index++,h}function Ji(i,o){return typeof o=="function"?o(i):o}function jl(i){var o=Qt();return qf(o,wt,i)}function qf(i,o,h){var g=i.queue;if(g===null)throw Error(r(311));g.lastRenderedReducer=h;var S=i.baseQueue,_=g.pending;if(_!==null){if(S!==null){var k=S.next;S.next=_.next,_.next=k}o.baseQueue=S=_,g.pending=null}if(_=i.baseState,S===null)i.memoizedState=_;else{o=S.next;var G=k=null,oe=null,_e=o,Be=!1;do{var He=_e.lane&-536870913;if(He!==_e.lane?(mt&He)===He:(Zi&He)===He){var we=_e.revertLane;if(we===0)oe!==null&&(oe=oe.next={lane:0,revertLane:0,gesture:null,action:_e.action,hasEagerState:_e.hasEagerState,eagerState:_e.eagerState,next:null}),He===sa&&(Be=!0);else if((Zi&we)===we){_e=_e.next,we===sa&&(Be=!0);continue}else He={lane:0,revertLane:_e.revertLane,gesture:null,action:_e.action,hasEagerState:_e.hasEagerState,eagerState:_e.eagerState,next:null},oe===null?(G=oe=He,k=_):oe=oe.next=He,ct.lanes|=we,Fn|=we;He=_e.action,xs&&h(_,He),_=_e.hasEagerState?_e.eagerState:h(_,He)}else we={lane:He,revertLane:_e.revertLane,gesture:_e.gesture,action:_e.action,hasEagerState:_e.hasEagerState,eagerState:_e.eagerState,next:null},oe===null?(G=oe=we,k=_):oe=oe.next=we,ct.lanes|=He,Fn|=He;_e=_e.next}while(_e!==null&&_e!==o);if(oe===null?k=_:oe.next=G,!qr(_,i.memoizedState)&&(er=!0,Be&&(h=aa,h!==null)))throw h;i.memoizedState=_,i.baseState=k,i.baseQueue=oe,g.lastRenderedState=_}return S===null&&(g.lanes=0),[i.memoizedState,g.dispatch]}function Yf(i){var o=Qt(),h=o.queue;if(h===null)throw Error(r(311));h.lastRenderedReducer=i;var g=h.dispatch,S=h.pending,_=o.memoizedState;if(S!==null){h.pending=null;var k=S=S.next;do _=i(_,k.action),k=k.next;while(k!==S);qr(_,o.memoizedState)||(er=!0),o.memoizedState=_,o.baseQueue===null&&(o.baseState=_),h.lastRenderedState=_}return[_,g]}function uy(i,o,h){var g=ct,S=Qt(),_=vt;if(_){if(h===void 0)throw Error(r(407));h=h()}else h=o();var k=!qr((wt||S).memoizedState,h);if(k&&(S.memoizedState=h,er=!0),S=S.queue,Xf(hy.bind(null,g,S,i),[i]),S.getSnapshot!==o||k||Jt!==null&&Jt.memoizedState.tag&1){if(g.flags|=2048,ha(9,{destroy:void 0},fy.bind(null,g,S,h,o),null),Dt===null)throw Error(r(349));_||(Zi&127)!==0||cy(g,o,h)}return h}function cy(i,o,h){i.flags|=16384,i={getSnapshot:o,value:h},o=ct.updateQueue,o===null?(o=Bl(),ct.updateQueue=o,o.stores=[i]):(h=o.stores,h===null?o.stores=[i]:h.push(i))}function fy(i,o,h,g){o.value=h,o.getSnapshot=g,dy(o)&&py(i)}function hy(i,o,h){return h(function(){dy(o)&&py(i)})}function dy(i){var o=i.getSnapshot;i=i.value;try{var h=o();return!qr(i,h)}catch{return!0}}function py(i){var o=ps(i,2);o!==null&&$r(o,i,2)}function Wf(i){var o=Ir();if(typeof i=="function"){var h=i;if(i=h(),xs){Ze(!0);try{h()}finally{Ze(!1)}}}return o.memoizedState=o.baseState=i,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ji,lastRenderedState:i},o}function gy(i,o,h,g){return i.baseState=h,qf(i,wt,typeof g=="function"?g:Ji)}function aw(i,o,h,g,S){if(Hl(i))throw Error(r(485));if(i=o.action,i!==null){var _={payload:S,action:i,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(k){_.listeners.push(k)}};H.T!==null?h(!0):_.isTransition=!1,g(_),h=o.pending,h===null?(_.next=o.pending=_,my(o,_)):(_.next=h.next,o.pending=h.next=_)}}function my(i,o){var h=o.action,g=o.payload,S=i.state;if(o.isTransition){var _=H.T,k={};H.T=k;try{var G=h(S,g),oe=H.S;oe!==null&&oe(k,G),yy(i,o,G)}catch(_e){Qf(i,o,_e)}finally{_!==null&&k.types!==null&&(_.types=k.types),H.T=_}}else try{_=h(S,g),yy(i,o,_)}catch(_e){Qf(i,o,_e)}}function yy(i,o,h){h!==null&&typeof h=="object"&&typeof h.then=="function"?h.then(function(g){vy(i,o,g)},function(g){return Qf(i,o,g)}):vy(i,o,h)}function vy(i,o,h){o.status="fulfilled",o.value=h,by(o),i.state=h,o=i.pending,o!==null&&(h=o.next,h===o?i.pending=null:(h=h.next,o.next=h,my(i,h)))}function Qf(i,o,h){var g=i.pending;if(i.pending=null,g!==null){g=g.next;do o.status="rejected",o.reason=h,by(o),o=o.next;while(o!==g)}i.action=null}function by(i){i=i.listeners;for(var o=0;o<i.length;o++)(0,i[o])()}function Ey(i,o){return o}function Sy(i,o){if(vt){var h=Dt.formState;if(h!==null){e:{var g=ct;if(vt){if(Pt){t:{for(var S=Pt,_=di;S.nodeType!==8;){if(!_){S=null;break t}if(S=gi(S.nextSibling),S===null){S=null;break t}}_=S.data,S=_==="F!"||_==="F"?S:null}if(S){Pt=gi(S.nextSibling),g=S.data==="F!";break e}}Cn(g)}g=!1}g&&(o=h[0])}}return h=Ir(),h.memoizedState=h.baseState=o,g={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ey,lastRenderedState:o},h.queue=g,h=jy.bind(null,ct,g),g.dispatch=h,g=Wf(!1),_=rh.bind(null,ct,!1,g.queue),g=Ir(),S={state:o,dispatch:null,action:i,pending:null},g.queue=S,h=aw.bind(null,ct,S,_,h),S.dispatch=h,g.memoizedState=i,[o,h,!1]}function Ty(i){var o=Qt();return xy(o,wt,i)}function xy(i,o,h){if(o=qf(i,o,Ey)[0],i=jl(Ji)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var g=go(o)}catch(k){throw k===oa?Cl:k}else g=o;o=Qt();var S=o.queue,_=S.dispatch;return h!==o.memoizedState&&(ct.flags|=2048,ha(9,{destroy:void 0},ow.bind(null,S,h),null)),[g,_,i]}function ow(i,o){i.action=o}function _y(i){var o=Qt(),h=wt;if(h!==null)return xy(o,h,i);Qt(),o=o.memoizedState,h=Qt();var g=h.queue.dispatch;return h.memoizedState=i,[o,g,!1]}function ha(i,o,h,g){return i={tag:i,create:h,deps:g,inst:o,next:null},o=ct.updateQueue,o===null&&(o=Bl(),ct.updateQueue=o),h=o.lastEffect,h===null?o.lastEffect=i.next=i:(g=h.next,h.next=i,i.next=g,o.lastEffect=i),i}function Ay(){return Qt().memoizedState}function $l(i,o,h,g){var S=Ir();ct.flags|=i,S.memoizedState=ha(1|o,{destroy:void 0},h,g===void 0?null:g)}function Gl(i,o,h,g){var S=Qt();g=g===void 0?null:g;var _=S.memoizedState.inst;wt!==null&&g!==null&&$f(g,wt.memoizedState.deps)?S.memoizedState=ha(o,_,h,g):(ct.flags|=i,S.memoizedState=ha(1|o,_,h,g))}function wy(i,o){$l(8390656,8,i,o)}function Xf(i,o){Gl(2048,8,i,o)}function lw(i){ct.flags|=4;var o=ct.updateQueue;if(o===null)o=Bl(),ct.updateQueue=o,o.events=[i];else{var h=o.events;h===null?o.events=[i]:h.push(i)}}function Ry(i){var o=Qt().memoizedState;return lw({ref:o,nextImpl:i}),function(){if((St&2)!==0)throw Error(r(440));return o.impl.apply(void 0,arguments)}}function Iy(i,o){return Gl(4,2,i,o)}function Ly(i,o){return Gl(4,4,i,o)}function Cy(i,o){if(typeof o=="function"){i=i();var h=o(i);return function(){typeof h=="function"?h():o(null)}}if(o!=null)return i=i(),o.current=i,function(){o.current=null}}function Dy(i,o,h){h=h!=null?h.concat([i]):null,Gl(4,4,Cy.bind(null,o,i),h)}function Zf(){}function Oy(i,o){var h=Qt();o=o===void 0?null:o;var g=h.memoizedState;return o!==null&&$f(o,g[1])?g[0]:(h.memoizedState=[i,o],i)}function ky(i,o){var h=Qt();o=o===void 0?null:o;var g=h.memoizedState;if(o!==null&&$f(o,g[1]))return g[0];if(g=i(),xs){Ze(!0);try{i()}finally{Ze(!1)}}return h.memoizedState=[g,o],g}function Jf(i,o,h){return h===void 0||(Zi&1073741824)!==0&&(mt&261930)===0?i.memoizedState=o:(i.memoizedState=h,i=Mv(),ct.lanes|=i,Fn|=i,h)}function My(i,o,h,g){return qr(h,o)?h:ua.current!==null?(i=Jf(i,h,g),qr(i,o)||(er=!0),i):(Zi&42)===0||(Zi&1073741824)!==0&&(mt&261930)===0?(er=!0,i.memoizedState=h):(i=Mv(),ct.lanes|=i,Fn|=i,o)}function Py(i,o,h,g,S){var _=K.p;K.p=_!==0&&8>_?_:8;var k=H.T,G={};H.T=G,rh(i,!1,o,h);try{var oe=S(),_e=H.S;if(_e!==null&&_e(G,oe),oe!==null&&typeof oe=="object"&&typeof oe.then=="function"){var Be=iw(oe,g);mo(i,o,Be,Jr(i))}else mo(i,o,g,Jr(i))}catch(He){mo(i,o,{then:function(){},status:"rejected",reason:He},Jr())}finally{K.p=_,k!==null&&G.types!==null&&(k.types=G.types),H.T=k}}function uw(){}function eh(i,o,h,g){if(i.tag!==5)throw Error(r(476));var S=Ny(i).queue;Py(i,S,o,z,h===null?uw:function(){return Uy(i),h(g)})}function Ny(i){var o=i.memoizedState;if(o!==null)return o;o={memoizedState:z,baseState:z,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ji,lastRenderedState:z},next:null};var h={};return o.next={memoizedState:h,baseState:h,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ji,lastRenderedState:h},next:null},i.memoizedState=o,i=i.alternate,i!==null&&(i.memoizedState=o),o}function Uy(i){var o=Ny(i);o.next===null&&(o=i.alternate.memoizedState),mo(i,o.next.queue,{},Jr())}function th(){return pr(ko)}function By(){return Qt().memoizedState}function Fy(){return Qt().memoizedState}function cw(i){for(var o=i.return;o!==null;){switch(o.tag){case 24:case 3:var h=Jr();i=kn(h);var g=Mn(o,i,h);g!==null&&($r(g,o,h),co(g,o,h)),o={cache:Cf()},i.payload=o;return}o=o.return}}function fw(i,o,h){var g=Jr();h={lane:g,revertLane:0,gesture:null,action:h,hasEagerState:!1,eagerState:null,next:null},Hl(i)?$y(o,h):(h=bf(i,o,h,g),h!==null&&($r(h,i,g),Gy(h,o,g)))}function jy(i,o,h){var g=Jr();mo(i,o,h,g)}function mo(i,o,h,g){var S={lane:g,revertLane:0,gesture:null,action:h,hasEagerState:!1,eagerState:null,next:null};if(Hl(i))$y(o,S);else{var _=i.alternate;if(i.lanes===0&&(_===null||_.lanes===0)&&(_=o.lastRenderedReducer,_!==null))try{var k=o.lastRenderedState,G=_(k,h);if(S.hasEagerState=!0,S.eagerState=G,qr(G,k))return xl(i,o,S,0),Dt===null&&Tl(),!1}catch{}finally{}if(h=bf(i,o,S,g),h!==null)return $r(h,i,g),Gy(h,o,g),!0}return!1}function rh(i,o,h,g){if(g={lane:2,revertLane:Mh(),gesture:null,action:g,hasEagerState:!1,eagerState:null,next:null},Hl(i)){if(o)throw Error(r(479))}else o=bf(i,h,g,2),o!==null&&$r(o,i,2)}function Hl(i){var o=i.alternate;return i===ct||o!==null&&o===ct}function $y(i,o){ca=Nl=!0;var h=i.pending;h===null?o.next=o:(o.next=h.next,h.next=o),i.pending=o}function Gy(i,o,h){if((h&4194048)!==0){var g=o.lanes;g&=i.pendingLanes,h|=g,o.lanes=h,qe(i,h)}}var yo={readContext:pr,use:Fl,useCallback:Vt,useContext:Vt,useEffect:Vt,useImperativeHandle:Vt,useLayoutEffect:Vt,useInsertionEffect:Vt,useMemo:Vt,useReducer:Vt,useRef:Vt,useState:Vt,useDebugValue:Vt,useDeferredValue:Vt,useTransition:Vt,useSyncExternalStore:Vt,useId:Vt,useHostTransitionStatus:Vt,useFormState:Vt,useActionState:Vt,useOptimistic:Vt,useMemoCache:Vt,useCacheRefresh:Vt};yo.useEffectEvent=Vt;var Hy={readContext:pr,use:Fl,useCallback:function(i,o){return Ir().memoizedState=[i,o===void 0?null:o],i},useContext:pr,useEffect:wy,useImperativeHandle:function(i,o,h){h=h!=null?h.concat([i]):null,$l(4194308,4,Cy.bind(null,o,i),h)},useLayoutEffect:function(i,o){return $l(4194308,4,i,o)},useInsertionEffect:function(i,o){$l(4,2,i,o)},useMemo:function(i,o){var h=Ir();o=o===void 0?null:o;var g=i();if(xs){Ze(!0);try{i()}finally{Ze(!1)}}return h.memoizedState=[g,o],g},useReducer:function(i,o,h){var g=Ir();if(h!==void 0){var S=h(o);if(xs){Ze(!0);try{h(o)}finally{Ze(!1)}}}else S=o;return g.memoizedState=g.baseState=S,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:S},g.queue=i,i=i.dispatch=fw.bind(null,ct,i),[g.memoizedState,i]},useRef:function(i){var o=Ir();return i={current:i},o.memoizedState=i},useState:function(i){i=Wf(i);var o=i.queue,h=jy.bind(null,ct,o);return o.dispatch=h,[i.memoizedState,h]},useDebugValue:Zf,useDeferredValue:function(i,o){var h=Ir();return Jf(h,i,o)},useTransition:function(){var i=Wf(!1);return i=Py.bind(null,ct,i.queue,!0,!1),Ir().memoizedState=i,[!1,i]},useSyncExternalStore:function(i,o,h){var g=ct,S=Ir();if(vt){if(h===void 0)throw Error(r(407));h=h()}else{if(h=o(),Dt===null)throw Error(r(349));(mt&127)!==0||cy(g,o,h)}S.memoizedState=h;var _={value:h,getSnapshot:o};return S.queue=_,wy(hy.bind(null,g,_,i),[i]),g.flags|=2048,ha(9,{destroy:void 0},fy.bind(null,g,_,h,o),null),h},useId:function(){var i=Ir(),o=Dt.identifierPrefix;if(vt){var h=Ri,g=wi;h=(g&~(1<<32-We(g)-1)).toString(32)+h,o="_"+o+"R_"+h,h=Ul++,0<h&&(o+="H"+h.toString(32)),o+="_"}else h=nw++,o="_"+o+"r_"+h.toString(32)+"_";return i.memoizedState=o},useHostTransitionStatus:th,useFormState:Sy,useActionState:Sy,useOptimistic:function(i){var o=Ir();o.memoizedState=o.baseState=i;var h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=h,o=rh.bind(null,ct,!0,h),h.dispatch=o,[i,o]},useMemoCache:zf,useCacheRefresh:function(){return Ir().memoizedState=cw.bind(null,ct)},useEffectEvent:function(i){var o=Ir(),h={impl:i};return o.memoizedState=h,function(){if((St&2)!==0)throw Error(r(440));return h.impl.apply(void 0,arguments)}}},ih={readContext:pr,use:Fl,useCallback:Oy,useContext:pr,useEffect:Xf,useImperativeHandle:Dy,useInsertionEffect:Iy,useLayoutEffect:Ly,useMemo:ky,useReducer:jl,useRef:Ay,useState:function(){return jl(Ji)},useDebugValue:Zf,useDeferredValue:function(i,o){var h=Qt();return My(h,wt.memoizedState,i,o)},useTransition:function(){var i=jl(Ji)[0],o=Qt().memoizedState;return[typeof i=="boolean"?i:go(i),o]},useSyncExternalStore:uy,useId:By,useHostTransitionStatus:th,useFormState:Ty,useActionState:Ty,useOptimistic:function(i,o){var h=Qt();return gy(h,wt,i,o)},useMemoCache:zf,useCacheRefresh:Fy};ih.useEffectEvent=Ry;var Ky={readContext:pr,use:Fl,useCallback:Oy,useContext:pr,useEffect:Xf,useImperativeHandle:Dy,useInsertionEffect:Iy,useLayoutEffect:Ly,useMemo:ky,useReducer:Yf,useRef:Ay,useState:function(){return Yf(Ji)},useDebugValue:Zf,useDeferredValue:function(i,o){var h=Qt();return wt===null?Jf(h,i,o):My(h,wt.memoizedState,i,o)},useTransition:function(){var i=Yf(Ji)[0],o=Qt().memoizedState;return[typeof i=="boolean"?i:go(i),o]},useSyncExternalStore:uy,useId:By,useHostTransitionStatus:th,useFormState:_y,useActionState:_y,useOptimistic:function(i,o){var h=Qt();return wt!==null?gy(h,wt,i,o):(h.baseState=i,[i,h.queue.dispatch])},useMemoCache:zf,useCacheRefresh:Fy};Ky.useEffectEvent=Ry;function nh(i,o,h,g){o=i.memoizedState,h=h(g,o),h=h==null?o:p({},o,h),i.memoizedState=h,i.lanes===0&&(i.updateQueue.baseState=h)}var sh={enqueueSetState:function(i,o,h){i=i._reactInternals;var g=Jr(),S=kn(g);S.payload=o,h!=null&&(S.callback=h),o=Mn(i,S,g),o!==null&&($r(o,i,g),co(o,i,g))},enqueueReplaceState:function(i,o,h){i=i._reactInternals;var g=Jr(),S=kn(g);S.tag=1,S.payload=o,h!=null&&(S.callback=h),o=Mn(i,S,g),o!==null&&($r(o,i,g),co(o,i,g))},enqueueForceUpdate:function(i,o){i=i._reactInternals;var h=Jr(),g=kn(h);g.tag=2,o!=null&&(g.callback=o),o=Mn(i,g,h),o!==null&&($r(o,i,h),co(o,i,h))}};function Vy(i,o,h,g,S,_,k){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(g,_,k):o.prototype&&o.prototype.isPureReactComponent?!ro(h,g)||!ro(S,_):!0}function zy(i,o,h,g){i=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(h,g),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(h,g),o.state!==i&&sh.enqueueReplaceState(o,o.state,null)}function _s(i,o){var h=o;if("ref"in o){h={};for(var g in o)g!=="ref"&&(h[g]=o[g])}if(i=i.defaultProps){h===o&&(h=p({},h));for(var S in i)h[S]===void 0&&(h[S]=i[S])}return h}function qy(i){Sl(i)}function Yy(i){console.error(i)}function Wy(i){Sl(i)}function Kl(i,o){try{var h=i.onUncaughtError;h(o.value,{componentStack:o.stack})}catch(g){setTimeout(function(){throw g})}}function Qy(i,o,h){try{var g=i.onCaughtError;g(h.value,{componentStack:h.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(S){setTimeout(function(){throw S})}}function ah(i,o,h){return h=kn(h),h.tag=3,h.payload={element:null},h.callback=function(){Kl(i,o)},h}function Xy(i){return i=kn(i),i.tag=3,i}function Zy(i,o,h,g){var S=h.type.getDerivedStateFromError;if(typeof S=="function"){var _=g.value;i.payload=function(){return S(_)},i.callback=function(){Qy(o,h,g)}}var k=h.stateNode;k!==null&&typeof k.componentDidCatch=="function"&&(i.callback=function(){Qy(o,h,g),typeof S!="function"&&(jn===null?jn=new Set([this]):jn.add(this));var G=g.stack;this.componentDidCatch(g.value,{componentStack:G!==null?G:""})})}function hw(i,o,h,g,S){if(h.flags|=32768,g!==null&&typeof g=="object"&&typeof g.then=="function"){if(o=h.alternate,o!==null&&na(o,h,S,!0),h=Wr.current,h!==null){switch(h.tag){case 31:case 13:return pi===null?ru():h.alternate===null&&zt===0&&(zt=3),h.flags&=-257,h.flags|=65536,h.lanes=S,g===Dl?h.flags|=16384:(o=h.updateQueue,o===null?h.updateQueue=new Set([g]):o.add(g),Dh(i,g,S)),!1;case 22:return h.flags|=65536,g===Dl?h.flags|=16384:(o=h.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([g])},h.updateQueue=o):(h=o.retryQueue,h===null?o.retryQueue=new Set([g]):h.add(g)),Dh(i,g,S)),!1}throw Error(r(435,h.tag))}return Dh(i,g,S),ru(),!1}if(vt)return o=Wr.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=S,g!==Af&&(i=Error(r(422),{cause:g}),so(ci(i,h)))):(g!==Af&&(o=Error(r(423),{cause:g}),so(ci(o,h))),i=i.current.alternate,i.flags|=65536,S&=-S,i.lanes|=S,g=ci(g,h),S=ah(i.stateNode,g,S),Nf(i,S),zt!==4&&(zt=2)),!1;var _=Error(r(520),{cause:g});if(_=ci(_,h),Ao===null?Ao=[_]:Ao.push(_),zt!==4&&(zt=2),o===null)return!0;g=ci(g,h),h=o;do{switch(h.tag){case 3:return h.flags|=65536,i=S&-S,h.lanes|=i,i=ah(h.stateNode,g,i),Nf(h,i),!1;case 1:if(o=h.type,_=h.stateNode,(h.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||_!==null&&typeof _.componentDidCatch=="function"&&(jn===null||!jn.has(_))))return h.flags|=65536,S&=-S,h.lanes|=S,S=Xy(S),Zy(S,i,h,g),Nf(h,S),!1}h=h.return}while(h!==null);return!1}var oh=Error(r(461)),er=!1;function gr(i,o,h,g){o.child=i===null?ry(o,null,h,g):Ts(o,i.child,h,g)}function Jy(i,o,h,g,S){h=h.render;var _=o.ref;if("ref"in g){var k={};for(var G in g)G!=="ref"&&(k[G]=g[G])}else k=g;return vs(o),g=Gf(i,o,h,k,_,S),G=Hf(),i!==null&&!er?(Kf(i,o,S),en(i,o,S)):(vt&&G&&xf(o),o.flags|=1,gr(i,o,g,S),o.child)}function ev(i,o,h,g,S){if(i===null){var _=h.type;return typeof _=="function"&&!Ef(_)&&_.defaultProps===void 0&&h.compare===null?(o.tag=15,o.type=_,tv(i,o,_,g,S)):(i=Al(h.type,null,g,o,o.mode,S),i.ref=o.ref,i.return=o,o.child=i)}if(_=i.child,!gh(i,S)){var k=_.memoizedProps;if(h=h.compare,h=h!==null?h:ro,h(k,g)&&i.ref===o.ref)return en(i,o,S)}return o.flags|=1,i=Yi(_,g),i.ref=o.ref,i.return=o,o.child=i}function tv(i,o,h,g,S){if(i!==null){var _=i.memoizedProps;if(ro(_,g)&&i.ref===o.ref)if(er=!1,o.pendingProps=g=_,gh(i,S))(i.flags&131072)!==0&&(er=!0);else return o.lanes=i.lanes,en(i,o,S)}return lh(i,o,h,g,S)}function rv(i,o,h,g){var S=g.children,_=i!==null?i.memoizedState:null;if(i===null&&o.stateNode===null&&(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),g.mode==="hidden"){if((o.flags&128)!==0){if(_=_!==null?_.baseLanes|h:h,i!==null){for(g=o.child=i.child,S=0;g!==null;)S=S|g.lanes|g.childLanes,g=g.sibling;g=S&~_}else g=0,o.child=null;return iv(i,o,_,h,g)}if((h&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},i!==null&&Ll(o,_!==null?_.cachePool:null),_!==null?sy(o,_):Bf(),ay(o);else return g=o.lanes=536870912,iv(i,o,_!==null?_.baseLanes|h:h,h,g)}else _!==null?(Ll(o,_.cachePool),sy(o,_),Nn(),o.memoizedState=null):(i!==null&&Ll(o,null),Bf(),Nn());return gr(i,o,S,h),o.child}function vo(i,o){return i!==null&&i.tag===22||o.stateNode!==null||(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),o.sibling}function iv(i,o,h,g,S){var _=Of();return _=_===null?null:{parent:Zt._currentValue,pool:_},o.memoizedState={baseLanes:h,cachePool:_},i!==null&&Ll(o,null),Bf(),ay(o),i!==null&&na(i,o,g,!0),o.childLanes=S,null}function Vl(i,o){return o=ql({mode:o.mode,children:o.children},i.mode),o.ref=i.ref,i.child=o,o.return=i,o}function nv(i,o,h){return Ts(o,i.child,null,h),i=Vl(o,o.pendingProps),i.flags|=2,Qr(o),o.memoizedState=null,i}function dw(i,o,h){var g=o.pendingProps,S=(o.flags&128)!==0;if(o.flags&=-129,i===null){if(vt){if(g.mode==="hidden")return i=Vl(o,g),o.lanes=536870912,vo(null,i);if(jf(o),(i=Pt)?(i=mb(i,di),i=i!==null&&i.data==="&"?i:null,i!==null&&(o.memoizedState={dehydrated:i,treeContext:In!==null?{id:wi,overflow:Ri}:null,retryLane:536870912,hydrationErrors:null},h=$0(i),h.return=o,o.child=h,dr=o,Pt=null)):i=null,i===null)throw Cn(o);return o.lanes=536870912,null}return Vl(o,g)}var _=i.memoizedState;if(_!==null){var k=_.dehydrated;if(jf(o),S)if(o.flags&256)o.flags&=-257,o=nv(i,o,h);else if(o.memoizedState!==null)o.child=i.child,o.flags|=128,o=null;else throw Error(r(558));else if(er||na(i,o,h,!1),S=(h&i.childLanes)!==0,er||S){if(g=Dt,g!==null&&(k=Qe(g,h),k!==0&&k!==_.retryLane))throw _.retryLane=k,ps(i,k),$r(g,i,k),oh;ru(),o=nv(i,o,h)}else i=_.treeContext,Pt=gi(k.nextSibling),dr=o,vt=!0,Ln=null,di=!1,i!==null&&K0(o,i),o=Vl(o,g),o.flags|=4096;return o}return i=Yi(i.child,{mode:g.mode,children:g.children}),i.ref=o.ref,o.child=i,i.return=o,i}function zl(i,o){var h=o.ref;if(h===null)i!==null&&i.ref!==null&&(o.flags|=4194816);else{if(typeof h!="function"&&typeof h!="object")throw Error(r(284));(i===null||i.ref!==h)&&(o.flags|=4194816)}}function lh(i,o,h,g,S){return vs(o),h=Gf(i,o,h,g,void 0,S),g=Hf(),i!==null&&!er?(Kf(i,o,S),en(i,o,S)):(vt&&g&&xf(o),o.flags|=1,gr(i,o,h,S),o.child)}function sv(i,o,h,g,S,_){return vs(o),o.updateQueue=null,h=ly(o,g,h,S),oy(i),g=Hf(),i!==null&&!er?(Kf(i,o,_),en(i,o,_)):(vt&&g&&xf(o),o.flags|=1,gr(i,o,h,_),o.child)}function av(i,o,h,g,S){if(vs(o),o.stateNode===null){var _=ea,k=h.contextType;typeof k=="object"&&k!==null&&(_=pr(k)),_=new h(g,_),o.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,_.updater=sh,o.stateNode=_,_._reactInternals=o,_=o.stateNode,_.props=g,_.state=o.memoizedState,_.refs={},Mf(o),k=h.contextType,_.context=typeof k=="object"&&k!==null?pr(k):ea,_.state=o.memoizedState,k=h.getDerivedStateFromProps,typeof k=="function"&&(nh(o,h,k,g),_.state=o.memoizedState),typeof h.getDerivedStateFromProps=="function"||typeof _.getSnapshotBeforeUpdate=="function"||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(k=_.state,typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount(),k!==_.state&&sh.enqueueReplaceState(_,_.state,null),ho(o,g,_,S),fo(),_.state=o.memoizedState),typeof _.componentDidMount=="function"&&(o.flags|=4194308),g=!0}else if(i===null){_=o.stateNode;var G=o.memoizedProps,oe=_s(h,G);_.props=oe;var _e=_.context,Be=h.contextType;k=ea,typeof Be=="object"&&Be!==null&&(k=pr(Be));var He=h.getDerivedStateFromProps;Be=typeof He=="function"||typeof _.getSnapshotBeforeUpdate=="function",G=o.pendingProps!==G,Be||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(G||_e!==k)&&zy(o,_,g,k),On=!1;var we=o.memoizedState;_.state=we,ho(o,g,_,S),fo(),_e=o.memoizedState,G||we!==_e||On?(typeof He=="function"&&(nh(o,h,He,g),_e=o.memoizedState),(oe=On||Vy(o,h,oe,g,we,_e,k))?(Be||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount()),typeof _.componentDidMount=="function"&&(o.flags|=4194308)):(typeof _.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=g,o.memoizedState=_e),_.props=g,_.state=_e,_.context=k,g=oe):(typeof _.componentDidMount=="function"&&(o.flags|=4194308),g=!1)}else{_=o.stateNode,Pf(i,o),k=o.memoizedProps,Be=_s(h,k),_.props=Be,He=o.pendingProps,we=_.context,_e=h.contextType,oe=ea,typeof _e=="object"&&_e!==null&&(oe=pr(_e)),G=h.getDerivedStateFromProps,(_e=typeof G=="function"||typeof _.getSnapshotBeforeUpdate=="function")||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(k!==He||we!==oe)&&zy(o,_,g,oe),On=!1,we=o.memoizedState,_.state=we,ho(o,g,_,S),fo();var Oe=o.memoizedState;k!==He||we!==Oe||On||i!==null&&i.dependencies!==null&&Rl(i.dependencies)?(typeof G=="function"&&(nh(o,h,G,g),Oe=o.memoizedState),(Be=On||Vy(o,h,Be,g,we,Oe,oe)||i!==null&&i.dependencies!==null&&Rl(i.dependencies))?(_e||typeof _.UNSAFE_componentWillUpdate!="function"&&typeof _.componentWillUpdate!="function"||(typeof _.componentWillUpdate=="function"&&_.componentWillUpdate(g,Oe,oe),typeof _.UNSAFE_componentWillUpdate=="function"&&_.UNSAFE_componentWillUpdate(g,Oe,oe)),typeof _.componentDidUpdate=="function"&&(o.flags|=4),typeof _.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof _.componentDidUpdate!="function"||k===i.memoizedProps&&we===i.memoizedState||(o.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||k===i.memoizedProps&&we===i.memoizedState||(o.flags|=1024),o.memoizedProps=g,o.memoizedState=Oe),_.props=g,_.state=Oe,_.context=oe,g=Be):(typeof _.componentDidUpdate!="function"||k===i.memoizedProps&&we===i.memoizedState||(o.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||k===i.memoizedProps&&we===i.memoizedState||(o.flags|=1024),g=!1)}return _=g,zl(i,o),g=(o.flags&128)!==0,_||g?(_=o.stateNode,h=g&&typeof h.getDerivedStateFromError!="function"?null:_.render(),o.flags|=1,i!==null&&g?(o.child=Ts(o,i.child,null,S),o.child=Ts(o,null,h,S)):gr(i,o,h,S),o.memoizedState=_.state,i=o.child):i=en(i,o,S),i}function ov(i,o,h,g){return ms(),o.flags|=256,gr(i,o,h,g),o.child}var uh={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function ch(i){return{baseLanes:i,cachePool:Q0()}}function fh(i,o,h){return i=i!==null?i.childLanes&~h:0,o&&(i|=Zr),i}function lv(i,o,h){var g=o.pendingProps,S=!1,_=(o.flags&128)!==0,k;if((k=_)||(k=i!==null&&i.memoizedState===null?!1:(Wt.current&2)!==0),k&&(S=!0,o.flags&=-129),k=(o.flags&32)!==0,o.flags&=-33,i===null){if(vt){if(S?Pn(o):Nn(),(i=Pt)?(i=mb(i,di),i=i!==null&&i.data!=="&"?i:null,i!==null&&(o.memoizedState={dehydrated:i,treeContext:In!==null?{id:wi,overflow:Ri}:null,retryLane:536870912,hydrationErrors:null},h=$0(i),h.return=o,o.child=h,dr=o,Pt=null)):i=null,i===null)throw Cn(o);return qh(i)?o.lanes=32:o.lanes=536870912,null}var G=g.children;return g=g.fallback,S?(Nn(),S=o.mode,G=ql({mode:"hidden",children:G},S),g=gs(g,S,h,null),G.return=o,g.return=o,G.sibling=g,o.child=G,g=o.child,g.memoizedState=ch(h),g.childLanes=fh(i,k,h),o.memoizedState=uh,vo(null,g)):(Pn(o),hh(o,G))}var oe=i.memoizedState;if(oe!==null&&(G=oe.dehydrated,G!==null)){if(_)o.flags&256?(Pn(o),o.flags&=-257,o=dh(i,o,h)):o.memoizedState!==null?(Nn(),o.child=i.child,o.flags|=128,o=null):(Nn(),G=g.fallback,S=o.mode,g=ql({mode:"visible",children:g.children},S),G=gs(G,S,h,null),G.flags|=2,g.return=o,G.return=o,g.sibling=G,o.child=g,Ts(o,i.child,null,h),g=o.child,g.memoizedState=ch(h),g.childLanes=fh(i,k,h),o.memoizedState=uh,o=vo(null,g));else if(Pn(o),qh(G)){if(k=G.nextSibling&&G.nextSibling.dataset,k)var _e=k.dgst;k=_e,g=Error(r(419)),g.stack="",g.digest=k,so({value:g,source:null,stack:null}),o=dh(i,o,h)}else if(er||na(i,o,h,!1),k=(h&i.childLanes)!==0,er||k){if(k=Dt,k!==null&&(g=Qe(k,h),g!==0&&g!==oe.retryLane))throw oe.retryLane=g,ps(i,g),$r(k,i,g),oh;zh(G)||ru(),o=dh(i,o,h)}else zh(G)?(o.flags|=192,o.child=i.child,o=null):(i=oe.treeContext,Pt=gi(G.nextSibling),dr=o,vt=!0,Ln=null,di=!1,i!==null&&K0(o,i),o=hh(o,g.children),o.flags|=4096);return o}return S?(Nn(),G=g.fallback,S=o.mode,oe=i.child,_e=oe.sibling,g=Yi(oe,{mode:"hidden",children:g.children}),g.subtreeFlags=oe.subtreeFlags&65011712,_e!==null?G=Yi(_e,G):(G=gs(G,S,h,null),G.flags|=2),G.return=o,g.return=o,g.sibling=G,o.child=g,vo(null,g),g=o.child,G=i.child.memoizedState,G===null?G=ch(h):(S=G.cachePool,S!==null?(oe=Zt._currentValue,S=S.parent!==oe?{parent:oe,pool:oe}:S):S=Q0(),G={baseLanes:G.baseLanes|h,cachePool:S}),g.memoizedState=G,g.childLanes=fh(i,k,h),o.memoizedState=uh,vo(i.child,g)):(Pn(o),h=i.child,i=h.sibling,h=Yi(h,{mode:"visible",children:g.children}),h.return=o,h.sibling=null,i!==null&&(k=o.deletions,k===null?(o.deletions=[i],o.flags|=16):k.push(i)),o.child=h,o.memoizedState=null,h)}function hh(i,o){return o=ql({mode:"visible",children:o},i.mode),o.return=i,i.child=o}function ql(i,o){return i=Yr(22,i,null,o),i.lanes=0,i}function dh(i,o,h){return Ts(o,i.child,null,h),i=hh(o,o.pendingProps.children),i.flags|=2,o.memoizedState=null,i}function uv(i,o,h){i.lanes|=o;var g=i.alternate;g!==null&&(g.lanes|=o),If(i.return,o,h)}function ph(i,o,h,g,S,_){var k=i.memoizedState;k===null?i.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:g,tail:h,tailMode:S,treeForkCount:_}:(k.isBackwards=o,k.rendering=null,k.renderingStartTime=0,k.last=g,k.tail=h,k.tailMode=S,k.treeForkCount=_)}function cv(i,o,h){var g=o.pendingProps,S=g.revealOrder,_=g.tail;g=g.children;var k=Wt.current,G=(k&2)!==0;if(G?(k=k&1|2,o.flags|=128):k&=1,W(Wt,k),gr(i,o,g,h),g=vt?no:0,!G&&i!==null&&(i.flags&128)!==0)e:for(i=o.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&uv(i,h,o);else if(i.tag===19)uv(i,h,o);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===o)break e;for(;i.sibling===null;){if(i.return===null||i.return===o)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}switch(S){case"forwards":for(h=o.child,S=null;h!==null;)i=h.alternate,i!==null&&Pl(i)===null&&(S=h),h=h.sibling;h=S,h===null?(S=o.child,o.child=null):(S=h.sibling,h.sibling=null),ph(o,!1,S,h,_,g);break;case"backwards":case"unstable_legacy-backwards":for(h=null,S=o.child,o.child=null;S!==null;){if(i=S.alternate,i!==null&&Pl(i)===null){o.child=S;break}i=S.sibling,S.sibling=h,h=S,S=i}ph(o,!0,h,null,_,g);break;case"together":ph(o,!1,null,null,void 0,g);break;default:o.memoizedState=null}return o.child}function en(i,o,h){if(i!==null&&(o.dependencies=i.dependencies),Fn|=o.lanes,(h&o.childLanes)===0)if(i!==null){if(na(i,o,h,!1),(h&o.childLanes)===0)return null}else return null;if(i!==null&&o.child!==i.child)throw Error(r(153));if(o.child!==null){for(i=o.child,h=Yi(i,i.pendingProps),o.child=h,h.return=o;i.sibling!==null;)i=i.sibling,h=h.sibling=Yi(i,i.pendingProps),h.return=o;h.sibling=null}return o.child}function gh(i,o){return(i.lanes&o)!==0?!0:(i=i.dependencies,!!(i!==null&&Rl(i)))}function pw(i,o,h){switch(o.tag){case 3:J(o,o.stateNode.containerInfo),Dn(o,Zt,i.memoizedState.cache),ms();break;case 27:case 5:ce(o);break;case 4:J(o,o.stateNode.containerInfo);break;case 10:Dn(o,o.type,o.memoizedProps.value);break;case 31:if(o.memoizedState!==null)return o.flags|=128,jf(o),null;break;case 13:var g=o.memoizedState;if(g!==null)return g.dehydrated!==null?(Pn(o),o.flags|=128,null):(h&o.child.childLanes)!==0?lv(i,o,h):(Pn(o),i=en(i,o,h),i!==null?i.sibling:null);Pn(o);break;case 19:var S=(i.flags&128)!==0;if(g=(h&o.childLanes)!==0,g||(na(i,o,h,!1),g=(h&o.childLanes)!==0),S){if(g)return cv(i,o,h);o.flags|=128}if(S=o.memoizedState,S!==null&&(S.rendering=null,S.tail=null,S.lastEffect=null),W(Wt,Wt.current),g)break;return null;case 22:return o.lanes=0,rv(i,o,h,o.pendingProps);case 24:Dn(o,Zt,i.memoizedState.cache)}return en(i,o,h)}function fv(i,o,h){if(i!==null)if(i.memoizedProps!==o.pendingProps)er=!0;else{if(!gh(i,h)&&(o.flags&128)===0)return er=!1,pw(i,o,h);er=(i.flags&131072)!==0}else er=!1,vt&&(o.flags&1048576)!==0&&H0(o,no,o.index);switch(o.lanes=0,o.tag){case 16:e:{var g=o.pendingProps;if(i=Es(o.elementType),o.type=i,typeof i=="function")Ef(i)?(g=_s(i,g),o.tag=1,o=av(null,o,i,g,h)):(o.tag=0,o=lh(null,o,i,g,h));else{if(i!=null){var S=i.$$typeof;if(S===L){o.tag=11,o=Jy(null,o,i,g,h);break e}else if(S===I){o.tag=14,o=ev(null,o,i,g,h);break e}}throw o=X(i)||i,Error(r(306,o,""))}}return o;case 0:return lh(i,o,o.type,o.pendingProps,h);case 1:return g=o.type,S=_s(g,o.pendingProps),av(i,o,g,S,h);case 3:e:{if(J(o,o.stateNode.containerInfo),i===null)throw Error(r(387));g=o.pendingProps;var _=o.memoizedState;S=_.element,Pf(i,o),ho(o,g,null,h);var k=o.memoizedState;if(g=k.cache,Dn(o,Zt,g),g!==_.cache&&Lf(o,[Zt],h,!0),fo(),g=k.element,_.isDehydrated)if(_={element:g,isDehydrated:!1,cache:k.cache},o.updateQueue.baseState=_,o.memoizedState=_,o.flags&256){o=ov(i,o,g,h);break e}else if(g!==S){S=ci(Error(r(424)),o),so(S),o=ov(i,o,g,h);break e}else{switch(i=o.stateNode.containerInfo,i.nodeType){case 9:i=i.body;break;default:i=i.nodeName==="HTML"?i.ownerDocument.body:i}for(Pt=gi(i.firstChild),dr=o,vt=!0,Ln=null,di=!0,h=ry(o,null,g,h),o.child=h;h;)h.flags=h.flags&-3|4096,h=h.sibling}else{if(ms(),g===S){o=en(i,o,h);break e}gr(i,o,g,h)}o=o.child}return o;case 26:return zl(i,o),i===null?(h=Tb(o.type,null,o.pendingProps,null))?o.memoizedState=h:vt||(h=o.type,i=o.pendingProps,g=uu(Ee.current).createElement(h),g[jt]=o,g[nr]=i,mr(g,h,i),lr(g),o.stateNode=g):o.memoizedState=Tb(o.type,i.memoizedProps,o.pendingProps,i.memoizedState),null;case 27:return ce(o),i===null&&vt&&(g=o.stateNode=bb(o.type,o.pendingProps,Ee.current),dr=o,di=!0,S=Pt,Kn(o.type)?(Yh=S,Pt=gi(g.firstChild)):Pt=S),gr(i,o,o.pendingProps.children,h),zl(i,o),i===null&&(o.flags|=4194304),o.child;case 5:return i===null&&vt&&((S=g=Pt)&&(g=Kw(g,o.type,o.pendingProps,di),g!==null?(o.stateNode=g,dr=o,Pt=gi(g.firstChild),di=!1,S=!0):S=!1),S||Cn(o)),ce(o),S=o.type,_=o.pendingProps,k=i!==null?i.memoizedProps:null,g=_.children,Hh(S,_)?g=null:k!==null&&Hh(S,k)&&(o.flags|=32),o.memoizedState!==null&&(S=Gf(i,o,sw,null,null,h),ko._currentValue=S),zl(i,o),gr(i,o,g,h),o.child;case 6:return i===null&&vt&&((i=h=Pt)&&(h=Vw(h,o.pendingProps,di),h!==null?(o.stateNode=h,dr=o,Pt=null,i=!0):i=!1),i||Cn(o)),null;case 13:return lv(i,o,h);case 4:return J(o,o.stateNode.containerInfo),g=o.pendingProps,i===null?o.child=Ts(o,null,g,h):gr(i,o,g,h),o.child;case 11:return Jy(i,o,o.type,o.pendingProps,h);case 7:return gr(i,o,o.pendingProps,h),o.child;case 8:return gr(i,o,o.pendingProps.children,h),o.child;case 12:return gr(i,o,o.pendingProps.children,h),o.child;case 10:return g=o.pendingProps,Dn(o,o.type,g.value),gr(i,o,g.children,h),o.child;case 9:return S=o.type._context,g=o.pendingProps.children,vs(o),S=pr(S),g=g(S),o.flags|=1,gr(i,o,g,h),o.child;case 14:return ev(i,o,o.type,o.pendingProps,h);case 15:return tv(i,o,o.type,o.pendingProps,h);case 19:return cv(i,o,h);case 31:return dw(i,o,h);case 22:return rv(i,o,h,o.pendingProps);case 24:return vs(o),g=pr(Zt),i===null?(S=Of(),S===null&&(S=Dt,_=Cf(),S.pooledCache=_,_.refCount++,_!==null&&(S.pooledCacheLanes|=h),S=_),o.memoizedState={parent:g,cache:S},Mf(o),Dn(o,Zt,S)):((i.lanes&h)!==0&&(Pf(i,o),ho(o,null,null,h),fo()),S=i.memoizedState,_=o.memoizedState,S.parent!==g?(S={parent:g,cache:g},o.memoizedState=S,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=S),Dn(o,Zt,g)):(g=_.cache,Dn(o,Zt,g),g!==S.cache&&Lf(o,[Zt],h,!0))),gr(i,o,o.pendingProps.children,h),o.child;case 29:throw o.pendingProps}throw Error(r(156,o.tag))}function tn(i){i.flags|=4}function mh(i,o,h,g,S){if((o=(i.mode&32)!==0)&&(o=!1),o){if(i.flags|=16777216,(S&335544128)===S)if(i.stateNode.complete)i.flags|=8192;else if(Bv())i.flags|=8192;else throw Ss=Dl,kf}else i.flags&=-16777217}function hv(i,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)i.flags&=-16777217;else if(i.flags|=16777216,!Rb(o))if(Bv())i.flags|=8192;else throw Ss=Dl,kf}function Yl(i,o){o!==null&&(i.flags|=4),i.flags&16384&&(o=i.tag!==22?Gi():536870912,i.lanes|=o,ma|=o)}function bo(i,o){if(!vt)switch(i.tailMode){case"hidden":o=i.tail;for(var h=null;o!==null;)o.alternate!==null&&(h=o),o=o.sibling;h===null?i.tail=null:h.sibling=null;break;case"collapsed":h=i.tail;for(var g=null;h!==null;)h.alternate!==null&&(g=h),h=h.sibling;g===null?o||i.tail===null?i.tail=null:i.tail.sibling=null:g.sibling=null}}function Nt(i){var o=i.alternate!==null&&i.alternate.child===i.child,h=0,g=0;if(o)for(var S=i.child;S!==null;)h|=S.lanes|S.childLanes,g|=S.subtreeFlags&65011712,g|=S.flags&65011712,S.return=i,S=S.sibling;else for(S=i.child;S!==null;)h|=S.lanes|S.childLanes,g|=S.subtreeFlags,g|=S.flags,S.return=i,S=S.sibling;return i.subtreeFlags|=g,i.childLanes=h,o}function gw(i,o,h){var g=o.pendingProps;switch(_f(o),o.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Nt(o),null;case 1:return Nt(o),null;case 3:return h=o.stateNode,g=null,i!==null&&(g=i.memoizedState.cache),o.memoizedState.cache!==g&&(o.flags|=2048),Xi(Zt),me(),h.pendingContext&&(h.context=h.pendingContext,h.pendingContext=null),(i===null||i.child===null)&&(ia(o)?tn(o):i===null||i.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,wf())),Nt(o),null;case 26:var S=o.type,_=o.memoizedState;return i===null?(tn(o),_!==null?(Nt(o),hv(o,_)):(Nt(o),mh(o,S,null,g,h))):_?_!==i.memoizedState?(tn(o),Nt(o),hv(o,_)):(Nt(o),o.flags&=-16777217):(i=i.memoizedProps,i!==g&&tn(o),Nt(o),mh(o,S,i,g,h)),null;case 27:if(he(o),h=Ee.current,S=o.type,i!==null&&o.stateNode!=null)i.memoizedProps!==g&&tn(o);else{if(!g){if(o.stateNode===null)throw Error(r(166));return Nt(o),null}i=ue.current,ia(o)?V0(o):(i=bb(S,g,h),o.stateNode=i,tn(o))}return Nt(o),null;case 5:if(he(o),S=o.type,i!==null&&o.stateNode!=null)i.memoizedProps!==g&&tn(o);else{if(!g){if(o.stateNode===null)throw Error(r(166));return Nt(o),null}if(_=ue.current,ia(o))V0(o);else{var k=uu(Ee.current);switch(_){case 1:_=k.createElementNS("http://www.w3.org/2000/svg",S);break;case 2:_=k.createElementNS("http://www.w3.org/1998/Math/MathML",S);break;default:switch(S){case"svg":_=k.createElementNS("http://www.w3.org/2000/svg",S);break;case"math":_=k.createElementNS("http://www.w3.org/1998/Math/MathML",S);break;case"script":_=k.createElement("div"),_.innerHTML="<script><\/script>",_=_.removeChild(_.firstChild);break;case"select":_=typeof g.is=="string"?k.createElement("select",{is:g.is}):k.createElement("select"),g.multiple?_.multiple=!0:g.size&&(_.size=g.size);break;default:_=typeof g.is=="string"?k.createElement(S,{is:g.is}):k.createElement(S)}}_[jt]=o,_[nr]=g;e:for(k=o.child;k!==null;){if(k.tag===5||k.tag===6)_.appendChild(k.stateNode);else if(k.tag!==4&&k.tag!==27&&k.child!==null){k.child.return=k,k=k.child;continue}if(k===o)break e;for(;k.sibling===null;){if(k.return===null||k.return===o)break e;k=k.return}k.sibling.return=k.return,k=k.sibling}o.stateNode=_;e:switch(mr(_,S,g),S){case"button":case"input":case"select":case"textarea":g=!!g.autoFocus;break e;case"img":g=!0;break e;default:g=!1}g&&tn(o)}}return Nt(o),mh(o,o.type,i===null?null:i.memoizedProps,o.pendingProps,h),null;case 6:if(i&&o.stateNode!=null)i.memoizedProps!==g&&tn(o);else{if(typeof g!="string"&&o.stateNode===null)throw Error(r(166));if(i=Ee.current,ia(o)){if(i=o.stateNode,h=o.memoizedProps,g=null,S=dr,S!==null)switch(S.tag){case 27:case 5:g=S.memoizedProps}i[jt]=o,i=!!(i.nodeValue===h||g!==null&&g.suppressHydrationWarning===!0||lb(i.nodeValue,h)),i||Cn(o,!0)}else i=uu(i).createTextNode(g),i[jt]=o,o.stateNode=i}return Nt(o),null;case 31:if(h=o.memoizedState,i===null||i.memoizedState!==null){if(g=ia(o),h!==null){if(i===null){if(!g)throw Error(r(318));if(i=o.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(r(557));i[jt]=o}else ms(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;Nt(o),i=!1}else h=wf(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=h),i=!0;if(!i)return o.flags&256?(Qr(o),o):(Qr(o),null);if((o.flags&128)!==0)throw Error(r(558))}return Nt(o),null;case 13:if(g=o.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(S=ia(o),g!==null&&g.dehydrated!==null){if(i===null){if(!S)throw Error(r(318));if(S=o.memoizedState,S=S!==null?S.dehydrated:null,!S)throw Error(r(317));S[jt]=o}else ms(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;Nt(o),S=!1}else S=wf(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=S),S=!0;if(!S)return o.flags&256?(Qr(o),o):(Qr(o),null)}return Qr(o),(o.flags&128)!==0?(o.lanes=h,o):(h=g!==null,i=i!==null&&i.memoizedState!==null,h&&(g=o.child,S=null,g.alternate!==null&&g.alternate.memoizedState!==null&&g.alternate.memoizedState.cachePool!==null&&(S=g.alternate.memoizedState.cachePool.pool),_=null,g.memoizedState!==null&&g.memoizedState.cachePool!==null&&(_=g.memoizedState.cachePool.pool),_!==S&&(g.flags|=2048)),h!==i&&h&&(o.child.flags|=8192),Yl(o,o.updateQueue),Nt(o),null);case 4:return me(),i===null&&Bh(o.stateNode.containerInfo),Nt(o),null;case 10:return Xi(o.type),Nt(o),null;case 19:if(N(Wt),g=o.memoizedState,g===null)return Nt(o),null;if(S=(o.flags&128)!==0,_=g.rendering,_===null)if(S)bo(g,!1);else{if(zt!==0||i!==null&&(i.flags&128)!==0)for(i=o.child;i!==null;){if(_=Pl(i),_!==null){for(o.flags|=128,bo(g,!1),i=_.updateQueue,o.updateQueue=i,Yl(o,i),o.subtreeFlags=0,i=h,h=o.child;h!==null;)j0(h,i),h=h.sibling;return W(Wt,Wt.current&1|2),vt&&Wi(o,g.treeForkCount),o.child}i=i.sibling}g.tail!==null&&Ae()>Jl&&(o.flags|=128,S=!0,bo(g,!1),o.lanes=4194304)}else{if(!S)if(i=Pl(_),i!==null){if(o.flags|=128,S=!0,i=i.updateQueue,o.updateQueue=i,Yl(o,i),bo(g,!0),g.tail===null&&g.tailMode==="hidden"&&!_.alternate&&!vt)return Nt(o),null}else 2*Ae()-g.renderingStartTime>Jl&&h!==536870912&&(o.flags|=128,S=!0,bo(g,!1),o.lanes=4194304);g.isBackwards?(_.sibling=o.child,o.child=_):(i=g.last,i!==null?i.sibling=_:o.child=_,g.last=_)}return g.tail!==null?(i=g.tail,g.rendering=i,g.tail=i.sibling,g.renderingStartTime=Ae(),i.sibling=null,h=Wt.current,W(Wt,S?h&1|2:h&1),vt&&Wi(o,g.treeForkCount),i):(Nt(o),null);case 22:case 23:return Qr(o),Ff(),g=o.memoizedState!==null,i!==null?i.memoizedState!==null!==g&&(o.flags|=8192):g&&(o.flags|=8192),g?(h&536870912)!==0&&(o.flags&128)===0&&(Nt(o),o.subtreeFlags&6&&(o.flags|=8192)):Nt(o),h=o.updateQueue,h!==null&&Yl(o,h.retryQueue),h=null,i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(h=i.memoizedState.cachePool.pool),g=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(g=o.memoizedState.cachePool.pool),g!==h&&(o.flags|=2048),i!==null&&N(bs),null;case 24:return h=null,i!==null&&(h=i.memoizedState.cache),o.memoizedState.cache!==h&&(o.flags|=2048),Xi(Zt),Nt(o),null;case 25:return null;case 30:return null}throw Error(r(156,o.tag))}function mw(i,o){switch(_f(o),o.tag){case 1:return i=o.flags,i&65536?(o.flags=i&-65537|128,o):null;case 3:return Xi(Zt),me(),i=o.flags,(i&65536)!==0&&(i&128)===0?(o.flags=i&-65537|128,o):null;case 26:case 27:case 5:return he(o),null;case 31:if(o.memoizedState!==null){if(Qr(o),o.alternate===null)throw Error(r(340));ms()}return i=o.flags,i&65536?(o.flags=i&-65537|128,o):null;case 13:if(Qr(o),i=o.memoizedState,i!==null&&i.dehydrated!==null){if(o.alternate===null)throw Error(r(340));ms()}return i=o.flags,i&65536?(o.flags=i&-65537|128,o):null;case 19:return N(Wt),null;case 4:return me(),null;case 10:return Xi(o.type),null;case 22:case 23:return Qr(o),Ff(),i!==null&&N(bs),i=o.flags,i&65536?(o.flags=i&-65537|128,o):null;case 24:return Xi(Zt),null;case 25:return null;default:return null}}function dv(i,o){switch(_f(o),o.tag){case 3:Xi(Zt),me();break;case 26:case 27:case 5:he(o);break;case 4:me();break;case 31:o.memoizedState!==null&&Qr(o);break;case 13:Qr(o);break;case 19:N(Wt);break;case 10:Xi(o.type);break;case 22:case 23:Qr(o),Ff(),i!==null&&N(bs);break;case 24:Xi(Zt)}}function Eo(i,o){try{var h=o.updateQueue,g=h!==null?h.lastEffect:null;if(g!==null){var S=g.next;h=S;do{if((h.tag&i)===i){g=void 0;var _=h.create,k=h.inst;g=_(),k.destroy=g}h=h.next}while(h!==S)}}catch(G){xt(o,o.return,G)}}function Un(i,o,h){try{var g=o.updateQueue,S=g!==null?g.lastEffect:null;if(S!==null){var _=S.next;g=_;do{if((g.tag&i)===i){var k=g.inst,G=k.destroy;if(G!==void 0){k.destroy=void 0,S=o;var oe=h,_e=G;try{_e()}catch(Be){xt(S,oe,Be)}}}g=g.next}while(g!==_)}}catch(Be){xt(o,o.return,Be)}}function pv(i){var o=i.updateQueue;if(o!==null){var h=i.stateNode;try{ny(o,h)}catch(g){xt(i,i.return,g)}}}function gv(i,o,h){h.props=_s(i.type,i.memoizedProps),h.state=i.memoizedState;try{h.componentWillUnmount()}catch(g){xt(i,o,g)}}function So(i,o){try{var h=i.ref;if(h!==null){switch(i.tag){case 26:case 27:case 5:var g=i.stateNode;break;case 30:g=i.stateNode;break;default:g=i.stateNode}typeof h=="function"?i.refCleanup=h(g):h.current=g}}catch(S){xt(i,o,S)}}function Ii(i,o){var h=i.ref,g=i.refCleanup;if(h!==null)if(typeof g=="function")try{g()}catch(S){xt(i,o,S)}finally{i.refCleanup=null,i=i.alternate,i!=null&&(i.refCleanup=null)}else if(typeof h=="function")try{h(null)}catch(S){xt(i,o,S)}else h.current=null}function mv(i){var o=i.type,h=i.memoizedProps,g=i.stateNode;try{e:switch(o){case"button":case"input":case"select":case"textarea":h.autoFocus&&g.focus();break e;case"img":h.src?g.src=h.src:h.srcSet&&(g.srcset=h.srcSet)}}catch(S){xt(i,i.return,S)}}function yh(i,o,h){try{var g=i.stateNode;Bw(g,i.type,h,o),g[nr]=o}catch(S){xt(i,i.return,S)}}function yv(i){return i.tag===5||i.tag===3||i.tag===26||i.tag===27&&Kn(i.type)||i.tag===4}function vh(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||yv(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.tag===27&&Kn(i.type)||i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function bh(i,o,h){var g=i.tag;if(g===5||g===6)i=i.stateNode,o?(h.nodeType===9?h.body:h.nodeName==="HTML"?h.ownerDocument.body:h).insertBefore(i,o):(o=h.nodeType===9?h.body:h.nodeName==="HTML"?h.ownerDocument.body:h,o.appendChild(i),h=h._reactRootContainer,h!=null||o.onclick!==null||(o.onclick=zi));else if(g!==4&&(g===27&&Kn(i.type)&&(h=i.stateNode,o=null),i=i.child,i!==null))for(bh(i,o,h),i=i.sibling;i!==null;)bh(i,o,h),i=i.sibling}function Wl(i,o,h){var g=i.tag;if(g===5||g===6)i=i.stateNode,o?h.insertBefore(i,o):h.appendChild(i);else if(g!==4&&(g===27&&Kn(i.type)&&(h=i.stateNode),i=i.child,i!==null))for(Wl(i,o,h),i=i.sibling;i!==null;)Wl(i,o,h),i=i.sibling}function vv(i){var o=i.stateNode,h=i.memoizedProps;try{for(var g=i.type,S=o.attributes;S.length;)o.removeAttributeNode(S[0]);mr(o,g,h),o[jt]=i,o[nr]=h}catch(_){xt(i,i.return,_)}}var rn=!1,tr=!1,Eh=!1,bv=typeof WeakSet=="function"?WeakSet:Set,ur=null;function yw(i,o){if(i=i.containerInfo,$h=mu,i=D0(i),df(i)){if("selectionStart"in i)var h={start:i.selectionStart,end:i.selectionEnd};else e:{h=(h=i.ownerDocument)&&h.defaultView||window;var g=h.getSelection&&h.getSelection();if(g&&g.rangeCount!==0){h=g.anchorNode;var S=g.anchorOffset,_=g.focusNode;g=g.focusOffset;try{h.nodeType,_.nodeType}catch{h=null;break e}var k=0,G=-1,oe=-1,_e=0,Be=0,He=i,we=null;t:for(;;){for(var Oe;He!==h||S!==0&&He.nodeType!==3||(G=k+S),He!==_||g!==0&&He.nodeType!==3||(oe=k+g),He.nodeType===3&&(k+=He.nodeValue.length),(Oe=He.firstChild)!==null;)we=He,He=Oe;for(;;){if(He===i)break t;if(we===h&&++_e===S&&(G=k),we===_&&++Be===g&&(oe=k),(Oe=He.nextSibling)!==null)break;He=we,we=He.parentNode}He=Oe}h=G===-1||oe===-1?null:{start:G,end:oe}}else h=null}h=h||{start:0,end:0}}else h=null;for(Gh={focusedElem:i,selectionRange:h},mu=!1,ur=o;ur!==null;)if(o=ur,i=o.child,(o.subtreeFlags&1028)!==0&&i!==null)i.return=o,ur=i;else for(;ur!==null;){switch(o=ur,_=o.alternate,i=o.flags,o.tag){case 0:if((i&4)!==0&&(i=o.updateQueue,i=i!==null?i.events:null,i!==null))for(h=0;h<i.length;h++)S=i[h],S.ref.impl=S.nextImpl;break;case 11:case 15:break;case 1:if((i&1024)!==0&&_!==null){i=void 0,h=o,S=_.memoizedProps,_=_.memoizedState,g=h.stateNode;try{var Je=_s(h.type,S);i=g.getSnapshotBeforeUpdate(Je,_),g.__reactInternalSnapshotBeforeUpdate=i}catch(it){xt(h,h.return,it)}}break;case 3:if((i&1024)!==0){if(i=o.stateNode.containerInfo,h=i.nodeType,h===9)Vh(i);else if(h===1)switch(i.nodeName){case"HEAD":case"HTML":case"BODY":Vh(i);break;default:i.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((i&1024)!==0)throw Error(r(163))}if(i=o.sibling,i!==null){i.return=o.return,ur=i;break}ur=o.return}}function Ev(i,o,h){var g=h.flags;switch(h.tag){case 0:case 11:case 15:sn(i,h),g&4&&Eo(5,h);break;case 1:if(sn(i,h),g&4)if(i=h.stateNode,o===null)try{i.componentDidMount()}catch(k){xt(h,h.return,k)}else{var S=_s(h.type,o.memoizedProps);o=o.memoizedState;try{i.componentDidUpdate(S,o,i.__reactInternalSnapshotBeforeUpdate)}catch(k){xt(h,h.return,k)}}g&64&&pv(h),g&512&&So(h,h.return);break;case 3:if(sn(i,h),g&64&&(i=h.updateQueue,i!==null)){if(o=null,h.child!==null)switch(h.child.tag){case 27:case 5:o=h.child.stateNode;break;case 1:o=h.child.stateNode}try{ny(i,o)}catch(k){xt(h,h.return,k)}}break;case 27:o===null&&g&4&&vv(h);case 26:case 5:sn(i,h),o===null&&g&4&&mv(h),g&512&&So(h,h.return);break;case 12:sn(i,h);break;case 31:sn(i,h),g&4&&xv(i,h);break;case 13:sn(i,h),g&4&&_v(i,h),g&64&&(i=h.memoizedState,i!==null&&(i=i.dehydrated,i!==null&&(h=ww.bind(null,h),zw(i,h))));break;case 22:if(g=h.memoizedState!==null||rn,!g){o=o!==null&&o.memoizedState!==null||tr,S=rn;var _=tr;rn=g,(tr=o)&&!_?an(i,h,(h.subtreeFlags&8772)!==0):sn(i,h),rn=S,tr=_}break;case 30:break;default:sn(i,h)}}function Sv(i){var o=i.alternate;o!==null&&(i.alternate=null,Sv(o)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(o=i.stateNode,o!==null&&Wc(o)),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}var Ut=null,Ur=!1;function nn(i,o,h){for(h=h.child;h!==null;)Tv(i,o,h),h=h.sibling}function Tv(i,o,h){if(Te&&typeof Te.onCommitFiberUnmount=="function")try{Te.onCommitFiberUnmount(de,h)}catch{}switch(h.tag){case 26:tr||Ii(h,o),nn(i,o,h),h.memoizedState?h.memoizedState.count--:h.stateNode&&(h=h.stateNode,h.parentNode.removeChild(h));break;case 27:tr||Ii(h,o);var g=Ut,S=Ur;Kn(h.type)&&(Ut=h.stateNode,Ur=!1),nn(i,o,h),Co(h.stateNode),Ut=g,Ur=S;break;case 5:tr||Ii(h,o);case 6:if(g=Ut,S=Ur,Ut=null,nn(i,o,h),Ut=g,Ur=S,Ut!==null)if(Ur)try{(Ut.nodeType===9?Ut.body:Ut.nodeName==="HTML"?Ut.ownerDocument.body:Ut).removeChild(h.stateNode)}catch(_){xt(h,o,_)}else try{Ut.removeChild(h.stateNode)}catch(_){xt(h,o,_)}break;case 18:Ut!==null&&(Ur?(i=Ut,pb(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,h.stateNode),_a(i)):pb(Ut,h.stateNode));break;case 4:g=Ut,S=Ur,Ut=h.stateNode.containerInfo,Ur=!0,nn(i,o,h),Ut=g,Ur=S;break;case 0:case 11:case 14:case 15:Un(2,h,o),tr||Un(4,h,o),nn(i,o,h);break;case 1:tr||(Ii(h,o),g=h.stateNode,typeof g.componentWillUnmount=="function"&&gv(h,o,g)),nn(i,o,h);break;case 21:nn(i,o,h);break;case 22:tr=(g=tr)||h.memoizedState!==null,nn(i,o,h),tr=g;break;default:nn(i,o,h)}}function xv(i,o){if(o.memoizedState===null&&(i=o.alternate,i!==null&&(i=i.memoizedState,i!==null))){i=i.dehydrated;try{_a(i)}catch(h){xt(o,o.return,h)}}}function _v(i,o){if(o.memoizedState===null&&(i=o.alternate,i!==null&&(i=i.memoizedState,i!==null&&(i=i.dehydrated,i!==null))))try{_a(i)}catch(h){xt(o,o.return,h)}}function vw(i){switch(i.tag){case 31:case 13:case 19:var o=i.stateNode;return o===null&&(o=i.stateNode=new bv),o;case 22:return i=i.stateNode,o=i._retryCache,o===null&&(o=i._retryCache=new bv),o;default:throw Error(r(435,i.tag))}}function Ql(i,o){var h=vw(i);o.forEach(function(g){if(!h.has(g)){h.add(g);var S=Rw.bind(null,i,g);g.then(S,S)}})}function Br(i,o){var h=o.deletions;if(h!==null)for(var g=0;g<h.length;g++){var S=h[g],_=i,k=o,G=k;e:for(;G!==null;){switch(G.tag){case 27:if(Kn(G.type)){Ut=G.stateNode,Ur=!1;break e}break;case 5:Ut=G.stateNode,Ur=!1;break e;case 3:case 4:Ut=G.stateNode.containerInfo,Ur=!0;break e}G=G.return}if(Ut===null)throw Error(r(160));Tv(_,k,S),Ut=null,Ur=!1,_=S.alternate,_!==null&&(_.return=null),S.return=null}if(o.subtreeFlags&13886)for(o=o.child;o!==null;)Av(o,i),o=o.sibling}var Ei=null;function Av(i,o){var h=i.alternate,g=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:Br(o,i),Fr(i),g&4&&(Un(3,i,i.return),Eo(3,i),Un(5,i,i.return));break;case 1:Br(o,i),Fr(i),g&512&&(tr||h===null||Ii(h,h.return)),g&64&&rn&&(i=i.updateQueue,i!==null&&(g=i.callbacks,g!==null&&(h=i.shared.hiddenCallbacks,i.shared.hiddenCallbacks=h===null?g:h.concat(g))));break;case 26:var S=Ei;if(Br(o,i),Fr(i),g&512&&(tr||h===null||Ii(h,h.return)),g&4){var _=h!==null?h.memoizedState:null;if(g=i.memoizedState,h===null)if(g===null)if(i.stateNode===null){e:{g=i.type,h=i.memoizedProps,S=S.ownerDocument||S;t:switch(g){case"title":_=S.getElementsByTagName("title")[0],(!_||_[Rr]||_[jt]||_.namespaceURI==="http://www.w3.org/2000/svg"||_.hasAttribute("itemprop"))&&(_=S.createElement(g),S.head.insertBefore(_,S.querySelector("head > title"))),mr(_,g,h),_[jt]=i,lr(_),g=_;break e;case"link":var k=Ab("link","href",S).get(g+(h.href||""));if(k){for(var G=0;G<k.length;G++)if(_=k[G],_.getAttribute("href")===(h.href==null||h.href===""?null:h.href)&&_.getAttribute("rel")===(h.rel==null?null:h.rel)&&_.getAttribute("title")===(h.title==null?null:h.title)&&_.getAttribute("crossorigin")===(h.crossOrigin==null?null:h.crossOrigin)){k.splice(G,1);break t}}_=S.createElement(g),mr(_,g,h),S.head.appendChild(_);break;case"meta":if(k=Ab("meta","content",S).get(g+(h.content||""))){for(G=0;G<k.length;G++)if(_=k[G],_.getAttribute("content")===(h.content==null?null:""+h.content)&&_.getAttribute("name")===(h.name==null?null:h.name)&&_.getAttribute("property")===(h.property==null?null:h.property)&&_.getAttribute("http-equiv")===(h.httpEquiv==null?null:h.httpEquiv)&&_.getAttribute("charset")===(h.charSet==null?null:h.charSet)){k.splice(G,1);break t}}_=S.createElement(g),mr(_,g,h),S.head.appendChild(_);break;default:throw Error(r(468,g))}_[jt]=i,lr(_),g=_}i.stateNode=g}else wb(S,i.type,i.stateNode);else i.stateNode=_b(S,g,i.memoizedProps);else _!==g?(_===null?h.stateNode!==null&&(h=h.stateNode,h.parentNode.removeChild(h)):_.count--,g===null?wb(S,i.type,i.stateNode):_b(S,g,i.memoizedProps)):g===null&&i.stateNode!==null&&yh(i,i.memoizedProps,h.memoizedProps)}break;case 27:Br(o,i),Fr(i),g&512&&(tr||h===null||Ii(h,h.return)),h!==null&&g&4&&yh(i,i.memoizedProps,h.memoizedProps);break;case 5:if(Br(o,i),Fr(i),g&512&&(tr||h===null||Ii(h,h.return)),i.flags&32){S=i.stateNode;try{qs(S,"")}catch(Je){xt(i,i.return,Je)}}g&4&&i.stateNode!=null&&(S=i.memoizedProps,yh(i,S,h!==null?h.memoizedProps:S)),g&1024&&(Eh=!0);break;case 6:if(Br(o,i),Fr(i),g&4){if(i.stateNode===null)throw Error(r(162));g=i.memoizedProps,h=i.stateNode;try{h.nodeValue=g}catch(Je){xt(i,i.return,Je)}}break;case 3:if(hu=null,S=Ei,Ei=cu(o.containerInfo),Br(o,i),Ei=S,Fr(i),g&4&&h!==null&&h.memoizedState.isDehydrated)try{_a(o.containerInfo)}catch(Je){xt(i,i.return,Je)}Eh&&(Eh=!1,wv(i));break;case 4:g=Ei,Ei=cu(i.stateNode.containerInfo),Br(o,i),Fr(i),Ei=g;break;case 12:Br(o,i),Fr(i);break;case 31:Br(o,i),Fr(i),g&4&&(g=i.updateQueue,g!==null&&(i.updateQueue=null,Ql(i,g)));break;case 13:Br(o,i),Fr(i),i.child.flags&8192&&i.memoizedState!==null!=(h!==null&&h.memoizedState!==null)&&(Zl=Ae()),g&4&&(g=i.updateQueue,g!==null&&(i.updateQueue=null,Ql(i,g)));break;case 22:S=i.memoizedState!==null;var oe=h!==null&&h.memoizedState!==null,_e=rn,Be=tr;if(rn=_e||S,tr=Be||oe,Br(o,i),tr=Be,rn=_e,Fr(i),g&8192)e:for(o=i.stateNode,o._visibility=S?o._visibility&-2:o._visibility|1,S&&(h===null||oe||rn||tr||As(i)),h=null,o=i;;){if(o.tag===5||o.tag===26){if(h===null){oe=h=o;try{if(_=oe.stateNode,S)k=_.style,typeof k.setProperty=="function"?k.setProperty("display","none","important"):k.display="none";else{G=oe.stateNode;var He=oe.memoizedProps.style,we=He!=null&&He.hasOwnProperty("display")?He.display:null;G.style.display=we==null||typeof we=="boolean"?"":(""+we).trim()}}catch(Je){xt(oe,oe.return,Je)}}}else if(o.tag===6){if(h===null){oe=o;try{oe.stateNode.nodeValue=S?"":oe.memoizedProps}catch(Je){xt(oe,oe.return,Je)}}}else if(o.tag===18){if(h===null){oe=o;try{var Oe=oe.stateNode;S?gb(Oe,!0):gb(oe.stateNode,!1)}catch(Je){xt(oe,oe.return,Je)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===i)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===i)break e;for(;o.sibling===null;){if(o.return===null||o.return===i)break e;h===o&&(h=null),o=o.return}h===o&&(h=null),o.sibling.return=o.return,o=o.sibling}g&4&&(g=i.updateQueue,g!==null&&(h=g.retryQueue,h!==null&&(g.retryQueue=null,Ql(i,h))));break;case 19:Br(o,i),Fr(i),g&4&&(g=i.updateQueue,g!==null&&(i.updateQueue=null,Ql(i,g)));break;case 30:break;case 21:break;default:Br(o,i),Fr(i)}}function Fr(i){var o=i.flags;if(o&2){try{for(var h,g=i.return;g!==null;){if(yv(g)){h=g;break}g=g.return}if(h==null)throw Error(r(160));switch(h.tag){case 27:var S=h.stateNode,_=vh(i);Wl(i,_,S);break;case 5:var k=h.stateNode;h.flags&32&&(qs(k,""),h.flags&=-33);var G=vh(i);Wl(i,G,k);break;case 3:case 4:var oe=h.stateNode.containerInfo,_e=vh(i);bh(i,_e,oe);break;default:throw Error(r(161))}}catch(Be){xt(i,i.return,Be)}i.flags&=-3}o&4096&&(i.flags&=-4097)}function wv(i){if(i.subtreeFlags&1024)for(i=i.child;i!==null;){var o=i;wv(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),i=i.sibling}}function sn(i,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)Ev(i,o.alternate,o),o=o.sibling}function As(i){for(i=i.child;i!==null;){var o=i;switch(o.tag){case 0:case 11:case 14:case 15:Un(4,o,o.return),As(o);break;case 1:Ii(o,o.return);var h=o.stateNode;typeof h.componentWillUnmount=="function"&&gv(o,o.return,h),As(o);break;case 27:Co(o.stateNode);case 26:case 5:Ii(o,o.return),As(o);break;case 22:o.memoizedState===null&&As(o);break;case 30:As(o);break;default:As(o)}i=i.sibling}}function an(i,o,h){for(h=h&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var g=o.alternate,S=i,_=o,k=_.flags;switch(_.tag){case 0:case 11:case 15:an(S,_,h),Eo(4,_);break;case 1:if(an(S,_,h),g=_,S=g.stateNode,typeof S.componentDidMount=="function")try{S.componentDidMount()}catch(_e){xt(g,g.return,_e)}if(g=_,S=g.updateQueue,S!==null){var G=g.stateNode;try{var oe=S.shared.hiddenCallbacks;if(oe!==null)for(S.shared.hiddenCallbacks=null,S=0;S<oe.length;S++)iy(oe[S],G)}catch(_e){xt(g,g.return,_e)}}h&&k&64&&pv(_),So(_,_.return);break;case 27:vv(_);case 26:case 5:an(S,_,h),h&&g===null&&k&4&&mv(_),So(_,_.return);break;case 12:an(S,_,h);break;case 31:an(S,_,h),h&&k&4&&xv(S,_);break;case 13:an(S,_,h),h&&k&4&&_v(S,_);break;case 22:_.memoizedState===null&&an(S,_,h),So(_,_.return);break;case 30:break;default:an(S,_,h)}o=o.sibling}}function Sh(i,o){var h=null;i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(h=i.memoizedState.cachePool.pool),i=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(i=o.memoizedState.cachePool.pool),i!==h&&(i!=null&&i.refCount++,h!=null&&ao(h))}function Th(i,o){i=null,o.alternate!==null&&(i=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==i&&(o.refCount++,i!=null&&ao(i))}function Si(i,o,h,g){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)Rv(i,o,h,g),o=o.sibling}function Rv(i,o,h,g){var S=o.flags;switch(o.tag){case 0:case 11:case 15:Si(i,o,h,g),S&2048&&Eo(9,o);break;case 1:Si(i,o,h,g);break;case 3:Si(i,o,h,g),S&2048&&(i=null,o.alternate!==null&&(i=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==i&&(o.refCount++,i!=null&&ao(i)));break;case 12:if(S&2048){Si(i,o,h,g),i=o.stateNode;try{var _=o.memoizedProps,k=_.id,G=_.onPostCommit;typeof G=="function"&&G(k,o.alternate===null?"mount":"update",i.passiveEffectDuration,-0)}catch(oe){xt(o,o.return,oe)}}else Si(i,o,h,g);break;case 31:Si(i,o,h,g);break;case 13:Si(i,o,h,g);break;case 23:break;case 22:_=o.stateNode,k=o.alternate,o.memoizedState!==null?_._visibility&2?Si(i,o,h,g):To(i,o):_._visibility&2?Si(i,o,h,g):(_._visibility|=2,da(i,o,h,g,(o.subtreeFlags&10256)!==0||!1)),S&2048&&Sh(k,o);break;case 24:Si(i,o,h,g),S&2048&&Th(o.alternate,o);break;default:Si(i,o,h,g)}}function da(i,o,h,g,S){for(S=S&&((o.subtreeFlags&10256)!==0||!1),o=o.child;o!==null;){var _=i,k=o,G=h,oe=g,_e=k.flags;switch(k.tag){case 0:case 11:case 15:da(_,k,G,oe,S),Eo(8,k);break;case 23:break;case 22:var Be=k.stateNode;k.memoizedState!==null?Be._visibility&2?da(_,k,G,oe,S):To(_,k):(Be._visibility|=2,da(_,k,G,oe,S)),S&&_e&2048&&Sh(k.alternate,k);break;case 24:da(_,k,G,oe,S),S&&_e&2048&&Th(k.alternate,k);break;default:da(_,k,G,oe,S)}o=o.sibling}}function To(i,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var h=i,g=o,S=g.flags;switch(g.tag){case 22:To(h,g),S&2048&&Sh(g.alternate,g);break;case 24:To(h,g),S&2048&&Th(g.alternate,g);break;default:To(h,g)}o=o.sibling}}var xo=8192;function pa(i,o,h){if(i.subtreeFlags&xo)for(i=i.child;i!==null;)Iv(i,o,h),i=i.sibling}function Iv(i,o,h){switch(i.tag){case 26:pa(i,o,h),i.flags&xo&&i.memoizedState!==null&&nR(h,Ei,i.memoizedState,i.memoizedProps);break;case 5:pa(i,o,h);break;case 3:case 4:var g=Ei;Ei=cu(i.stateNode.containerInfo),pa(i,o,h),Ei=g;break;case 22:i.memoizedState===null&&(g=i.alternate,g!==null&&g.memoizedState!==null?(g=xo,xo=16777216,pa(i,o,h),xo=g):pa(i,o,h));break;default:pa(i,o,h)}}function Lv(i){var o=i.alternate;if(o!==null&&(i=o.child,i!==null)){o.child=null;do o=i.sibling,i.sibling=null,i=o;while(i!==null)}}function _o(i){var o=i.deletions;if((i.flags&16)!==0){if(o!==null)for(var h=0;h<o.length;h++){var g=o[h];ur=g,Dv(g,i)}Lv(i)}if(i.subtreeFlags&10256)for(i=i.child;i!==null;)Cv(i),i=i.sibling}function Cv(i){switch(i.tag){case 0:case 11:case 15:_o(i),i.flags&2048&&Un(9,i,i.return);break;case 3:_o(i);break;case 12:_o(i);break;case 22:var o=i.stateNode;i.memoizedState!==null&&o._visibility&2&&(i.return===null||i.return.tag!==13)?(o._visibility&=-3,Xl(i)):_o(i);break;default:_o(i)}}function Xl(i){var o=i.deletions;if((i.flags&16)!==0){if(o!==null)for(var h=0;h<o.length;h++){var g=o[h];ur=g,Dv(g,i)}Lv(i)}for(i=i.child;i!==null;){switch(o=i,o.tag){case 0:case 11:case 15:Un(8,o,o.return),Xl(o);break;case 22:h=o.stateNode,h._visibility&2&&(h._visibility&=-3,Xl(o));break;default:Xl(o)}i=i.sibling}}function Dv(i,o){for(;ur!==null;){var h=ur;switch(h.tag){case 0:case 11:case 15:Un(8,h,o);break;case 23:case 22:if(h.memoizedState!==null&&h.memoizedState.cachePool!==null){var g=h.memoizedState.cachePool.pool;g!=null&&g.refCount++}break;case 24:ao(h.memoizedState.cache)}if(g=h.child,g!==null)g.return=h,ur=g;else e:for(h=i;ur!==null;){g=ur;var S=g.sibling,_=g.return;if(Sv(g),g===h){ur=null;break e}if(S!==null){S.return=_,ur=S;break e}ur=_}}}var bw={getCacheForType:function(i){var o=pr(Zt),h=o.data.get(i);return h===void 0&&(h=i(),o.data.set(i,h)),h},cacheSignal:function(){return pr(Zt).controller.signal}},Ew=typeof WeakMap=="function"?WeakMap:Map,St=0,Dt=null,pt=null,mt=0,Tt=0,Xr=null,Bn=!1,ga=!1,xh=!1,on=0,zt=0,Fn=0,ws=0,_h=0,Zr=0,ma=0,Ao=null,jr=null,Ah=!1,Zl=0,Ov=0,Jl=1/0,eu=null,jn=null,sr=0,$n=null,ya=null,ln=0,wh=0,Rh=null,kv=null,wo=0,Ih=null;function Jr(){return(St&2)!==0&&mt!==0?mt&-mt:H.T!==null?Mh():Or()}function Mv(){if(Zr===0)if((mt&536870912)===0||vt){var i=Yt;Yt<<=1,(Yt&3932160)===0&&(Yt=262144),Zr=i}else Zr=536870912;return i=Wr.current,i!==null&&(i.flags|=32),Zr}function $r(i,o,h){(i===Dt&&(Tt===2||Tt===9)||i.cancelPendingCommit!==null)&&(va(i,0),Gn(i,mt,Zr,!1)),Q(i,h),((St&2)===0||i!==Dt)&&(i===Dt&&((St&2)===0&&(ws|=h),zt===4&&Gn(i,mt,Zr,!1)),Li(i))}function Pv(i,o,h){if((St&6)!==0)throw Error(r(327));var g=!h&&(o&127)===0&&(o&i.expiredLanes)===0||rr(i,o),S=g?xw(i,o):Ch(i,o,!0),_=g;do{if(S===0){ga&&!g&&Gn(i,o,0,!1);break}else{if(h=i.current.alternate,_&&!Sw(h)){S=Ch(i,o,!1),_=!1;continue}if(S===2){if(_=o,i.errorRecoveryDisabledLanes&_)var k=0;else k=i.pendingLanes&-536870913,k=k!==0?k:k&536870912?536870912:0;if(k!==0){o=k;e:{var G=i;S=Ao;var oe=G.current.memoizedState.isDehydrated;if(oe&&(va(G,k).flags|=256),k=Ch(G,k,!1),k!==2){if(xh&&!oe){G.errorRecoveryDisabledLanes|=_,ws|=_,S=4;break e}_=jr,jr=S,_!==null&&(jr===null?jr=_:jr.push.apply(jr,_))}S=k}if(_=!1,S!==2)continue}}if(S===1){va(i,0),Gn(i,o,0,!0);break}e:{switch(g=i,_=S,_){case 0:case 1:throw Error(r(345));case 4:if((o&4194048)!==o)break;case 6:Gn(g,o,Zr,!Bn);break e;case 2:jr=null;break;case 3:case 5:break;default:throw Error(r(329))}if((o&62914560)===o&&(S=Zl+300-Ae(),10<S)){if(Gn(g,o,Zr,!Bn),wr(g,0,!0)!==0)break e;ln=o,g.timeoutHandle=hb(Nv.bind(null,g,h,jr,eu,Ah,o,Zr,ws,ma,Bn,_,"Throttled",-0,0),S);break e}Nv(g,h,jr,eu,Ah,o,Zr,ws,ma,Bn,_,null,-0,0)}}break}while(!0);Li(i)}function Nv(i,o,h,g,S,_,k,G,oe,_e,Be,He,we,Oe){if(i.timeoutHandle=-1,He=o.subtreeFlags,He&8192||(He&16785408)===16785408){He={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:zi},Iv(o,_,He);var Je=(_&62914560)===_?Zl-Ae():(_&4194048)===_?Ov-Ae():0;if(Je=sR(He,Je),Je!==null){ln=_,i.cancelPendingCommit=Je(Kv.bind(null,i,o,_,h,g,S,k,G,oe,Be,He,null,we,Oe)),Gn(i,_,k,!_e);return}}Kv(i,o,_,h,g,S,k,G,oe)}function Sw(i){for(var o=i;;){var h=o.tag;if((h===0||h===11||h===15)&&o.flags&16384&&(h=o.updateQueue,h!==null&&(h=h.stores,h!==null)))for(var g=0;g<h.length;g++){var S=h[g],_=S.getSnapshot;S=S.value;try{if(!qr(_(),S))return!1}catch{return!1}}if(h=o.child,o.subtreeFlags&16384&&h!==null)h.return=o,o=h;else{if(o===i)break;for(;o.sibling===null;){if(o.return===null||o.return===i)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function Gn(i,o,h,g){o&=~_h,o&=~ws,i.suspendedLanes|=o,i.pingedLanes&=~o,g&&(i.warmLanes|=o),g=i.expirationTimes;for(var S=o;0<S;){var _=31-We(S),k=1<<_;g[_]=-1,S&=~k}h!==0&&Ve(i,h,o)}function tu(){return(St&6)===0?(Ro(0),!1):!0}function Lh(){if(pt!==null){if(Tt===0)var i=pt.return;else i=pt,Qi=ys=null,Vf(i),la=null,lo=0,i=pt;for(;i!==null;)dv(i.alternate,i),i=i.return;pt=null}}function va(i,o){var h=i.timeoutHandle;h!==-1&&(i.timeoutHandle=-1,$w(h)),h=i.cancelPendingCommit,h!==null&&(i.cancelPendingCommit=null,h()),ln=0,Lh(),Dt=i,pt=h=Yi(i.current,null),mt=o,Tt=0,Xr=null,Bn=!1,ga=rr(i,o),xh=!1,ma=Zr=_h=ws=Fn=zt=0,jr=Ao=null,Ah=!1,(o&8)!==0&&(o|=o&32);var g=i.entangledLanes;if(g!==0)for(i=i.entanglements,g&=o;0<g;){var S=31-We(g),_=1<<S;o|=i[S],g&=~_}return on=o,Tl(),h}function Uv(i,o){ct=null,H.H=yo,o===oa||o===Cl?(o=J0(),Tt=3):o===kf?(o=J0(),Tt=4):Tt=o===oh?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,Xr=o,pt===null&&(zt=1,Kl(i,ci(o,i.current)))}function Bv(){var i=Wr.current;return i===null?!0:(mt&4194048)===mt?pi===null:(mt&62914560)===mt||(mt&536870912)!==0?i===pi:!1}function Fv(){var i=H.H;return H.H=yo,i===null?yo:i}function jv(){var i=H.A;return H.A=bw,i}function ru(){zt=4,Bn||(mt&4194048)!==mt&&Wr.current!==null||(ga=!0),(Fn&134217727)===0&&(ws&134217727)===0||Dt===null||Gn(Dt,mt,Zr,!1)}function Ch(i,o,h){var g=St;St|=2;var S=Fv(),_=jv();(Dt!==i||mt!==o)&&(eu=null,va(i,o)),o=!1;var k=zt;e:do try{if(Tt!==0&&pt!==null){var G=pt,oe=Xr;switch(Tt){case 8:Lh(),k=6;break e;case 3:case 2:case 9:case 6:Wr.current===null&&(o=!0);var _e=Tt;if(Tt=0,Xr=null,ba(i,G,oe,_e),h&&ga){k=0;break e}break;default:_e=Tt,Tt=0,Xr=null,ba(i,G,oe,_e)}}Tw(),k=zt;break}catch(Be){Uv(i,Be)}while(!0);return o&&i.shellSuspendCounter++,Qi=ys=null,St=g,H.H=S,H.A=_,pt===null&&(Dt=null,mt=0,Tl()),k}function Tw(){for(;pt!==null;)$v(pt)}function xw(i,o){var h=St;St|=2;var g=Fv(),S=jv();Dt!==i||mt!==o?(eu=null,Jl=Ae()+500,va(i,o)):ga=rr(i,o);e:do try{if(Tt!==0&&pt!==null){o=pt;var _=Xr;t:switch(Tt){case 1:Tt=0,Xr=null,ba(i,o,_,1);break;case 2:case 9:if(X0(_)){Tt=0,Xr=null,Gv(o);break}o=function(){Tt!==2&&Tt!==9||Dt!==i||(Tt=7),Li(i)},_.then(o,o);break e;case 3:Tt=7;break e;case 4:Tt=5;break e;case 7:X0(_)?(Tt=0,Xr=null,Gv(o)):(Tt=0,Xr=null,ba(i,o,_,7));break;case 5:var k=null;switch(pt.tag){case 26:k=pt.memoizedState;case 5:case 27:var G=pt;if(k?Rb(k):G.stateNode.complete){Tt=0,Xr=null;var oe=G.sibling;if(oe!==null)pt=oe;else{var _e=G.return;_e!==null?(pt=_e,iu(_e)):pt=null}break t}}Tt=0,Xr=null,ba(i,o,_,5);break;case 6:Tt=0,Xr=null,ba(i,o,_,6);break;case 8:Lh(),zt=6;break e;default:throw Error(r(462))}}_w();break}catch(Be){Uv(i,Be)}while(!0);return Qi=ys=null,H.H=g,H.A=S,St=h,pt!==null?0:(Dt=null,mt=0,Tl(),zt)}function _w(){for(;pt!==null&&!Ne();)$v(pt)}function $v(i){var o=fv(i.alternate,i,on);i.memoizedProps=i.pendingProps,o===null?iu(i):pt=o}function Gv(i){var o=i,h=o.alternate;switch(o.tag){case 15:case 0:o=sv(h,o,o.pendingProps,o.type,void 0,mt);break;case 11:o=sv(h,o,o.pendingProps,o.type.render,o.ref,mt);break;case 5:Vf(o);default:dv(h,o),o=pt=j0(o,on),o=fv(h,o,on)}i.memoizedProps=i.pendingProps,o===null?iu(i):pt=o}function ba(i,o,h,g){Qi=ys=null,Vf(o),la=null,lo=0;var S=o.return;try{if(hw(i,S,o,h,mt)){zt=1,Kl(i,ci(h,i.current)),pt=null;return}}catch(_){if(S!==null)throw pt=S,_;zt=1,Kl(i,ci(h,i.current)),pt=null;return}o.flags&32768?(vt||g===1?i=!0:ga||(mt&536870912)!==0?i=!1:(Bn=i=!0,(g===2||g===9||g===3||g===6)&&(g=Wr.current,g!==null&&g.tag===13&&(g.flags|=16384))),Hv(o,i)):iu(o)}function iu(i){var o=i;do{if((o.flags&32768)!==0){Hv(o,Bn);return}i=o.return;var h=gw(o.alternate,o,on);if(h!==null){pt=h;return}if(o=o.sibling,o!==null){pt=o;return}pt=o=i}while(o!==null);zt===0&&(zt=5)}function Hv(i,o){do{var h=mw(i.alternate,i);if(h!==null){h.flags&=32767,pt=h;return}if(h=i.return,h!==null&&(h.flags|=32768,h.subtreeFlags=0,h.deletions=null),!o&&(i=i.sibling,i!==null)){pt=i;return}pt=i=h}while(i!==null);zt=6,pt=null}function Kv(i,o,h,g,S,_,k,G,oe){i.cancelPendingCommit=null;do nu();while(sr!==0);if((St&6)!==0)throw Error(r(327));if(o!==null){if(o===i.current)throw Error(r(177));if(_=o.lanes|o.childLanes,_|=vf,re(i,h,_,k,G,oe),i===Dt&&(pt=Dt=null,mt=0),ya=o,$n=i,ln=h,wh=_,Rh=S,kv=g,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(i.callbackNode=null,i.callbackPriority=0,Iw(j,function(){return Wv(),null})):(i.callbackNode=null,i.callbackPriority=0),g=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||g){g=H.T,H.T=null,S=K.p,K.p=2,k=St,St|=4;try{yw(i,o,h)}finally{St=k,K.p=S,H.T=g}}sr=1,Vv(),zv(),qv()}}function Vv(){if(sr===1){sr=0;var i=$n,o=ya,h=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||h){h=H.T,H.T=null;var g=K.p;K.p=2;var S=St;St|=4;try{Av(o,i);var _=Gh,k=D0(i.containerInfo),G=_.focusedElem,oe=_.selectionRange;if(k!==G&&G&&G.ownerDocument&&C0(G.ownerDocument.documentElement,G)){if(oe!==null&&df(G)){var _e=oe.start,Be=oe.end;if(Be===void 0&&(Be=_e),"selectionStart"in G)G.selectionStart=_e,G.selectionEnd=Math.min(Be,G.value.length);else{var He=G.ownerDocument||document,we=He&&He.defaultView||window;if(we.getSelection){var Oe=we.getSelection(),Je=G.textContent.length,it=Math.min(oe.start,Je),It=oe.end===void 0?it:Math.min(oe.end,Je);!Oe.extend&&it>It&&(k=It,It=it,it=k);var ve=L0(G,it),fe=L0(G,It);if(ve&&fe&&(Oe.rangeCount!==1||Oe.anchorNode!==ve.node||Oe.anchorOffset!==ve.offset||Oe.focusNode!==fe.node||Oe.focusOffset!==fe.offset)){var xe=He.createRange();xe.setStart(ve.node,ve.offset),Oe.removeAllRanges(),it>It?(Oe.addRange(xe),Oe.extend(fe.node,fe.offset)):(xe.setEnd(fe.node,fe.offset),Oe.addRange(xe))}}}}for(He=[],Oe=G;Oe=Oe.parentNode;)Oe.nodeType===1&&He.push({element:Oe,left:Oe.scrollLeft,top:Oe.scrollTop});for(typeof G.focus=="function"&&G.focus(),G=0;G<He.length;G++){var Ge=He[G];Ge.element.scrollLeft=Ge.left,Ge.element.scrollTop=Ge.top}}mu=!!$h,Gh=$h=null}finally{St=S,K.p=g,H.T=h}}i.current=o,sr=2}}function zv(){if(sr===2){sr=0;var i=$n,o=ya,h=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||h){h=H.T,H.T=null;var g=K.p;K.p=2;var S=St;St|=4;try{Ev(i,o.alternate,o)}finally{St=S,K.p=g,H.T=h}}sr=3}}function qv(){if(sr===4||sr===3){sr=0,Ke();var i=$n,o=ya,h=ln,g=kv;(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?sr=5:(sr=0,ya=$n=null,Yv(i,i.pendingLanes));var S=i.pendingLanes;if(S===0&&(jn=null),ir(h),o=o.stateNode,Te&&typeof Te.onCommitFiberRoot=="function")try{Te.onCommitFiberRoot(de,o,void 0,(o.current.flags&128)===128)}catch{}if(g!==null){o=H.T,S=K.p,K.p=2,H.T=null;try{for(var _=i.onRecoverableError,k=0;k<g.length;k++){var G=g[k];_(G.value,{componentStack:G.stack})}}finally{H.T=o,K.p=S}}(ln&3)!==0&&nu(),Li(i),S=i.pendingLanes,(h&261930)!==0&&(S&42)!==0?i===Ih?wo++:(wo=0,Ih=i):wo=0,Ro(0)}}function Yv(i,o){(i.pooledCacheLanes&=o)===0&&(o=i.pooledCache,o!=null&&(i.pooledCache=null,ao(o)))}function nu(){return Vv(),zv(),qv(),Wv()}function Wv(){if(sr!==5)return!1;var i=$n,o=wh;wh=0;var h=ir(ln),g=H.T,S=K.p;try{K.p=32>h?32:h,H.T=null,h=Rh,Rh=null;var _=$n,k=ln;if(sr=0,ya=$n=null,ln=0,(St&6)!==0)throw Error(r(331));var G=St;if(St|=4,Cv(_.current),Rv(_,_.current,k,h),St=G,Ro(0,!1),Te&&typeof Te.onPostCommitFiberRoot=="function")try{Te.onPostCommitFiberRoot(de,_)}catch{}return!0}finally{K.p=S,H.T=g,Yv(i,o)}}function Qv(i,o,h){o=ci(h,o),o=ah(i.stateNode,o,2),i=Mn(i,o,2),i!==null&&(Q(i,2),Li(i))}function xt(i,o,h){if(i.tag===3)Qv(i,i,h);else for(;o!==null;){if(o.tag===3){Qv(o,i,h);break}else if(o.tag===1){var g=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof g.componentDidCatch=="function"&&(jn===null||!jn.has(g))){i=ci(h,i),h=Xy(2),g=Mn(o,h,2),g!==null&&(Zy(h,g,o,i),Q(g,2),Li(g));break}}o=o.return}}function Dh(i,o,h){var g=i.pingCache;if(g===null){g=i.pingCache=new Ew;var S=new Set;g.set(o,S)}else S=g.get(o),S===void 0&&(S=new Set,g.set(o,S));S.has(h)||(xh=!0,S.add(h),i=Aw.bind(null,i,o,h),o.then(i,i))}function Aw(i,o,h){var g=i.pingCache;g!==null&&g.delete(o),i.pingedLanes|=i.suspendedLanes&h,i.warmLanes&=~h,Dt===i&&(mt&h)===h&&(zt===4||zt===3&&(mt&62914560)===mt&&300>Ae()-Zl?(St&2)===0&&va(i,0):_h|=h,ma===mt&&(ma=0)),Li(i)}function Xv(i,o){o===0&&(o=Gi()),i=ps(i,o),i!==null&&(Q(i,o),Li(i))}function ww(i){var o=i.memoizedState,h=0;o!==null&&(h=o.retryLane),Xv(i,h)}function Rw(i,o){var h=0;switch(i.tag){case 31:case 13:var g=i.stateNode,S=i.memoizedState;S!==null&&(h=S.retryLane);break;case 19:g=i.stateNode;break;case 22:g=i.stateNode._retryCache;break;default:throw Error(r(314))}g!==null&&g.delete(o),Xv(i,h)}function Iw(i,o){return Ue(i,o)}var su=null,Ea=null,Oh=!1,au=!1,kh=!1,Hn=0;function Li(i){i!==Ea&&i.next===null&&(Ea===null?su=Ea=i:Ea=Ea.next=i),au=!0,Oh||(Oh=!0,Cw())}function Ro(i,o){if(!kh&&au){kh=!0;do for(var h=!1,g=su;g!==null;){if(i!==0){var S=g.pendingLanes;if(S===0)var _=0;else{var k=g.suspendedLanes,G=g.pingedLanes;_=(1<<31-We(42|i)+1)-1,_&=S&~(k&~G),_=_&201326741?_&201326741|1:_?_|2:0}_!==0&&(h=!0,tb(g,_))}else _=mt,_=wr(g,g===Dt?_:0,g.cancelPendingCommit!==null||g.timeoutHandle!==-1),(_&3)===0||rr(g,_)||(h=!0,tb(g,_));g=g.next}while(h);kh=!1}}function Lw(){Zv()}function Zv(){au=Oh=!1;var i=0;Hn!==0&&jw()&&(i=Hn);for(var o=Ae(),h=null,g=su;g!==null;){var S=g.next,_=Jv(g,o);_===0?(g.next=null,h===null?su=S:h.next=S,S===null&&(Ea=h)):(h=g,(i!==0||(_&3)!==0)&&(au=!0)),g=S}sr!==0&&sr!==5||Ro(i),Hn!==0&&(Hn=0)}function Jv(i,o){for(var h=i.suspendedLanes,g=i.pingedLanes,S=i.expirationTimes,_=i.pendingLanes&-62914561;0<_;){var k=31-We(_),G=1<<k,oe=S[k];oe===-1?((G&h)===0||(G&g)!==0)&&(S[k]=$s(G,o)):oe<=o&&(i.expiredLanes|=G),_&=~G}if(o=Dt,h=mt,h=wr(i,i===o?h:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),g=i.callbackNode,h===0||i===o&&(Tt===2||Tt===9)||i.cancelPendingCommit!==null)return g!==null&&g!==null&&le(g),i.callbackNode=null,i.callbackPriority=0;if((h&3)===0||rr(i,h)){if(o=h&-h,o===i.callbackPriority)return o;switch(g!==null&&le(g),ir(h)){case 2:case 8:h=D;break;case 32:h=j;break;case 268435456:h=ye;break;default:h=j}return g=eb.bind(null,i),h=Ue(h,g),i.callbackPriority=o,i.callbackNode=h,o}return g!==null&&g!==null&&le(g),i.callbackPriority=2,i.callbackNode=null,2}function eb(i,o){if(sr!==0&&sr!==5)return i.callbackNode=null,i.callbackPriority=0,null;var h=i.callbackNode;if(nu()&&i.callbackNode!==h)return null;var g=mt;return g=wr(i,i===Dt?g:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),g===0?null:(Pv(i,g,o),Jv(i,Ae()),i.callbackNode!=null&&i.callbackNode===h?eb.bind(null,i):null)}function tb(i,o){if(nu())return null;Pv(i,o,!0)}function Cw(){Gw(function(){(St&6)!==0?Ue(R,Lw):Zv()})}function Mh(){if(Hn===0){var i=sa;i===0&&(i=_r,_r<<=1,(_r&261888)===0&&(_r=256)),Hn=i}return Hn}function rb(i){return i==null||typeof i=="symbol"||typeof i=="boolean"?null:typeof i=="function"?i:pl(""+i)}function ib(i,o){var h=o.ownerDocument.createElement("input");return h.name=o.name,h.value=o.value,i.id&&h.setAttribute("form",i.id),o.parentNode.insertBefore(h,o),i=new FormData(i),h.parentNode.removeChild(h),i}function Dw(i,o,h,g,S){if(o==="submit"&&h&&h.stateNode===S){var _=rb((S[nr]||null).action),k=g.submitter;k&&(o=(o=k[nr]||null)?rb(o.formAction):k.getAttribute("formAction"),o!==null&&(_=o,k=null));var G=new vl("action","action",null,g,S);i.push({event:G,listeners:[{instance:null,listener:function(){if(g.defaultPrevented){if(Hn!==0){var oe=k?ib(S,k):new FormData(S);eh(h,{pending:!0,data:oe,method:S.method,action:_},null,oe)}}else typeof _=="function"&&(G.preventDefault(),oe=k?ib(S,k):new FormData(S),eh(h,{pending:!0,data:oe,method:S.method,action:_},_,oe))},currentTarget:S}]})}}for(var Ph=0;Ph<yf.length;Ph++){var Nh=yf[Ph],Ow=Nh.toLowerCase(),kw=Nh[0].toUpperCase()+Nh.slice(1);bi(Ow,"on"+kw)}bi(M0,"onAnimationEnd"),bi(P0,"onAnimationIteration"),bi(N0,"onAnimationStart"),bi("dblclick","onDoubleClick"),bi("focusin","onFocus"),bi("focusout","onBlur"),bi(W1,"onTransitionRun"),bi(Q1,"onTransitionStart"),bi(X1,"onTransitionCancel"),bi(U0,"onTransitionEnd"),Vs("onMouseEnter",["mouseout","mouseover"]),Vs("onMouseLeave",["mouseout","mouseover"]),Vs("onPointerEnter",["pointerout","pointerover"]),Vs("onPointerLeave",["pointerout","pointerover"]),cs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),cs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),cs("onBeforeInput",["compositionend","keypress","textInput","paste"]),cs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),cs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),cs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Io="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Mw=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Io));function nb(i,o){o=(o&4)!==0;for(var h=0;h<i.length;h++){var g=i[h],S=g.event;g=g.listeners;e:{var _=void 0;if(o)for(var k=g.length-1;0<=k;k--){var G=g[k],oe=G.instance,_e=G.currentTarget;if(G=G.listener,oe!==_&&S.isPropagationStopped())break e;_=G,S.currentTarget=_e;try{_(S)}catch(Be){Sl(Be)}S.currentTarget=null,_=oe}else for(k=0;k<g.length;k++){if(G=g[k],oe=G.instance,_e=G.currentTarget,G=G.listener,oe!==_&&S.isPropagationStopped())break e;_=G,S.currentTarget=_e;try{_(S)}catch(Be){Sl(Be)}S.currentTarget=null,_=oe}}}}function gt(i,o){var h=o[Pr];h===void 0&&(h=o[Pr]=new Set);var g=i+"__bubble";h.has(g)||(sb(o,i,2,!1),h.add(g))}function Uh(i,o,h){var g=0;o&&(g|=4),sb(h,i,g,o)}var ou="_reactListening"+Math.random().toString(36).slice(2);function Bh(i){if(!i[ou]){i[ou]=!0,Zm.forEach(function(h){h!=="selectionchange"&&(Mw.has(h)||Uh(h,!1,i),Uh(h,!0,i))});var o=i.nodeType===9?i:i.ownerDocument;o===null||o[ou]||(o[ou]=!0,Uh("selectionchange",!1,o))}}function sb(i,o,h,g){switch(Mb(o)){case 2:var S=lR;break;case 8:S=uR;break;default:S=Jh}h=S.bind(null,o,h,i),S=void 0,!nf||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(S=!0),g?S!==void 0?i.addEventListener(o,h,{capture:!0,passive:S}):i.addEventListener(o,h,!0):S!==void 0?i.addEventListener(o,h,{passive:S}):i.addEventListener(o,h,!1)}function Fh(i,o,h,g,S){var _=g;if((o&1)===0&&(o&2)===0&&g!==null)e:for(;;){if(g===null)return;var k=g.tag;if(k===3||k===4){var G=g.stateNode.containerInfo;if(G===S)break;if(k===4)for(k=g.return;k!==null;){var oe=k.tag;if((oe===3||oe===4)&&k.stateNode.containerInfo===S)return;k=k.return}for(;G!==null;){if(k=Gs(G),k===null)return;if(oe=k.tag,oe===5||oe===6||oe===26||oe===27){g=_=k;continue e}G=G.parentNode}}g=g.return}c0(function(){var _e=_,Be=tf(h),He=[];e:{var we=B0.get(i);if(we!==void 0){var Oe=vl,Je=i;switch(i){case"keypress":if(ml(h)===0)break e;case"keydown":case"keyup":Oe=R1;break;case"focusin":Je="focus",Oe=lf;break;case"focusout":Je="blur",Oe=lf;break;case"beforeblur":case"afterblur":Oe=lf;break;case"click":if(h.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Oe=d0;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Oe=g1;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Oe=C1;break;case M0:case P0:case N0:Oe=v1;break;case U0:Oe=O1;break;case"scroll":case"scrollend":Oe=d1;break;case"wheel":Oe=M1;break;case"copy":case"cut":case"paste":Oe=E1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Oe=g0;break;case"toggle":case"beforetoggle":Oe=N1}var it=(o&4)!==0,It=!it&&(i==="scroll"||i==="scrollend"),ve=it?we!==null?we+"Capture":null:we;it=[];for(var fe=_e,xe;fe!==null;){var Ge=fe;if(xe=Ge.stateNode,Ge=Ge.tag,Ge!==5&&Ge!==26&&Ge!==27||xe===null||ve===null||(Ge=Wa(fe,ve),Ge!=null&&it.push(Lo(fe,Ge,xe))),It)break;fe=fe.return}0<it.length&&(we=new Oe(we,Je,null,h,Be),He.push({event:we,listeners:it}))}}if((o&7)===0){e:{if(we=i==="mouseover"||i==="pointerover",Oe=i==="mouseout"||i==="pointerout",we&&h!==ef&&(Je=h.relatedTarget||h.fromElement)&&(Gs(Je)||Je[Mr]))break e;if((Oe||we)&&(we=Be.window===Be?Be:(we=Be.ownerDocument)?we.defaultView||we.parentWindow:window,Oe?(Je=h.relatedTarget||h.toElement,Oe=_e,Je=Je?Gs(Je):null,Je!==null&&(It=s(Je),it=Je.tag,Je!==It||it!==5&&it!==27&&it!==6)&&(Je=null)):(Oe=null,Je=_e),Oe!==Je)){if(it=d0,Ge="onMouseLeave",ve="onMouseEnter",fe="mouse",(i==="pointerout"||i==="pointerover")&&(it=g0,Ge="onPointerLeave",ve="onPointerEnter",fe="pointer"),It=Oe==null?we:Ya(Oe),xe=Je==null?we:Ya(Je),we=new it(Ge,fe+"leave",Oe,h,Be),we.target=It,we.relatedTarget=xe,Ge=null,Gs(Be)===_e&&(it=new it(ve,fe+"enter",Je,h,Be),it.target=xe,it.relatedTarget=It,Ge=it),It=Ge,Oe&&Je)t:{for(it=Pw,ve=Oe,fe=Je,xe=0,Ge=ve;Ge;Ge=it(Ge))xe++;Ge=0;for(var rt=fe;rt;rt=it(rt))Ge++;for(;0<xe-Ge;)ve=it(ve),xe--;for(;0<Ge-xe;)fe=it(fe),Ge--;for(;xe--;){if(ve===fe||fe!==null&&ve===fe.alternate){it=ve;break t}ve=it(ve),fe=it(fe)}it=null}else it=null;Oe!==null&&ab(He,we,Oe,it,!1),Je!==null&&It!==null&&ab(He,It,Je,it,!0)}}e:{if(we=_e?Ya(_e):window,Oe=we.nodeName&&we.nodeName.toLowerCase(),Oe==="select"||Oe==="input"&&we.type==="file")var bt=x0;else if(S0(we))if(_0)bt=z1;else{bt=K1;var et=H1}else Oe=we.nodeName,!Oe||Oe.toLowerCase()!=="input"||we.type!=="checkbox"&&we.type!=="radio"?_e&&Jc(_e.elementType)&&(bt=x0):bt=V1;if(bt&&(bt=bt(i,_e))){T0(He,bt,h,Be);break e}et&&et(i,we,_e),i==="focusout"&&_e&&we.type==="number"&&_e.memoizedProps.value!=null&&Zc(we,"number",we.value)}switch(et=_e?Ya(_e):window,i){case"focusin":(S0(et)||et.contentEditable==="true")&&(Xs=et,pf=_e,io=null);break;case"focusout":io=pf=Xs=null;break;case"mousedown":gf=!0;break;case"contextmenu":case"mouseup":case"dragend":gf=!1,O0(He,h,Be);break;case"selectionchange":if(Y1)break;case"keydown":case"keyup":O0(He,h,Be)}var ft;if(cf)e:{switch(i){case"compositionstart":var yt="onCompositionStart";break e;case"compositionend":yt="onCompositionEnd";break e;case"compositionupdate":yt="onCompositionUpdate";break e}yt=void 0}else Qs?b0(i,h)&&(yt="onCompositionEnd"):i==="keydown"&&h.keyCode===229&&(yt="onCompositionStart");yt&&(m0&&h.locale!=="ko"&&(Qs||yt!=="onCompositionStart"?yt==="onCompositionEnd"&&Qs&&(ft=f0()):(Rn=Be,sf="value"in Rn?Rn.value:Rn.textContent,Qs=!0)),et=lu(_e,yt),0<et.length&&(yt=new p0(yt,i,null,h,Be),He.push({event:yt,listeners:et}),ft?yt.data=ft:(ft=E0(h),ft!==null&&(yt.data=ft)))),(ft=B1?F1(i,h):j1(i,h))&&(yt=lu(_e,"onBeforeInput"),0<yt.length&&(et=new p0("onBeforeInput","beforeinput",null,h,Be),He.push({event:et,listeners:yt}),et.data=ft)),Dw(He,i,_e,h,Be)}nb(He,o)})}function Lo(i,o,h){return{instance:i,listener:o,currentTarget:h}}function lu(i,o){for(var h=o+"Capture",g=[];i!==null;){var S=i,_=S.stateNode;if(S=S.tag,S!==5&&S!==26&&S!==27||_===null||(S=Wa(i,h),S!=null&&g.unshift(Lo(i,S,_)),S=Wa(i,o),S!=null&&g.push(Lo(i,S,_))),i.tag===3)return g;i=i.return}return[]}function Pw(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5&&i.tag!==27);return i||null}function ab(i,o,h,g,S){for(var _=o._reactName,k=[];h!==null&&h!==g;){var G=h,oe=G.alternate,_e=G.stateNode;if(G=G.tag,oe!==null&&oe===g)break;G!==5&&G!==26&&G!==27||_e===null||(oe=_e,S?(_e=Wa(h,_),_e!=null&&k.unshift(Lo(h,_e,oe))):S||(_e=Wa(h,_),_e!=null&&k.push(Lo(h,_e,oe)))),h=h.return}k.length!==0&&i.push({event:o,listeners:k})}var Nw=/\r\n?/g,Uw=/\u0000|\uFFFD/g;function ob(i){return(typeof i=="string"?i:""+i).replace(Nw,`
`).replace(Uw,"")}function lb(i,o){return o=ob(o),ob(i)===o}function Rt(i,o,h,g,S,_){switch(h){case"children":typeof g=="string"?o==="body"||o==="textarea"&&g===""||qs(i,g):(typeof g=="number"||typeof g=="bigint")&&o!=="body"&&qs(i,""+g);break;case"className":hl(i,"class",g);break;case"tabIndex":hl(i,"tabindex",g);break;case"dir":case"role":case"viewBox":case"width":case"height":hl(i,h,g);break;case"style":l0(i,g,_);break;case"data":if(o!=="object"){hl(i,"data",g);break}case"src":case"href":if(g===""&&(o!=="a"||h!=="href")){i.removeAttribute(h);break}if(g==null||typeof g=="function"||typeof g=="symbol"||typeof g=="boolean"){i.removeAttribute(h);break}g=pl(""+g),i.setAttribute(h,g);break;case"action":case"formAction":if(typeof g=="function"){i.setAttribute(h,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof _=="function"&&(h==="formAction"?(o!=="input"&&Rt(i,o,"name",S.name,S,null),Rt(i,o,"formEncType",S.formEncType,S,null),Rt(i,o,"formMethod",S.formMethod,S,null),Rt(i,o,"formTarget",S.formTarget,S,null)):(Rt(i,o,"encType",S.encType,S,null),Rt(i,o,"method",S.method,S,null),Rt(i,o,"target",S.target,S,null)));if(g==null||typeof g=="symbol"||typeof g=="boolean"){i.removeAttribute(h);break}g=pl(""+g),i.setAttribute(h,g);break;case"onClick":g!=null&&(i.onclick=zi);break;case"onScroll":g!=null&&gt("scroll",i);break;case"onScrollEnd":g!=null&&gt("scrollend",i);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(r(61));if(h=g.__html,h!=null){if(S.children!=null)throw Error(r(60));i.innerHTML=h}}break;case"multiple":i.multiple=g&&typeof g!="function"&&typeof g!="symbol";break;case"muted":i.muted=g&&typeof g!="function"&&typeof g!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(g==null||typeof g=="function"||typeof g=="boolean"||typeof g=="symbol"){i.removeAttribute("xlink:href");break}h=pl(""+g),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",h);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":g!=null&&typeof g!="function"&&typeof g!="symbol"?i.setAttribute(h,""+g):i.removeAttribute(h);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":g&&typeof g!="function"&&typeof g!="symbol"?i.setAttribute(h,""):i.removeAttribute(h);break;case"capture":case"download":g===!0?i.setAttribute(h,""):g!==!1&&g!=null&&typeof g!="function"&&typeof g!="symbol"?i.setAttribute(h,g):i.removeAttribute(h);break;case"cols":case"rows":case"size":case"span":g!=null&&typeof g!="function"&&typeof g!="symbol"&&!isNaN(g)&&1<=g?i.setAttribute(h,g):i.removeAttribute(h);break;case"rowSpan":case"start":g==null||typeof g=="function"||typeof g=="symbol"||isNaN(g)?i.removeAttribute(h):i.setAttribute(h,g);break;case"popover":gt("beforetoggle",i),gt("toggle",i),fl(i,"popover",g);break;case"xlinkActuate":Vi(i,"http://www.w3.org/1999/xlink","xlink:actuate",g);break;case"xlinkArcrole":Vi(i,"http://www.w3.org/1999/xlink","xlink:arcrole",g);break;case"xlinkRole":Vi(i,"http://www.w3.org/1999/xlink","xlink:role",g);break;case"xlinkShow":Vi(i,"http://www.w3.org/1999/xlink","xlink:show",g);break;case"xlinkTitle":Vi(i,"http://www.w3.org/1999/xlink","xlink:title",g);break;case"xlinkType":Vi(i,"http://www.w3.org/1999/xlink","xlink:type",g);break;case"xmlBase":Vi(i,"http://www.w3.org/XML/1998/namespace","xml:base",g);break;case"xmlLang":Vi(i,"http://www.w3.org/XML/1998/namespace","xml:lang",g);break;case"xmlSpace":Vi(i,"http://www.w3.org/XML/1998/namespace","xml:space",g);break;case"is":fl(i,"is",g);break;case"innerText":case"textContent":break;default:(!(2<h.length)||h[0]!=="o"&&h[0]!=="O"||h[1]!=="n"&&h[1]!=="N")&&(h=f1.get(h)||h,fl(i,h,g))}}function jh(i,o,h,g,S,_){switch(h){case"style":l0(i,g,_);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(r(61));if(h=g.__html,h!=null){if(S.children!=null)throw Error(r(60));i.innerHTML=h}}break;case"children":typeof g=="string"?qs(i,g):(typeof g=="number"||typeof g=="bigint")&&qs(i,""+g);break;case"onScroll":g!=null&&gt("scroll",i);break;case"onScrollEnd":g!=null&&gt("scrollend",i);break;case"onClick":g!=null&&(i.onclick=zi);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Jm.hasOwnProperty(h))e:{if(h[0]==="o"&&h[1]==="n"&&(S=h.endsWith("Capture"),o=h.slice(2,S?h.length-7:void 0),_=i[nr]||null,_=_!=null?_[h]:null,typeof _=="function"&&i.removeEventListener(o,_,S),typeof g=="function")){typeof _!="function"&&_!==null&&(h in i?i[h]=null:i.hasAttribute(h)&&i.removeAttribute(h)),i.addEventListener(o,g,S);break e}h in i?i[h]=g:g===!0?i.setAttribute(h,""):fl(i,h,g)}}}function mr(i,o,h){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":gt("error",i),gt("load",i);var g=!1,S=!1,_;for(_ in h)if(h.hasOwnProperty(_)){var k=h[_];if(k!=null)switch(_){case"src":g=!0;break;case"srcSet":S=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,o));default:Rt(i,o,_,k,h,null)}}S&&Rt(i,o,"srcSet",h.srcSet,h,null),g&&Rt(i,o,"src",h.src,h,null);return;case"input":gt("invalid",i);var G=_=k=S=null,oe=null,_e=null;for(g in h)if(h.hasOwnProperty(g)){var Be=h[g];if(Be!=null)switch(g){case"name":S=Be;break;case"type":k=Be;break;case"checked":oe=Be;break;case"defaultChecked":_e=Be;break;case"value":_=Be;break;case"defaultValue":G=Be;break;case"children":case"dangerouslySetInnerHTML":if(Be!=null)throw Error(r(137,o));break;default:Rt(i,o,g,Be,h,null)}}n0(i,_,G,oe,_e,k,S,!1);return;case"select":gt("invalid",i),g=k=_=null;for(S in h)if(h.hasOwnProperty(S)&&(G=h[S],G!=null))switch(S){case"value":_=G;break;case"defaultValue":k=G;break;case"multiple":g=G;default:Rt(i,o,S,G,h,null)}o=_,h=k,i.multiple=!!g,o!=null?zs(i,!!g,o,!1):h!=null&&zs(i,!!g,h,!0);return;case"textarea":gt("invalid",i),_=S=g=null;for(k in h)if(h.hasOwnProperty(k)&&(G=h[k],G!=null))switch(k){case"value":g=G;break;case"defaultValue":S=G;break;case"children":_=G;break;case"dangerouslySetInnerHTML":if(G!=null)throw Error(r(91));break;default:Rt(i,o,k,G,h,null)}a0(i,g,S,_);return;case"option":for(oe in h)if(h.hasOwnProperty(oe)&&(g=h[oe],g!=null))switch(oe){case"selected":i.selected=g&&typeof g!="function"&&typeof g!="symbol";break;default:Rt(i,o,oe,g,h,null)}return;case"dialog":gt("beforetoggle",i),gt("toggle",i),gt("cancel",i),gt("close",i);break;case"iframe":case"object":gt("load",i);break;case"video":case"audio":for(g=0;g<Io.length;g++)gt(Io[g],i);break;case"image":gt("error",i),gt("load",i);break;case"details":gt("toggle",i);break;case"embed":case"source":case"link":gt("error",i),gt("load",i);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(_e in h)if(h.hasOwnProperty(_e)&&(g=h[_e],g!=null))switch(_e){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,o));default:Rt(i,o,_e,g,h,null)}return;default:if(Jc(o)){for(Be in h)h.hasOwnProperty(Be)&&(g=h[Be],g!==void 0&&jh(i,o,Be,g,h,void 0));return}}for(G in h)h.hasOwnProperty(G)&&(g=h[G],g!=null&&Rt(i,o,G,g,h,null))}function Bw(i,o,h,g){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var S=null,_=null,k=null,G=null,oe=null,_e=null,Be=null;for(Oe in h){var He=h[Oe];if(h.hasOwnProperty(Oe)&&He!=null)switch(Oe){case"checked":break;case"value":break;case"defaultValue":oe=He;default:g.hasOwnProperty(Oe)||Rt(i,o,Oe,null,g,He)}}for(var we in g){var Oe=g[we];if(He=h[we],g.hasOwnProperty(we)&&(Oe!=null||He!=null))switch(we){case"type":_=Oe;break;case"name":S=Oe;break;case"checked":_e=Oe;break;case"defaultChecked":Be=Oe;break;case"value":k=Oe;break;case"defaultValue":G=Oe;break;case"children":case"dangerouslySetInnerHTML":if(Oe!=null)throw Error(r(137,o));break;default:Oe!==He&&Rt(i,o,we,Oe,g,He)}}Xc(i,k,G,oe,_e,Be,_,S);return;case"select":Oe=k=G=we=null;for(_ in h)if(oe=h[_],h.hasOwnProperty(_)&&oe!=null)switch(_){case"value":break;case"multiple":Oe=oe;default:g.hasOwnProperty(_)||Rt(i,o,_,null,g,oe)}for(S in g)if(_=g[S],oe=h[S],g.hasOwnProperty(S)&&(_!=null||oe!=null))switch(S){case"value":we=_;break;case"defaultValue":G=_;break;case"multiple":k=_;default:_!==oe&&Rt(i,o,S,_,g,oe)}o=G,h=k,g=Oe,we!=null?zs(i,!!h,we,!1):!!g!=!!h&&(o!=null?zs(i,!!h,o,!0):zs(i,!!h,h?[]:"",!1));return;case"textarea":Oe=we=null;for(G in h)if(S=h[G],h.hasOwnProperty(G)&&S!=null&&!g.hasOwnProperty(G))switch(G){case"value":break;case"children":break;default:Rt(i,o,G,null,g,S)}for(k in g)if(S=g[k],_=h[k],g.hasOwnProperty(k)&&(S!=null||_!=null))switch(k){case"value":we=S;break;case"defaultValue":Oe=S;break;case"children":break;case"dangerouslySetInnerHTML":if(S!=null)throw Error(r(91));break;default:S!==_&&Rt(i,o,k,S,g,_)}s0(i,we,Oe);return;case"option":for(var Je in h)if(we=h[Je],h.hasOwnProperty(Je)&&we!=null&&!g.hasOwnProperty(Je))switch(Je){case"selected":i.selected=!1;break;default:Rt(i,o,Je,null,g,we)}for(oe in g)if(we=g[oe],Oe=h[oe],g.hasOwnProperty(oe)&&we!==Oe&&(we!=null||Oe!=null))switch(oe){case"selected":i.selected=we&&typeof we!="function"&&typeof we!="symbol";break;default:Rt(i,o,oe,we,g,Oe)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var it in h)we=h[it],h.hasOwnProperty(it)&&we!=null&&!g.hasOwnProperty(it)&&Rt(i,o,it,null,g,we);for(_e in g)if(we=g[_e],Oe=h[_e],g.hasOwnProperty(_e)&&we!==Oe&&(we!=null||Oe!=null))switch(_e){case"children":case"dangerouslySetInnerHTML":if(we!=null)throw Error(r(137,o));break;default:Rt(i,o,_e,we,g,Oe)}return;default:if(Jc(o)){for(var It in h)we=h[It],h.hasOwnProperty(It)&&we!==void 0&&!g.hasOwnProperty(It)&&jh(i,o,It,void 0,g,we);for(Be in g)we=g[Be],Oe=h[Be],!g.hasOwnProperty(Be)||we===Oe||we===void 0&&Oe===void 0||jh(i,o,Be,we,g,Oe);return}}for(var ve in h)we=h[ve],h.hasOwnProperty(ve)&&we!=null&&!g.hasOwnProperty(ve)&&Rt(i,o,ve,null,g,we);for(He in g)we=g[He],Oe=h[He],!g.hasOwnProperty(He)||we===Oe||we==null&&Oe==null||Rt(i,o,He,we,g,Oe)}function ub(i){switch(i){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Fw(){if(typeof performance.getEntriesByType=="function"){for(var i=0,o=0,h=performance.getEntriesByType("resource"),g=0;g<h.length;g++){var S=h[g],_=S.transferSize,k=S.initiatorType,G=S.duration;if(_&&G&&ub(k)){for(k=0,G=S.responseEnd,g+=1;g<h.length;g++){var oe=h[g],_e=oe.startTime;if(_e>G)break;var Be=oe.transferSize,He=oe.initiatorType;Be&&ub(He)&&(oe=oe.responseEnd,k+=Be*(oe<G?1:(G-_e)/(oe-_e)))}if(--g,o+=8*(_+k)/(S.duration/1e3),i++,10<i)break}}if(0<i)return o/i/1e6}return navigator.connection&&(i=navigator.connection.downlink,typeof i=="number")?i:5}var $h=null,Gh=null;function uu(i){return i.nodeType===9?i:i.ownerDocument}function cb(i){switch(i){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function fb(i,o){if(i===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return i===1&&o==="foreignObject"?0:i}function Hh(i,o){return i==="textarea"||i==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var Kh=null;function jw(){var i=window.event;return i&&i.type==="popstate"?i===Kh?!1:(Kh=i,!0):(Kh=null,!1)}var hb=typeof setTimeout=="function"?setTimeout:void 0,$w=typeof clearTimeout=="function"?clearTimeout:void 0,db=typeof Promise=="function"?Promise:void 0,Gw=typeof queueMicrotask=="function"?queueMicrotask:typeof db<"u"?function(i){return db.resolve(null).then(i).catch(Hw)}:hb;function Hw(i){setTimeout(function(){throw i})}function Kn(i){return i==="head"}function pb(i,o){var h=o,g=0;do{var S=h.nextSibling;if(i.removeChild(h),S&&S.nodeType===8)if(h=S.data,h==="/$"||h==="/&"){if(g===0){i.removeChild(S),_a(o);return}g--}else if(h==="$"||h==="$?"||h==="$~"||h==="$!"||h==="&")g++;else if(h==="html")Co(i.ownerDocument.documentElement);else if(h==="head"){h=i.ownerDocument.head,Co(h);for(var _=h.firstChild;_;){var k=_.nextSibling,G=_.nodeName;_[Rr]||G==="SCRIPT"||G==="STYLE"||G==="LINK"&&_.rel.toLowerCase()==="stylesheet"||h.removeChild(_),_=k}}else h==="body"&&Co(i.ownerDocument.body);h=S}while(h);_a(o)}function gb(i,o){var h=i;i=0;do{var g=h.nextSibling;if(h.nodeType===1?o?(h._stashedDisplay=h.style.display,h.style.display="none"):(h.style.display=h._stashedDisplay||"",h.getAttribute("style")===""&&h.removeAttribute("style")):h.nodeType===3&&(o?(h._stashedText=h.nodeValue,h.nodeValue=""):h.nodeValue=h._stashedText||""),g&&g.nodeType===8)if(h=g.data,h==="/$"){if(i===0)break;i--}else h!=="$"&&h!=="$?"&&h!=="$~"&&h!=="$!"||i++;h=g}while(h)}function Vh(i){var o=i.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var h=o;switch(o=o.nextSibling,h.nodeName){case"HTML":case"HEAD":case"BODY":Vh(h),Wc(h);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(h.rel.toLowerCase()==="stylesheet")continue}i.removeChild(h)}}function Kw(i,o,h,g){for(;i.nodeType===1;){var S=h;if(i.nodeName.toLowerCase()!==o.toLowerCase()){if(!g&&(i.nodeName!=="INPUT"||i.type!=="hidden"))break}else if(g){if(!i[Rr])switch(o){case"meta":if(!i.hasAttribute("itemprop"))break;return i;case"link":if(_=i.getAttribute("rel"),_==="stylesheet"&&i.hasAttribute("data-precedence"))break;if(_!==S.rel||i.getAttribute("href")!==(S.href==null||S.href===""?null:S.href)||i.getAttribute("crossorigin")!==(S.crossOrigin==null?null:S.crossOrigin)||i.getAttribute("title")!==(S.title==null?null:S.title))break;return i;case"style":if(i.hasAttribute("data-precedence"))break;return i;case"script":if(_=i.getAttribute("src"),(_!==(S.src==null?null:S.src)||i.getAttribute("type")!==(S.type==null?null:S.type)||i.getAttribute("crossorigin")!==(S.crossOrigin==null?null:S.crossOrigin))&&_&&i.hasAttribute("async")&&!i.hasAttribute("itemprop"))break;return i;default:return i}}else if(o==="input"&&i.type==="hidden"){var _=S.name==null?null:""+S.name;if(S.type==="hidden"&&i.getAttribute("name")===_)return i}else return i;if(i=gi(i.nextSibling),i===null)break}return null}function Vw(i,o,h){if(o==="")return null;for(;i.nodeType!==3;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!h||(i=gi(i.nextSibling),i===null))return null;return i}function mb(i,o){for(;i.nodeType!==8;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!o||(i=gi(i.nextSibling),i===null))return null;return i}function zh(i){return i.data==="$?"||i.data==="$~"}function qh(i){return i.data==="$!"||i.data==="$?"&&i.ownerDocument.readyState!=="loading"}function zw(i,o){var h=i.ownerDocument;if(i.data==="$~")i._reactRetry=o;else if(i.data!=="$?"||h.readyState!=="loading")o();else{var g=function(){o(),h.removeEventListener("DOMContentLoaded",g)};h.addEventListener("DOMContentLoaded",g),i._reactRetry=g}}function gi(i){for(;i!=null;i=i.nextSibling){var o=i.nodeType;if(o===1||o===3)break;if(o===8){if(o=i.data,o==="$"||o==="$!"||o==="$?"||o==="$~"||o==="&"||o==="F!"||o==="F")break;if(o==="/$"||o==="/&")return null}}return i}var Yh=null;function yb(i){i=i.nextSibling;for(var o=0;i;){if(i.nodeType===8){var h=i.data;if(h==="/$"||h==="/&"){if(o===0)return gi(i.nextSibling);o--}else h!=="$"&&h!=="$!"&&h!=="$?"&&h!=="$~"&&h!=="&"||o++}i=i.nextSibling}return null}function vb(i){i=i.previousSibling;for(var o=0;i;){if(i.nodeType===8){var h=i.data;if(h==="$"||h==="$!"||h==="$?"||h==="$~"||h==="&"){if(o===0)return i;o--}else h!=="/$"&&h!=="/&"||o++}i=i.previousSibling}return null}function bb(i,o,h){switch(o=uu(h),i){case"html":if(i=o.documentElement,!i)throw Error(r(452));return i;case"head":if(i=o.head,!i)throw Error(r(453));return i;case"body":if(i=o.body,!i)throw Error(r(454));return i;default:throw Error(r(451))}}function Co(i){for(var o=i.attributes;o.length;)i.removeAttributeNode(o[0]);Wc(i)}var mi=new Map,Eb=new Set;function cu(i){return typeof i.getRootNode=="function"?i.getRootNode():i.nodeType===9?i:i.ownerDocument}var un=K.d;K.d={f:qw,r:Yw,D:Ww,C:Qw,L:Xw,m:Zw,X:eR,S:Jw,M:tR};function qw(){var i=un.f(),o=tu();return i||o}function Yw(i){var o=Hs(i);o!==null&&o.tag===5&&o.type==="form"?Uy(o):un.r(i)}var Sa=typeof document>"u"?null:document;function Sb(i,o,h){var g=Sa;if(g&&typeof o=="string"&&o){var S=li(o);S='link[rel="'+i+'"][href="'+S+'"]',typeof h=="string"&&(S+='[crossorigin="'+h+'"]'),Eb.has(S)||(Eb.add(S),i={rel:i,crossOrigin:h,href:o},g.querySelector(S)===null&&(o=g.createElement("link"),mr(o,"link",i),lr(o),g.head.appendChild(o)))}}function Ww(i){un.D(i),Sb("dns-prefetch",i,null)}function Qw(i,o){un.C(i,o),Sb("preconnect",i,o)}function Xw(i,o,h){un.L(i,o,h);var g=Sa;if(g&&i&&o){var S='link[rel="preload"][as="'+li(o)+'"]';o==="image"&&h&&h.imageSrcSet?(S+='[imagesrcset="'+li(h.imageSrcSet)+'"]',typeof h.imageSizes=="string"&&(S+='[imagesizes="'+li(h.imageSizes)+'"]')):S+='[href="'+li(i)+'"]';var _=S;switch(o){case"style":_=Ta(i);break;case"script":_=xa(i)}mi.has(_)||(i=p({rel:"preload",href:o==="image"&&h&&h.imageSrcSet?void 0:i,as:o},h),mi.set(_,i),g.querySelector(S)!==null||o==="style"&&g.querySelector(Do(_))||o==="script"&&g.querySelector(Oo(_))||(o=g.createElement("link"),mr(o,"link",i),lr(o),g.head.appendChild(o)))}}function Zw(i,o){un.m(i,o);var h=Sa;if(h&&i){var g=o&&typeof o.as=="string"?o.as:"script",S='link[rel="modulepreload"][as="'+li(g)+'"][href="'+li(i)+'"]',_=S;switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":_=xa(i)}if(!mi.has(_)&&(i=p({rel:"modulepreload",href:i},o),mi.set(_,i),h.querySelector(S)===null)){switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(h.querySelector(Oo(_)))return}g=h.createElement("link"),mr(g,"link",i),lr(g),h.head.appendChild(g)}}}function Jw(i,o,h){un.S(i,o,h);var g=Sa;if(g&&i){var S=Ks(g).hoistableStyles,_=Ta(i);o=o||"default";var k=S.get(_);if(!k){var G={loading:0,preload:null};if(k=g.querySelector(Do(_)))G.loading=5;else{i=p({rel:"stylesheet",href:i,"data-precedence":o},h),(h=mi.get(_))&&Wh(i,h);var oe=k=g.createElement("link");lr(oe),mr(oe,"link",i),oe._p=new Promise(function(_e,Be){oe.onload=_e,oe.onerror=Be}),oe.addEventListener("load",function(){G.loading|=1}),oe.addEventListener("error",function(){G.loading|=2}),G.loading|=4,fu(k,o,g)}k={type:"stylesheet",instance:k,count:1,state:G},S.set(_,k)}}}function eR(i,o){un.X(i,o);var h=Sa;if(h&&i){var g=Ks(h).hoistableScripts,S=xa(i),_=g.get(S);_||(_=h.querySelector(Oo(S)),_||(i=p({src:i,async:!0},o),(o=mi.get(S))&&Qh(i,o),_=h.createElement("script"),lr(_),mr(_,"link",i),h.head.appendChild(_)),_={type:"script",instance:_,count:1,state:null},g.set(S,_))}}function tR(i,o){un.M(i,o);var h=Sa;if(h&&i){var g=Ks(h).hoistableScripts,S=xa(i),_=g.get(S);_||(_=h.querySelector(Oo(S)),_||(i=p({src:i,async:!0,type:"module"},o),(o=mi.get(S))&&Qh(i,o),_=h.createElement("script"),lr(_),mr(_,"link",i),h.head.appendChild(_)),_={type:"script",instance:_,count:1,state:null},g.set(S,_))}}function Tb(i,o,h,g){var S=(S=Ee.current)?cu(S):null;if(!S)throw Error(r(446));switch(i){case"meta":case"title":return null;case"style":return typeof h.precedence=="string"&&typeof h.href=="string"?(o=Ta(h.href),h=Ks(S).hoistableStyles,g=h.get(o),g||(g={type:"style",instance:null,count:0,state:null},h.set(o,g)),g):{type:"void",instance:null,count:0,state:null};case"link":if(h.rel==="stylesheet"&&typeof h.href=="string"&&typeof h.precedence=="string"){i=Ta(h.href);var _=Ks(S).hoistableStyles,k=_.get(i);if(k||(S=S.ownerDocument||S,k={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},_.set(i,k),(_=S.querySelector(Do(i)))&&!_._p&&(k.instance=_,k.state.loading=5),mi.has(i)||(h={rel:"preload",as:"style",href:h.href,crossOrigin:h.crossOrigin,integrity:h.integrity,media:h.media,hrefLang:h.hrefLang,referrerPolicy:h.referrerPolicy},mi.set(i,h),_||rR(S,i,h,k.state))),o&&g===null)throw Error(r(528,""));return k}if(o&&g!==null)throw Error(r(529,""));return null;case"script":return o=h.async,h=h.src,typeof h=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=xa(h),h=Ks(S).hoistableScripts,g=h.get(o),g||(g={type:"script",instance:null,count:0,state:null},h.set(o,g)),g):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,i))}}function Ta(i){return'href="'+li(i)+'"'}function Do(i){return'link[rel="stylesheet"]['+i+"]"}function xb(i){return p({},i,{"data-precedence":i.precedence,precedence:null})}function rR(i,o,h,g){i.querySelector('link[rel="preload"][as="style"]['+o+"]")?g.loading=1:(o=i.createElement("link"),g.preload=o,o.addEventListener("load",function(){return g.loading|=1}),o.addEventListener("error",function(){return g.loading|=2}),mr(o,"link",h),lr(o),i.head.appendChild(o))}function xa(i){return'[src="'+li(i)+'"]'}function Oo(i){return"script[async]"+i}function _b(i,o,h){if(o.count++,o.instance===null)switch(o.type){case"style":var g=i.querySelector('style[data-href~="'+li(h.href)+'"]');if(g)return o.instance=g,lr(g),g;var S=p({},h,{"data-href":h.href,"data-precedence":h.precedence,href:null,precedence:null});return g=(i.ownerDocument||i).createElement("style"),lr(g),mr(g,"style",S),fu(g,h.precedence,i),o.instance=g;case"stylesheet":S=Ta(h.href);var _=i.querySelector(Do(S));if(_)return o.state.loading|=4,o.instance=_,lr(_),_;g=xb(h),(S=mi.get(S))&&Wh(g,S),_=(i.ownerDocument||i).createElement("link"),lr(_);var k=_;return k._p=new Promise(function(G,oe){k.onload=G,k.onerror=oe}),mr(_,"link",g),o.state.loading|=4,fu(_,h.precedence,i),o.instance=_;case"script":return _=xa(h.src),(S=i.querySelector(Oo(_)))?(o.instance=S,lr(S),S):(g=h,(S=mi.get(_))&&(g=p({},h),Qh(g,S)),i=i.ownerDocument||i,S=i.createElement("script"),lr(S),mr(S,"link",g),i.head.appendChild(S),o.instance=S);case"void":return null;default:throw Error(r(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(g=o.instance,o.state.loading|=4,fu(g,h.precedence,i));return o.instance}function fu(i,o,h){for(var g=h.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),S=g.length?g[g.length-1]:null,_=S,k=0;k<g.length;k++){var G=g[k];if(G.dataset.precedence===o)_=G;else if(_!==S)break}_?_.parentNode.insertBefore(i,_.nextSibling):(o=h.nodeType===9?h.head:h,o.insertBefore(i,o.firstChild))}function Wh(i,o){i.crossOrigin==null&&(i.crossOrigin=o.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=o.referrerPolicy),i.title==null&&(i.title=o.title)}function Qh(i,o){i.crossOrigin==null&&(i.crossOrigin=o.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=o.referrerPolicy),i.integrity==null&&(i.integrity=o.integrity)}var hu=null;function Ab(i,o,h){if(hu===null){var g=new Map,S=hu=new Map;S.set(h,g)}else S=hu,g=S.get(h),g||(g=new Map,S.set(h,g));if(g.has(i))return g;for(g.set(i,null),h=h.getElementsByTagName(i),S=0;S<h.length;S++){var _=h[S];if(!(_[Rr]||_[jt]||i==="link"&&_.getAttribute("rel")==="stylesheet")&&_.namespaceURI!=="http://www.w3.org/2000/svg"){var k=_.getAttribute(o)||"";k=i+k;var G=g.get(k);G?G.push(_):g.set(k,[_])}}return g}function wb(i,o,h){i=i.ownerDocument||i,i.head.insertBefore(h,o==="title"?i.querySelector("head > title"):null)}function iR(i,o,h){if(h===1||o.itemProp!=null)return!1;switch(i){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;switch(o.rel){case"stylesheet":return i=o.disabled,typeof o.precedence=="string"&&i==null;default:return!0}case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function Rb(i){return!(i.type==="stylesheet"&&(i.state.loading&3)===0)}function nR(i,o,h,g){if(h.type==="stylesheet"&&(typeof g.media!="string"||matchMedia(g.media).matches!==!1)&&(h.state.loading&4)===0){if(h.instance===null){var S=Ta(g.href),_=o.querySelector(Do(S));if(_){o=_._p,o!==null&&typeof o=="object"&&typeof o.then=="function"&&(i.count++,i=du.bind(i),o.then(i,i)),h.state.loading|=4,h.instance=_,lr(_);return}_=o.ownerDocument||o,g=xb(g),(S=mi.get(S))&&Wh(g,S),_=_.createElement("link"),lr(_);var k=_;k._p=new Promise(function(G,oe){k.onload=G,k.onerror=oe}),mr(_,"link",g),h.instance=_}i.stylesheets===null&&(i.stylesheets=new Map),i.stylesheets.set(h,o),(o=h.state.preload)&&(h.state.loading&3)===0&&(i.count++,h=du.bind(i),o.addEventListener("load",h),o.addEventListener("error",h))}}var Xh=0;function sR(i,o){return i.stylesheets&&i.count===0&&gu(i,i.stylesheets),0<i.count||0<i.imgCount?function(h){var g=setTimeout(function(){if(i.stylesheets&&gu(i,i.stylesheets),i.unsuspend){var _=i.unsuspend;i.unsuspend=null,_()}},6e4+o);0<i.imgBytes&&Xh===0&&(Xh=62500*Fw());var S=setTimeout(function(){if(i.waitingForImages=!1,i.count===0&&(i.stylesheets&&gu(i,i.stylesheets),i.unsuspend)){var _=i.unsuspend;i.unsuspend=null,_()}},(i.imgBytes>Xh?50:800)+o);return i.unsuspend=h,function(){i.unsuspend=null,clearTimeout(g),clearTimeout(S)}}:null}function du(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)gu(this,this.stylesheets);else if(this.unsuspend){var i=this.unsuspend;this.unsuspend=null,i()}}}var pu=null;function gu(i,o){i.stylesheets=null,i.unsuspend!==null&&(i.count++,pu=new Map,o.forEach(aR,i),pu=null,du.call(i))}function aR(i,o){if(!(o.state.loading&4)){var h=pu.get(i);if(h)var g=h.get(null);else{h=new Map,pu.set(i,h);for(var S=i.querySelectorAll("link[data-precedence],style[data-precedence]"),_=0;_<S.length;_++){var k=S[_];(k.nodeName==="LINK"||k.getAttribute("media")!=="not all")&&(h.set(k.dataset.precedence,k),g=k)}g&&h.set(null,g)}S=o.instance,k=S.getAttribute("data-precedence"),_=h.get(k)||g,_===g&&h.set(null,S),h.set(k,S),this.count++,g=du.bind(this),S.addEventListener("load",g),S.addEventListener("error",g),_?_.parentNode.insertBefore(S,_.nextSibling):(i=i.nodeType===9?i.head:i,i.insertBefore(S,i.firstChild)),o.state.loading|=4}}var ko={$$typeof:A,Provider:null,Consumer:null,_currentValue:z,_currentValue2:z,_threadCount:0};function oR(i,o,h,g,S,_,k,G,oe){this.tag=1,this.containerInfo=i,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Hi(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Hi(0),this.hiddenUpdates=Hi(null),this.identifierPrefix=g,this.onUncaughtError=S,this.onCaughtError=_,this.onRecoverableError=k,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=oe,this.incompleteTransitions=new Map}function Ib(i,o,h,g,S,_,k,G,oe,_e,Be,He){return i=new oR(i,o,h,k,oe,_e,Be,He,G),o=1,_===!0&&(o|=24),_=Yr(3,null,null,o),i.current=_,_.stateNode=i,o=Cf(),o.refCount++,i.pooledCache=o,o.refCount++,_.memoizedState={element:g,isDehydrated:h,cache:o},Mf(_),i}function Lb(i){return i?(i=ea,i):ea}function Cb(i,o,h,g,S,_){S=Lb(S),g.context===null?g.context=S:g.pendingContext=S,g=kn(o),g.payload={element:h},_=_===void 0?null:_,_!==null&&(g.callback=_),h=Mn(i,g,o),h!==null&&($r(h,i,o),co(h,i,o))}function Db(i,o){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var h=i.retryLane;i.retryLane=h!==0&&h<o?h:o}}function Zh(i,o){Db(i,o),(i=i.alternate)&&Db(i,o)}function Ob(i){if(i.tag===13||i.tag===31){var o=ps(i,67108864);o!==null&&$r(o,i,67108864),Zh(i,67108864)}}function kb(i){if(i.tag===13||i.tag===31){var o=Jr();o=Ft(o);var h=ps(i,o);h!==null&&$r(h,i,o),Zh(i,o)}}var mu=!0;function lR(i,o,h,g){var S=H.T;H.T=null;var _=K.p;try{K.p=2,Jh(i,o,h,g)}finally{K.p=_,H.T=S}}function uR(i,o,h,g){var S=H.T;H.T=null;var _=K.p;try{K.p=8,Jh(i,o,h,g)}finally{K.p=_,H.T=S}}function Jh(i,o,h,g){if(mu){var S=ed(g);if(S===null)Fh(i,o,g,yu,h),Pb(i,g);else if(fR(S,i,o,h,g))g.stopPropagation();else if(Pb(i,g),o&4&&-1<cR.indexOf(i)){for(;S!==null;){var _=Hs(S);if(_!==null)switch(_.tag){case 3:if(_=_.stateNode,_.current.memoizedState.isDehydrated){var k=Dr(_.pendingLanes);if(k!==0){var G=_;for(G.pendingLanes|=2,G.entangledLanes|=2;k;){var oe=1<<31-We(k);G.entanglements[1]|=oe,k&=~oe}Li(_),(St&6)===0&&(Jl=Ae()+500,Ro(0))}}break;case 31:case 13:G=ps(_,2),G!==null&&$r(G,_,2),tu(),Zh(_,2)}if(_=ed(g),_===null&&Fh(i,o,g,yu,h),_===S)break;S=_}S!==null&&g.stopPropagation()}else Fh(i,o,g,null,h)}}function ed(i){return i=tf(i),td(i)}var yu=null;function td(i){if(yu=null,i=Gs(i),i!==null){var o=s(i);if(o===null)i=null;else{var h=o.tag;if(h===13){if(i=a(o),i!==null)return i;i=null}else if(h===31){if(i=u(o),i!==null)return i;i=null}else if(h===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;i=null}else o!==i&&(i=null)}}return yu=i,null}function Mb(i){switch(i){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(nt()){case R:return 2;case D:return 8;case j:case ae:return 32;case ye:return 268435456;default:return 32}default:return 32}}var rd=!1,Vn=null,zn=null,qn=null,Mo=new Map,Po=new Map,Yn=[],cR="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Pb(i,o){switch(i){case"focusin":case"focusout":Vn=null;break;case"dragenter":case"dragleave":zn=null;break;case"mouseover":case"mouseout":qn=null;break;case"pointerover":case"pointerout":Mo.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Po.delete(o.pointerId)}}function No(i,o,h,g,S,_){return i===null||i.nativeEvent!==_?(i={blockedOn:o,domEventName:h,eventSystemFlags:g,nativeEvent:_,targetContainers:[S]},o!==null&&(o=Hs(o),o!==null&&Ob(o)),i):(i.eventSystemFlags|=g,o=i.targetContainers,S!==null&&o.indexOf(S)===-1&&o.push(S),i)}function fR(i,o,h,g,S){switch(o){case"focusin":return Vn=No(Vn,i,o,h,g,S),!0;case"dragenter":return zn=No(zn,i,o,h,g,S),!0;case"mouseover":return qn=No(qn,i,o,h,g,S),!0;case"pointerover":var _=S.pointerId;return Mo.set(_,No(Mo.get(_)||null,i,o,h,g,S)),!0;case"gotpointercapture":return _=S.pointerId,Po.set(_,No(Po.get(_)||null,i,o,h,g,S)),!0}return!1}function Nb(i){var o=Gs(i.target);if(o!==null){var h=s(o);if(h!==null){if(o=h.tag,o===13){if(o=a(h),o!==null){i.blockedOn=o,wn(i.priority,function(){kb(h)});return}}else if(o===31){if(o=u(h),o!==null){i.blockedOn=o,wn(i.priority,function(){kb(h)});return}}else if(o===3&&h.stateNode.current.memoizedState.isDehydrated){i.blockedOn=h.tag===3?h.stateNode.containerInfo:null;return}}}i.blockedOn=null}function vu(i){if(i.blockedOn!==null)return!1;for(var o=i.targetContainers;0<o.length;){var h=ed(i.nativeEvent);if(h===null){h=i.nativeEvent;var g=new h.constructor(h.type,h);ef=g,h.target.dispatchEvent(g),ef=null}else return o=Hs(h),o!==null&&Ob(o),i.blockedOn=h,!1;o.shift()}return!0}function Ub(i,o,h){vu(i)&&h.delete(o)}function hR(){rd=!1,Vn!==null&&vu(Vn)&&(Vn=null),zn!==null&&vu(zn)&&(zn=null),qn!==null&&vu(qn)&&(qn=null),Mo.forEach(Ub),Po.forEach(Ub)}function bu(i,o){i.blockedOn===o&&(i.blockedOn=null,rd||(rd=!0,l.unstable_scheduleCallback(l.unstable_NormalPriority,hR)))}var Eu=null;function Bb(i){Eu!==i&&(Eu=i,l.unstable_scheduleCallback(l.unstable_NormalPriority,function(){Eu===i&&(Eu=null);for(var o=0;o<i.length;o+=3){var h=i[o],g=i[o+1],S=i[o+2];if(typeof g!="function"){if(td(g||h)===null)continue;break}var _=Hs(h);_!==null&&(i.splice(o,3),o-=3,eh(_,{pending:!0,data:S,method:h.method,action:g},g,S))}}))}function _a(i){function o(oe){return bu(oe,i)}Vn!==null&&bu(Vn,i),zn!==null&&bu(zn,i),qn!==null&&bu(qn,i),Mo.forEach(o),Po.forEach(o);for(var h=0;h<Yn.length;h++){var g=Yn[h];g.blockedOn===i&&(g.blockedOn=null)}for(;0<Yn.length&&(h=Yn[0],h.blockedOn===null);)Nb(h),h.blockedOn===null&&Yn.shift();if(h=(i.ownerDocument||i).$$reactFormReplay,h!=null)for(g=0;g<h.length;g+=3){var S=h[g],_=h[g+1],k=S[nr]||null;if(typeof _=="function")k||Bb(h);else if(k){var G=null;if(_&&_.hasAttribute("formAction")){if(S=_,k=_[nr]||null)G=k.formAction;else if(td(S)!==null)continue}else G=k.action;typeof G=="function"?h[g+1]=G:(h.splice(g,3),g-=3),Bb(h)}}}function Fb(){function i(_){_.canIntercept&&_.info==="react-transition"&&_.intercept({handler:function(){return new Promise(function(k){return S=k})},focusReset:"manual",scroll:"manual"})}function o(){S!==null&&(S(),S=null),g||setTimeout(h,20)}function h(){if(!g&&!navigation.transition){var _=navigation.currentEntry;_&&_.url!=null&&navigation.navigate(_.url,{state:_.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var g=!1,S=null;return navigation.addEventListener("navigate",i),navigation.addEventListener("navigatesuccess",o),navigation.addEventListener("navigateerror",o),setTimeout(h,100),function(){g=!0,navigation.removeEventListener("navigate",i),navigation.removeEventListener("navigatesuccess",o),navigation.removeEventListener("navigateerror",o),S!==null&&(S(),S=null)}}}function id(i){this._internalRoot=i}Su.prototype.render=id.prototype.render=function(i){var o=this._internalRoot;if(o===null)throw Error(r(409));var h=o.current,g=Jr();Cb(h,g,i,o,null,null)},Su.prototype.unmount=id.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var o=i.containerInfo;Cb(i.current,2,null,i,null,null),tu(),o[Mr]=null}};function Su(i){this._internalRoot=i}Su.prototype.unstable_scheduleHydration=function(i){if(i){var o=Or();i={blockedOn:null,target:i,priority:o};for(var h=0;h<Yn.length&&o!==0&&o<Yn[h].priority;h++);Yn.splice(h,0,i),h===0&&Nb(i)}};var jb=e.version;if(jb!=="19.2.0")throw Error(r(527,jb,"19.2.0"));K.findDOMNode=function(i){var o=i._reactInternals;if(o===void 0)throw typeof i.render=="function"?Error(r(188)):(i=Object.keys(i).join(","),Error(r(268,i)));return i=c(o),i=i!==null?d(i):null,i=i===null?null:i.stateNode,i};var dR={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:H,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Tu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Tu.isDisabled&&Tu.supportsFiber)try{de=Tu.inject(dR),Te=Tu}catch{}}return Bo.createRoot=function(i,o){if(!n(i))throw Error(r(299));var h=!1,g="",S=qy,_=Yy,k=Wy;return o!=null&&(o.unstable_strictMode===!0&&(h=!0),o.identifierPrefix!==void 0&&(g=o.identifierPrefix),o.onUncaughtError!==void 0&&(S=o.onUncaughtError),o.onCaughtError!==void 0&&(_=o.onCaughtError),o.onRecoverableError!==void 0&&(k=o.onRecoverableError)),o=Ib(i,1,!1,null,null,h,g,null,S,_,k,Fb),i[Mr]=o.current,Bh(i),new id(o)},Bo.hydrateRoot=function(i,o,h){if(!n(i))throw Error(r(299));var g=!1,S="",_=qy,k=Yy,G=Wy,oe=null;return h!=null&&(h.unstable_strictMode===!0&&(g=!0),h.identifierPrefix!==void 0&&(S=h.identifierPrefix),h.onUncaughtError!==void 0&&(_=h.onUncaughtError),h.onCaughtError!==void 0&&(k=h.onCaughtError),h.onRecoverableError!==void 0&&(G=h.onRecoverableError),h.formState!==void 0&&(oe=h.formState)),o=Ib(i,1,!0,o,h??null,g,S,oe,_,k,G,Fb),o.context=Lb(null),h=o.current,g=Jr(),g=Ft(g),S=kn(g),S.callback=null,Mn(h,S,g),h=g,o.current.lanes=h,Q(o,h),Li(o),i[Mr]=o.current,Bh(i),new Su(o)},Bo.version="19.2.0",Bo}var Qb;function xR(){if(Qb)return ad.exports;Qb=1;function l(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(l)}catch(e){console.error(e)}}return l(),ad.exports=TR(),ad.exports}var _R=xR();var Xb="popstate";function AR(l={}){function e(r,n){let{pathname:s,search:a,hash:u}=r.location;return $d("",{pathname:s,search:a,hash:u},n.state&&n.state.usr||null,n.state&&n.state.key||"default")}function t(r,n){return typeof n=="string"?n:Xo(n)}return RR(e,t,null,l)}function Ht(l,e){if(l===!1||l===null||typeof l>"u")throw new Error(e)}function _i(l,e){if(!l){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function wR(){return Math.random().toString(36).substring(2,10)}function Zb(l,e){return{usr:l.state,key:l.key,idx:e}}function $d(l,e,t=null,r){return{pathname:typeof l=="string"?l:l.pathname,search:"",hash:"",...typeof e=="string"?Ga(e):e,state:t,key:e&&e.key||r||wR()}}function Xo({pathname:l="/",search:e="",hash:t=""}){return e&&e!=="?"&&(l+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(l+=t.charAt(0)==="#"?t:"#"+t),l}function Ga(l){let e={};if(l){let t=l.indexOf("#");t>=0&&(e.hash=l.substring(t),l=l.substring(0,t));let r=l.indexOf("?");r>=0&&(e.search=l.substring(r),l=l.substring(0,r)),l&&(e.pathname=l)}return e}function RR(l,e,t,r={}){let{window:n=document.defaultView,v5Compat:s=!1}=r,a=n.history,u="POP",f=null,c=d();c==null&&(c=0,a.replaceState({...a.state,idx:c},""));function d(){return(a.state||{idx:null}).idx}function p(){u="POP";let E=d(),x=E==null?null:E-c;c=E,f&&f({action:u,location:b.location,delta:x})}function m(E,x){u="PUSH";let T=$d(b.location,E,x);c=d()+1;let A=Zb(T,c),L=b.createHref(T);try{a.pushState(A,"",L)}catch(w){if(w instanceof DOMException&&w.name==="DataCloneError")throw w;n.location.assign(L)}s&&f&&f({action:u,location:b.location,delta:1})}function v(E,x){u="REPLACE";let T=$d(b.location,E,x);c=d();let A=Zb(T,c),L=b.createHref(T);a.replaceState(A,"",L),s&&f&&f({action:u,location:b.location,delta:0})}function y(E){return IR(E)}let b={get action(){return u},get location(){return l(n,a)},listen(E){if(f)throw new Error("A history only accepts one active listener");return n.addEventListener(Xb,p),f=E,()=>{n.removeEventListener(Xb,p),f=null}},createHref(E){return e(n,E)},createURL:y,encodeLocation(E){let x=y(E);return{pathname:x.pathname,search:x.search,hash:x.hash}},push:m,replace:v,go(E){return a.go(E)}};return b}function IR(l,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),Ht(t,"No window.location.(origin|href) available to create URL");let r=typeof l=="string"?l:Xo(l);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=t+r),new URL(r,t)}function MT(l,e,t="/"){return LR(l,e,t,!1)}function LR(l,e,t,r){let n=typeof e=="string"?Ga(e):e,s=bn(n.pathname||"/",t);if(s==null)return null;let a=PT(l);CR(a);let u=null;for(let f=0;u==null&&f<a.length;++f){let c=$R(s);u=FR(a[f],c,r)}return u}function PT(l,e=[],t=[],r="",n=!1){let s=(a,u,f=n,c)=>{let d={relativePath:c===void 0?a.path||"":c,caseSensitive:a.caseSensitive===!0,childrenIndex:u,route:a};if(d.relativePath.startsWith("/")){if(!d.relativePath.startsWith(r)&&f)return;Ht(d.relativePath.startsWith(r),`Absolute route path "${d.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),d.relativePath=d.relativePath.slice(r.length)}let p=vn([r,d.relativePath]),m=t.concat(d);a.children&&a.children.length>0&&(Ht(a.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${p}".`),PT(a.children,e,m,p,f)),!(a.path==null&&!a.index)&&e.push({path:p,score:UR(p,a.index),routesMeta:m})};return l.forEach((a,u)=>{if(a.path===""||!a.path?.includes("?"))s(a,u);else for(let f of NT(a.path))s(a,u,!0,f)}),e}function NT(l){let e=l.split("/");if(e.length===0)return[];let[t,...r]=e,n=t.endsWith("?"),s=t.replace(/\?$/,"");if(r.length===0)return n?[s,""]:[s];let a=NT(r.join("/")),u=[];return u.push(...a.map(f=>f===""?s:[s,f].join("/"))),n&&u.push(...a),u.map(f=>l.startsWith("/")&&f===""?"/":f)}function CR(l){l.sort((e,t)=>e.score!==t.score?t.score-e.score:BR(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}var DR=/^:[\w-]+$/,OR=3,kR=2,MR=1,PR=10,NR=-2,Jb=l=>l==="*";function UR(l,e){let t=l.split("/"),r=t.length;return t.some(Jb)&&(r+=NR),e&&(r+=kR),t.filter(n=>!Jb(n)).reduce((n,s)=>n+(DR.test(s)?OR:s===""?MR:PR),r)}function BR(l,e){return l.length===e.length&&l.slice(0,-1).every((r,n)=>r===e[n])?l[l.length-1]-e[e.length-1]:0}function FR(l,e,t=!1){let{routesMeta:r}=l,n={},s="/",a=[];for(let u=0;u<r.length;++u){let f=r[u],c=u===r.length-1,d=s==="/"?e:e.slice(s.length)||"/",p=xc({path:f.relativePath,caseSensitive:f.caseSensitive,end:c},d),m=f.route;if(!p&&c&&t&&!r[r.length-1].route.index&&(p=xc({path:f.relativePath,caseSensitive:f.caseSensitive,end:!1},d)),!p)return null;Object.assign(n,p.params),a.push({params:n,pathname:vn([s,p.pathname]),pathnameBase:zR(vn([s,p.pathnameBase])),route:m}),p.pathnameBase!=="/"&&(s=vn([s,p.pathnameBase]))}return a}function xc(l,e){typeof l=="string"&&(l={path:l,caseSensitive:!1,end:!0});let[t,r]=jR(l.path,l.caseSensitive,l.end),n=e.match(t);if(!n)return null;let s=n[0],a=s.replace(/(.)\/+$/,"$1"),u=n.slice(1);return{params:r.reduce((c,{paramName:d,isOptional:p},m)=>{if(d==="*"){let y=u[m]||"";a=s.slice(0,s.length-y.length).replace(/(.)\/+$/,"$1")}const v=u[m];return p&&!v?c[d]=void 0:c[d]=(v||"").replace(/%2F/g,"/"),c},{}),pathname:s,pathnameBase:a,pattern:l}}function jR(l,e=!1,t=!0){_i(l==="*"||!l.endsWith("*")||l.endsWith("/*"),`Route path "${l}" will be treated as if it were "${l.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${l.replace(/\*$/,"/*")}".`);let r=[],n="^"+l.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,u,f)=>(r.push({paramName:u,isOptional:f!=null}),f?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return l.endsWith("*")?(r.push({paramName:"*"}),n+=l==="*"||l==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?n+="\\/*$":l!==""&&l!=="/"&&(n+="(?:(?=\\/|$))"),[new RegExp(n,e?void 0:"i"),r]}function $R(l){try{return l.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return _i(!1,`The URL path "${l}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),l}}function bn(l,e){if(e==="/")return l;if(!l.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=l.charAt(t);return r&&r!=="/"?null:l.slice(t)||"/"}var GR=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,HR=l=>GR.test(l);function KR(l,e="/"){let{pathname:t,search:r="",hash:n=""}=typeof l=="string"?Ga(l):l,s;if(t)if(HR(t))s=t;else{if(t.includes("//")){let a=t;t=t.replace(/\/\/+/g,"/"),_i(!1,`Pathnames cannot have embedded double slashes - normalizing ${a} -> ${t}`)}t.startsWith("/")?s=eE(t.substring(1),"/"):s=eE(t,e)}else s=e;return{pathname:s,search:qR(r),hash:YR(n)}}function eE(l,e){let t=e.replace(/\/+$/,"").split("/");return l.split("/").forEach(n=>{n===".."?t.length>1&&t.pop():n!=="."&&t.push(n)}),t.length>1?t.join("/"):"/"}function cd(l,e,t,r){return`Cannot include a '${l}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function VR(l){return l.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function UT(l){let e=VR(l);return e.map((t,r)=>r===e.length-1?t.pathname:t.pathnameBase)}function BT(l,e,t,r=!1){let n;typeof l=="string"?n=Ga(l):(n={...l},Ht(!n.pathname||!n.pathname.includes("?"),cd("?","pathname","search",n)),Ht(!n.pathname||!n.pathname.includes("#"),cd("#","pathname","hash",n)),Ht(!n.search||!n.search.includes("#"),cd("#","search","hash",n)));let s=l===""||n.pathname==="",a=s?"/":n.pathname,u;if(a==null)u=t;else{let p=e.length-1;if(!r&&a.startsWith("..")){let m=a.split("/");for(;m[0]==="..";)m.shift(),p-=1;n.pathname=m.join("/")}u=p>=0?e[p]:"/"}let f=KR(n,u),c=a&&a!=="/"&&a.endsWith("/"),d=(s||a===".")&&t.endsWith("/");return!f.pathname.endsWith("/")&&(c||d)&&(f.pathname+="/"),f}var vn=l=>l.join("/").replace(/\/\/+/g,"/"),zR=l=>l.replace(/\/+$/,"").replace(/^\/*/,"/"),qR=l=>!l||l==="?"?"":l.startsWith("?")?l:"?"+l,YR=l=>!l||l==="#"?"":l.startsWith("#")?l:"#"+l;function WR(l){return l!=null&&typeof l.status=="number"&&typeof l.statusText=="string"&&typeof l.internal=="boolean"&&"data"in l}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var FT=["POST","PUT","PATCH","DELETE"];new Set(FT);var QR=["GET",...FT];new Set(QR);var Ha=Le.createContext(null);Ha.displayName="DataRouter";var Bc=Le.createContext(null);Bc.displayName="DataRouterState";Le.createContext(!1);var jT=Le.createContext({isTransitioning:!1});jT.displayName="ViewTransition";var XR=Le.createContext(new Map);XR.displayName="Fetchers";var ZR=Le.createContext(null);ZR.displayName="Await";var $i=Le.createContext(null);$i.displayName="Navigation";var al=Le.createContext(null);al.displayName="Location";var Tn=Le.createContext({outlet:null,matches:[],isDataRoute:!1});Tn.displayName="Route";var lm=Le.createContext(null);lm.displayName="RouteError";function JR(l,{relative:e}={}){Ht(ol(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:r}=Le.useContext($i),{hash:n,pathname:s,search:a}=ll(l,{relative:e}),u=s;return t!=="/"&&(u=s==="/"?t:vn([t,s])),r.createHref({pathname:u,search:a,hash:n})}function ol(){return Le.useContext(al)!=null}function Us(){return Ht(ol(),"useLocation() may be used only in the context of a <Router> component."),Le.useContext(al).location}var $T="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function GT(l){Le.useContext($i).static||Le.useLayoutEffect(l)}function eI(){let{isDataRoute:l}=Le.useContext(Tn);return l?dI():tI()}function tI(){Ht(ol(),"useNavigate() may be used only in the context of a <Router> component.");let l=Le.useContext(Ha),{basename:e,navigator:t}=Le.useContext($i),{matches:r}=Le.useContext(Tn),{pathname:n}=Us(),s=JSON.stringify(UT(r)),a=Le.useRef(!1);return GT(()=>{a.current=!0}),Le.useCallback((f,c={})=>{if(_i(a.current,$T),!a.current)return;if(typeof f=="number"){t.go(f);return}let d=BT(f,JSON.parse(s),n,c.relative==="path");l==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:vn([e,d.pathname])),(c.replace?t.replace:t.push)(d,c.state,c)},[e,t,s,n,l])}Le.createContext(null);function ll(l,{relative:e}={}){let{matches:t}=Le.useContext(Tn),{pathname:r}=Us(),n=JSON.stringify(UT(t));return Le.useMemo(()=>BT(l,JSON.parse(n),r,e==="path"),[l,n,r,e])}function rI(l,e){return HT(l,e)}function HT(l,e,t,r,n){Ht(ol(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:s}=Le.useContext($i),{matches:a}=Le.useContext(Tn),u=a[a.length-1],f=u?u.params:{},c=u?u.pathname:"/",d=u?u.pathnameBase:"/",p=u&&u.route;{let T=p&&p.path||"";KT(c,!p||T.endsWith("*")||T.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${c}" (under <Route path="${T}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${T}"> to <Route path="${T==="/"?"*":`${T}/*`}">.`)}let m=Us(),v;if(e){let T=typeof e=="string"?Ga(e):e;Ht(d==="/"||T.pathname?.startsWith(d),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${d}" but pathname "${T.pathname}" was given in the \`location\` prop.`),v=T}else v=m;let y=v.pathname||"/",b=y;if(d!=="/"){let T=d.replace(/^\//,"").split("/");b="/"+y.replace(/^\//,"").split("/").slice(T.length).join("/")}let E=MT(l,{pathname:b});_i(p||E!=null,`No routes matched location "${v.pathname}${v.search}${v.hash}" `),_i(E==null||E[E.length-1].route.element!==void 0||E[E.length-1].route.Component!==void 0||E[E.length-1].route.lazy!==void 0,`Matched leaf route at location "${v.pathname}${v.search}${v.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let x=oI(E&&E.map(T=>Object.assign({},T,{params:Object.assign({},f,T.params),pathname:vn([d,s.encodeLocation?s.encodeLocation(T.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:T.pathname]),pathnameBase:T.pathnameBase==="/"?d:vn([d,s.encodeLocation?s.encodeLocation(T.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:T.pathnameBase])})),a,t,r,n);return e&&x?Le.createElement(al.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...v},navigationType:"POP"}},x):x}function iI(){let l=hI(),e=WR(l)?`${l.status} ${l.statusText}`:l instanceof Error?l.message:JSON.stringify(l),t=l instanceof Error?l.stack:null,r="rgba(200,200,200, 0.5)",n={padding:"0.5rem",backgroundColor:r},s={padding:"2px 4px",backgroundColor:r},a=null;return console.error("Error handled by React Router default ErrorBoundary:",l),a=Le.createElement(Le.Fragment,null,Le.createElement("p",null," Hey developer "),Le.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",Le.createElement("code",{style:s},"ErrorBoundary")," or"," ",Le.createElement("code",{style:s},"errorElement")," prop on your route.")),Le.createElement(Le.Fragment,null,Le.createElement("h2",null,"Unexpected Application Error!"),Le.createElement("h3",{style:{fontStyle:"italic"}},e),t?Le.createElement("pre",{style:n},t):null,a)}var nI=Le.createElement(iI,null),sI=class extends Le.Component{constructor(l){super(l),this.state={location:l.location,revalidation:l.revalidation,error:l.error}}static getDerivedStateFromError(l){return{error:l}}static getDerivedStateFromProps(l,e){return e.location!==l.location||e.revalidation!=="idle"&&l.revalidation==="idle"?{error:l.error,location:l.location,revalidation:l.revalidation}:{error:l.error!==void 0?l.error:e.error,location:e.location,revalidation:l.revalidation||e.revalidation}}componentDidCatch(l,e){this.props.onError?this.props.onError(l,e):console.error("React Router caught the following error during render",l)}render(){return this.state.error!==void 0?Le.createElement(Tn.Provider,{value:this.props.routeContext},Le.createElement(lm.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function aI({routeContext:l,match:e,children:t}){let r=Le.useContext(Ha);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),Le.createElement(Tn.Provider,{value:l},t)}function oI(l,e=[],t=null,r=null,n=null){if(l==null){if(!t)return null;if(t.errors)l=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)l=t.matches;else return null}let s=l,a=t?.errors;if(a!=null){let d=s.findIndex(p=>p.route.id&&a?.[p.route.id]!==void 0);Ht(d>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(a).join(",")}`),s=s.slice(0,Math.min(s.length,d+1))}let u=!1,f=-1;if(t)for(let d=0;d<s.length;d++){let p=s[d];if((p.route.HydrateFallback||p.route.hydrateFallbackElement)&&(f=d),p.route.id){let{loaderData:m,errors:v}=t,y=p.route.loader&&!m.hasOwnProperty(p.route.id)&&(!v||v[p.route.id]===void 0);if(p.route.lazy||y){u=!0,f>=0?s=s.slice(0,f+1):s=[s[0]];break}}}let c=t&&r?(d,p)=>{r(d,{location:t.location,params:t.matches?.[0]?.params??{},errorInfo:p})}:void 0;return s.reduceRight((d,p,m)=>{let v,y=!1,b=null,E=null;t&&(v=a&&p.route.id?a[p.route.id]:void 0,b=p.route.errorElement||nI,u&&(f<0&&m===0?(KT("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),y=!0,E=null):f===m&&(y=!0,E=p.route.hydrateFallbackElement||null)));let x=e.concat(s.slice(0,m+1)),T=()=>{let A;return v?A=b:y?A=E:p.route.Component?A=Le.createElement(p.route.Component,null):p.route.element?A=p.route.element:A=d,Le.createElement(aI,{match:p,routeContext:{outlet:d,matches:x,isDataRoute:t!=null},children:A})};return t&&(p.route.ErrorBoundary||p.route.errorElement||m===0)?Le.createElement(sI,{location:t.location,revalidation:t.revalidation,component:b,error:v,children:T(),routeContext:{outlet:null,matches:x,isDataRoute:!0},onError:c}):T()},null)}function um(l){return`${l} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function lI(l){let e=Le.useContext(Ha);return Ht(e,um(l)),e}function uI(l){let e=Le.useContext(Bc);return Ht(e,um(l)),e}function cI(l){let e=Le.useContext(Tn);return Ht(e,um(l)),e}function cm(l){let e=cI(l),t=e.matches[e.matches.length-1];return Ht(t.route.id,`${l} can only be used on routes that contain a unique "id"`),t.route.id}function fI(){return cm("useRouteId")}function hI(){let l=Le.useContext(lm),e=uI("useRouteError"),t=cm("useRouteError");return l!==void 0?l:e.errors?.[t]}function dI(){let{router:l}=lI("useNavigate"),e=cm("useNavigate"),t=Le.useRef(!1);return GT(()=>{t.current=!0}),Le.useCallback(async(n,s={})=>{_i(t.current,$T),t.current&&(typeof n=="number"?l.navigate(n):await l.navigate(n,{fromRouteId:e,...s}))},[l,e])}var tE={};function KT(l,e,t){!e&&!tE[l]&&(tE[l]=!0,_i(!1,t))}Le.memo(pI);function pI({routes:l,future:e,state:t,unstable_onError:r}){return HT(l,void 0,t,r,e)}function Gd(l){Ht(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function gI({basename:l="/",children:e=null,location:t,navigationType:r="POP",navigator:n,static:s=!1}){Ht(!ol(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let a=l.replace(/^\/*/,"/"),u=Le.useMemo(()=>({basename:a,navigator:n,static:s,future:{}}),[a,n,s]);typeof t=="string"&&(t=Ga(t));let{pathname:f="/",search:c="",hash:d="",state:p=null,key:m="default"}=t,v=Le.useMemo(()=>{let y=bn(f,a);return y==null?null:{location:{pathname:y,search:c,hash:d,state:p,key:m},navigationType:r}},[a,f,c,d,p,m,r]);return _i(v!=null,`<Router basename="${a}"> is not able to match the URL "${f}${c}${d}" because it does not start with the basename, so the <Router> won't render anything.`),v==null?null:Le.createElement($i.Provider,{value:u},Le.createElement(al.Provider,{children:e,value:v}))}function mI({children:l,location:e}){return rI(Hd(l),e)}function Hd(l,e=[]){let t=[];return Le.Children.forEach(l,(r,n)=>{if(!Le.isValidElement(r))return;let s=[...e,n];if(r.type===Le.Fragment){t.push.apply(t,Hd(r.props.children,s));return}Ht(r.type===Gd,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Ht(!r.props.index||!r.props.children,"An index route cannot have child routes.");let a={id:r.props.id||s.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(a.children=Hd(r.props.children,s)),t.push(a)}),t}var Gu="get",Hu="application/x-www-form-urlencoded";function Fc(l){return l!=null&&typeof l.tagName=="string"}function yI(l){return Fc(l)&&l.tagName.toLowerCase()==="button"}function vI(l){return Fc(l)&&l.tagName.toLowerCase()==="form"}function bI(l){return Fc(l)&&l.tagName.toLowerCase()==="input"}function EI(l){return!!(l.metaKey||l.altKey||l.ctrlKey||l.shiftKey)}function SI(l,e){return l.button===0&&(!e||e==="_self")&&!EI(l)}var xu=null;function TI(){if(xu===null)try{new FormData(document.createElement("form"),0),xu=!1}catch{xu=!0}return xu}var xI=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function fd(l){return l!=null&&!xI.has(l)?(_i(!1,`"${l}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Hu}"`),null):l}function _I(l,e){let t,r,n,s,a;if(vI(l)){let u=l.getAttribute("action");r=u?bn(u,e):null,t=l.getAttribute("method")||Gu,n=fd(l.getAttribute("enctype"))||Hu,s=new FormData(l)}else if(yI(l)||bI(l)&&(l.type==="submit"||l.type==="image")){let u=l.form;if(u==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let f=l.getAttribute("formaction")||u.getAttribute("action");if(r=f?bn(f,e):null,t=l.getAttribute("formmethod")||u.getAttribute("method")||Gu,n=fd(l.getAttribute("formenctype"))||fd(u.getAttribute("enctype"))||Hu,s=new FormData(u,l),!TI()){let{name:c,type:d,value:p}=l;if(d==="image"){let m=c?`${c}.`:"";s.append(`${m}x`,"0"),s.append(`${m}y`,"0")}else c&&s.append(c,p)}}else{if(Fc(l))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=Gu,r=null,n=Hu,a=l}return s&&n==="text/plain"&&(a=s,s=void 0),{action:r,method:t.toLowerCase(),encType:n,formData:s,body:a}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function fm(l,e){if(l===!1||l===null||typeof l>"u")throw new Error(e)}function AI(l,e,t){let r=typeof l=="string"?new URL(l,typeof window>"u"?"server://singlefetch/":window.location.origin):l;return r.pathname==="/"?r.pathname=`_root.${t}`:e&&bn(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${t}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${t}`,r}async function wI(l,e){if(l.id in e)return e[l.id];try{let t=await import(l.module);return e[l.id]=t,t}catch(t){return console.error(`Error loading route module \`${l.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function RI(l){return l==null?!1:l.href==null?l.rel==="preload"&&typeof l.imageSrcSet=="string"&&typeof l.imageSizes=="string":typeof l.rel=="string"&&typeof l.href=="string"}async function II(l,e,t){let r=await Promise.all(l.map(async n=>{let s=e.routes[n.route.id];if(s){let a=await wI(s,t);return a.links?a.links():[]}return[]}));return OI(r.flat(1).filter(RI).filter(n=>n.rel==="stylesheet"||n.rel==="preload").map(n=>n.rel==="stylesheet"?{...n,rel:"prefetch",as:"style"}:{...n,rel:"prefetch"}))}function rE(l,e,t,r,n,s){let a=(f,c)=>t[c]?f.route.id!==t[c].route.id:!0,u=(f,c)=>t[c].pathname!==f.pathname||t[c].route.path?.endsWith("*")&&t[c].params["*"]!==f.params["*"];return s==="assets"?e.filter((f,c)=>a(f,c)||u(f,c)):s==="data"?e.filter((f,c)=>{let d=r.routes[f.route.id];if(!d||!d.hasLoader)return!1;if(a(f,c)||u(f,c))return!0;if(f.route.shouldRevalidate){let p=f.route.shouldRevalidate({currentUrl:new URL(n.pathname+n.search+n.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(l,window.origin),nextParams:f.params,defaultShouldRevalidate:!0});if(typeof p=="boolean")return p}return!0}):[]}function LI(l,e,{includeHydrateFallback:t}={}){return CI(l.map(r=>{let n=e.routes[r.route.id];if(!n)return[];let s=[n.module];return n.clientActionModule&&(s=s.concat(n.clientActionModule)),n.clientLoaderModule&&(s=s.concat(n.clientLoaderModule)),t&&n.hydrateFallbackModule&&(s=s.concat(n.hydrateFallbackModule)),n.imports&&(s=s.concat(n.imports)),s}).flat(1))}function CI(l){return[...new Set(l)]}function DI(l){let e={},t=Object.keys(l).sort();for(let r of t)e[r]=l[r];return e}function OI(l,e){let t=new Set;return new Set(e),l.reduce((r,n)=>{let s=JSON.stringify(DI(n));return t.has(s)||(t.add(s),r.push({key:s,link:n})),r},[])}function VT(){let l=Le.useContext(Ha);return fm(l,"You must render this element inside a <DataRouterContext.Provider> element"),l}function kI(){let l=Le.useContext(Bc);return fm(l,"You must render this element inside a <DataRouterStateContext.Provider> element"),l}var hm=Le.createContext(void 0);hm.displayName="FrameworkContext";function zT(){let l=Le.useContext(hm);return fm(l,"You must render this element inside a <HydratedRouter> element"),l}function MI(l,e){let t=Le.useContext(hm),[r,n]=Le.useState(!1),[s,a]=Le.useState(!1),{onFocus:u,onBlur:f,onMouseEnter:c,onMouseLeave:d,onTouchStart:p}=e,m=Le.useRef(null);Le.useEffect(()=>{if(l==="render"&&a(!0),l==="viewport"){let b=x=>{x.forEach(T=>{a(T.isIntersecting)})},E=new IntersectionObserver(b,{threshold:.5});return m.current&&E.observe(m.current),()=>{E.disconnect()}}},[l]),Le.useEffect(()=>{if(r){let b=setTimeout(()=>{a(!0)},100);return()=>{clearTimeout(b)}}},[r]);let v=()=>{n(!0)},y=()=>{n(!1),a(!1)};return t?l!=="intent"?[s,m,{}]:[s,m,{onFocus:Fo(u,v),onBlur:Fo(f,y),onMouseEnter:Fo(c,v),onMouseLeave:Fo(d,y),onTouchStart:Fo(p,v)}]:[!1,m,{}]}function Fo(l,e){return t=>{l&&l(t),t.defaultPrevented||e(t)}}function PI({page:l,...e}){let{router:t}=VT(),r=Le.useMemo(()=>MT(t.routes,l,t.basename),[t.routes,l,t.basename]);return r?Le.createElement(UI,{page:l,matches:r,...e}):null}function NI(l){let{manifest:e,routeModules:t}=zT(),[r,n]=Le.useState([]);return Le.useEffect(()=>{let s=!1;return II(l,e,t).then(a=>{s||n(a)}),()=>{s=!0}},[l,e,t]),r}function UI({page:l,matches:e,...t}){let r=Us(),{manifest:n,routeModules:s}=zT(),{basename:a}=VT(),{loaderData:u,matches:f}=kI(),c=Le.useMemo(()=>rE(l,e,f,n,r,"data"),[l,e,f,n,r]),d=Le.useMemo(()=>rE(l,e,f,n,r,"assets"),[l,e,f,n,r]),p=Le.useMemo(()=>{if(l===r.pathname+r.search+r.hash)return[];let y=new Set,b=!1;if(e.forEach(x=>{let T=n.routes[x.route.id];!T||!T.hasLoader||(!c.some(A=>A.route.id===x.route.id)&&x.route.id in u&&s[x.route.id]?.shouldRevalidate||T.hasClientLoader?b=!0:y.add(x.route.id))}),y.size===0)return[];let E=AI(l,a,"data");return b&&y.size>0&&E.searchParams.set("_routes",e.filter(x=>y.has(x.route.id)).map(x=>x.route.id).join(",")),[E.pathname+E.search]},[a,u,r,n,c,e,l,s]),m=Le.useMemo(()=>LI(d,n),[d,n]),v=NI(d);return Le.createElement(Le.Fragment,null,p.map(y=>Le.createElement("link",{key:y,rel:"prefetch",as:"fetch",href:y,...t})),m.map(y=>Le.createElement("link",{key:y,rel:"modulepreload",href:y,...t})),v.map(({key:y,link:b})=>Le.createElement("link",{key:y,nonce:t.nonce,...b})))}function BI(...l){return e=>{l.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var qT=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{qT&&(window.__reactRouterVersion="7.9.6")}catch{}function FI({basename:l,children:e,window:t}){let r=Le.useRef();r.current==null&&(r.current=AR({window:t,v5Compat:!0}));let n=r.current,[s,a]=Le.useState({action:n.action,location:n.location}),u=Le.useCallback(f=>{Le.startTransition(()=>a(f))},[a]);return Le.useLayoutEffect(()=>n.listen(u),[n,u]),Le.createElement(gI,{basename:l,children:e,location:s.location,navigationType:s.action,navigator:n})}var YT=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,WT=Le.forwardRef(function({onClick:e,discover:t="render",prefetch:r="none",relative:n,reloadDocument:s,replace:a,state:u,target:f,to:c,preventScrollReset:d,viewTransition:p,...m},v){let{basename:y}=Le.useContext($i),b=typeof c=="string"&&YT.test(c),E,x=!1;if(typeof c=="string"&&b&&(E=c,qT))try{let B=new URL(window.location.href),P=c.startsWith("//")?new URL(B.protocol+c):new URL(c),$=bn(P.pathname,y);P.origin===B.origin&&$!=null?c=$+P.search+P.hash:x=!0}catch{_i(!1,`<Link to="${c}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let T=JR(c,{relative:n}),[A,L,w]=MI(r,m),C=HI(c,{replace:a,state:u,target:f,preventScrollReset:d,relative:n,viewTransition:p});function I(B){e&&e(B),B.defaultPrevented||C(B)}let O=Le.createElement("a",{...m,...w,href:E||T,onClick:x||s?e:I,ref:BI(v,L),target:f,"data-discover":!b&&t==="render"?"true":void 0});return A&&!b?Le.createElement(Le.Fragment,null,O,Le.createElement(PI,{page:T})):O});WT.displayName="Link";var jI=Le.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:r="",end:n=!1,style:s,to:a,viewTransition:u,children:f,...c},d){let p=ll(a,{relative:c.relative}),m=Us(),v=Le.useContext(Bc),{navigator:y,basename:b}=Le.useContext($i),E=v!=null&&YI(p)&&u===!0,x=y.encodeLocation?y.encodeLocation(p).pathname:p.pathname,T=m.pathname,A=v&&v.navigation&&v.navigation.location?v.navigation.location.pathname:null;t||(T=T.toLowerCase(),A=A?A.toLowerCase():null,x=x.toLowerCase()),A&&b&&(A=bn(A,b)||A);const L=x!=="/"&&x.endsWith("/")?x.length-1:x.length;let w=T===x||!n&&T.startsWith(x)&&T.charAt(L)==="/",C=A!=null&&(A===x||!n&&A.startsWith(x)&&A.charAt(x.length)==="/"),I={isActive:w,isPending:C,isTransitioning:E},O=w?e:void 0,B;typeof r=="function"?B=r(I):B=[r,w?"active":null,C?"pending":null,E?"transitioning":null].filter(Boolean).join(" ");let P=typeof s=="function"?s(I):s;return Le.createElement(WT,{...c,"aria-current":O,className:B,ref:d,style:P,to:a,viewTransition:u},typeof f=="function"?f(I):f)});jI.displayName="NavLink";var $I=Le.forwardRef(({discover:l="render",fetcherKey:e,navigate:t,reloadDocument:r,replace:n,state:s,method:a=Gu,action:u,onSubmit:f,relative:c,preventScrollReset:d,viewTransition:p,...m},v)=>{let y=zI(),b=qI(u,{relative:c}),E=a.toLowerCase()==="get"?"get":"post",x=typeof u=="string"&&YT.test(u),T=A=>{if(f&&f(A),A.defaultPrevented)return;A.preventDefault();let L=A.nativeEvent.submitter,w=L?.getAttribute("formmethod")||a;y(L||A.currentTarget,{fetcherKey:e,method:w,navigate:t,replace:n,state:s,relative:c,preventScrollReset:d,viewTransition:p})};return Le.createElement("form",{ref:v,method:E,action:b,onSubmit:r?f:T,...m,"data-discover":!x&&l==="render"?"true":void 0})});$I.displayName="Form";function GI(l){return`${l} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function QT(l){let e=Le.useContext(Ha);return Ht(e,GI(l)),e}function HI(l,{target:e,replace:t,state:r,preventScrollReset:n,relative:s,viewTransition:a}={}){let u=eI(),f=Us(),c=ll(l,{relative:s});return Le.useCallback(d=>{if(SI(d,e)){d.preventDefault();let p=t!==void 0?t:Xo(f)===Xo(c);u(l,{replace:p,state:r,preventScrollReset:n,relative:s,viewTransition:a})}},[f,u,c,t,r,e,l,n,s,a])}var KI=0,VI=()=>`__${String(++KI)}__`;function zI(){let{router:l}=QT("useSubmit"),{basename:e}=Le.useContext($i),t=fI();return Le.useCallback(async(r,n={})=>{let{action:s,method:a,encType:u,formData:f,body:c}=_I(r,e);if(n.navigate===!1){let d=n.fetcherKey||VI();await l.fetch(d,t,n.action||s,{preventScrollReset:n.preventScrollReset,formData:f,body:c,formMethod:n.method||a,formEncType:n.encType||u,flushSync:n.flushSync})}else await l.navigate(n.action||s,{preventScrollReset:n.preventScrollReset,formData:f,body:c,formMethod:n.method||a,formEncType:n.encType||u,replace:n.replace,state:n.state,fromRouteId:t,flushSync:n.flushSync,viewTransition:n.viewTransition})},[l,e,t])}function qI(l,{relative:e}={}){let{basename:t}=Le.useContext($i),r=Le.useContext(Tn);Ht(r,"useFormAction must be used inside a RouteContext");let[n]=r.matches.slice(-1),s={...ll(l||".",{relative:e})},a=Us();if(l==null){s.search=a.search;let u=new URLSearchParams(s.search),f=u.getAll("index");if(f.some(d=>d==="")){u.delete("index"),f.filter(p=>p).forEach(p=>u.append("index",p));let d=u.toString();s.search=d?`?${d}`:""}}return(!l||l===".")&&n.route.index&&(s.search=s.search?s.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(s.pathname=s.pathname==="/"?t:vn([t,s.pathname])),Xo(s)}function YI(l,{relative:e}={}){let t=Le.useContext(jT);Ht(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=QT("useViewTransitionState"),n=ll(l,{relative:e});if(!t.isTransitioning)return!1;let s=bn(t.currentLocation.pathname,r)||t.currentLocation.pathname,a=bn(t.nextLocation.pathname,r)||t.nextLocation.pathname;return xc(n.pathname,a)!=null||xc(n.pathname,s)!=null}function WI({connectionState:l}){const[e,t]=Le.useState(new Date);Le.useEffect(()=>{const n=setInterval(()=>{t(new Date)},5e3);return()=>clearInterval(n)},[]);const r=()=>{switch(l){case"connected":return V.jsxs("span",{className:"flex items-center gap-1.5 px-2.5 py-1 rounded-full bg-farm-100 text-farm-700 text-xs font-medium",children:[V.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-farm-500"}),"Connected"]});case"connecting":return V.jsxs("span",{className:"flex items-center gap-1.5 px-2.5 py-1 rounded-full bg-amber-100 text-amber-700 text-xs font-medium",children:[V.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-amber-500 animate-pulse"}),"Connecting"]});case"disconnected":return V.jsxs("span",{className:"flex items-center gap-1.5 px-2.5 py-1 rounded-full bg-red-100 text-red-700 text-xs font-medium",children:[V.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-red-500"}),"Disconnected"]});case"error":return V.jsxs("span",{className:"flex items-center gap-1.5 px-2.5 py-1 rounded-full bg-red-100 text-red-700 text-xs font-medium",children:[V.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-red-500"}),"Error"]})}};return V.jsx("header",{className:"bg-farm-500 shadow-lg flex-shrink-0",children:V.jsx("div",{className:"max-w-screen-2xl mx-auto px-4 py-3",children:V.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[V.jsxs("div",{className:"flex items-center gap-3",children:[V.jsx("div",{className:"text-lg font-bold text-gray-900",children:" | Tansaeng SmartFarm"}),V.jsxs("div",{className:"flex items-center gap-2",children:[V.jsx("a",{href:"/",target:"_blank",className:"text-xs px-2 py-1 bg-white text-farm-700 rounded hover:bg-farm-50 transition-colors font-medium",children:""}),V.jsx("a",{href:"/admin/",target:"_blank",className:"text-xs px-2 py-1 bg-white text-farm-700 rounded hover:bg-farm-50 transition-colors font-medium",children:""})]})]}),V.jsx("div",{className:"text-sm font-medium text-gray-800",children:e.toLocaleString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}),V.jsx("div",{className:"flex items-center gap-2",children:r()})]})})})}const QI=[{id:"devices",label:" ",icon:""},{id:"mist",label:"",icon:""},{id:"environment",label:" ",icon:""},{id:"cameras",label:"",icon:""},{id:"settings",label:"",icon:""}];function XI({activeTab:l,onTabChange:e}){return V.jsx("nav",{className:"bg-white shadow-sm border-b border-gray-200 flex-shrink-0",children:V.jsx("div",{className:"max-w-screen-2xl mx-auto px-2 sm:px-4",children:V.jsx("div",{className:"flex justify-start sm:justify-center gap-1 overflow-x-auto scrollbar-hide",children:QI.map(t=>V.jsxs("button",{onClick:()=>e(t.id),className:`
                flex items-center gap-1.5 px-3 sm:px-4 py-3 text-xs sm:text-sm font-medium
                transition-all duration-200 whitespace-nowrap border-b-2 flex-shrink-0
                ${l===t.id?"border-farm-500 bg-farm-50 text-farm-700":"border-transparent text-gray-500 hover:bg-gray-50 hover:text-farm-700"}
              `,children:[V.jsx("span",{className:"text-base sm:text-lg",children:t.icon}),V.jsx("span",{className:"hidden xs:inline sm:inline",children:t.label})]},t.id))})})})}const Kd=[{id:"fan_front",name:" ",type:"fan",esp32Id:"ctlr-0001",commandTopic:"tansaeng/ctlr-0001/fan1/cmd",stateTopic:"tansaeng/ctlr-0001/fan1/state"},{id:"fan_back",name:" ",type:"fan",esp32Id:"esp32-node-1",commandTopic:"tansaeng/esp32-node-1/fan_back/cmd",stateTopic:"tansaeng/esp32-node-1/fan_back/state"},{id:"fan_top",name:"",type:"fan",esp32Id:"esp32-node-1",commandTopic:"tansaeng/esp32-node-1/fan_top/cmd",stateTopic:"tansaeng/esp32-node-1/fan_top/state"},{id:"vent_side_left",name:" Left",type:"vent",esp32Id:"esp32-node-2",commandTopic:"tansaeng/esp32-node-2/vent_side_left/cmd",stateTopic:"tansaeng/esp32-node-2/vent_side_left/state",extra:{supportsPercentage:!0}},{id:"vent_side_right",name:" Right",type:"vent",esp32Id:"esp32-node-2",commandTopic:"tansaeng/esp32-node-2/vent_side_right/cmd",stateTopic:"tansaeng/esp32-node-2/vent_side_right/state",extra:{supportsPercentage:!0}},{id:"vent_top_left",name:" Left",type:"vent",esp32Id:"esp32-node-2",commandTopic:"tansaeng/esp32-node-2/vent_top_left/cmd",stateTopic:"tansaeng/esp32-node-2/vent_top_left/state",extra:{supportsPercentage:!0}},{id:"vent_top_right",name:" Right",type:"vent",esp32Id:"esp32-node-2",commandTopic:"tansaeng/esp32-node-2/vent_top_right/cmd",stateTopic:"tansaeng/esp32-node-2/vent_top_right/state",extra:{supportsPercentage:!0}},{id:"pump_nutrient_fill",name:" ",type:"pump",esp32Id:"esp32-node-3",commandTopic:"tansaeng/esp32-node-3/pump_nutrient_fill/cmd",stateTopic:"tansaeng/esp32-node-3/pump_nutrient_fill/state"},{id:"pump_water_curtain",name:"",type:"pump",esp32Id:"esp32-node-3",commandTopic:"tansaeng/esp32-node-3/pump_water_curtain/cmd",stateTopic:"tansaeng/esp32-node-3/pump_water_curtain/state"},{id:"pump_heating_fill",name:" ",type:"pump",esp32Id:"esp32-node-3",commandTopic:"tansaeng/esp32-node-3/pump_heating_fill/cmd",stateTopic:"tansaeng/esp32-node-3/pump_heating_fill/state"}];function hd(l){return Kd.filter(e=>e.type===l)}function dd({device:l,power:e,percentage:t,lastSavedAt:r,onToggle:n,onPercentageChange:s}){const a=e==="on",u=()=>l.type==="fan"?"":l.type==="vent"?"":l.type==="pump"?"":"";return V.jsxs("div",{className:"bg-white rounded-lg shadow-card hover:shadow-card-hover transition-all duration-200 p-3 border border-gray-200",children:[V.jsxs("div",{className:"flex items-center justify-between mb-2",children:[V.jsxs("div",{className:"flex items-center gap-1.5",children:[V.jsx("div",{className:"text-2xl",children:u()}),V.jsxs("div",{children:[V.jsx("h3",{className:"text-sm font-bold text-gray-800 m-0",children:l.name}),V.jsx("p",{className:"text-2xs text-gray-500 m-0",children:l.type==="fan"?"":l.type==="vent"?"":""})]})]}),!l.extra?.supportsPercentage&&V.jsxs("div",{className:"flex flex-col items-end gap-1",children:[V.jsx("button",{onClick:()=>n?.(!a),className:`
                relative inline-flex h-9 w-18 cursor-pointer rounded-full
                border-2 border-transparent transition-all duration-300
                ${a?"bg-farm-500":"bg-gray-300"}
              `,role:"switch","aria-checked":a,children:V.jsx("span",{className:`
                flex items-center justify-center h-8 w-8 rounded-full
                bg-white shadow-md transition-transform duration-300
                ${a?"translate-x-9":"translate-x-0"}
              `,children:a?V.jsx("svg",{className:"w-4 h-4 text-farm-500",fill:"currentColor",viewBox:"0 0 20 20",children:V.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):V.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",children:V.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})}),V.jsx("span",{className:`text-xs font-semibold ${a?"text-farm-500":"text-gray-500"}`,children:a?"ON":"OFF"})]})]}),l.extra?.supportsPercentage&&V.jsxs("div",{className:"mb-3",children:[V.jsxs("div",{className:"flex items-center justify-between mb-2",children:[V.jsx("span",{className:"text-xs font-medium text-gray-600",children:" "}),V.jsxs("span",{className:"text-2xl font-bold text-farm-500",children:[t??0,"%"]})]}),V.jsx("input",{type:"range",min:"0",max:"100",value:t??0,onChange:f=>s?.(Number(f.target.value)),className:"slider-thumb w-full h-2 rounded-full appearance-none cursor-pointer",style:{background:`linear-gradient(to right, #10b981 0%, #10b981 ${t??0}%, #e5e7eb ${t??0}%, #e5e7eb 100%)`}}),V.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[V.jsx("span",{children:""}),V.jsx("span",{children:""})]})]}),V.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-gray-100",children:[V.jsxs("div",{className:"flex items-center gap-1.5",children:[V.jsx("div",{className:`
            w-1.5 h-1.5 rounded-full
            ${a?"bg-farm-500 animate-pulse":"bg-gray-400"}
          `}),V.jsx("span",{className:`
            text-2xs font-semibold
            ${a?"text-farm-700":"text-gray-600"}
          `,children:a?" ":""})]}),V.jsx("div",{className:"text-2xs text-gray-400",children:r?new Date(r).toLocaleString("ko-KR",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):""})]})]})}var dm=Object.defineProperty,ZI=Object.getOwnPropertyDescriptor,JI=Object.getOwnPropertyNames,eL=Object.prototype.hasOwnProperty,Vr=(l,e)=>()=>(l&&(e=l(l=0)),e),je=(l,e)=>()=>(e||l((e={exports:{}}).exports,e),e.exports),Ka=(l,e)=>{for(var t in e)dm(l,t,{get:e[t],enumerable:!0})},tL=(l,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of JI(e))!eL.call(l,n)&&n!==t&&dm(l,n,{get:()=>e[n],enumerable:!(r=ZI(e,n))||r.enumerable});return l},Ct=l=>tL(dm({},"__esModule",{value:!0}),l),ke=Vr(()=>{}),Mt={};Ka(Mt,{_debugEnd:()=>_p,_debugProcess:()=>xp,_events:()=>Fp,_eventsCount:()=>jp,_exiting:()=>up,_fatalExceptions:()=>Ep,_getActiveHandles:()=>ix,_getActiveRequests:()=>rx,_kill:()=>hp,_linkedBinding:()=>ex,_maxListeners:()=>Bp,_preload_modules:()=>Np,_rawDebug:()=>ap,_startProfilerIdleNotifier:()=>Ap,_stopProfilerIdleNotifier:()=>wp,_tickCallback:()=>Tp,abort:()=>Cp,addListener:()=>$p,allowedNodeEnvironmentFlags:()=>vp,arch:()=>zd,argv:()=>Wd,argv0:()=>Pp,assert:()=>nx,binding:()=>ep,browser:()=>sp,chdir:()=>ip,config:()=>cp,cpuUsage:()=>$o,cwd:()=>rp,debugPort:()=>Mp,default:()=>gm,dlopen:()=>tx,domain:()=>lp,emit:()=>zp,emitWarning:()=>Jd,env:()=>Yd,execArgv:()=>Qd,execPath:()=>kp,exit:()=>mp,features:()=>bp,hasUncaughtExceptionCaptureCallback:()=>sx,hrtime:()=>Ku,kill:()=>gp,listeners:()=>ox,memoryUsage:()=>pp,moduleLoadList:()=>op,nextTick:()=>ZT,off:()=>Hp,on:()=>hn,once:()=>Gp,openStdin:()=>yp,pid:()=>Dp,platform:()=>qd,ppid:()=>Op,prependListener:()=>qp,prependOnceListener:()=>Yp,reallyExit:()=>fp,release:()=>np,removeAllListeners:()=>Vp,removeListener:()=>Kp,resourceUsage:()=>dp,setSourceMapsEnabled:()=>Up,setUncaughtExceptionCaptureCallback:()=>Sp,stderr:()=>Ip,stdin:()=>Lp,stdout:()=>Rp,title:()=>Vd,umask:()=>tp,uptime:()=>ax,version:()=>Xd,versions:()=>Zd});function pm(l){throw new Error("Node.js process "+l+" is not supported by JSPM core outside of Node.js")}function rL(){!ks||!Ds||(ks=!1,Ds.length?Pi=Ds.concat(Pi):zo=-1,Pi.length&&XT())}function XT(){if(!ks){var l=setTimeout(rL,0);ks=!0;for(var e=Pi.length;e;){for(Ds=Pi,Pi=[];++zo<e;)Ds&&Ds[zo].run();zo=-1,e=Pi.length}Ds=null,ks=!1,clearTimeout(l)}}function ZT(l){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];Pi.push(new JT(l,e)),Pi.length===1&&!ks&&setTimeout(XT,0)}function JT(l,e){this.fun=l,this.array=e}function Sr(){}function ex(l){pm("_linkedBinding")}function tx(l){pm("dlopen")}function rx(){return[]}function ix(){return[]}function nx(l,e){if(!l)throw new Error(e||"assertion error")}function sx(){return!1}function ax(){return mn.now()/1e3}function Ku(l){var e=Math.floor((Date.now()-mn.now())*.001),t=mn.now()*.001,r=Math.floor(t)+e,n=Math.floor(t%1*1e9);return l&&(r=r-l[0],n=n-l[1],n<0&&(r--,n+=Vu)),[r,n]}function hn(){return gm}function ox(l){return[]}var Pi,ks,Ds,zo,Vd,zd,qd,Yd,Wd,Qd,Xd,Zd,Jd,ep,tp,rp,ip,np,sp,ap,op,lp,up,cp,fp,hp,$o,dp,pp,gp,mp,yp,vp,bp,Ep,Sp,Tp,xp,_p,Ap,wp,Rp,Ip,Lp,Cp,Dp,Op,kp,Mp,Pp,Np,Up,mn,pd,Vu,Bp,Fp,jp,$p,Gp,Hp,Kp,Vp,zp,qp,Yp,gm,iL=Vr(()=>{ke(),Pe(),Me(),Pi=[],ks=!1,zo=-1,JT.prototype.run=function(){this.fun.apply(null,this.array)},Vd="browser",zd="x64",qd="browser",Yd={PATH:"/usr/bin",LANG:typeof navigator<"u"?navigator.language+".UTF-8":void 0,PWD:"/",HOME:"/home",TMP:"/tmp"},Wd=["/usr/bin/node"],Qd=[],Xd="v16.8.0",Zd={},Jd=function(l,e){console.warn((e?e+": ":"")+l)},ep=function(l){pm("binding")},tp=function(l){return 0},rp=function(){return"/"},ip=function(l){},np={name:"node",sourceUrl:"",headersUrl:"",libUrl:""},sp=!0,ap=Sr,op=[],lp={},up=!1,cp={},fp=Sr,hp=Sr,$o=function(){return{}},dp=$o,pp=$o,gp=Sr,mp=Sr,yp=Sr,vp={},bp={inspector:!1,debug:!1,uv:!1,ipv6:!1,tls_alpn:!1,tls_sni:!1,tls_ocsp:!1,tls:!1,cached_builtins:!0},Ep=Sr,Sp=Sr,Tp=Sr,xp=Sr,_p=Sr,Ap=Sr,wp=Sr,Rp=void 0,Ip=void 0,Lp=void 0,Cp=Sr,Dp=2,Op=1,kp="/bin/usr/node",Mp=9229,Pp="node",Np=[],Up=Sr,mn={now:typeof performance<"u"?performance.now.bind(performance):void 0,timing:typeof performance<"u"?performance.timing:void 0},mn.now===void 0&&(pd=Date.now(),mn.timing&&mn.timing.navigationStart&&(pd=mn.timing.navigationStart),mn.now=()=>Date.now()-pd),Vu=1e9,Ku.bigint=function(l){var e=Ku(l);return typeof BigInt>"u"?e[0]*Vu+e[1]:BigInt(e[0]*Vu)+BigInt(e[1])},Bp=10,Fp={},jp=0,$p=hn,Gp=hn,Hp=hn,Kp=hn,Vp=hn,zp=Sr,qp=hn,Yp=hn,gm={version:Xd,versions:Zd,arch:zd,platform:qd,browser:sp,release:np,_rawDebug:ap,moduleLoadList:op,binding:ep,_linkedBinding:ex,_events:Fp,_eventsCount:jp,_maxListeners:Bp,on:hn,addListener:$p,once:Gp,off:Hp,removeListener:Kp,removeAllListeners:Vp,emit:zp,prependListener:qp,prependOnceListener:Yp,listeners:ox,domain:lp,_exiting:up,config:cp,dlopen:tx,uptime:ax,_getActiveRequests:rx,_getActiveHandles:ix,reallyExit:fp,_kill:hp,cpuUsage:$o,resourceUsage:dp,memoryUsage:pp,kill:gp,exit:mp,openStdin:yp,allowedNodeEnvironmentFlags:vp,assert:nx,features:bp,_fatalExceptions:Ep,setUncaughtExceptionCaptureCallback:Sp,hasUncaughtExceptionCaptureCallback:sx,emitWarning:Jd,nextTick:ZT,_tickCallback:Tp,_debugProcess:xp,_debugEnd:_p,_startProfilerIdleNotifier:Ap,_stopProfilerIdleNotifier:wp,stdout:Rp,stdin:Lp,stderr:Ip,abort:Cp,umask:tp,chdir:ip,cwd:rp,env:Yd,title:Vd,argv:Wd,execArgv:Qd,pid:Dp,ppid:Op,execPath:kp,debugPort:Mp,hrtime:Ku,argv0:Pp,_preload_modules:Np,setSourceMapsEnabled:Up}}),Me=Vr(()=>{iL()});function nL(){if(Wp)return Ca;Wp=!0,Ca.byteLength=u,Ca.toByteArray=c,Ca.fromByteArray=m;for(var l=[],e=[],t=typeof Uint8Array<"u"?Uint8Array:Array,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=0,s=r.length;n<s;++n)l[n]=r[n],e[r.charCodeAt(n)]=n;e[45]=62,e[95]=63;function a(v){var y=v.length;if(y%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var b=v.indexOf("=");b===-1&&(b=y);var E=b===y?0:4-b%4;return[b,E]}function u(v){var y=a(v),b=y[0],E=y[1];return(b+E)*3/4-E}function f(v,y,b){return(y+b)*3/4-b}function c(v){var y,b=a(v),E=b[0],x=b[1],T=new t(f(v,E,x)),A=0,L=x>0?E-4:E,w;for(w=0;w<L;w+=4)y=e[v.charCodeAt(w)]<<18|e[v.charCodeAt(w+1)]<<12|e[v.charCodeAt(w+2)]<<6|e[v.charCodeAt(w+3)],T[A++]=y>>16&255,T[A++]=y>>8&255,T[A++]=y&255;return x===2&&(y=e[v.charCodeAt(w)]<<2|e[v.charCodeAt(w+1)]>>4,T[A++]=y&255),x===1&&(y=e[v.charCodeAt(w)]<<10|e[v.charCodeAt(w+1)]<<4|e[v.charCodeAt(w+2)]>>2,T[A++]=y>>8&255,T[A++]=y&255),T}function d(v){return l[v>>18&63]+l[v>>12&63]+l[v>>6&63]+l[v&63]}function p(v,y,b){for(var E,x=[],T=y;T<b;T+=3)E=(v[T]<<16&16711680)+(v[T+1]<<8&65280)+(v[T+2]&255),x.push(d(E));return x.join("")}function m(v){for(var y,b=v.length,E=b%3,x=[],T=16383,A=0,L=b-E;A<L;A+=T)x.push(p(v,A,A+T>L?L:A+T));return E===1?(y=v[b-1],x.push(l[y>>2]+l[y<<4&63]+"==")):E===2&&(y=(v[b-2]<<8)+v[b-1],x.push(l[y>>10]+l[y>>4&63]+l[y<<2&63]+"=")),x.join("")}return Ca}function sL(){return Qp?Go:(Qp=!0,Go.read=function(l,e,t,r,n){var s,a,u=n*8-r-1,f=(1<<u)-1,c=f>>1,d=-7,p=t?n-1:0,m=t?-1:1,v=l[e+p];for(p+=m,s=v&(1<<-d)-1,v>>=-d,d+=u;d>0;s=s*256+l[e+p],p+=m,d-=8);for(a=s&(1<<-d)-1,s>>=-d,d+=r;d>0;a=a*256+l[e+p],p+=m,d-=8);if(s===0)s=1-c;else{if(s===f)return a?NaN:(v?-1:1)*(1/0);a=a+Math.pow(2,r),s=s-c}return(v?-1:1)*a*Math.pow(2,s-r)},Go.write=function(l,e,t,r,n,s){var a,u,f,c=s*8-n-1,d=(1<<c)-1,p=d>>1,m=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,v=r?0:s-1,y=r?1:-1,b=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(u=isNaN(e)?1:0,a=d):(a=Math.floor(Math.log(e)/Math.LN2),e*(f=Math.pow(2,-a))<1&&(a--,f*=2),a+p>=1?e+=m/f:e+=m*Math.pow(2,1-p),e*f>=2&&(a++,f/=2),a+p>=d?(u=0,a=d):a+p>=1?(u=(e*f-1)*Math.pow(2,n),a=a+p):(u=e*Math.pow(2,p-1)*Math.pow(2,n),a=0));n>=8;l[t+v]=u&255,v+=y,u/=256,n-=8);for(a=a<<n|u,c+=n;c>0;l[t+v]=a&255,v+=y,a/=256,c-=8);l[t+v-y]|=b*128},Go)}function aL(){if(Xp)return Jn;Xp=!0;let l=nL(),e=sL(),t=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;Jn.Buffer=a,Jn.SlowBuffer=x,Jn.INSPECT_MAX_BYTES=50;let r=2147483647;Jn.kMaxLength=r,a.TYPED_ARRAY_SUPPORT=n(),!a.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function n(){try{let R=new Uint8Array(1),D={foo:function(){return 42}};return Object.setPrototypeOf(D,Uint8Array.prototype),Object.setPrototypeOf(R,D),R.foo()===42}catch{return!1}}Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}});function s(R){if(R>r)throw new RangeError('The value "'+R+'" is invalid for option "size"');let D=new Uint8Array(R);return Object.setPrototypeOf(D,a.prototype),D}function a(R,D,j){if(typeof R=="number"){if(typeof D=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return d(R)}return u(R,D,j)}a.poolSize=8192;function u(R,D,j){if(typeof R=="string")return p(R,D);if(ArrayBuffer.isView(R))return v(R);if(R==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof R);if(le(R,ArrayBuffer)||R&&le(R.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(le(R,SharedArrayBuffer)||R&&le(R.buffer,SharedArrayBuffer)))return y(R,D,j);if(typeof R=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');let ae=R.valueOf&&R.valueOf();if(ae!=null&&ae!==R)return a.from(ae,D,j);let ye=b(R);if(ye)return ye;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof R[Symbol.toPrimitive]=="function")return a.from(R[Symbol.toPrimitive]("string"),D,j);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof R)}a.from=function(R,D,j){return u(R,D,j)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array);function f(R){if(typeof R!="number")throw new TypeError('"size" argument must be of type number');if(R<0)throw new RangeError('The value "'+R+'" is invalid for option "size"')}function c(R,D,j){return f(R),R<=0?s(R):D!==void 0?typeof j=="string"?s(R).fill(D,j):s(R).fill(D):s(R)}a.alloc=function(R,D,j){return c(R,D,j)};function d(R){return f(R),s(R<0?0:E(R)|0)}a.allocUnsafe=function(R){return d(R)},a.allocUnsafeSlow=function(R){return d(R)};function p(R,D){if((typeof D!="string"||D==="")&&(D="utf8"),!a.isEncoding(D))throw new TypeError("Unknown encoding: "+D);let j=T(R,D)|0,ae=s(j),ye=ae.write(R,D);return ye!==j&&(ae=ae.slice(0,ye)),ae}function m(R){let D=R.length<0?0:E(R.length)|0,j=s(D);for(let ae=0;ae<D;ae+=1)j[ae]=R[ae]&255;return j}function v(R){if(le(R,Uint8Array)){let D=new Uint8Array(R);return y(D.buffer,D.byteOffset,D.byteLength)}return m(R)}function y(R,D,j){if(D<0||R.byteLength<D)throw new RangeError('"offset" is outside of buffer bounds');if(R.byteLength<D+(j||0))throw new RangeError('"length" is outside of buffer bounds');let ae;return D===void 0&&j===void 0?ae=new Uint8Array(R):j===void 0?ae=new Uint8Array(R,D):ae=new Uint8Array(R,D,j),Object.setPrototypeOf(ae,a.prototype),ae}function b(R){if(a.isBuffer(R)){let D=E(R.length)|0,j=s(D);return j.length===0||R.copy(j,0,0,D),j}if(R.length!==void 0)return typeof R.length!="number"||Ne(R.length)?s(0):m(R);if(R.type==="Buffer"&&Array.isArray(R.data))return m(R.data)}function E(R){if(R>=r)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r.toString(16)+" bytes");return R|0}function x(R){return+R!=R&&(R=0),a.alloc(+R)}a.isBuffer=function(R){return R!=null&&R._isBuffer===!0&&R!==a.prototype},a.compare=function(R,D){if(le(R,Uint8Array)&&(R=a.from(R,R.offset,R.byteLength)),le(D,Uint8Array)&&(D=a.from(D,D.offset,D.byteLength)),!a.isBuffer(R)||!a.isBuffer(D))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(R===D)return 0;let j=R.length,ae=D.length;for(let ye=0,De=Math.min(j,ae);ye<De;++ye)if(R[ye]!==D[ye]){j=R[ye],ae=D[ye];break}return j<ae?-1:ae<j?1:0},a.isEncoding=function(R){switch(String(R).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(R,D){if(!Array.isArray(R))throw new TypeError('"list" argument must be an Array of Buffers');if(R.length===0)return a.alloc(0);let j;if(D===void 0)for(D=0,j=0;j<R.length;++j)D+=R[j].length;let ae=a.allocUnsafe(D),ye=0;for(j=0;j<R.length;++j){let De=R[j];if(le(De,Uint8Array))ye+De.length>ae.length?(a.isBuffer(De)||(De=a.from(De)),De.copy(ae,ye)):Uint8Array.prototype.set.call(ae,De,ye);else if(a.isBuffer(De))De.copy(ae,ye);else throw new TypeError('"list" argument must be an Array of Buffers');ye+=De.length}return ae};function T(R,D){if(a.isBuffer(R))return R.length;if(ArrayBuffer.isView(R)||le(R,ArrayBuffer))return R.byteLength;if(typeof R!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof R);let j=R.length,ae=arguments.length>2&&arguments[2]===!0;if(!ae&&j===0)return 0;let ye=!1;for(;;)switch(D){case"ascii":case"latin1":case"binary":return j;case"utf8":case"utf-8":return te(R).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return j*2;case"hex":return j>>>1;case"base64":return Ce(R).length;default:if(ye)return ae?-1:te(R).length;D=(""+D).toLowerCase(),ye=!0}}a.byteLength=T;function A(R,D,j){let ae=!1;if((D===void 0||D<0)&&(D=0),D>this.length||((j===void 0||j>this.length)&&(j=this.length),j<=0)||(j>>>=0,D>>>=0,j<=D))return"";for(R||(R="utf8");;)switch(R){case"hex":return z(this,D,j);case"utf8":case"utf-8":return Z(this,D,j);case"ascii":return H(this,D,j);case"latin1":case"binary":return K(this,D,j);case"base64":return F(this,D,j);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ie(this,D,j);default:if(ae)throw new TypeError("Unknown encoding: "+R);R=(R+"").toLowerCase(),ae=!0}}a.prototype._isBuffer=!0;function L(R,D,j){let ae=R[D];R[D]=R[j],R[j]=ae}a.prototype.swap16=function(){let R=this.length;if(R%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let D=0;D<R;D+=2)L(this,D,D+1);return this},a.prototype.swap32=function(){let R=this.length;if(R%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let D=0;D<R;D+=4)L(this,D,D+3),L(this,D+1,D+2);return this},a.prototype.swap64=function(){let R=this.length;if(R%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let D=0;D<R;D+=8)L(this,D,D+7),L(this,D+1,D+6),L(this,D+2,D+5),L(this,D+3,D+4);return this},a.prototype.toString=function(){let R=this.length;return R===0?"":arguments.length===0?Z(this,0,R):A.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(R){if(!a.isBuffer(R))throw new TypeError("Argument must be a Buffer");return this===R?!0:a.compare(this,R)===0},a.prototype.inspect=function(){let R="",D=Jn.INSPECT_MAX_BYTES;return R=this.toString("hex",0,D).replace(/(.{2})/g,"$1 ").trim(),this.length>D&&(R+=" ... "),"<Buffer "+R+">"},t&&(a.prototype[t]=a.prototype.inspect),a.prototype.compare=function(R,D,j,ae,ye){if(le(R,Uint8Array)&&(R=a.from(R,R.offset,R.byteLength)),!a.isBuffer(R))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof R);if(D===void 0&&(D=0),j===void 0&&(j=R?R.length:0),ae===void 0&&(ae=0),ye===void 0&&(ye=this.length),D<0||j>R.length||ae<0||ye>this.length)throw new RangeError("out of range index");if(ae>=ye&&D>=j)return 0;if(ae>=ye)return-1;if(D>=j)return 1;if(D>>>=0,j>>>=0,ae>>>=0,ye>>>=0,this===R)return 0;let De=ye-ae,ze=j-D,de=Math.min(De,ze),Te=this.slice(ae,ye),Ze=R.slice(D,j);for(let We=0;We<de;++We)if(Te[We]!==Ze[We]){De=Te[We],ze=Ze[We];break}return De<ze?-1:ze<De?1:0};function w(R,D,j,ae,ye){if(R.length===0)return-1;if(typeof j=="string"?(ae=j,j=0):j>2147483647?j=2147483647:j<-2147483648&&(j=-2147483648),j=+j,Ne(j)&&(j=ye?0:R.length-1),j<0&&(j=R.length+j),j>=R.length){if(ye)return-1;j=R.length-1}else if(j<0)if(ye)j=0;else return-1;if(typeof D=="string"&&(D=a.from(D,ae)),a.isBuffer(D))return D.length===0?-1:C(R,D,j,ae,ye);if(typeof D=="number")return D=D&255,typeof Uint8Array.prototype.indexOf=="function"?ye?Uint8Array.prototype.indexOf.call(R,D,j):Uint8Array.prototype.lastIndexOf.call(R,D,j):C(R,[D],j,ae,ye);throw new TypeError("val must be string, number or Buffer")}function C(R,D,j,ae,ye){let De=1,ze=R.length,de=D.length;if(ae!==void 0&&(ae=String(ae).toLowerCase(),ae==="ucs2"||ae==="ucs-2"||ae==="utf16le"||ae==="utf-16le")){if(R.length<2||D.length<2)return-1;De=2,ze/=2,de/=2,j/=2}function Te(We,at){return De===1?We[at]:We.readUInt16BE(at*De)}let Ze;if(ye){let We=-1;for(Ze=j;Ze<ze;Ze++)if(Te(R,Ze)===Te(D,We===-1?0:Ze-We)){if(We===-1&&(We=Ze),Ze-We+1===de)return We*De}else We!==-1&&(Ze-=Ze-We),We=-1}else for(j+de>ze&&(j=ze-de),Ze=j;Ze>=0;Ze--){let We=!0;for(let at=0;at<de;at++)if(Te(R,Ze+at)!==Te(D,at)){We=!1;break}if(We)return Ze}return-1}a.prototype.includes=function(R,D,j){return this.indexOf(R,D,j)!==-1},a.prototype.indexOf=function(R,D,j){return w(this,R,D,j,!0)},a.prototype.lastIndexOf=function(R,D,j){return w(this,R,D,j,!1)};function I(R,D,j,ae){j=Number(j)||0;let ye=R.length-j;ae?(ae=Number(ae),ae>ye&&(ae=ye)):ae=ye;let De=D.length;ae>De/2&&(ae=De/2);let ze;for(ze=0;ze<ae;++ze){let de=parseInt(D.substr(ze*2,2),16);if(Ne(de))return ze;R[j+ze]=de}return ze}function O(R,D,j,ae){return Ue(te(D,R.length-j),R,j,ae)}function B(R,D,j,ae){return Ue(ge(D),R,j,ae)}function P(R,D,j,ae){return Ue(Ce(D),R,j,ae)}function $(R,D,j,ae){return Ue(Ie(D,R.length-j),R,j,ae)}a.prototype.write=function(R,D,j,ae){if(D===void 0)ae="utf8",j=this.length,D=0;else if(j===void 0&&typeof D=="string")ae=D,j=this.length,D=0;else if(isFinite(D))D=D>>>0,isFinite(j)?(j=j>>>0,ae===void 0&&(ae="utf8")):(ae=j,j=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let ye=this.length-D;if((j===void 0||j>ye)&&(j=ye),R.length>0&&(j<0||D<0)||D>this.length)throw new RangeError("Attempt to write outside buffer bounds");ae||(ae="utf8");let De=!1;for(;;)switch(ae){case"hex":return I(this,R,D,j);case"utf8":case"utf-8":return O(this,R,D,j);case"ascii":case"latin1":case"binary":return B(this,R,D,j);case"base64":return P(this,R,D,j);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return $(this,R,D,j);default:if(De)throw new TypeError("Unknown encoding: "+ae);ae=(""+ae).toLowerCase(),De=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function F(R,D,j){return D===0&&j===R.length?l.fromByteArray(R):l.fromByteArray(R.slice(D,j))}function Z(R,D,j){j=Math.min(R.length,j);let ae=[],ye=D;for(;ye<j;){let De=R[ye],ze=null,de=De>239?4:De>223?3:De>191?2:1;if(ye+de<=j){let Te,Ze,We,at;switch(de){case 1:De<128&&(ze=De);break;case 2:Te=R[ye+1],(Te&192)===128&&(at=(De&31)<<6|Te&63,at>127&&(ze=at));break;case 3:Te=R[ye+1],Ze=R[ye+2],(Te&192)===128&&(Ze&192)===128&&(at=(De&15)<<12|(Te&63)<<6|Ze&63,at>2047&&(at<55296||at>57343)&&(ze=at));break;case 4:Te=R[ye+1],Ze=R[ye+2],We=R[ye+3],(Te&192)===128&&(Ze&192)===128&&(We&192)===128&&(at=(De&15)<<18|(Te&63)<<12|(Ze&63)<<6|We&63,at>65535&&at<1114112&&(ze=at))}}ze===null?(ze=65533,de=1):ze>65535&&(ze-=65536,ae.push(ze>>>10&1023|55296),ze=56320|ze&1023),ae.push(ze),ye+=de}return q(ae)}let X=4096;function q(R){let D=R.length;if(D<=X)return String.fromCharCode.apply(String,R);let j="",ae=0;for(;ae<D;)j+=String.fromCharCode.apply(String,R.slice(ae,ae+=X));return j}function H(R,D,j){let ae="";j=Math.min(R.length,j);for(let ye=D;ye<j;++ye)ae+=String.fromCharCode(R[ye]&127);return ae}function K(R,D,j){let ae="";j=Math.min(R.length,j);for(let ye=D;ye<j;++ye)ae+=String.fromCharCode(R[ye]);return ae}function z(R,D,j){let ae=R.length;(!D||D<0)&&(D=0),(!j||j<0||j>ae)&&(j=ae);let ye="";for(let De=D;De<j;++De)ye+=Ke[R[De]];return ye}function ie(R,D,j){let ae=R.slice(D,j),ye="";for(let De=0;De<ae.length-1;De+=2)ye+=String.fromCharCode(ae[De]+ae[De+1]*256);return ye}a.prototype.slice=function(R,D){let j=this.length;R=~~R,D=D===void 0?j:~~D,R<0?(R+=j,R<0&&(R=0)):R>j&&(R=j),D<0?(D+=j,D<0&&(D=0)):D>j&&(D=j),D<R&&(D=R);let ae=this.subarray(R,D);return Object.setPrototypeOf(ae,a.prototype),ae};function Y(R,D,j){if(R%1!==0||R<0)throw new RangeError("offset is not uint");if(R+D>j)throw new RangeError("Trying to access beyond buffer length")}a.prototype.readUintLE=a.prototype.readUIntLE=function(R,D,j){R=R>>>0,D=D>>>0,j||Y(R,D,this.length);let ae=this[R],ye=1,De=0;for(;++De<D&&(ye*=256);)ae+=this[R+De]*ye;return ae},a.prototype.readUintBE=a.prototype.readUIntBE=function(R,D,j){R=R>>>0,D=D>>>0,j||Y(R,D,this.length);let ae=this[R+--D],ye=1;for(;D>0&&(ye*=256);)ae+=this[R+--D]*ye;return ae},a.prototype.readUint8=a.prototype.readUInt8=function(R,D){return R=R>>>0,D||Y(R,1,this.length),this[R]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(R,D){return R=R>>>0,D||Y(R,2,this.length),this[R]|this[R+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(R,D){return R=R>>>0,D||Y(R,2,this.length),this[R]<<8|this[R+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(R,D){return R=R>>>0,D||Y(R,4,this.length),(this[R]|this[R+1]<<8|this[R+2]<<16)+this[R+3]*16777216},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(R,D){return R=R>>>0,D||Y(R,4,this.length),this[R]*16777216+(this[R+1]<<16|this[R+2]<<8|this[R+3])},a.prototype.readBigUInt64LE=Ae(function(R){R=R>>>0,pe(R,"offset");let D=this[R],j=this[R+7];(D===void 0||j===void 0)&&Fe(R,this.length-8);let ae=D+this[++R]*2**8+this[++R]*2**16+this[++R]*2**24,ye=this[++R]+this[++R]*2**8+this[++R]*2**16+j*2**24;return BigInt(ae)+(BigInt(ye)<<BigInt(32))}),a.prototype.readBigUInt64BE=Ae(function(R){R=R>>>0,pe(R,"offset");let D=this[R],j=this[R+7];(D===void 0||j===void 0)&&Fe(R,this.length-8);let ae=D*2**24+this[++R]*2**16+this[++R]*2**8+this[++R],ye=this[++R]*2**24+this[++R]*2**16+this[++R]*2**8+j;return(BigInt(ae)<<BigInt(32))+BigInt(ye)}),a.prototype.readIntLE=function(R,D,j){R=R>>>0,D=D>>>0,j||Y(R,D,this.length);let ae=this[R],ye=1,De=0;for(;++De<D&&(ye*=256);)ae+=this[R+De]*ye;return ye*=128,ae>=ye&&(ae-=Math.pow(2,8*D)),ae},a.prototype.readIntBE=function(R,D,j){R=R>>>0,D=D>>>0,j||Y(R,D,this.length);let ae=D,ye=1,De=this[R+--ae];for(;ae>0&&(ye*=256);)De+=this[R+--ae]*ye;return ye*=128,De>=ye&&(De-=Math.pow(2,8*D)),De},a.prototype.readInt8=function(R,D){return R=R>>>0,D||Y(R,1,this.length),this[R]&128?(255-this[R]+1)*-1:this[R]},a.prototype.readInt16LE=function(R,D){R=R>>>0,D||Y(R,2,this.length);let j=this[R]|this[R+1]<<8;return j&32768?j|4294901760:j},a.prototype.readInt16BE=function(R,D){R=R>>>0,D||Y(R,2,this.length);let j=this[R+1]|this[R]<<8;return j&32768?j|4294901760:j},a.prototype.readInt32LE=function(R,D){return R=R>>>0,D||Y(R,4,this.length),this[R]|this[R+1]<<8|this[R+2]<<16|this[R+3]<<24},a.prototype.readInt32BE=function(R,D){return R=R>>>0,D||Y(R,4,this.length),this[R]<<24|this[R+1]<<16|this[R+2]<<8|this[R+3]},a.prototype.readBigInt64LE=Ae(function(R){R=R>>>0,pe(R,"offset");let D=this[R],j=this[R+7];(D===void 0||j===void 0)&&Fe(R,this.length-8);let ae=this[R+4]+this[R+5]*2**8+this[R+6]*2**16+(j<<24);return(BigInt(ae)<<BigInt(32))+BigInt(D+this[++R]*2**8+this[++R]*2**16+this[++R]*2**24)}),a.prototype.readBigInt64BE=Ae(function(R){R=R>>>0,pe(R,"offset");let D=this[R],j=this[R+7];(D===void 0||j===void 0)&&Fe(R,this.length-8);let ae=(D<<24)+this[++R]*2**16+this[++R]*2**8+this[++R];return(BigInt(ae)<<BigInt(32))+BigInt(this[++R]*2**24+this[++R]*2**16+this[++R]*2**8+j)}),a.prototype.readFloatLE=function(R,D){return R=R>>>0,D||Y(R,4,this.length),e.read(this,R,!0,23,4)},a.prototype.readFloatBE=function(R,D){return R=R>>>0,D||Y(R,4,this.length),e.read(this,R,!1,23,4)},a.prototype.readDoubleLE=function(R,D){return R=R>>>0,D||Y(R,8,this.length),e.read(this,R,!0,52,8)},a.prototype.readDoubleBE=function(R,D){return R=R>>>0,D||Y(R,8,this.length),e.read(this,R,!1,52,8)};function U(R,D,j,ae,ye,De){if(!a.isBuffer(R))throw new TypeError('"buffer" argument must be a Buffer instance');if(D>ye||D<De)throw new RangeError('"value" argument is out of bounds');if(j+ae>R.length)throw new RangeError("Index out of range")}a.prototype.writeUintLE=a.prototype.writeUIntLE=function(R,D,j,ae){if(R=+R,D=D>>>0,j=j>>>0,!ae){let ze=Math.pow(2,8*j)-1;U(this,R,D,j,ze,0)}let ye=1,De=0;for(this[D]=R&255;++De<j&&(ye*=256);)this[D+De]=R/ye&255;return D+j},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(R,D,j,ae){if(R=+R,D=D>>>0,j=j>>>0,!ae){let ze=Math.pow(2,8*j)-1;U(this,R,D,j,ze,0)}let ye=j-1,De=1;for(this[D+ye]=R&255;--ye>=0&&(De*=256);)this[D+ye]=R/De&255;return D+j},a.prototype.writeUint8=a.prototype.writeUInt8=function(R,D,j){return R=+R,D=D>>>0,j||U(this,R,D,1,255,0),this[D]=R&255,D+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(R,D,j){return R=+R,D=D>>>0,j||U(this,R,D,2,65535,0),this[D]=R&255,this[D+1]=R>>>8,D+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(R,D,j){return R=+R,D=D>>>0,j||U(this,R,D,2,65535,0),this[D]=R>>>8,this[D+1]=R&255,D+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(R,D,j){return R=+R,D=D>>>0,j||U(this,R,D,4,4294967295,0),this[D+3]=R>>>24,this[D+2]=R>>>16,this[D+1]=R>>>8,this[D]=R&255,D+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(R,D,j){return R=+R,D=D>>>0,j||U(this,R,D,4,4294967295,0),this[D]=R>>>24,this[D+1]=R>>>16,this[D+2]=R>>>8,this[D+3]=R&255,D+4};function N(R,D,j,ae,ye){he(D,ae,ye,R,j,7);let De=Number(D&BigInt(4294967295));R[j++]=De,De=De>>8,R[j++]=De,De=De>>8,R[j++]=De,De=De>>8,R[j++]=De;let ze=Number(D>>BigInt(32)&BigInt(4294967295));return R[j++]=ze,ze=ze>>8,R[j++]=ze,ze=ze>>8,R[j++]=ze,ze=ze>>8,R[j++]=ze,j}function W(R,D,j,ae,ye){he(D,ae,ye,R,j,7);let De=Number(D&BigInt(4294967295));R[j+7]=De,De=De>>8,R[j+6]=De,De=De>>8,R[j+5]=De,De=De>>8,R[j+4]=De;let ze=Number(D>>BigInt(32)&BigInt(4294967295));return R[j+3]=ze,ze=ze>>8,R[j+2]=ze,ze=ze>>8,R[j+1]=ze,ze=ze>>8,R[j]=ze,j+8}a.prototype.writeBigUInt64LE=Ae(function(R,D=0){return N(this,R,D,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeBigUInt64BE=Ae(function(R,D=0){return W(this,R,D,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeIntLE=function(R,D,j,ae){if(R=+R,D=D>>>0,!ae){let de=Math.pow(2,8*j-1);U(this,R,D,j,de-1,-de)}let ye=0,De=1,ze=0;for(this[D]=R&255;++ye<j&&(De*=256);)R<0&&ze===0&&this[D+ye-1]!==0&&(ze=1),this[D+ye]=(R/De>>0)-ze&255;return D+j},a.prototype.writeIntBE=function(R,D,j,ae){if(R=+R,D=D>>>0,!ae){let de=Math.pow(2,8*j-1);U(this,R,D,j,de-1,-de)}let ye=j-1,De=1,ze=0;for(this[D+ye]=R&255;--ye>=0&&(De*=256);)R<0&&ze===0&&this[D+ye+1]!==0&&(ze=1),this[D+ye]=(R/De>>0)-ze&255;return D+j},a.prototype.writeInt8=function(R,D,j){return R=+R,D=D>>>0,j||U(this,R,D,1,127,-128),R<0&&(R=255+R+1),this[D]=R&255,D+1},a.prototype.writeInt16LE=function(R,D,j){return R=+R,D=D>>>0,j||U(this,R,D,2,32767,-32768),this[D]=R&255,this[D+1]=R>>>8,D+2},a.prototype.writeInt16BE=function(R,D,j){return R=+R,D=D>>>0,j||U(this,R,D,2,32767,-32768),this[D]=R>>>8,this[D+1]=R&255,D+2},a.prototype.writeInt32LE=function(R,D,j){return R=+R,D=D>>>0,j||U(this,R,D,4,2147483647,-2147483648),this[D]=R&255,this[D+1]=R>>>8,this[D+2]=R>>>16,this[D+3]=R>>>24,D+4},a.prototype.writeInt32BE=function(R,D,j){return R=+R,D=D>>>0,j||U(this,R,D,4,2147483647,-2147483648),R<0&&(R=4294967295+R+1),this[D]=R>>>24,this[D+1]=R>>>16,this[D+2]=R>>>8,this[D+3]=R&255,D+4},a.prototype.writeBigInt64LE=Ae(function(R,D=0){return N(this,R,D,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),a.prototype.writeBigInt64BE=Ae(function(R,D=0){return W(this,R,D,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function ue(R,D,j,ae,ye,De){if(j+ae>R.length)throw new RangeError("Index out of range");if(j<0)throw new RangeError("Index out of range")}function ne(R,D,j,ae,ye){return D=+D,j=j>>>0,ye||ue(R,D,j,4),e.write(R,D,j,ae,23,4),j+4}a.prototype.writeFloatLE=function(R,D,j){return ne(this,R,D,!0,j)},a.prototype.writeFloatBE=function(R,D,j){return ne(this,R,D,!1,j)};function Ee(R,D,j,ae,ye){return D=+D,j=j>>>0,ye||ue(R,D,j,8),e.write(R,D,j,ae,52,8),j+8}a.prototype.writeDoubleLE=function(R,D,j){return Ee(this,R,D,!0,j)},a.prototype.writeDoubleBE=function(R,D,j){return Ee(this,R,D,!1,j)},a.prototype.copy=function(R,D,j,ae){if(!a.isBuffer(R))throw new TypeError("argument should be a Buffer");if(j||(j=0),!ae&&ae!==0&&(ae=this.length),D>=R.length&&(D=R.length),D||(D=0),ae>0&&ae<j&&(ae=j),ae===j||R.length===0||this.length===0)return 0;if(D<0)throw new RangeError("targetStart out of bounds");if(j<0||j>=this.length)throw new RangeError("Index out of range");if(ae<0)throw new RangeError("sourceEnd out of bounds");ae>this.length&&(ae=this.length),R.length-D<ae-j&&(ae=R.length-D+j);let ye=ae-j;return this===R&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(D,j,ae):Uint8Array.prototype.set.call(R,this.subarray(j,ae),D),ye},a.prototype.fill=function(R,D,j,ae){if(typeof R=="string"){if(typeof D=="string"?(ae=D,D=0,j=this.length):typeof j=="string"&&(ae=j,j=this.length),ae!==void 0&&typeof ae!="string")throw new TypeError("encoding must be a string");if(typeof ae=="string"&&!a.isEncoding(ae))throw new TypeError("Unknown encoding: "+ae);if(R.length===1){let De=R.charCodeAt(0);(ae==="utf8"&&De<128||ae==="latin1")&&(R=De)}}else typeof R=="number"?R=R&255:typeof R=="boolean"&&(R=Number(R));if(D<0||this.length<D||this.length<j)throw new RangeError("Out of range index");if(j<=D)return this;D=D>>>0,j=j===void 0?this.length:j>>>0,R||(R=0);let ye;if(typeof R=="number")for(ye=D;ye<j;++ye)this[ye]=R;else{let De=a.isBuffer(R)?R:a.from(R,ae),ze=De.length;if(ze===0)throw new TypeError('The value "'+R+'" is invalid for argument "value"');for(ye=0;ye<j-D;++ye)this[ye+D]=De[ye%ze]}return this};let se={};function J(R,D,j){se[R]=class extends j{constructor(){super(),Object.defineProperty(this,"message",{value:D.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${R}]`,this.stack,delete this.name}get code(){return R}set code(ae){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:ae,writable:!0})}toString(){return`${this.name} [${R}]: ${this.message}`}}}J("ERR_BUFFER_OUT_OF_BOUNDS",function(R){return R?`${R} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),J("ERR_INVALID_ARG_TYPE",function(R,D){return`The "${R}" argument must be of type number. Received type ${typeof D}`},TypeError),J("ERR_OUT_OF_RANGE",function(R,D,j){let ae=`The value of "${R}" is out of range.`,ye=j;return Number.isInteger(j)&&Math.abs(j)>2**32?ye=me(String(j)):typeof j=="bigint"&&(ye=String(j),(j>BigInt(2)**BigInt(32)||j<-(BigInt(2)**BigInt(32)))&&(ye=me(ye)),ye+="n"),ae+=` It must be ${D}. Received ${ye}`,ae},RangeError);function me(R){let D="",j=R.length,ae=R[0]==="-"?1:0;for(;j>=ae+4;j-=3)D=`_${R.slice(j-3,j)}${D}`;return`${R.slice(0,j)}${D}`}function ce(R,D,j){pe(D,"offset"),(R[D]===void 0||R[D+j]===void 0)&&Fe(D,R.length-(j+1))}function he(R,D,j,ae,ye,De){if(R>j||R<D){let ze=typeof D=="bigint"?"n":"",de;throw D===0||D===BigInt(0)?de=`>= 0${ze} and < 2${ze} ** ${(De+1)*8}${ze}`:de=`>= -(2${ze} ** ${(De+1)*8-1}${ze}) and < 2 ** ${(De+1)*8-1}${ze}`,new se.ERR_OUT_OF_RANGE("value",de,R)}ce(ae,ye,De)}function pe(R,D){if(typeof R!="number")throw new se.ERR_INVALID_ARG_TYPE(D,"number",R)}function Fe(R,D,j){throw Math.floor(R)!==R?(pe(R,j),new se.ERR_OUT_OF_RANGE("offset","an integer",R)):D<0?new se.ERR_BUFFER_OUT_OF_BOUNDS:new se.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${D}`,R)}let Re=/[^+/0-9A-Za-z-_]/g;function ee(R){if(R=R.split("=")[0],R=R.trim().replace(Re,""),R.length<2)return"";for(;R.length%4!==0;)R=R+"=";return R}function te(R,D){D=D||1/0;let j,ae=R.length,ye=null,De=[];for(let ze=0;ze<ae;++ze){if(j=R.charCodeAt(ze),j>55295&&j<57344){if(!ye){if(j>56319){(D-=3)>-1&&De.push(239,191,189);continue}else if(ze+1===ae){(D-=3)>-1&&De.push(239,191,189);continue}ye=j;continue}if(j<56320){(D-=3)>-1&&De.push(239,191,189),ye=j;continue}j=(ye-55296<<10|j-56320)+65536}else ye&&(D-=3)>-1&&De.push(239,191,189);if(ye=null,j<128){if((D-=1)<0)break;De.push(j)}else if(j<2048){if((D-=2)<0)break;De.push(j>>6|192,j&63|128)}else if(j<65536){if((D-=3)<0)break;De.push(j>>12|224,j>>6&63|128,j&63|128)}else if(j<1114112){if((D-=4)<0)break;De.push(j>>18|240,j>>12&63|128,j>>6&63|128,j&63|128)}else throw new Error("Invalid code point")}return De}function ge(R){let D=[];for(let j=0;j<R.length;++j)D.push(R.charCodeAt(j)&255);return D}function Ie(R,D){let j,ae,ye,De=[];for(let ze=0;ze<R.length&&!((D-=2)<0);++ze)j=R.charCodeAt(ze),ae=j>>8,ye=j%256,De.push(ye),De.push(ae);return De}function Ce(R){return l.toByteArray(ee(R))}function Ue(R,D,j,ae){let ye;for(ye=0;ye<ae&&!(ye+j>=D.length||ye>=R.length);++ye)D[ye+j]=R[ye];return ye}function le(R,D){return R instanceof D||R!=null&&R.constructor!=null&&R.constructor.name!=null&&R.constructor.name===D.name}function Ne(R){return R!==R}let Ke=(function(){let R="0123456789abcdef",D=new Array(256);for(let j=0;j<16;++j){let ae=j*16;for(let ye=0;ye<16;++ye)D[ae+ye]=R[j]+R[ye]}return D})();function Ae(R){return typeof BigInt>"u"?nt:R}function nt(){throw new Error("BigInt not supported")}return Jn}var Ca,Wp,Go,Qp,Jn,Xp,oL=Vr(()=>{ke(),Pe(),Me(),Ca={},Wp=!1,Go={},Qp=!1,Jn={},Xp=!1}),fr={};Ka(fr,{Buffer:()=>_c,INSPECT_MAX_BYTES:()=>lx,default:()=>dn,kMaxLength:()=>ux});var dn,_c,lx,ux,hr=Vr(()=>{ke(),Pe(),Me(),oL(),dn=aL(),dn.Buffer,dn.SlowBuffer,dn.INSPECT_MAX_BYTES,dn.kMaxLength,_c=dn.Buffer,lx=dn.INSPECT_MAX_BYTES,ux=dn.kMaxLength}),Pe=Vr(()=>{hr()}),Kt=je((l,e)=>{ke(),Pe(),Me();var t=class extends Error{constructor(r){if(!Array.isArray(r))throw new TypeError(`Expected input to be an Array, got ${typeof r}`);let n="";for(let s=0;s<r.length;s++)n+=`    ${r[s].stack}
`;super(n),this.name="AggregateError",this.errors=r}};e.exports={AggregateError:t,ArrayIsArray(r){return Array.isArray(r)},ArrayPrototypeIncludes(r,n){return r.includes(n)},ArrayPrototypeIndexOf(r,n){return r.indexOf(n)},ArrayPrototypeJoin(r,n){return r.join(n)},ArrayPrototypeMap(r,n){return r.map(n)},ArrayPrototypePop(r,n){return r.pop(n)},ArrayPrototypePush(r,n){return r.push(n)},ArrayPrototypeSlice(r,n,s){return r.slice(n,s)},Error,FunctionPrototypeCall(r,n,...s){return r.call(n,...s)},FunctionPrototypeSymbolHasInstance(r,n){return Function.prototype[Symbol.hasInstance].call(r,n)},MathFloor:Math.floor,Number,NumberIsInteger:Number.isInteger,NumberIsNaN:Number.isNaN,NumberMAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,NumberMIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,NumberParseInt:Number.parseInt,ObjectDefineProperties(r,n){return Object.defineProperties(r,n)},ObjectDefineProperty(r,n,s){return Object.defineProperty(r,n,s)},ObjectGetOwnPropertyDescriptor(r,n){return Object.getOwnPropertyDescriptor(r,n)},ObjectKeys(r){return Object.keys(r)},ObjectSetPrototypeOf(r,n){return Object.setPrototypeOf(r,n)},Promise,PromisePrototypeCatch(r,n){return r.catch(n)},PromisePrototypeThen(r,n,s){return r.then(n,s)},PromiseReject(r){return Promise.reject(r)},PromiseResolve(r){return Promise.resolve(r)},ReflectApply:Reflect.apply,RegExpPrototypeTest(r,n){return r.test(n)},SafeSet:Set,String,StringPrototypeSlice(r,n,s){return r.slice(n,s)},StringPrototypeToLowerCase(r){return r.toLowerCase()},StringPrototypeToUpperCase(r){return r.toUpperCase()},StringPrototypeTrim(r){return r.trim()},Symbol,SymbolFor:Symbol.for,SymbolAsyncIterator:Symbol.asyncIterator,SymbolHasInstance:Symbol.hasInstance,SymbolIterator:Symbol.iterator,SymbolDispose:Symbol.dispose||Symbol("Symbol.dispose"),SymbolAsyncDispose:Symbol.asyncDispose||Symbol("Symbol.asyncDispose"),TypedArrayPrototypeSet(r,n,s){return r.set(n,s)},Boolean,Uint8Array}}),cx=je((l,e)=>{ke(),Pe(),Me(),e.exports={format(t,...r){return t.replace(/%([sdifj])/g,function(...[n,s]){let a=r.shift();return s==="f"?a.toFixed(6):s==="j"?JSON.stringify(a):s==="s"&&typeof a=="object"?`${a.constructor!==Object?a.constructor.name:""} {}`.trim():a.toString()})},inspect(t){switch(typeof t){case"string":if(t.includes("'"))if(t.includes('"')){if(!t.includes("`")&&!t.includes("${"))return`\`${t}\``}else return`"${t}"`;return`'${t}'`;case"number":return isNaN(t)?"NaN":Object.is(t,-0)?String(t):t;case"bigint":return`${String(t)}n`;case"boolean":case"undefined":return String(t);case"object":return"{}"}}}}),Cr=je((l,e)=>{ke(),Pe(),Me();var{format:t,inspect:r}=cx(),{AggregateError:n}=Kt(),s=globalThis.AggregateError||n,a=Symbol("kIsNodeError"),u=["string","function","number","object","Function","Object","boolean","bigint","symbol"],f=/^([A-Z][a-z0-9]*)+$/,c="__node_internal_",d={};function p(T,A){if(!T)throw new d.ERR_INTERNAL_ASSERTION(A)}function m(T){let A="",L=T.length,w=T[0]==="-"?1:0;for(;L>=w+4;L-=3)A=`_${T.slice(L-3,L)}${A}`;return`${T.slice(0,L)}${A}`}function v(T,A,L){if(typeof A=="function")return p(A.length<=L.length,`Code: ${T}; The provided arguments length (${L.length}) does not match the required ones (${A.length}).`),A(...L);let w=(A.match(/%[dfijoOs]/g)||[]).length;return p(w===L.length,`Code: ${T}; The provided arguments length (${L.length}) does not match the required ones (${w}).`),L.length===0?A:t(A,...L)}function y(T,A,L){L||(L=Error);class w extends L{constructor(...I){super(v(T,A,I))}toString(){return`${this.name} [${T}]: ${this.message}`}}Object.defineProperties(w.prototype,{name:{value:L.name,writable:!0,enumerable:!1,configurable:!0},toString:{value(){return`${this.name} [${T}]: ${this.message}`},writable:!0,enumerable:!1,configurable:!0}}),w.prototype.code=T,w.prototype[a]=!0,d[T]=w}function b(T){let A=c+T.name;return Object.defineProperty(T,"name",{value:A}),T}function E(T,A){if(T&&A&&T!==A){if(Array.isArray(A.errors))return A.errors.push(T),A;let L=new s([A,T],A.message);return L.code=A.code,L}return T||A}var x=class extends Error{constructor(T="The operation was aborted",A=void 0){if(A!==void 0&&typeof A!="object")throw new d.ERR_INVALID_ARG_TYPE("options","Object",A);super(T,A),this.code="ABORT_ERR",this.name="AbortError"}};y("ERR_ASSERTION","%s",Error),y("ERR_INVALID_ARG_TYPE",(T,A,L)=>{p(typeof T=="string","'name' must be a string"),Array.isArray(A)||(A=[A]);let w="The ";T.endsWith(" argument")?w+=`${T} `:w+=`"${T}" ${T.includes(".")?"property":"argument"} `,w+="must be ";let C=[],I=[],O=[];for(let P of A)p(typeof P=="string","All expected entries have to be of type string"),u.includes(P)?C.push(P.toLowerCase()):f.test(P)?I.push(P):(p(P!=="object",'The value "object" should be written as "Object"'),O.push(P));if(I.length>0){let P=C.indexOf("object");P!==-1&&(C.splice(C,P,1),I.push("Object"))}if(C.length>0){switch(C.length){case 1:w+=`of type ${C[0]}`;break;case 2:w+=`one of type ${C[0]} or ${C[1]}`;break;default:{let P=C.pop();w+=`one of type ${C.join(", ")}, or ${P}`}}(I.length>0||O.length>0)&&(w+=" or ")}if(I.length>0){switch(I.length){case 1:w+=`an instance of ${I[0]}`;break;case 2:w+=`an instance of ${I[0]} or ${I[1]}`;break;default:{let P=I.pop();w+=`an instance of ${I.join(", ")}, or ${P}`}}O.length>0&&(w+=" or ")}switch(O.length){case 0:break;case 1:O[0].toLowerCase()!==O[0]&&(w+="an "),w+=`${O[0]}`;break;case 2:w+=`one of ${O[0]} or ${O[1]}`;break;default:{let P=O.pop();w+=`one of ${O.join(", ")}, or ${P}`}}if(L==null)w+=`. Received ${L}`;else if(typeof L=="function"&&L.name)w+=`. Received function ${L.name}`;else if(typeof L=="object"){var B;if((B=L.constructor)!==null&&B!==void 0&&B.name)w+=`. Received an instance of ${L.constructor.name}`;else{let P=r(L,{depth:-1});w+=`. Received ${P}`}}else{let P=r(L,{colors:!1});P.length>25&&(P=`${P.slice(0,25)}...`),w+=`. Received type ${typeof L} (${P})`}return w},TypeError),y("ERR_INVALID_ARG_VALUE",(T,A,L="is invalid")=>{let w=r(A);return w.length>128&&(w=w.slice(0,128)+"..."),`The ${T.includes(".")?"property":"argument"} '${T}' ${L}. Received ${w}`},TypeError),y("ERR_INVALID_RETURN_VALUE",(T,A,L)=>{var w;let C=L!=null&&(w=L.constructor)!==null&&w!==void 0&&w.name?`instance of ${L.constructor.name}`:`type ${typeof L}`;return`Expected ${T} to be returned from the "${A}" function but got ${C}.`},TypeError),y("ERR_MISSING_ARGS",(...T)=>{p(T.length>0,"At least one arg needs to be specified");let A,L=T.length;switch(T=(Array.isArray(T)?T:[T]).map(w=>`"${w}"`).join(" or "),L){case 1:A+=`The ${T[0]} argument`;break;case 2:A+=`The ${T[0]} and ${T[1]} arguments`;break;default:{let w=T.pop();A+=`The ${T.join(", ")}, and ${w} arguments`}break}return`${A} must be specified`},TypeError),y("ERR_OUT_OF_RANGE",(T,A,L)=>{p(A,'Missing "range" argument');let w;if(Number.isInteger(L)&&Math.abs(L)>2**32)w=m(String(L));else if(typeof L=="bigint"){w=String(L);let C=BigInt(2)**BigInt(32);(L>C||L<-C)&&(w=m(w)),w+="n"}else w=r(L);return`The value of "${T}" is out of range. It must be ${A}. Received ${w}`},RangeError),y("ERR_MULTIPLE_CALLBACK","Callback called multiple times",Error),y("ERR_METHOD_NOT_IMPLEMENTED","The %s method is not implemented",Error),y("ERR_STREAM_ALREADY_FINISHED","Cannot call %s after a stream was finished",Error),y("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable",Error),y("ERR_STREAM_DESTROYED","Cannot call %s after a stream was destroyed",Error),y("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),y("ERR_STREAM_PREMATURE_CLOSE","Premature close",Error),y("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF",Error),y("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event",Error),y("ERR_STREAM_WRITE_AFTER_END","write after end",Error),y("ERR_UNKNOWN_ENCODING","Unknown encoding: %s",TypeError),e.exports={AbortError:x,aggregateTwoErrors:b(E),hideStackFrames:b,codes:d}}),Zo=je((l,e)=>{ke(),Pe(),Me();var{AbortController:t,AbortSignal:r}=typeof self<"u"?self:typeof window<"u"?window:void 0;e.exports=t,e.exports.AbortSignal=r,e.exports.default=t}),ls={};Ka(ls,{EventEmitter:()=>fx,default:()=>Da,defaultMaxListeners:()=>hx,init:()=>dx,listenerCount:()=>px,on:()=>gx,once:()=>mx});function lL(){if(Zp)return Ho;Zp=!0;var l=typeof Reflect=="object"?Reflect:null,e=l&&typeof l.apply=="function"?l.apply:function(L,w,C){return Function.prototype.apply.call(L,w,C)},t;l&&typeof l.ownKeys=="function"?t=l.ownKeys:Object.getOwnPropertySymbols?t=function(L){return Object.getOwnPropertyNames(L).concat(Object.getOwnPropertySymbols(L))}:t=function(L){return Object.getOwnPropertyNames(L)};function r(L){console&&console.warn&&console.warn(L)}var n=Number.isNaN||function(L){return L!==L};function s(){s.init.call(this)}Ho=s,Ho.once=x,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var a=10;function u(L){if(typeof L!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof L)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(L){if(typeof L!="number"||L<0||n(L))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+L+".");a=L}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(L){if(typeof L!="number"||L<0||n(L))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+L+".");return this._maxListeners=L,this};function f(L){return L._maxListeners===void 0?s.defaultMaxListeners:L._maxListeners}s.prototype.getMaxListeners=function(){return f(this)},s.prototype.emit=function(L){for(var w=[],C=1;C<arguments.length;C++)w.push(arguments[C]);var I=L==="error",O=this._events;if(O!==void 0)I=I&&O.error===void 0;else if(!I)return!1;if(I){var B;if(w.length>0&&(B=w[0]),B instanceof Error)throw B;var P=new Error("Unhandled error."+(B?" ("+B.message+")":""));throw P.context=B,P}var $=O[L];if($===void 0)return!1;if(typeof $=="function")e($,this,w);else for(var F=$.length,Z=y($,F),C=0;C<F;++C)e(Z[C],this,w);return!0};function c(L,w,C,I){var O,B,P;if(u(C),B=L._events,B===void 0?(B=L._events=Object.create(null),L._eventsCount=0):(B.newListener!==void 0&&(L.emit("newListener",w,C.listener?C.listener:C),B=L._events),P=B[w]),P===void 0)P=B[w]=C,++L._eventsCount;else if(typeof P=="function"?P=B[w]=I?[C,P]:[P,C]:I?P.unshift(C):P.push(C),O=f(L),O>0&&P.length>O&&!P.warned){P.warned=!0;var $=new Error("Possible EventEmitter memory leak detected. "+P.length+" "+String(w)+" listeners added. Use emitter.setMaxListeners() to increase limit");$.name="MaxListenersExceededWarning",$.emitter=L,$.type=w,$.count=P.length,r($)}return L}s.prototype.addListener=function(L,w){return c(this,L,w,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(L,w){return c(this,L,w,!0)};function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(L,w,C){var I={fired:!1,wrapFn:void 0,target:L,type:w,listener:C},O=d.bind(I);return O.listener=C,I.wrapFn=O,O}s.prototype.once=function(L,w){return u(w),this.on(L,p(this,L,w)),this},s.prototype.prependOnceListener=function(L,w){return u(w),this.prependListener(L,p(this,L,w)),this},s.prototype.removeListener=function(L,w){var C,I,O,B,P;if(u(w),I=this._events,I===void 0)return this;if(C=I[L],C===void 0)return this;if(C===w||C.listener===w)--this._eventsCount===0?this._events=Object.create(null):(delete I[L],I.removeListener&&this.emit("removeListener",L,C.listener||w));else if(typeof C!="function"){for(O=-1,B=C.length-1;B>=0;B--)if(C[B]===w||C[B].listener===w){P=C[B].listener,O=B;break}if(O<0)return this;O===0?C.shift():b(C,O),C.length===1&&(I[L]=C[0]),I.removeListener!==void 0&&this.emit("removeListener",L,P||w)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(L){var w,C,I;if(C=this._events,C===void 0)return this;if(C.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):C[L]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete C[L]),this;if(arguments.length===0){var O=Object.keys(C),B;for(I=0;I<O.length;++I)B=O[I],B!=="removeListener"&&this.removeAllListeners(B);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(w=C[L],typeof w=="function")this.removeListener(L,w);else if(w!==void 0)for(I=w.length-1;I>=0;I--)this.removeListener(L,w[I]);return this};function m(L,w,C){var I=L._events;if(I===void 0)return[];var O=I[w];return O===void 0?[]:typeof O=="function"?C?[O.listener||O]:[O]:C?E(O):y(O,O.length)}s.prototype.listeners=function(L){return m(this,L,!0)},s.prototype.rawListeners=function(L){return m(this,L,!1)},s.listenerCount=function(L,w){return typeof L.listenerCount=="function"?L.listenerCount(w):v.call(L,w)},s.prototype.listenerCount=v;function v(L){var w=this._events;if(w!==void 0){var C=w[L];if(typeof C=="function")return 1;if(C!==void 0)return C.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function y(L,w){for(var C=new Array(w),I=0;I<w;++I)C[I]=L[I];return C}function b(L,w){for(;w+1<L.length;w++)L[w]=L[w+1];L.pop()}function E(L){for(var w=new Array(L.length),C=0;C<w.length;++C)w[C]=L[C].listener||L[C];return w}function x(L,w){return new Promise(function(C,I){function O(P){L.removeListener(w,B),I(P)}function B(){typeof L.removeListener=="function"&&L.removeListener("error",O),C([].slice.call(arguments))}A(L,w,B,{once:!0}),w!=="error"&&T(L,O,{once:!0})})}function T(L,w,C){typeof L.on=="function"&&A(L,"error",w,C)}function A(L,w,C,I){if(typeof L.on=="function")I.once?L.once(w,C):L.on(w,C);else if(typeof L.addEventListener=="function")L.addEventListener(w,function O(B){I.once&&L.removeEventListener(w,O),C(B)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof L)}return Ho}var Ho,Zp,Da,fx,hx,dx,px,gx,mx,Bs=Vr(()=>{ke(),Pe(),Me(),Ho={},Zp=!1,Da=lL(),Da.once,Da.once=function(l,e){return new Promise((t,r)=>{function n(...a){s!==void 0&&l.removeListener("error",s),t(a)}let s;e!=="error"&&(s=a=>{l.removeListener(name,n),r(a)},l.once("error",s)),l.once(e,n)})},Da.on=function(l,e){let t=[],r=[],n=null,s=!1,a={async next(){let c=t.shift();if(c)return createIterResult(c,!1);if(n){let d=Promise.reject(n);return n=null,d}return s?createIterResult(void 0,!0):new Promise((d,p)=>r.push({resolve:d,reject:p}))},async return(){l.removeListener(e,u),l.removeListener("error",f),s=!0;for(let c of r)c.resolve(createIterResult(void 0,!0));return createIterResult(void 0,!0)},throw(c){n=c,l.removeListener(e,u),l.removeListener("error",f)},[Symbol.asyncIterator](){return this}};return l.on(e,u),l.on("error",f),a;function u(...c){let d=r.shift();d?d.resolve(createIterResult(c,!1)):t.push(c)}function f(c){s=!0;let d=r.shift();d?d.reject(c):n=c,a.return()}},{EventEmitter:fx,defaultMaxListeners:hx,init:dx,listenerCount:px,on:gx,once:mx}=Da}),Kr=je((l,e)=>{ke(),Pe(),Me();var t=(hr(),Ct(fr)),{format:r,inspect:n}=cx(),{codes:{ERR_INVALID_ARG_TYPE:s}}=Cr(),{kResistStopPropagation:a,AggregateError:u,SymbolDispose:f}=Kt(),c=globalThis.AbortSignal||Zo().AbortSignal,d=globalThis.AbortController||Zo().AbortController,p=Object.getPrototypeOf(async function(){}).constructor,m=globalThis.Blob||t.Blob,v=typeof m<"u"?function(E){return E instanceof m}:function(E){return!1},y=(E,x)=>{if(E!==void 0&&(E===null||typeof E!="object"||!("aborted"in E)))throw new s(x,"AbortSignal",E)},b=(E,x)=>{if(typeof E!="function")throw new s(x,"Function",E)};e.exports={AggregateError:u,kEmptyObject:Object.freeze({}),once(E){let x=!1;return function(...T){x||(x=!0,E.apply(this,T))}},createDeferredPromise:function(){let E,x;return{promise:new Promise((T,A)=>{E=T,x=A}),resolve:E,reject:x}},promisify(E){return new Promise((x,T)=>{E((A,...L)=>A?T(A):x(...L))})},debuglog(){return function(){}},format:r,inspect:n,types:{isAsyncFunction(E){return E instanceof p},isArrayBufferView(E){return ArrayBuffer.isView(E)}},isBlob:v,deprecate(E,x){return E},addAbortListener:(Bs(),Ct(ls)).addAbortListener||function(E,x){if(E===void 0)throw new s("signal","AbortSignal",E);y(E,"signal"),b(x,"listener");let T;return E.aborted?queueMicrotask(()=>x()):(E.addEventListener("abort",x,{__proto__:null,once:!0,[a]:!0}),T=()=>{E.removeEventListener("abort",x)}),{__proto__:null,[f](){var A;(A=T)===null||A===void 0||A()}}},AbortSignalAny:c.any||function(E){if(E.length===1)return E[0];let x=new d,T=()=>x.abort();return E.forEach(A=>{y(A,"signals"),A.addEventListener("abort",T,{once:!0})}),x.signal.addEventListener("abort",()=>{E.forEach(A=>A.removeEventListener("abort",T))},{once:!0}),x.signal}},e.exports.promisify.custom=Symbol.for("nodejs.util.promisify.custom")}),ul=je((l,e)=>{ke(),Pe(),Me();var{ArrayIsArray:t,ArrayPrototypeIncludes:r,ArrayPrototypeJoin:n,ArrayPrototypeMap:s,NumberIsInteger:a,NumberIsNaN:u,NumberMAX_SAFE_INTEGER:f,NumberMIN_SAFE_INTEGER:c,NumberParseInt:d,ObjectPrototypeHasOwnProperty:p,RegExpPrototypeExec:m,String:v,StringPrototypeToUpperCase:y,StringPrototypeTrim:b}=Kt(),{hideStackFrames:E,codes:{ERR_SOCKET_BAD_PORT:x,ERR_INVALID_ARG_TYPE:T,ERR_INVALID_ARG_VALUE:A,ERR_OUT_OF_RANGE:L,ERR_UNKNOWN_SIGNAL:w}}=Cr(),{normalizeEncoding:C}=Kr(),{isAsyncFunction:I,isArrayBufferView:O}=Kr().types,B={};function P(le){return le===(le|0)}function $(le){return le===le>>>0}var F=/^[0-7]+$/,Z="must be a 32-bit unsigned integer or an octal string";function X(le,Ne,Ke){if(typeof le>"u"&&(le=Ke),typeof le=="string"){if(m(F,le)===null)throw new A(Ne,le,Z);le=d(le,8)}return K(le,Ne),le}var q=E((le,Ne,Ke=c,Ae=f)=>{if(typeof le!="number")throw new T(Ne,"number",le);if(!a(le))throw new L(Ne,"an integer",le);if(le<Ke||le>Ae)throw new L(Ne,`>= ${Ke} && <= ${Ae}`,le)}),H=E((le,Ne,Ke=-2147483648,Ae=2147483647)=>{if(typeof le!="number")throw new T(Ne,"number",le);if(!a(le))throw new L(Ne,"an integer",le);if(le<Ke||le>Ae)throw new L(Ne,`>= ${Ke} && <= ${Ae}`,le)}),K=E((le,Ne,Ke=!1)=>{if(typeof le!="number")throw new T(Ne,"number",le);if(!a(le))throw new L(Ne,"an integer",le);let Ae=Ke?1:0,nt=4294967295;if(le<Ae||le>nt)throw new L(Ne,`>= ${Ae} && <= ${nt}`,le)});function z(le,Ne){if(typeof le!="string")throw new T(Ne,"string",le)}function ie(le,Ne,Ke=void 0,Ae){if(typeof le!="number")throw new T(Ne,"number",le);if(Ke!=null&&le<Ke||Ae!=null&&le>Ae||(Ke!=null||Ae!=null)&&u(le))throw new L(Ne,`${Ke!=null?`>= ${Ke}`:""}${Ke!=null&&Ae!=null?" && ":""}${Ae!=null?`<= ${Ae}`:""}`,le)}var Y=E((le,Ne,Ke)=>{if(!r(Ke,le)){let Ae="must be one of: "+n(s(Ke,nt=>typeof nt=="string"?`'${nt}'`:v(nt)),", ");throw new A(Ne,le,Ae)}});function U(le,Ne){if(typeof le!="boolean")throw new T(Ne,"boolean",le)}function N(le,Ne,Ke){return le==null||!p(le,Ne)?Ke:le[Ne]}var W=E((le,Ne,Ke=null)=>{let Ae=N(Ke,"allowArray",!1),nt=N(Ke,"allowFunction",!1);if(!N(Ke,"nullable",!1)&&le===null||!Ae&&t(le)||typeof le!="object"&&(!nt||typeof le!="function"))throw new T(Ne,"Object",le)}),ue=E((le,Ne)=>{if(le!=null&&typeof le!="object"&&typeof le!="function")throw new T(Ne,"a dictionary",le)}),ne=E((le,Ne,Ke=0)=>{if(!t(le))throw new T(Ne,"Array",le);if(le.length<Ke){let Ae=`must be longer than ${Ke}`;throw new A(Ne,le,Ae)}});function Ee(le,Ne){ne(le,Ne);for(let Ke=0;Ke<le.length;Ke++)z(le[Ke],`${Ne}[${Ke}]`)}function se(le,Ne){ne(le,Ne);for(let Ke=0;Ke<le.length;Ke++)U(le[Ke],`${Ne}[${Ke}]`)}function J(le,Ne){ne(le,Ne);for(let Ke=0;Ke<le.length;Ke++){let Ae=le[Ke],nt=`${Ne}[${Ke}]`;if(Ae==null)throw new T(nt,"AbortSignal",Ae);Fe(Ae,nt)}}function me(le,Ne="signal"){if(z(le,Ne),B[le]===void 0)throw B[y(le)]!==void 0?new w(le+" (signals must use all capital letters)"):new w(le)}var ce=E((le,Ne="buffer")=>{if(!O(le))throw new T(Ne,["Buffer","TypedArray","DataView"],le)});function he(le,Ne){let Ke=C(Ne),Ae=le.length;if(Ke==="hex"&&Ae%2!==0)throw new A("encoding",Ne,`is invalid for data of length ${Ae}`)}function pe(le,Ne="Port",Ke=!0){if(typeof le!="number"&&typeof le!="string"||typeof le=="string"&&b(le).length===0||+le!==+le>>>0||le>65535||le===0&&!Ke)throw new x(Ne,le,Ke);return le|0}var Fe=E((le,Ne)=>{if(le!==void 0&&(le===null||typeof le!="object"||!("aborted"in le)))throw new T(Ne,"AbortSignal",le)}),Re=E((le,Ne)=>{if(typeof le!="function")throw new T(Ne,"Function",le)}),ee=E((le,Ne)=>{if(typeof le!="function"||I(le))throw new T(Ne,"Function",le)}),te=E((le,Ne)=>{if(le!==void 0)throw new T(Ne,"undefined",le)});function ge(le,Ne,Ke){if(!r(Ke,le))throw new T(Ne,`('${n(Ke,"|")}')`,le)}var Ie=/^(?:<[^>]*>)(?:\s*;\s*[^;"\s]+(?:=(")?[^;"\s]*\1)?)*$/;function Ce(le,Ne){if(typeof le>"u"||!m(Ie,le))throw new A(Ne,le,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}function Ue(le){if(typeof le=="string")return Ce(le,"hints"),le;if(t(le)){let Ne=le.length,Ke="";if(Ne===0)return Ke;for(let Ae=0;Ae<Ne;Ae++){let nt=le[Ae];Ce(nt,"hints"),Ke+=nt,Ae!==Ne-1&&(Ke+=", ")}return Ke}throw new A("hints",le,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}e.exports={isInt32:P,isUint32:$,parseFileMode:X,validateArray:ne,validateStringArray:Ee,validateBooleanArray:se,validateAbortSignalArray:J,validateBoolean:U,validateBuffer:ce,validateDictionary:ue,validateEncoding:he,validateFunction:Re,validateInt32:H,validateInteger:q,validateNumber:ie,validateObject:W,validateOneOf:Y,validatePlainFunction:ee,validatePort:pe,validateSignalName:me,validateString:z,validateUint32:K,validateUndefined:te,validateUnion:ge,validateAbortSignal:Fe,validateLinkHeaderValue:Ue}}),Fs=je((l,e)=>{ke(),Pe(),Me();var t=e.exports={},r,n;function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?r=setTimeout:r=s}catch{r=s}try{typeof clearTimeout=="function"?n=clearTimeout:n=a}catch{n=a}})();function u(x){if(r===setTimeout)return setTimeout(x,0);if((r===s||!r)&&setTimeout)return r=setTimeout,setTimeout(x,0);try{return r(x,0)}catch{try{return r.call(null,x,0)}catch{return r.call(this,x,0)}}}function f(x){if(n===clearTimeout)return clearTimeout(x);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(x);try{return n(x)}catch{try{return n.call(null,x)}catch{return n.call(this,x)}}}var c=[],d=!1,p,m=-1;function v(){!d||!p||(d=!1,p.length?c=p.concat(c):m=-1,c.length&&y())}function y(){if(!d){var x=u(v);d=!0;for(var T=c.length;T;){for(p=c,c=[];++m<T;)p&&p[m].run();m=-1,T=c.length}p=null,d=!1,f(x)}}t.nextTick=function(x){var T=new Array(arguments.length-1);if(arguments.length>1)for(var A=1;A<arguments.length;A++)T[A-1]=arguments[A];c.push(new b(x,T)),c.length===1&&!d&&u(y)};function b(x,T){this.fun=x,this.array=T}b.prototype.run=function(){this.fun.apply(null,this.array)},t.title="browser",t.browser=!0,t.env={},t.argv=[],t.version="",t.versions={};function E(){}t.on=E,t.addListener=E,t.once=E,t.off=E,t.removeListener=E,t.removeAllListeners=E,t.emit=E,t.prependListener=E,t.prependOnceListener=E,t.listeners=function(x){return[]},t.binding=function(x){throw new Error("process.binding is not supported")},t.cwd=function(){return"/"},t.chdir=function(x){throw new Error("process.chdir is not supported")},t.umask=function(){return 0}}),xn=je((l,e)=>{ke(),Pe(),Me();var{SymbolAsyncIterator:t,SymbolIterator:r,SymbolFor:n}=Kt(),s=n("nodejs.stream.destroyed"),a=n("nodejs.stream.errored"),u=n("nodejs.stream.readable"),f=n("nodejs.stream.writable"),c=n("nodejs.stream.disturbed"),d=n("nodejs.webstream.isClosedPromise"),p=n("nodejs.webstream.controllerErrorFunction");function m(N,W=!1){var ue;return!!(N&&typeof N.pipe=="function"&&typeof N.on=="function"&&(!W||typeof N.pause=="function"&&typeof N.resume=="function")&&(!N._writableState||((ue=N._readableState)===null||ue===void 0?void 0:ue.readable)!==!1)&&(!N._writableState||N._readableState))}function v(N){var W;return!!(N&&typeof N.write=="function"&&typeof N.on=="function"&&(!N._readableState||((W=N._writableState)===null||W===void 0?void 0:W.writable)!==!1))}function y(N){return!!(N&&typeof N.pipe=="function"&&N._readableState&&typeof N.on=="function"&&typeof N.write=="function")}function b(N){return N&&(N._readableState||N._writableState||typeof N.write=="function"&&typeof N.on=="function"||typeof N.pipe=="function"&&typeof N.on=="function")}function E(N){return!!(N&&!b(N)&&typeof N.pipeThrough=="function"&&typeof N.getReader=="function"&&typeof N.cancel=="function")}function x(N){return!!(N&&!b(N)&&typeof N.getWriter=="function"&&typeof N.abort=="function")}function T(N){return!!(N&&!b(N)&&typeof N.readable=="object"&&typeof N.writable=="object")}function A(N){return E(N)||x(N)||T(N)}function L(N,W){return N==null?!1:W===!0?typeof N[t]=="function":W===!1?typeof N[r]=="function":typeof N[t]=="function"||typeof N[r]=="function"}function w(N){if(!b(N))return null;let W=N._writableState,ue=N._readableState,ne=W||ue;return!!(N.destroyed||N[s]||ne!=null&&ne.destroyed)}function C(N){if(!v(N))return null;if(N.writableEnded===!0)return!0;let W=N._writableState;return W!=null&&W.errored?!1:typeof W?.ended!="boolean"?null:W.ended}function I(N,W){if(!v(N))return null;if(N.writableFinished===!0)return!0;let ue=N._writableState;return ue!=null&&ue.errored?!1:typeof ue?.finished!="boolean"?null:!!(ue.finished||W===!1&&ue.ended===!0&&ue.length===0)}function O(N){if(!m(N))return null;if(N.readableEnded===!0)return!0;let W=N._readableState;return!W||W.errored?!1:typeof W?.ended!="boolean"?null:W.ended}function B(N,W){if(!m(N))return null;let ue=N._readableState;return ue!=null&&ue.errored?!1:typeof ue?.endEmitted!="boolean"?null:!!(ue.endEmitted||W===!1&&ue.ended===!0&&ue.length===0)}function P(N){return N&&N[u]!=null?N[u]:typeof N?.readable!="boolean"?null:w(N)?!1:m(N)&&N.readable&&!B(N)}function $(N){return N&&N[f]!=null?N[f]:typeof N?.writable!="boolean"?null:w(N)?!1:v(N)&&N.writable&&!C(N)}function F(N,W){return b(N)?w(N)?!0:!(W?.readable!==!1&&P(N)||W?.writable!==!1&&$(N)):null}function Z(N){var W,ue;return b(N)?N.writableErrored?N.writableErrored:(W=(ue=N._writableState)===null||ue===void 0?void 0:ue.errored)!==null&&W!==void 0?W:null:null}function X(N){var W,ue;return b(N)?N.readableErrored?N.readableErrored:(W=(ue=N._readableState)===null||ue===void 0?void 0:ue.errored)!==null&&W!==void 0?W:null:null}function q(N){if(!b(N))return null;if(typeof N.closed=="boolean")return N.closed;let W=N._writableState,ue=N._readableState;return typeof W?.closed=="boolean"||typeof ue?.closed=="boolean"?W?.closed||ue?.closed:typeof N._closed=="boolean"&&H(N)?N._closed:null}function H(N){return typeof N._closed=="boolean"&&typeof N._defaultKeepAlive=="boolean"&&typeof N._removedConnection=="boolean"&&typeof N._removedContLen=="boolean"}function K(N){return typeof N._sent100=="boolean"&&H(N)}function z(N){var W;return typeof N._consuming=="boolean"&&typeof N._dumped=="boolean"&&((W=N.req)===null||W===void 0?void 0:W.upgradeOrConnect)===void 0}function ie(N){if(!b(N))return null;let W=N._writableState,ue=N._readableState,ne=W||ue;return!ne&&K(N)||!!(ne&&ne.autoDestroy&&ne.emitClose&&ne.closed===!1)}function Y(N){var W;return!!(N&&((W=N[c])!==null&&W!==void 0?W:N.readableDidRead||N.readableAborted))}function U(N){var W,ue,ne,Ee,se,J,me,ce,he,pe;return!!(N&&((W=(ue=(ne=(Ee=(se=(J=N[a])!==null&&J!==void 0?J:N.readableErrored)!==null&&se!==void 0?se:N.writableErrored)!==null&&Ee!==void 0?Ee:(me=N._readableState)===null||me===void 0?void 0:me.errorEmitted)!==null&&ne!==void 0?ne:(ce=N._writableState)===null||ce===void 0?void 0:ce.errorEmitted)!==null&&ue!==void 0?ue:(he=N._readableState)===null||he===void 0?void 0:he.errored)!==null&&W!==void 0?W:!((pe=N._writableState)===null||pe===void 0)&&pe.errored))}e.exports={isDestroyed:w,kIsDestroyed:s,isDisturbed:Y,kIsDisturbed:c,isErrored:U,kIsErrored:a,isReadable:P,kIsReadable:u,kIsClosedPromise:d,kControllerErrorFunction:p,kIsWritable:f,isClosed:q,isDuplexNodeStream:y,isFinished:F,isIterable:L,isReadableNodeStream:m,isReadableStream:E,isReadableEnded:O,isReadableFinished:B,isReadableErrored:X,isNodeStream:b,isWebStream:A,isWritable:$,isWritableNodeStream:v,isWritableStream:x,isWritableEnded:C,isWritableFinished:I,isWritableErrored:Z,isServerRequest:z,isServerResponse:K,willEmitClose:ie,isTransformStream:T}}),us=je((l,e)=>{ke(),Pe(),Me();var t=Fs(),{AbortError:r,codes:n}=Cr(),{ERR_INVALID_ARG_TYPE:s,ERR_STREAM_PREMATURE_CLOSE:a}=n,{kEmptyObject:u,once:f}=Kr(),{validateAbortSignal:c,validateFunction:d,validateObject:p,validateBoolean:m}=ul(),{Promise:v,PromisePrototypeThen:y,SymbolDispose:b}=Kt(),{isClosed:E,isReadable:x,isReadableNodeStream:T,isReadableStream:A,isReadableFinished:L,isReadableErrored:w,isWritable:C,isWritableNodeStream:I,isWritableStream:O,isWritableFinished:B,isWritableErrored:P,isNodeStream:$,willEmitClose:F,kIsClosedPromise:Z}=xn(),X;function q(Y){return Y.setHeader&&typeof Y.abort=="function"}var H=()=>{};function K(Y,U,N){var W,ue;if(arguments.length===2?(N=U,U=u):U==null?U=u:p(U,"options"),d(N,"callback"),c(U.signal,"options.signal"),N=f(N),A(Y)||O(Y))return z(Y,U,N);if(!$(Y))throw new s("stream",["ReadableStream","WritableStream","Stream"],Y);let ne=(W=U.readable)!==null&&W!==void 0?W:T(Y),Ee=(ue=U.writable)!==null&&ue!==void 0?ue:I(Y),se=Y._writableState,J=Y._readableState,me=()=>{Y.writable||pe()},ce=F(Y)&&T(Y)===ne&&I(Y)===Ee,he=B(Y,!1),pe=()=>{he=!0,Y.destroyed&&(ce=!1),!(ce&&(!Y.readable||ne))&&(!ne||Fe)&&N.call(Y)},Fe=L(Y,!1),Re=()=>{Fe=!0,Y.destroyed&&(ce=!1),!(ce&&(!Y.writable||Ee))&&(!Ee||he)&&N.call(Y)},ee=le=>{N.call(Y,le)},te=E(Y),ge=()=>{te=!0;let le=P(Y)||w(Y);if(le&&typeof le!="boolean")return N.call(Y,le);if(ne&&!Fe&&T(Y,!0)&&!L(Y,!1))return N.call(Y,new a);if(Ee&&!he&&!B(Y,!1))return N.call(Y,new a);N.call(Y)},Ie=()=>{te=!0;let le=P(Y)||w(Y);if(le&&typeof le!="boolean")return N.call(Y,le);N.call(Y)},Ce=()=>{Y.req.on("finish",pe)};q(Y)?(Y.on("complete",pe),ce||Y.on("abort",ge),Y.req?Ce():Y.on("request",Ce)):Ee&&!se&&(Y.on("end",me),Y.on("close",me)),!ce&&typeof Y.aborted=="boolean"&&Y.on("aborted",ge),Y.on("end",Re),Y.on("finish",pe),U.error!==!1&&Y.on("error",ee),Y.on("close",ge),te?t.nextTick(ge):se!=null&&se.errorEmitted||J!=null&&J.errorEmitted?ce||t.nextTick(Ie):(!ne&&(!ce||x(Y))&&(he||C(Y)===!1)||!Ee&&(!ce||C(Y))&&(Fe||x(Y)===!1)||J&&Y.req&&Y.aborted)&&t.nextTick(Ie);let Ue=()=>{N=H,Y.removeListener("aborted",ge),Y.removeListener("complete",pe),Y.removeListener("abort",ge),Y.removeListener("request",Ce),Y.req&&Y.req.removeListener("finish",pe),Y.removeListener("end",me),Y.removeListener("close",me),Y.removeListener("finish",pe),Y.removeListener("end",Re),Y.removeListener("error",ee),Y.removeListener("close",ge)};if(U.signal&&!te){let le=()=>{let Ne=N;Ue(),Ne.call(Y,new r(void 0,{cause:U.signal.reason}))};if(U.signal.aborted)t.nextTick(le);else{X=X||Kr().addAbortListener;let Ne=X(U.signal,le),Ke=N;N=f((...Ae)=>{Ne[b](),Ke.apply(Y,Ae)})}}return Ue}function z(Y,U,N){let W=!1,ue=H;if(U.signal)if(ue=()=>{W=!0,N.call(Y,new r(void 0,{cause:U.signal.reason}))},U.signal.aborted)t.nextTick(ue);else{X=X||Kr().addAbortListener;let Ee=X(U.signal,ue),se=N;N=f((...J)=>{Ee[b](),se.apply(Y,J)})}let ne=(...Ee)=>{W||t.nextTick(()=>N.apply(Y,Ee))};return y(Y[Z].promise,ne,ne),H}function ie(Y,U){var N;let W=!1;return U===null&&(U=u),(N=U)!==null&&N!==void 0&&N.cleanup&&(m(U.cleanup,"cleanup"),W=U.cleanup),new v((ue,ne)=>{let Ee=K(Y,U,se=>{W&&Ee(),se?ne(se):ue()})})}e.exports=K,e.exports.finished=ie}),Va=je((l,e)=>{ke(),Pe(),Me();var t=Fs(),{aggregateTwoErrors:r,codes:{ERR_MULTIPLE_CALLBACK:n},AbortError:s}=Cr(),{Symbol:a}=Kt(),{kIsDestroyed:u,isDestroyed:f,isFinished:c,isServerRequest:d}=xn(),p=a("kDestroy"),m=a("kConstruct");function v(F,Z,X){F&&(F.stack,Z&&!Z.errored&&(Z.errored=F),X&&!X.errored&&(X.errored=F))}function y(F,Z){let X=this._readableState,q=this._writableState,H=q||X;return q!=null&&q.destroyed||X!=null&&X.destroyed?(typeof Z=="function"&&Z(),this):(v(F,q,X),q&&(q.destroyed=!0),X&&(X.destroyed=!0),H.constructed?b(this,F,Z):this.once(p,function(K){b(this,r(K,F),Z)}),this)}function b(F,Z,X){let q=!1;function H(K){if(q)return;q=!0;let z=F._readableState,ie=F._writableState;v(K,ie,z),ie&&(ie.closed=!0),z&&(z.closed=!0),typeof X=="function"&&X(K),K?t.nextTick(E,F,K):t.nextTick(x,F)}try{F._destroy(Z||null,H)}catch(K){H(K)}}function E(F,Z){T(F,Z),x(F)}function x(F){let Z=F._readableState,X=F._writableState;X&&(X.closeEmitted=!0),Z&&(Z.closeEmitted=!0),(X!=null&&X.emitClose||Z!=null&&Z.emitClose)&&F.emit("close")}function T(F,Z){let X=F._readableState,q=F._writableState;q!=null&&q.errorEmitted||X!=null&&X.errorEmitted||(q&&(q.errorEmitted=!0),X&&(X.errorEmitted=!0),F.emit("error",Z))}function A(){let F=this._readableState,Z=this._writableState;F&&(F.constructed=!0,F.closed=!1,F.closeEmitted=!1,F.destroyed=!1,F.errored=null,F.errorEmitted=!1,F.reading=!1,F.ended=F.readable===!1,F.endEmitted=F.readable===!1),Z&&(Z.constructed=!0,Z.destroyed=!1,Z.closed=!1,Z.closeEmitted=!1,Z.errored=null,Z.errorEmitted=!1,Z.finalCalled=!1,Z.prefinished=!1,Z.ended=Z.writable===!1,Z.ending=Z.writable===!1,Z.finished=Z.writable===!1)}function L(F,Z,X){let q=F._readableState,H=F._writableState;if(H!=null&&H.destroyed||q!=null&&q.destroyed)return this;q!=null&&q.autoDestroy||H!=null&&H.autoDestroy?F.destroy(Z):Z&&(Z.stack,H&&!H.errored&&(H.errored=Z),q&&!q.errored&&(q.errored=Z),X?t.nextTick(T,F,Z):T(F,Z))}function w(F,Z){if(typeof F._construct!="function")return;let X=F._readableState,q=F._writableState;X&&(X.constructed=!1),q&&(q.constructed=!1),F.once(m,Z),!(F.listenerCount(m)>1)&&t.nextTick(C,F)}function C(F){let Z=!1;function X(q){if(Z){L(F,q??new n);return}Z=!0;let H=F._readableState,K=F._writableState,z=K||H;H&&(H.constructed=!0),K&&(K.constructed=!0),z.destroyed?F.emit(p,q):q?L(F,q,!0):t.nextTick(I,F)}try{F._construct(q=>{t.nextTick(X,q)})}catch(q){t.nextTick(X,q)}}function I(F){F.emit(m)}function O(F){return F?.setHeader&&typeof F.abort=="function"}function B(F){F.emit("close")}function P(F,Z){F.emit("error",Z),t.nextTick(B,F)}function $(F,Z){!F||f(F)||(!Z&&!c(F)&&(Z=new s),d(F)?(F.socket=null,F.destroy(Z)):O(F)?F.abort():O(F.req)?F.req.abort():typeof F.destroy=="function"?F.destroy(Z):typeof F.close=="function"?F.close():Z?t.nextTick(P,F,Z):t.nextTick(B,F),F.destroyed||(F[u]=!0))}e.exports={construct:w,destroyer:$,destroy:y,undestroy:A,errorOrDestroy:L}}),mm=je((l,e)=>{ke(),Pe(),Me();var{ArrayIsArray:t,ObjectSetPrototypeOf:r}=Kt(),{EventEmitter:n}=(Bs(),Ct(ls));function s(u){n.call(this,u)}r(s.prototype,n.prototype),r(s,n),s.prototype.pipe=function(u,f){let c=this;function d(x){u.writable&&u.write(x)===!1&&c.pause&&c.pause()}c.on("data",d);function p(){c.readable&&c.resume&&c.resume()}u.on("drain",p),!u._isStdio&&(!f||f.end!==!1)&&(c.on("end",v),c.on("close",y));let m=!1;function v(){m||(m=!0,u.end())}function y(){m||(m=!0,typeof u.destroy=="function"&&u.destroy())}function b(x){E(),n.listenerCount(this,"error")===0&&this.emit("error",x)}a(c,"error",b),a(u,"error",b);function E(){c.removeListener("data",d),u.removeListener("drain",p),c.removeListener("end",v),c.removeListener("close",y),c.removeListener("error",b),u.removeListener("error",b),c.removeListener("end",E),c.removeListener("close",E),u.removeListener("close",E)}return c.on("end",E),c.on("close",E),u.on("close",E),u.emit("pipe",c),u};function a(u,f,c){if(typeof u.prependListener=="function")return u.prependListener(f,c);!u._events||!u._events[f]?u.on(f,c):t(u._events[f])?u._events[f].unshift(c):u._events[f]=[c,u._events[f]]}e.exports={Stream:s,prependListener:a}}),jc=je((l,e)=>{ke(),Pe(),Me();var{SymbolDispose:t}=Kt(),{AbortError:r,codes:n}=Cr(),{isNodeStream:s,isWebStream:a,kControllerErrorFunction:u}=xn(),f=us(),{ERR_INVALID_ARG_TYPE:c}=n,d,p=(m,v)=>{if(typeof m!="object"||!("aborted"in m))throw new c(v,"AbortSignal",m)};e.exports.addAbortSignal=function(m,v){if(p(m,"signal"),!s(v)&&!a(v))throw new c("stream",["ReadableStream","WritableStream","Stream"],v);return e.exports.addAbortSignalNoValidate(m,v)},e.exports.addAbortSignalNoValidate=function(m,v){if(typeof m!="object"||!("aborted"in m))return v;let y=s(v)?()=>{v.destroy(new r(void 0,{cause:m.reason}))}:()=>{v[u](new r(void 0,{cause:m.reason}))};if(m.aborted)y();else{d=d||Kr().addAbortListener;let b=d(m,y);f(v,b[t])}return v}}),uL=je((l,e)=>{ke(),Pe(),Me();var{StringPrototypeSlice:t,SymbolIterator:r,TypedArrayPrototypeSet:n,Uint8Array:s}=Kt(),{Buffer:a}=(hr(),Ct(fr)),{inspect:u}=Kr();e.exports=class{constructor(){this.head=null,this.tail=null,this.length=0}push(f){let c={data:f,next:null};this.length>0?this.tail.next=c:this.head=c,this.tail=c,++this.length}unshift(f){let c={data:f,next:this.head};this.length===0&&(this.tail=c),this.head=c,++this.length}shift(){if(this.length===0)return;let f=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,f}clear(){this.head=this.tail=null,this.length=0}join(f){if(this.length===0)return"";let c=this.head,d=""+c.data;for(;(c=c.next)!==null;)d+=f+c.data;return d}concat(f){if(this.length===0)return a.alloc(0);let c=a.allocUnsafe(f>>>0),d=this.head,p=0;for(;d;)n(c,d.data,p),p+=d.data.length,d=d.next;return c}consume(f,c){let d=this.head.data;if(f<d.length){let p=d.slice(0,f);return this.head.data=d.slice(f),p}return f===d.length?this.shift():c?this._getString(f):this._getBuffer(f)}first(){return this.head.data}*[r](){for(let f=this.head;f;f=f.next)yield f.data}_getString(f){let c="",d=this.head,p=0;do{let m=d.data;if(f>m.length)c+=m,f-=m.length;else{f===m.length?(c+=m,++p,d.next?this.head=d.next:this.head=this.tail=null):(c+=t(m,0,f),this.head=d,d.data=t(m,f));break}++p}while((d=d.next)!==null);return this.length-=p,c}_getBuffer(f){let c=a.allocUnsafe(f),d=f,p=this.head,m=0;do{let v=p.data;if(f>v.length)n(c,v,d-f),f-=v.length;else{f===v.length?(n(c,v,d-f),++m,p.next?this.head=p.next:this.head=this.tail=null):(n(c,new s(v.buffer,v.byteOffset,f),d-f),this.head=p,p.data=v.slice(f));break}++m}while((p=p.next)!==null);return this.length-=m,c}[Symbol.for("nodejs.util.inspect.custom")](f,c){return u(this,{...c,depth:0,customInspect:!1})}}}),$c=je((l,e)=>{ke(),Pe(),Me();var{MathFloor:t,NumberIsInteger:r}=Kt(),{validateInteger:n}=ul(),{ERR_INVALID_ARG_VALUE:s}=Cr().codes,a=16*1024,u=16;function f(m,v,y){return m.highWaterMark!=null?m.highWaterMark:v?m[y]:null}function c(m){return m?u:a}function d(m,v){n(v,"value",0),m?u=v:a=v}function p(m,v,y,b){let E=f(v,b,y);if(E!=null){if(!r(E)||E<0){let x=b?`options.${y}`:"options.highWaterMark";throw new s(x,E)}return t(E)}return c(m.objectMode)}e.exports={getHighWaterMark:p,getDefaultHighWaterMark:c,setDefaultHighWaterMark:d}}),cL=je((l,e)=>{ke(),Pe(),Me();var t=(hr(),Ct(fr)),r=t.Buffer;function n(a,u){for(var f in a)u[f]=a[f]}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?e.exports=t:(n(t,l),l.Buffer=s);function s(a,u,f){return r(a,u,f)}s.prototype=Object.create(r.prototype),n(r,s),s.from=function(a,u,f){if(typeof a=="number")throw new TypeError("Argument must not be a number");return r(a,u,f)},s.alloc=function(a,u,f){if(typeof a!="number")throw new TypeError("Argument must be a number");var c=r(a);return u!==void 0?typeof f=="string"?c.fill(u,f):c.fill(u):c.fill(0),c},s.allocUnsafe=function(a){if(typeof a!="number")throw new TypeError("Argument must be a number");return r(a)},s.allocUnsafeSlow=function(a){if(typeof a!="number")throw new TypeError("Argument must be a number");return t.SlowBuffer(a)}}),fL=je(l=>{ke(),Pe(),Me();var e=cL().Buffer,t=e.isEncoding||function(T){switch(T=""+T,T&&T.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function r(T){if(!T)return"utf8";for(var A;;)switch(T){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return T;default:if(A)return;T=(""+T).toLowerCase(),A=!0}}function n(T){var A=r(T);if(typeof A!="string"&&(e.isEncoding===t||!t(T)))throw new Error("Unknown encoding: "+T);return A||T}l.StringDecoder=s;function s(T){this.encoding=n(T);var A;switch(this.encoding){case"utf16le":this.text=m,this.end=v,A=4;break;case"utf8":this.fillLast=c,A=4;break;case"base64":this.text=y,this.end=b,A=3;break;default:this.write=E,this.end=x;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=e.allocUnsafe(A)}s.prototype.write=function(T){if(T.length===0)return"";var A,L;if(this.lastNeed){if(A=this.fillLast(T),A===void 0)return"";L=this.lastNeed,this.lastNeed=0}else L=0;return L<T.length?A?A+this.text(T,L):this.text(T,L):A||""},s.prototype.end=p,s.prototype.text=d,s.prototype.fillLast=function(T){if(this.lastNeed<=T.length)return T.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);T.copy(this.lastChar,this.lastTotal-this.lastNeed,0,T.length),this.lastNeed-=T.length};function a(T){return T<=127?0:T>>5===6?2:T>>4===14?3:T>>3===30?4:T>>6===2?-1:-2}function u(T,A,L){var w=A.length-1;if(w<L)return 0;var C=a(A[w]);return C>=0?(C>0&&(T.lastNeed=C-1),C):--w<L||C===-2?0:(C=a(A[w]),C>=0?(C>0&&(T.lastNeed=C-2),C):--w<L||C===-2?0:(C=a(A[w]),C>=0?(C>0&&(C===2?C=0:T.lastNeed=C-3),C):0))}function f(T,A,L){if((A[0]&192)!==128)return T.lastNeed=0,"";if(T.lastNeed>1&&A.length>1){if((A[1]&192)!==128)return T.lastNeed=1,"";if(T.lastNeed>2&&A.length>2&&(A[2]&192)!==128)return T.lastNeed=2,""}}function c(T){var A=this.lastTotal-this.lastNeed,L=f(this,T);if(L!==void 0)return L;if(this.lastNeed<=T.length)return T.copy(this.lastChar,A,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);T.copy(this.lastChar,A,0,T.length),this.lastNeed-=T.length}function d(T,A){var L=u(this,T,A);if(!this.lastNeed)return T.toString("utf8",A);this.lastTotal=L;var w=T.length-(L-this.lastNeed);return T.copy(this.lastChar,0,w),T.toString("utf8",A,w)}function p(T){var A=T&&T.length?this.write(T):"";return this.lastNeed?A+"":A}function m(T,A){if((T.length-A)%2===0){var L=T.toString("utf16le",A);if(L){var w=L.charCodeAt(L.length-1);if(w>=55296&&w<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=T[T.length-2],this.lastChar[1]=T[T.length-1],L.slice(0,-1)}return L}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=T[T.length-1],T.toString("utf16le",A,T.length-1)}function v(T){var A=T&&T.length?this.write(T):"";if(this.lastNeed){var L=this.lastTotal-this.lastNeed;return A+this.lastChar.toString("utf16le",0,L)}return A}function y(T,A){var L=(T.length-A)%3;return L===0?T.toString("base64",A):(this.lastNeed=3-L,this.lastTotal=3,L===1?this.lastChar[0]=T[T.length-1]:(this.lastChar[0]=T[T.length-2],this.lastChar[1]=T[T.length-1]),T.toString("base64",A,T.length-L))}function b(T){var A=T&&T.length?this.write(T):"";return this.lastNeed?A+this.lastChar.toString("base64",0,3-this.lastNeed):A}function E(T){return T.toString(this.encoding)}function x(T){return T&&T.length?this.write(T):""}}),yx=je((l,e)=>{ke(),Pe(),Me();var t=Fs(),{PromisePrototypeThen:r,SymbolAsyncIterator:n,SymbolIterator:s}=Kt(),{Buffer:a}=(hr(),Ct(fr)),{ERR_INVALID_ARG_TYPE:u,ERR_STREAM_NULL_VALUES:f}=Cr().codes;function c(d,p,m){let v;if(typeof p=="string"||p instanceof a)return new d({objectMode:!0,...m,read(){this.push(p),this.push(null)}});let y;if(p&&p[n])y=!0,v=p[n]();else if(p&&p[s])y=!1,v=p[s]();else throw new u("iterable",["Iterable"],p);let b=new d({objectMode:!0,highWaterMark:1,...m}),E=!1;b._read=function(){E||(E=!0,T())},b._destroy=function(A,L){r(x(A),()=>t.nextTick(L,A),w=>t.nextTick(L,w||A))};async function x(A){let L=A!=null,w=typeof v.throw=="function";if(L&&w){let{value:C,done:I}=await v.throw(A);if(await C,I)return}if(typeof v.return=="function"){let{value:C}=await v.return();await C}}async function T(){for(;;){try{let{value:A,done:L}=y?await v.next():v.next();if(L)b.push(null);else{let w=A&&typeof A.then=="function"?await A:A;if(w===null)throw E=!1,new f;if(b.push(w))continue;E=!1}}catch(A){b.destroy(A)}break}}return b}e.exports=c}),Gc=je((l,e)=>{ke(),Pe(),Me();var t=Fs(),{ArrayPrototypeIndexOf:r,NumberIsInteger:n,NumberIsNaN:s,NumberParseInt:a,ObjectDefineProperties:u,ObjectKeys:f,ObjectSetPrototypeOf:c,Promise:d,SafeSet:p,SymbolAsyncDispose:m,SymbolAsyncIterator:v,Symbol:y}=Kt();e.exports=Ae,Ae.ReadableState=Ke;var{EventEmitter:b}=(Bs(),Ct(ls)),{Stream:E,prependListener:x}=mm(),{Buffer:T}=(hr(),Ct(fr)),{addAbortSignal:A}=jc(),L=us(),w=Kr().debuglog("stream",Q=>{w=Q}),C=uL(),I=Va(),{getHighWaterMark:O,getDefaultHighWaterMark:B}=$c(),{aggregateTwoErrors:P,codes:{ERR_INVALID_ARG_TYPE:$,ERR_METHOD_NOT_IMPLEMENTED:F,ERR_OUT_OF_RANGE:Z,ERR_STREAM_PUSH_AFTER_EOF:X,ERR_STREAM_UNSHIFT_AFTER_END_EVENT:q},AbortError:H}=Cr(),{validateObject:K}=ul(),z=y("kPaused"),{StringDecoder:ie}=fL(),Y=yx();c(Ae.prototype,E.prototype),c(Ae,E);var U=()=>{},{errorOrDestroy:N}=I,W=1,ue=2,ne=4,Ee=8,se=16,J=32,me=64,ce=128,he=256,pe=512,Fe=1024,Re=2048,ee=4096,te=8192,ge=16384,Ie=32768,Ce=65536,Ue=1<<17,le=1<<18;function Ne(Q){return{enumerable:!1,get(){return(this.state&Q)!==0},set(re){re?this.state|=Q:this.state&=~Q}}}u(Ke.prototype,{objectMode:Ne(W),ended:Ne(ue),endEmitted:Ne(ne),reading:Ne(Ee),constructed:Ne(se),sync:Ne(J),needReadable:Ne(me),emittedReadable:Ne(ce),readableListening:Ne(he),resumeScheduled:Ne(pe),errorEmitted:Ne(Fe),emitClose:Ne(Re),autoDestroy:Ne(ee),destroyed:Ne(te),closed:Ne(ge),closeEmitted:Ne(Ie),multiAwaitDrain:Ne(Ce),readingMore:Ne(Ue),dataEmitted:Ne(le)});function Ke(Q,re,Ve){typeof Ve!="boolean"&&(Ve=re instanceof En()),this.state=Re|ee|se|J,Q&&Q.objectMode&&(this.state|=W),Ve&&Q&&Q.readableObjectMode&&(this.state|=W),this.highWaterMark=Q?O(this,Q,"readableHighWaterMark",Ve):B(!1),this.buffer=new C,this.length=0,this.pipes=[],this.flowing=null,this[z]=null,Q&&Q.emitClose===!1&&(this.state&=~Re),Q&&Q.autoDestroy===!1&&(this.state&=~ee),this.errored=null,this.defaultEncoding=Q&&Q.defaultEncoding||"utf8",this.awaitDrainWriters=null,this.decoder=null,this.encoding=null,Q&&Q.encoding&&(this.decoder=new ie(Q.encoding),this.encoding=Q.encoding)}function Ae(Q){if(!(this instanceof Ae))return new Ae(Q);let re=this instanceof En();this._readableState=new Ke(Q,this,re),Q&&(typeof Q.read=="function"&&(this._read=Q.read),typeof Q.destroy=="function"&&(this._destroy=Q.destroy),typeof Q.construct=="function"&&(this._construct=Q.construct),Q.signal&&!re&&A(Q.signal,this)),E.call(this,Q),I.construct(this,()=>{this._readableState.needReadable&&de(this,this._readableState)})}Ae.prototype.destroy=I.destroy,Ae.prototype._undestroy=I.undestroy,Ae.prototype._destroy=function(Q,re){re(Q)},Ae.prototype[b.captureRejectionSymbol]=function(Q){this.destroy(Q)},Ae.prototype[m]=function(){let Q;return this.destroyed||(Q=this.readableEnded?null:new H,this.destroy(Q)),new d((re,Ve)=>L(this,qe=>qe&&qe!==Q?Ve(qe):re(null)))},Ae.prototype.push=function(Q,re){return nt(this,Q,re,!1)},Ae.prototype.unshift=function(Q,re){return nt(this,Q,re,!0)};function nt(Q,re,Ve,qe){w("readableAddChunk",re);let Qe=Q._readableState,Ft;if((Qe.state&W)===0&&(typeof re=="string"?(Ve=Ve||Qe.defaultEncoding,Qe.encoding!==Ve&&(qe&&Qe.encoding?re=T.from(re,Ve).toString(Qe.encoding):(re=T.from(re,Ve),Ve=""))):re instanceof T?Ve="":E._isUint8Array(re)?(re=E._uint8ArrayToBuffer(re),Ve=""):re!=null&&(Ft=new $("chunk",["string","Buffer","Uint8Array"],re))),Ft)N(Q,Ft);else if(re===null)Qe.state&=~Ee,ye(Q,Qe);else if((Qe.state&W)!==0||re&&re.length>0)if(qe)if((Qe.state&ne)!==0)N(Q,new q);else{if(Qe.destroyed||Qe.errored)return!1;R(Q,Qe,re,!0)}else if(Qe.ended)N(Q,new X);else{if(Qe.destroyed||Qe.errored)return!1;Qe.state&=~Ee,Qe.decoder&&!Ve?(re=Qe.decoder.write(re),Qe.objectMode||re.length!==0?R(Q,Qe,re,!1):de(Q,Qe)):R(Q,Qe,re,!1)}else qe||(Qe.state&=~Ee,de(Q,Qe));return!Qe.ended&&(Qe.length<Qe.highWaterMark||Qe.length===0)}function R(Q,re,Ve,qe){re.flowing&&re.length===0&&!re.sync&&Q.listenerCount("data")>0?((re.state&Ce)!==0?re.awaitDrainWriters.clear():re.awaitDrainWriters=null,re.dataEmitted=!0,Q.emit("data",Ve)):(re.length+=re.objectMode?1:Ve.length,qe?re.buffer.unshift(Ve):re.buffer.push(Ve),(re.state&me)!==0&&De(Q)),de(Q,re)}Ae.prototype.isPaused=function(){let Q=this._readableState;return Q[z]===!0||Q.flowing===!1},Ae.prototype.setEncoding=function(Q){let re=new ie(Q);this._readableState.decoder=re,this._readableState.encoding=this._readableState.decoder.encoding;let Ve=this._readableState.buffer,qe="";for(let Qe of Ve)qe+=re.write(Qe);return Ve.clear(),qe!==""&&Ve.push(qe),this._readableState.length=qe.length,this};var D=1073741824;function j(Q){if(Q>D)throw new Z("size","<= 1GiB",Q);return Q--,Q|=Q>>>1,Q|=Q>>>2,Q|=Q>>>4,Q|=Q>>>8,Q|=Q>>>16,Q++,Q}function ae(Q,re){return Q<=0||re.length===0&&re.ended?0:(re.state&W)!==0?1:s(Q)?re.flowing&&re.length?re.buffer.first().length:re.length:Q<=re.length?Q:re.ended?re.length:0}Ae.prototype.read=function(Q){w("read",Q),Q===void 0?Q=NaN:n(Q)||(Q=a(Q,10));let re=this._readableState,Ve=Q;if(Q>re.highWaterMark&&(re.highWaterMark=j(Q)),Q!==0&&(re.state&=~ce),Q===0&&re.needReadable&&((re.highWaterMark!==0?re.length>=re.highWaterMark:re.length>0)||re.ended))return w("read: emitReadable",re.length,re.ended),re.length===0&&re.ended?wr(this):De(this),null;if(Q=ae(Q,re),Q===0&&re.ended)return re.length===0&&wr(this),null;let qe=(re.state&me)!==0;if(w("need readable",qe),(re.length===0||re.length-Q<re.highWaterMark)&&(qe=!0,w("length less than watermark",qe)),re.ended||re.reading||re.destroyed||re.errored||!re.constructed)qe=!1,w("reading, ended or constructing",qe);else if(qe){w("do read"),re.state|=Ee|J,re.length===0&&(re.state|=me);try{this._read(re.highWaterMark)}catch(Ft){N(this,Ft)}re.state&=~J,re.reading||(Q=ae(Ve,re))}let Qe;return Q>0?Qe=Dr(Q,re):Qe=null,Qe===null?(re.needReadable=re.length<=re.highWaterMark,Q=0):(re.length-=Q,re.multiAwaitDrain?re.awaitDrainWriters.clear():re.awaitDrainWriters=null),re.length===0&&(re.ended||(re.needReadable=!0),Ve!==Q&&re.ended&&wr(this)),Qe!==null&&!re.errorEmitted&&!re.closeEmitted&&(re.dataEmitted=!0,this.emit("data",Qe)),Qe};function ye(Q,re){if(w("onEofChunk"),!re.ended){if(re.decoder){let Ve=re.decoder.end();Ve&&Ve.length&&(re.buffer.push(Ve),re.length+=re.objectMode?1:Ve.length)}re.ended=!0,re.sync?De(Q):(re.needReadable=!1,re.emittedReadable=!0,ze(Q))}}function De(Q){let re=Q._readableState;w("emitReadable",re.needReadable,re.emittedReadable),re.needReadable=!1,re.emittedReadable||(w("emitReadable",re.flowing),re.emittedReadable=!0,t.nextTick(ze,Q))}function ze(Q){let re=Q._readableState;w("emitReadable_",re.destroyed,re.length,re.ended),!re.destroyed&&!re.errored&&(re.length||re.ended)&&(Q.emit("readable"),re.emittedReadable=!1),re.needReadable=!re.flowing&&!re.ended&&re.length<=re.highWaterMark,_r(Q)}function de(Q,re){!re.readingMore&&re.constructed&&(re.readingMore=!0,t.nextTick(Te,Q,re))}function Te(Q,re){for(;!re.reading&&!re.ended&&(re.length<re.highWaterMark||re.flowing&&re.length===0);){let Ve=re.length;if(w("maybeReadMore read 0"),Q.read(0),Ve===re.length)break}re.readingMore=!1}Ae.prototype._read=function(Q){throw new F("_read()")},Ae.prototype.pipe=function(Q,re){let Ve=this,qe=this._readableState;qe.pipes.length===1&&(qe.multiAwaitDrain||(qe.multiAwaitDrain=!0,qe.awaitDrainWriters=new p(qe.awaitDrainWriters?[qe.awaitDrainWriters]:[]))),qe.pipes.push(Q),w("pipe count=%d opts=%j",qe.pipes.length,re);let Qe=(!re||re.end!==!1)&&Q!==t.stdout&&Q!==t.stderr?ir:Ki;qe.endEmitted?t.nextTick(Qe):Ve.once("end",Qe),Q.on("unpipe",Ft);function Ft(zr,Rr){w("onunpipe"),zr===Ve&&Rr&&Rr.hasUnpiped===!1&&(Rr.hasUnpiped=!0,kr())}function ir(){w("onend"),Q.end()}let Or,wn=!1;function kr(){w("cleanup"),Q.removeListener("close",Pr),Q.removeListener("finish",Ai),Or&&Q.removeListener("drain",Or),Q.removeListener("error",Mr),Q.removeListener("unpipe",Ft),Ve.removeListener("end",ir),Ve.removeListener("end",Ki),Ve.removeListener("data",nr),wn=!0,Or&&qe.awaitDrainWriters&&(!Q._writableState||Q._writableState.needDrain)&&Or()}function jt(){wn||(qe.pipes.length===1&&qe.pipes[0]===Q?(w("false write response, pause",0),qe.awaitDrainWriters=Q,qe.multiAwaitDrain=!1):qe.pipes.length>1&&qe.pipes.includes(Q)&&(w("false write response, pause",qe.awaitDrainWriters.size),qe.awaitDrainWriters.add(Q)),Ve.pause()),Or||(Or=Ze(Ve,Q),Q.on("drain",Or))}Ve.on("data",nr);function nr(zr){w("ondata");let Rr=Q.write(zr);w("dest.write",Rr),Rr===!1&&jt()}function Mr(zr){if(w("onerror",zr),Ki(),Q.removeListener("error",Mr),Q.listenerCount("error")===0){let Rr=Q._writableState||Q._readableState;Rr&&!Rr.errorEmitted?N(Q,zr):Q.emit("error",zr)}}x(Q,"error",Mr);function Pr(){Q.removeListener("finish",Ai),Ki()}Q.once("close",Pr);function Ai(){w("onfinish"),Q.removeListener("close",Pr),Ki()}Q.once("finish",Ai);function Ki(){w("unpipe"),Ve.unpipe(Q)}return Q.emit("pipe",Ve),Q.writableNeedDrain===!0?jt():qe.flowing||(w("pipe resume"),Ve.resume()),Q};function Ze(Q,re){return function(){let Ve=Q._readableState;Ve.awaitDrainWriters===re?(w("pipeOnDrain",1),Ve.awaitDrainWriters=null):Ve.multiAwaitDrain&&(w("pipeOnDrain",Ve.awaitDrainWriters.size),Ve.awaitDrainWriters.delete(re)),(!Ve.awaitDrainWriters||Ve.awaitDrainWriters.size===0)&&Q.listenerCount("data")&&Q.resume()}}Ae.prototype.unpipe=function(Q){let re=this._readableState,Ve={hasUnpiped:!1};if(re.pipes.length===0)return this;if(!Q){let Qe=re.pipes;re.pipes=[],this.pause();for(let Ft=0;Ft<Qe.length;Ft++)Qe[Ft].emit("unpipe",this,{hasUnpiped:!1});return this}let qe=r(re.pipes,Q);return qe===-1?this:(re.pipes.splice(qe,1),re.pipes.length===0&&this.pause(),Q.emit("unpipe",this,Ve),this)},Ae.prototype.on=function(Q,re){let Ve=E.prototype.on.call(this,Q,re),qe=this._readableState;return Q==="data"?(qe.readableListening=this.listenerCount("readable")>0,qe.flowing!==!1&&this.resume()):Q==="readable"&&!qe.endEmitted&&!qe.readableListening&&(qe.readableListening=qe.needReadable=!0,qe.flowing=!1,qe.emittedReadable=!1,w("on readable",qe.length,qe.reading),qe.length?De(this):qe.reading||t.nextTick(at,this)),Ve},Ae.prototype.addListener=Ae.prototype.on,Ae.prototype.removeListener=function(Q,re){let Ve=E.prototype.removeListener.call(this,Q,re);return Q==="readable"&&t.nextTick(We,this),Ve},Ae.prototype.off=Ae.prototype.removeListener,Ae.prototype.removeAllListeners=function(Q){let re=E.prototype.removeAllListeners.apply(this,arguments);return(Q==="readable"||Q===void 0)&&t.nextTick(We,this),re};function We(Q){let re=Q._readableState;re.readableListening=Q.listenerCount("readable")>0,re.resumeScheduled&&re[z]===!1?re.flowing=!0:Q.listenerCount("data")>0?Q.resume():re.readableListening||(re.flowing=null)}function at(Q){w("readable nexttick read 0"),Q.read(0)}Ae.prototype.resume=function(){let Q=this._readableState;return Q.flowing||(w("resume"),Q.flowing=!Q.readableListening,ut(this,Q)),Q[z]=!1,this};function ut(Q,re){re.resumeScheduled||(re.resumeScheduled=!0,t.nextTick(ai,Q,re))}function ai(Q,re){w("resume",re.reading),re.reading||Q.read(0),re.resumeScheduled=!1,Q.emit("resume"),_r(Q),re.flowing&&!re.reading&&Q.read(0)}Ae.prototype.pause=function(){return w("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(w("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState[z]=!0,this};function _r(Q){let re=Q._readableState;for(w("flow",re.flowing);re.flowing&&Q.read()!==null;);}Ae.prototype.wrap=function(Q){let re=!1;Q.on("data",qe=>{!this.push(qe)&&Q.pause&&(re=!0,Q.pause())}),Q.on("end",()=>{this.push(null)}),Q.on("error",qe=>{N(this,qe)}),Q.on("close",()=>{this.destroy()}),Q.on("destroy",()=>{this.destroy()}),this._read=()=>{re&&Q.resume&&(re=!1,Q.resume())};let Ve=f(Q);for(let qe=1;qe<Ve.length;qe++){let Qe=Ve[qe];this[Qe]===void 0&&typeof Q[Qe]=="function"&&(this[Qe]=Q[Qe].bind(Q))}return this},Ae.prototype[v]=function(){return Yt(this)},Ae.prototype.iterator=function(Q){return Q!==void 0&&K(Q,"options"),Yt(this,Q)};function Yt(Q,re){typeof Q.read!="function"&&(Q=Ae.wrap(Q,{objectMode:!0}));let Ve=Ar(Q,re);return Ve.stream=Q,Ve}async function*Ar(Q,re){let Ve=U;function qe(ir){this===Q?(Ve(),Ve=U):Ve=ir}Q.on("readable",qe);let Qe,Ft=L(Q,{writable:!1},ir=>{Qe=ir?P(Qe,ir):null,Ve(),Ve=U});try{for(;;){let ir=Q.destroyed?null:Q.read();if(ir!==null)yield ir;else{if(Qe)throw Qe;if(Qe===null)return;await new d(qe)}}}catch(ir){throw Qe=P(Qe,ir),Qe}finally{(Qe||re?.destroyOnReturn!==!1)&&(Qe===void 0||Q._readableState.autoDestroy)?I.destroyer(Q,null):(Q.off("readable",qe),Ft())}}u(Ae.prototype,{readable:{__proto__:null,get(){let Q=this._readableState;return!!Q&&Q.readable!==!1&&!Q.destroyed&&!Q.errorEmitted&&!Q.endEmitted},set(Q){this._readableState&&(this._readableState.readable=!!Q)}},readableDidRead:{__proto__:null,enumerable:!1,get:function(){return this._readableState.dataEmitted}},readableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._readableState.readable!==!1&&(this._readableState.destroyed||this._readableState.errored)&&!this._readableState.endEmitted)}},readableHighWaterMark:{__proto__:null,enumerable:!1,get:function(){return this._readableState.highWaterMark}},readableBuffer:{__proto__:null,enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}},readableFlowing:{__proto__:null,enumerable:!1,get:function(){return this._readableState.flowing},set:function(Q){this._readableState&&(this._readableState.flowing=Q)}},readableLength:{__proto__:null,enumerable:!1,get(){return this._readableState.length}},readableObjectMode:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.objectMode:!1}},readableEncoding:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.encoding:null}},errored:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.errored:null}},closed:{__proto__:null,get(){return this._readableState?this._readableState.closed:!1}},destroyed:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.destroyed:!1},set(Q){this._readableState&&(this._readableState.destroyed=Q)}},readableEnded:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.endEmitted:!1}}}),u(Ke.prototype,{pipesCount:{__proto__:null,get(){return this.pipes.length}},paused:{__proto__:null,get(){return this[z]!==!1},set(Q){this[z]=!!Q}}}),Ae._fromList=Dr;function Dr(Q,re){if(re.length===0)return null;let Ve;return re.objectMode?Ve=re.buffer.shift():!Q||Q>=re.length?(re.decoder?Ve=re.buffer.join(""):re.buffer.length===1?Ve=re.buffer.first():Ve=re.buffer.concat(re.length),re.buffer.clear()):Ve=re.buffer.consume(Q,re.decoder),Ve}function wr(Q){let re=Q._readableState;w("endReadable",re.endEmitted),re.endEmitted||(re.ended=!0,t.nextTick(rr,re,Q))}function rr(Q,re){if(w("endReadableNT",Q.endEmitted,Q.length),!Q.errored&&!Q.closeEmitted&&!Q.endEmitted&&Q.length===0){if(Q.endEmitted=!0,re.emit("end"),re.writable&&re.allowHalfOpen===!1)t.nextTick($s,re);else if(Q.autoDestroy){let Ve=re._writableState;(!Ve||Ve.autoDestroy&&(Ve.finished||Ve.writable===!1))&&re.destroy()}}}function $s(Q){Q.writable&&!Q.writableEnded&&!Q.destroyed&&Q.end()}Ae.from=function(Q,re){return Y(Ae,Q,re)};var Gi;function Hi(){return Gi===void 0&&(Gi={}),Gi}Ae.fromWeb=function(Q,re){return Hi().newStreamReadableFromReadableStream(Q,re)},Ae.toWeb=function(Q,re){return Hi().newReadableStreamFromStreamReadable(Q,re)},Ae.wrap=function(Q,re){var Ve,qe;return new Ae({objectMode:(Ve=(qe=Q.readableObjectMode)!==null&&qe!==void 0?qe:Q.objectMode)!==null&&Ve!==void 0?Ve:!0,...re,destroy(Qe,Ft){I.destroyer(Q,Qe),Ft(Qe)}}).wrap(Q)}}),ym=je((l,e)=>{ke(),Pe(),Me();var t=Fs(),{ArrayPrototypeSlice:r,Error:n,FunctionPrototypeSymbolHasInstance:s,ObjectDefineProperty:a,ObjectDefineProperties:u,ObjectSetPrototypeOf:f,StringPrototypeToLowerCase:c,Symbol:d,SymbolHasInstance:p}=Kt();e.exports=K,K.WritableState=q;var{EventEmitter:m}=(Bs(),Ct(ls)),v=mm().Stream,{Buffer:y}=(hr(),Ct(fr)),b=Va(),{addAbortSignal:E}=jc(),{getHighWaterMark:x,getDefaultHighWaterMark:T}=$c(),{ERR_INVALID_ARG_TYPE:A,ERR_METHOD_NOT_IMPLEMENTED:L,ERR_MULTIPLE_CALLBACK:w,ERR_STREAM_CANNOT_PIPE:C,ERR_STREAM_DESTROYED:I,ERR_STREAM_ALREADY_FINISHED:O,ERR_STREAM_NULL_VALUES:B,ERR_STREAM_WRITE_AFTER_END:P,ERR_UNKNOWN_ENCODING:$}=Cr().codes,{errorOrDestroy:F}=b;f(K.prototype,v.prototype),f(K,v);function Z(){}var X=d("kOnFinished");function q(ee,te,ge){typeof ge!="boolean"&&(ge=te instanceof En()),this.objectMode=!!(ee&&ee.objectMode),ge&&(this.objectMode=this.objectMode||!!(ee&&ee.writableObjectMode)),this.highWaterMark=ee?x(this,ee,"writableHighWaterMark",ge):T(!1),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;let Ie=!!(ee&&ee.decodeStrings===!1);this.decodeStrings=!Ie,this.defaultEncoding=ee&&ee.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=N.bind(void 0,te),this.writecb=null,this.writelen=0,this.afterWriteTickInfo=null,H(this),this.pendingcb=0,this.constructed=!0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!ee||ee.emitClose!==!1,this.autoDestroy=!ee||ee.autoDestroy!==!1,this.errored=null,this.closed=!1,this.closeEmitted=!1,this[X]=[]}function H(ee){ee.buffered=[],ee.bufferedIndex=0,ee.allBuffers=!0,ee.allNoop=!0}q.prototype.getBuffer=function(){return r(this.buffered,this.bufferedIndex)},a(q.prototype,"bufferedRequestCount",{__proto__:null,get(){return this.buffered.length-this.bufferedIndex}});function K(ee){let te=this instanceof En();if(!te&&!s(K,this))return new K(ee);this._writableState=new q(ee,this,te),ee&&(typeof ee.write=="function"&&(this._write=ee.write),typeof ee.writev=="function"&&(this._writev=ee.writev),typeof ee.destroy=="function"&&(this._destroy=ee.destroy),typeof ee.final=="function"&&(this._final=ee.final),typeof ee.construct=="function"&&(this._construct=ee.construct),ee.signal&&E(ee.signal,this)),v.call(this,ee),b.construct(this,()=>{let ge=this._writableState;ge.writing||Ee(this,ge),ce(this,ge)})}a(K,p,{__proto__:null,value:function(ee){return s(this,ee)?!0:this!==K?!1:ee&&ee._writableState instanceof q}}),K.prototype.pipe=function(){F(this,new C)};function z(ee,te,ge,Ie){let Ce=ee._writableState;if(typeof ge=="function")Ie=ge,ge=Ce.defaultEncoding;else{if(!ge)ge=Ce.defaultEncoding;else if(ge!=="buffer"&&!y.isEncoding(ge))throw new $(ge);typeof Ie!="function"&&(Ie=Z)}if(te===null)throw new B;if(!Ce.objectMode)if(typeof te=="string")Ce.decodeStrings!==!1&&(te=y.from(te,ge),ge="buffer");else if(te instanceof y)ge="buffer";else if(v._isUint8Array(te))te=v._uint8ArrayToBuffer(te),ge="buffer";else throw new A("chunk",["string","Buffer","Uint8Array"],te);let Ue;return Ce.ending?Ue=new P:Ce.destroyed&&(Ue=new I("write")),Ue?(t.nextTick(Ie,Ue),F(ee,Ue,!0),Ue):(Ce.pendingcb++,ie(ee,Ce,te,ge,Ie))}K.prototype.write=function(ee,te,ge){return z(this,ee,te,ge)===!0},K.prototype.cork=function(){this._writableState.corked++},K.prototype.uncork=function(){let ee=this._writableState;ee.corked&&(ee.corked--,ee.writing||Ee(this,ee))},K.prototype.setDefaultEncoding=function(ee){if(typeof ee=="string"&&(ee=c(ee)),!y.isEncoding(ee))throw new $(ee);return this._writableState.defaultEncoding=ee,this};function ie(ee,te,ge,Ie,Ce){let Ue=te.objectMode?1:ge.length;te.length+=Ue;let le=te.length<te.highWaterMark;return le||(te.needDrain=!0),te.writing||te.corked||te.errored||!te.constructed?(te.buffered.push({chunk:ge,encoding:Ie,callback:Ce}),te.allBuffers&&Ie!=="buffer"&&(te.allBuffers=!1),te.allNoop&&Ce!==Z&&(te.allNoop=!1)):(te.writelen=Ue,te.writecb=Ce,te.writing=!0,te.sync=!0,ee._write(ge,Ie,te.onwrite),te.sync=!1),le&&!te.errored&&!te.destroyed}function Y(ee,te,ge,Ie,Ce,Ue,le){te.writelen=Ie,te.writecb=le,te.writing=!0,te.sync=!0,te.destroyed?te.onwrite(new I("write")):ge?ee._writev(Ce,te.onwrite):ee._write(Ce,Ue,te.onwrite),te.sync=!1}function U(ee,te,ge,Ie){--te.pendingcb,Ie(ge),ne(te),F(ee,ge)}function N(ee,te){let ge=ee._writableState,Ie=ge.sync,Ce=ge.writecb;if(typeof Ce!="function"){F(ee,new w);return}ge.writing=!1,ge.writecb=null,ge.length-=ge.writelen,ge.writelen=0,te?(te.stack,ge.errored||(ge.errored=te),ee._readableState&&!ee._readableState.errored&&(ee._readableState.errored=te),Ie?t.nextTick(U,ee,ge,te,Ce):U(ee,ge,te,Ce)):(ge.buffered.length>ge.bufferedIndex&&Ee(ee,ge),Ie?ge.afterWriteTickInfo!==null&&ge.afterWriteTickInfo.cb===Ce?ge.afterWriteTickInfo.count++:(ge.afterWriteTickInfo={count:1,cb:Ce,stream:ee,state:ge},t.nextTick(W,ge.afterWriteTickInfo)):ue(ee,ge,1,Ce))}function W({stream:ee,state:te,count:ge,cb:Ie}){return te.afterWriteTickInfo=null,ue(ee,te,ge,Ie)}function ue(ee,te,ge,Ie){for(!te.ending&&!ee.destroyed&&te.length===0&&te.needDrain&&(te.needDrain=!1,ee.emit("drain"));ge-- >0;)te.pendingcb--,Ie();te.destroyed&&ne(te),ce(ee,te)}function ne(ee){if(ee.writing)return;for(let Ce=ee.bufferedIndex;Ce<ee.buffered.length;++Ce){var te;let{chunk:Ue,callback:le}=ee.buffered[Ce],Ne=ee.objectMode?1:Ue.length;ee.length-=Ne,le((te=ee.errored)!==null&&te!==void 0?te:new I("write"))}let ge=ee[X].splice(0);for(let Ce=0;Ce<ge.length;Ce++){var Ie;ge[Ce]((Ie=ee.errored)!==null&&Ie!==void 0?Ie:new I("end"))}H(ee)}function Ee(ee,te){if(te.corked||te.bufferProcessing||te.destroyed||!te.constructed)return;let{buffered:ge,bufferedIndex:Ie,objectMode:Ce}=te,Ue=ge.length-Ie;if(!Ue)return;let le=Ie;if(te.bufferProcessing=!0,Ue>1&&ee._writev){te.pendingcb-=Ue-1;let Ne=te.allNoop?Z:Ae=>{for(let nt=le;nt<ge.length;++nt)ge[nt].callback(Ae)},Ke=te.allNoop&&le===0?ge:r(ge,le);Ke.allBuffers=te.allBuffers,Y(ee,te,!0,te.length,Ke,"",Ne),H(te)}else{do{let{chunk:Ne,encoding:Ke,callback:Ae}=ge[le];ge[le++]=null;let nt=Ce?1:Ne.length;Y(ee,te,!1,nt,Ne,Ke,Ae)}while(le<ge.length&&!te.writing);le===ge.length?H(te):le>256?(ge.splice(0,le),te.bufferedIndex=0):te.bufferedIndex=le}te.bufferProcessing=!1}K.prototype._write=function(ee,te,ge){if(this._writev)this._writev([{chunk:ee,encoding:te}],ge);else throw new L("_write()")},K.prototype._writev=null,K.prototype.end=function(ee,te,ge){let Ie=this._writableState;typeof ee=="function"?(ge=ee,ee=null,te=null):typeof te=="function"&&(ge=te,te=null);let Ce;if(ee!=null){let Ue=z(this,ee,te);Ue instanceof n&&(Ce=Ue)}return Ie.corked&&(Ie.corked=1,this.uncork()),Ce||(!Ie.errored&&!Ie.ending?(Ie.ending=!0,ce(this,Ie,!0),Ie.ended=!0):Ie.finished?Ce=new O("end"):Ie.destroyed&&(Ce=new I("end"))),typeof ge=="function"&&(Ce||Ie.finished?t.nextTick(ge,Ce):Ie[X].push(ge)),this};function se(ee){return ee.ending&&!ee.destroyed&&ee.constructed&&ee.length===0&&!ee.errored&&ee.buffered.length===0&&!ee.finished&&!ee.writing&&!ee.errorEmitted&&!ee.closeEmitted}function J(ee,te){let ge=!1;function Ie(Ce){if(ge){F(ee,Ce??w());return}if(ge=!0,te.pendingcb--,Ce){let Ue=te[X].splice(0);for(let le=0;le<Ue.length;le++)Ue[le](Ce);F(ee,Ce,te.sync)}else se(te)&&(te.prefinished=!0,ee.emit("prefinish"),te.pendingcb++,t.nextTick(he,ee,te))}te.sync=!0,te.pendingcb++;try{ee._final(Ie)}catch(Ce){Ie(Ce)}te.sync=!1}function me(ee,te){!te.prefinished&&!te.finalCalled&&(typeof ee._final=="function"&&!te.destroyed?(te.finalCalled=!0,J(ee,te)):(te.prefinished=!0,ee.emit("prefinish")))}function ce(ee,te,ge){se(te)&&(me(ee,te),te.pendingcb===0&&(ge?(te.pendingcb++,t.nextTick((Ie,Ce)=>{se(Ce)?he(Ie,Ce):Ce.pendingcb--},ee,te)):se(te)&&(te.pendingcb++,he(ee,te))))}function he(ee,te){te.pendingcb--,te.finished=!0;let ge=te[X].splice(0);for(let Ie=0;Ie<ge.length;Ie++)ge[Ie]();if(ee.emit("finish"),te.autoDestroy){let Ie=ee._readableState;(!Ie||Ie.autoDestroy&&(Ie.endEmitted||Ie.readable===!1))&&ee.destroy()}}u(K.prototype,{closed:{__proto__:null,get(){return this._writableState?this._writableState.closed:!1}},destroyed:{__proto__:null,get(){return this._writableState?this._writableState.destroyed:!1},set(ee){this._writableState&&(this._writableState.destroyed=ee)}},writable:{__proto__:null,get(){let ee=this._writableState;return!!ee&&ee.writable!==!1&&!ee.destroyed&&!ee.errored&&!ee.ending&&!ee.ended},set(ee){this._writableState&&(this._writableState.writable=!!ee)}},writableFinished:{__proto__:null,get(){return this._writableState?this._writableState.finished:!1}},writableObjectMode:{__proto__:null,get(){return this._writableState?this._writableState.objectMode:!1}},writableBuffer:{__proto__:null,get(){return this._writableState&&this._writableState.getBuffer()}},writableEnded:{__proto__:null,get(){return this._writableState?this._writableState.ending:!1}},writableNeedDrain:{__proto__:null,get(){let ee=this._writableState;return ee?!ee.destroyed&&!ee.ending&&ee.needDrain:!1}},writableHighWaterMark:{__proto__:null,get(){return this._writableState&&this._writableState.highWaterMark}},writableCorked:{__proto__:null,get(){return this._writableState?this._writableState.corked:0}},writableLength:{__proto__:null,get(){return this._writableState&&this._writableState.length}},errored:{__proto__:null,enumerable:!1,get(){return this._writableState?this._writableState.errored:null}},writableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._writableState.writable!==!1&&(this._writableState.destroyed||this._writableState.errored)&&!this._writableState.finished)}}});var pe=b.destroy;K.prototype.destroy=function(ee,te){let ge=this._writableState;return!ge.destroyed&&(ge.bufferedIndex<ge.buffered.length||ge[X].length)&&t.nextTick(ne,ge),pe.call(this,ee,te),this},K.prototype._undestroy=b.undestroy,K.prototype._destroy=function(ee,te){te(ee)},K.prototype[m.captureRejectionSymbol]=function(ee){this.destroy(ee)};var Fe;function Re(){return Fe===void 0&&(Fe={}),Fe}K.fromWeb=function(ee,te){return Re().newStreamWritableFromWritableStream(ee,te)},K.toWeb=function(ee){return Re().newWritableStreamFromStreamWritable(ee)}}),hL=je((l,e)=>{ke(),Pe(),Me();var t=Fs(),r=(hr(),Ct(fr)),{isReadable:n,isWritable:s,isIterable:a,isNodeStream:u,isReadableNodeStream:f,isWritableNodeStream:c,isDuplexNodeStream:d,isReadableStream:p,isWritableStream:m}=xn(),v=us(),{AbortError:y,codes:{ERR_INVALID_ARG_TYPE:b,ERR_INVALID_RETURN_VALUE:E}}=Cr(),{destroyer:x}=Va(),T=En(),A=Gc(),L=ym(),{createDeferredPromise:w}=Kr(),C=yx(),I=globalThis.Blob||r.Blob,O=typeof I<"u"?function(X){return X instanceof I}:function(X){return!1},B=globalThis.AbortController||Zo().AbortController,{FunctionPrototypeCall:P}=Kt(),$=class extends T{constructor(X){super(X),X?.readable===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),X?.writable===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)}};e.exports=function X(q,H){if(d(q))return q;if(f(q))return Z({readable:q});if(c(q))return Z({writable:q});if(u(q))return Z({writable:!1,readable:!1});if(p(q))return Z({readable:A.fromWeb(q)});if(m(q))return Z({writable:L.fromWeb(q)});if(typeof q=="function"){let{value:z,write:ie,final:Y,destroy:U}=F(q);if(a(z))return C($,z,{objectMode:!0,write:ie,final:Y,destroy:U});let N=z?.then;if(typeof N=="function"){let W,ue=P(N,z,ne=>{if(ne!=null)throw new E("nully","body",ne)},ne=>{x(W,ne)});return W=new $({objectMode:!0,readable:!1,write:ie,final(ne){Y(async()=>{try{await ue,t.nextTick(ne,null)}catch(Ee){t.nextTick(ne,Ee)}})},destroy:U})}throw new E("Iterable, AsyncIterable or AsyncFunction",H,z)}if(O(q))return X(q.arrayBuffer());if(a(q))return C($,q,{objectMode:!0,writable:!1});if(p(q?.readable)&&m(q?.writable))return $.fromWeb(q);if(typeof q?.writable=="object"||typeof q?.readable=="object"){let z=q!=null&&q.readable?f(q?.readable)?q?.readable:X(q.readable):void 0,ie=q!=null&&q.writable?c(q?.writable)?q?.writable:X(q.writable):void 0;return Z({readable:z,writable:ie})}let K=q?.then;if(typeof K=="function"){let z;return P(K,q,ie=>{ie!=null&&z.push(ie),z.push(null)},ie=>{x(z,ie)}),z=new $({objectMode:!0,writable:!1,read(){}})}throw new b(H,["Blob","ReadableStream","WritableStream","Stream","Iterable","AsyncIterable","Function","{ readable, writable } pair","Promise"],q)};function F(X){let{promise:q,resolve:H}=w(),K=new B,z=K.signal;return{value:X((async function*(){for(;;){let ie=q;q=null;let{chunk:Y,done:U,cb:N}=await ie;if(t.nextTick(N),U)return;if(z.aborted)throw new y(void 0,{cause:z.reason});({promise:q,resolve:H}=w()),yield Y}})(),{signal:z}),write(ie,Y,U){let N=H;H=null,N({chunk:ie,done:!1,cb:U})},final(ie){let Y=H;H=null,Y({done:!0,cb:ie})},destroy(ie,Y){K.abort(),Y(ie)}}}function Z(X){let q=X.readable&&typeof X.readable.read!="function"?A.wrap(X.readable):X.readable,H=X.writable,K=!!n(q),z=!!s(H),ie,Y,U,N,W;function ue(ne){let Ee=N;N=null,Ee?Ee(ne):ne&&W.destroy(ne)}return W=new $({readableObjectMode:!!(q!=null&&q.readableObjectMode),writableObjectMode:!!(H!=null&&H.writableObjectMode),readable:K,writable:z}),z&&(v(H,ne=>{z=!1,ne&&x(q,ne),ue(ne)}),W._write=function(ne,Ee,se){H.write(ne,Ee)?se():ie=se},W._final=function(ne){H.end(),Y=ne},H.on("drain",function(){if(ie){let ne=ie;ie=null,ne()}}),H.on("finish",function(){if(Y){let ne=Y;Y=null,ne()}})),K&&(v(q,ne=>{K=!1,ne&&x(q,ne),ue(ne)}),q.on("readable",function(){if(U){let ne=U;U=null,ne()}}),q.on("end",function(){W.push(null)}),W._read=function(){for(;;){let ne=q.read();if(ne===null){U=W._read;return}if(!W.push(ne))return}}),W._destroy=function(ne,Ee){!ne&&N!==null&&(ne=new y),U=null,ie=null,Y=null,N===null?Ee(ne):(N=Ee,x(H,ne),x(q,ne))},W}}),En=je((l,e)=>{ke(),Pe(),Me();var{ObjectDefineProperties:t,ObjectGetOwnPropertyDescriptor:r,ObjectKeys:n,ObjectSetPrototypeOf:s}=Kt();e.exports=f;var a=Gc(),u=ym();s(f.prototype,a.prototype),s(f,a);{let m=n(u.prototype);for(let v=0;v<m.length;v++){let y=m[v];f.prototype[y]||(f.prototype[y]=u.prototype[y])}}function f(m){if(!(this instanceof f))return new f(m);a.call(this,m),u.call(this,m),m?(this.allowHalfOpen=m.allowHalfOpen!==!1,m.readable===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),m.writable===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)):this.allowHalfOpen=!0}t(f.prototype,{writable:{__proto__:null,...r(u.prototype,"writable")},writableHighWaterMark:{__proto__:null,...r(u.prototype,"writableHighWaterMark")},writableObjectMode:{__proto__:null,...r(u.prototype,"writableObjectMode")},writableBuffer:{__proto__:null,...r(u.prototype,"writableBuffer")},writableLength:{__proto__:null,...r(u.prototype,"writableLength")},writableFinished:{__proto__:null,...r(u.prototype,"writableFinished")},writableCorked:{__proto__:null,...r(u.prototype,"writableCorked")},writableEnded:{__proto__:null,...r(u.prototype,"writableEnded")},writableNeedDrain:{__proto__:null,...r(u.prototype,"writableNeedDrain")},destroyed:{__proto__:null,get(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set(m){this._readableState&&this._writableState&&(this._readableState.destroyed=m,this._writableState.destroyed=m)}}});var c;function d(){return c===void 0&&(c={}),c}f.fromWeb=function(m,v){return d().newStreamDuplexFromReadableWritablePair(m,v)},f.toWeb=function(m){return d().newReadableWritablePairFromDuplex(m)};var p;f.from=function(m){return p||(p=hL()),p(m,"body")}}),vx=je((l,e)=>{ke(),Pe(),Me();var{ObjectSetPrototypeOf:t,Symbol:r}=Kt();e.exports=f;var{ERR_METHOD_NOT_IMPLEMENTED:n}=Cr().codes,s=En(),{getHighWaterMark:a}=$c();t(f.prototype,s.prototype),t(f,s);var u=r("kCallback");function f(p){if(!(this instanceof f))return new f(p);let m=p?a(this,p,"readableHighWaterMark",!0):null;m===0&&(p={...p,highWaterMark:null,readableHighWaterMark:m,writableHighWaterMark:p.writableHighWaterMark||0}),s.call(this,p),this._readableState.sync=!1,this[u]=null,p&&(typeof p.transform=="function"&&(this._transform=p.transform),typeof p.flush=="function"&&(this._flush=p.flush)),this.on("prefinish",d)}function c(p){typeof this._flush=="function"&&!this.destroyed?this._flush((m,v)=>{if(m){p?p(m):this.destroy(m);return}v!=null&&this.push(v),this.push(null),p&&p()}):(this.push(null),p&&p())}function d(){this._final!==c&&c.call(this)}f.prototype._final=c,f.prototype._transform=function(p,m,v){throw new n("_transform()")},f.prototype._write=function(p,m,v){let y=this._readableState,b=this._writableState,E=y.length;this._transform(p,m,(x,T)=>{if(x){v(x);return}T!=null&&this.push(T),b.ended||E===y.length||y.length<y.highWaterMark?v():this[u]=v})},f.prototype._read=function(){if(this[u]){let p=this[u];this[u]=null,p()}}}),bx=je((l,e)=>{ke(),Pe(),Me();var{ObjectSetPrototypeOf:t}=Kt();e.exports=n;var r=vx();t(n.prototype,r.prototype),t(n,r);function n(s){if(!(this instanceof n))return new n(s);r.call(this,s)}n.prototype._transform=function(s,a,u){u(null,s)}}),vm=je((l,e)=>{ke(),Pe(),Me();var t=Fs(),{ArrayIsArray:r,Promise:n,SymbolAsyncIterator:s,SymbolDispose:a}=Kt(),u=us(),{once:f}=Kr(),c=Va(),d=En(),{aggregateTwoErrors:p,codes:{ERR_INVALID_ARG_TYPE:m,ERR_INVALID_RETURN_VALUE:v,ERR_MISSING_ARGS:y,ERR_STREAM_DESTROYED:b,ERR_STREAM_PREMATURE_CLOSE:E},AbortError:x}=Cr(),{validateFunction:T,validateAbortSignal:A}=ul(),{isIterable:L,isReadable:w,isReadableNodeStream:C,isNodeStream:I,isTransformStream:O,isWebStream:B,isReadableStream:P,isReadableFinished:$}=xn(),F=globalThis.AbortController||Zo().AbortController,Z,X,q;function H(ne,Ee,se){let J=!1;ne.on("close",()=>{J=!0});let me=u(ne,{readable:Ee,writable:se},ce=>{J=!ce});return{destroy:ce=>{J||(J=!0,c.destroyer(ne,ce||new b("pipe")))},cleanup:me}}function K(ne){return T(ne[ne.length-1],"streams[stream.length - 1]"),ne.pop()}function z(ne){if(L(ne))return ne;if(C(ne))return ie(ne);throw new m("val",["Readable","Iterable","AsyncIterable"],ne)}async function*ie(ne){X||(X=Gc()),yield*X.prototype[s].call(ne)}async function Y(ne,Ee,se,{end:J}){let me,ce=null,he=Re=>{if(Re&&(me=Re),ce){let ee=ce;ce=null,ee()}},pe=()=>new n((Re,ee)=>{me?ee(me):ce=()=>{me?ee(me):Re()}});Ee.on("drain",he);let Fe=u(Ee,{readable:!1},he);try{Ee.writableNeedDrain&&await pe();for await(let Re of ne)Ee.write(Re)||await pe();J&&(Ee.end(),await pe()),se()}catch(Re){se(me!==Re?p(me,Re):Re)}finally{Fe(),Ee.off("drain",he)}}async function U(ne,Ee,se,{end:J}){O(Ee)&&(Ee=Ee.writable);let me=Ee.getWriter();try{for await(let ce of ne)await me.ready,me.write(ce).catch(()=>{});await me.ready,J&&await me.close(),se()}catch(ce){try{await me.abort(ce),se(ce)}catch(he){se(he)}}}function N(...ne){return W(ne,f(K(ne)))}function W(ne,Ee,se){if(ne.length===1&&r(ne[0])&&(ne=ne[0]),ne.length<2)throw new y("streams");let J=new F,me=J.signal,ce=se?.signal,he=[];A(ce,"options.signal");function pe(){Ce(new x)}q=q||Kr().addAbortListener;let Fe;ce&&(Fe=q(ce,pe));let Re,ee,te=[],ge=0;function Ie(Ke){Ce(Ke,--ge===0)}function Ce(Ke,Ae){var nt;if(Ke&&(!Re||Re.code==="ERR_STREAM_PREMATURE_CLOSE")&&(Re=Ke),!(!Re&&!Ae)){for(;te.length;)te.shift()(Re);(nt=Fe)===null||nt===void 0||nt[a](),J.abort(),Ae&&(Re||he.forEach(R=>R()),t.nextTick(Ee,Re,ee))}}let Ue;for(let Ke=0;Ke<ne.length;Ke++){let Ae=ne[Ke],nt=Ke<ne.length-1,R=Ke>0,D=nt||se?.end!==!1,j=Ke===ne.length-1;if(I(Ae)){let ae=function(ye){ye&&ye.name!=="AbortError"&&ye.code!=="ERR_STREAM_PREMATURE_CLOSE"&&Ie(ye)};if(D){let{destroy:ye,cleanup:De}=H(Ae,nt,R);te.push(ye),w(Ae)&&j&&he.push(De)}Ae.on("error",ae),w(Ae)&&j&&he.push(()=>{Ae.removeListener("error",ae)})}if(Ke===0)if(typeof Ae=="function"){if(Ue=Ae({signal:me}),!L(Ue))throw new v("Iterable, AsyncIterable or Stream","source",Ue)}else L(Ae)||C(Ae)||O(Ae)?Ue=Ae:Ue=d.from(Ae);else if(typeof Ae=="function"){if(O(Ue)){var le;Ue=z((le=Ue)===null||le===void 0?void 0:le.readable)}else Ue=z(Ue);if(Ue=Ae(Ue,{signal:me}),nt){if(!L(Ue,!0))throw new v("AsyncIterable",`transform[${Ke-1}]`,Ue)}else{var Ne;Z||(Z=bx());let ae=new Z({objectMode:!0}),ye=(Ne=Ue)===null||Ne===void 0?void 0:Ne.then;if(typeof ye=="function")ge++,ye.call(Ue,de=>{ee=de,de!=null&&ae.write(de),D&&ae.end(),t.nextTick(Ie)},de=>{ae.destroy(de),t.nextTick(Ie,de)});else if(L(Ue,!0))ge++,Y(Ue,ae,Ie,{end:D});else if(P(Ue)||O(Ue)){let de=Ue.readable||Ue;ge++,Y(de,ae,Ie,{end:D})}else throw new v("AsyncIterable or Promise","destination",Ue);Ue=ae;let{destroy:De,cleanup:ze}=H(Ue,!1,!0);te.push(De),j&&he.push(ze)}}else if(I(Ae)){if(C(Ue)){ge+=2;let ae=ue(Ue,Ae,Ie,{end:D});w(Ae)&&j&&he.push(ae)}else if(O(Ue)||P(Ue)){let ae=Ue.readable||Ue;ge++,Y(ae,Ae,Ie,{end:D})}else if(L(Ue))ge++,Y(Ue,Ae,Ie,{end:D});else throw new m("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],Ue);Ue=Ae}else if(B(Ae)){if(C(Ue))ge++,U(z(Ue),Ae,Ie,{end:D});else if(P(Ue)||L(Ue))ge++,U(Ue,Ae,Ie,{end:D});else if(O(Ue))ge++,U(Ue.readable,Ae,Ie,{end:D});else throw new m("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],Ue);Ue=Ae}else Ue=d.from(Ae)}return(me!=null&&me.aborted||ce!=null&&ce.aborted)&&t.nextTick(pe),Ue}function ue(ne,Ee,se,{end:J}){let me=!1;if(Ee.on("close",()=>{me||se(new E)}),ne.pipe(Ee,{end:!1}),J){let ce=function(){me=!0,Ee.end()};$(ne)?t.nextTick(ce):ne.once("end",ce)}else se();return u(ne,{readable:!0,writable:!1},ce=>{let he=ne._readableState;ce&&ce.code==="ERR_STREAM_PREMATURE_CLOSE"&&he&&he.ended&&!he.errored&&!he.errorEmitted?ne.once("end",se).once("error",se):se(ce)}),u(Ee,{readable:!1,writable:!0},se)}e.exports={pipelineImpl:W,pipeline:N}}),Ex=je((l,e)=>{ke(),Pe(),Me();var{pipeline:t}=vm(),r=En(),{destroyer:n}=Va(),{isNodeStream:s,isReadable:a,isWritable:u,isWebStream:f,isTransformStream:c,isWritableStream:d,isReadableStream:p}=xn(),{AbortError:m,codes:{ERR_INVALID_ARG_VALUE:v,ERR_MISSING_ARGS:y}}=Cr(),b=us();e.exports=function(...E){if(E.length===0)throw new y("streams");if(E.length===1)return r.from(E[0]);let x=[...E];if(typeof E[0]=="function"&&(E[0]=r.from(E[0])),typeof E[E.length-1]=="function"){let F=E.length-1;E[F]=r.from(E[F])}for(let F=0;F<E.length;++F)if(!(!s(E[F])&&!f(E[F]))){if(F<E.length-1&&!(a(E[F])||p(E[F])||c(E[F])))throw new v(`streams[${F}]`,x[F],"must be readable");if(F>0&&!(u(E[F])||d(E[F])||c(E[F])))throw new v(`streams[${F}]`,x[F],"must be writable")}let T,A,L,w,C;function I(F){let Z=w;w=null,Z?Z(F):F?C.destroy(F):!$&&!P&&C.destroy()}let O=E[0],B=t(E,I),P=!!(u(O)||d(O)||c(O)),$=!!(a(B)||p(B)||c(B));if(C=new r({writableObjectMode:!!(O!=null&&O.writableObjectMode),readableObjectMode:!!(B!=null&&B.readableObjectMode),writable:P,readable:$}),P){if(s(O))C._write=function(Z,X,q){O.write(Z,X)?q():T=q},C._final=function(Z){O.end(),A=Z},O.on("drain",function(){if(T){let Z=T;T=null,Z()}});else if(f(O)){let Z=(c(O)?O.writable:O).getWriter();C._write=async function(X,q,H){try{await Z.ready,Z.write(X).catch(()=>{}),H()}catch(K){H(K)}},C._final=async function(X){try{await Z.ready,Z.close().catch(()=>{}),A=X}catch(q){X(q)}}}let F=c(B)?B.readable:B;b(F,()=>{if(A){let Z=A;A=null,Z()}})}if($){if(s(B))B.on("readable",function(){if(L){let F=L;L=null,F()}}),B.on("end",function(){C.push(null)}),C._read=function(){for(;;){let F=B.read();if(F===null){L=C._read;return}if(!C.push(F))return}};else if(f(B)){let F=(c(B)?B.readable:B).getReader();C._read=async function(){for(;;)try{let{value:Z,done:X}=await F.read();if(!C.push(Z))return;if(X){C.push(null);return}}catch{return}}}}return C._destroy=function(F,Z){!F&&w!==null&&(F=new m),L=null,T=null,A=null,w===null?Z(F):(w=Z,s(B)&&n(B,F))},C}}),dL=je((l,e)=>{ke(),Pe(),Me();var t=globalThis.AbortController||Zo().AbortController,{codes:{ERR_INVALID_ARG_VALUE:r,ERR_INVALID_ARG_TYPE:n,ERR_MISSING_ARGS:s,ERR_OUT_OF_RANGE:a},AbortError:u}=Cr(),{validateAbortSignal:f,validateInteger:c,validateObject:d}=ul(),p=Kt().Symbol("kWeak"),m=Kt().Symbol("kResistStopPropagation"),{finished:v}=us(),y=Ex(),{addAbortSignalNoValidate:b}=jc(),{isWritable:E,isNodeStream:x}=xn(),{deprecate:T}=Kr(),{ArrayPrototypePush:A,Boolean:L,MathFloor:w,Number:C,NumberIsNaN:I,Promise:O,PromiseReject:B,PromiseResolve:P,PromisePrototypeThen:$,Symbol:F}=Kt(),Z=F("kEmpty"),X=F("kEof");function q(ce,he){if(he!=null&&d(he,"options"),he?.signal!=null&&f(he.signal,"options.signal"),x(ce)&&!E(ce))throw new r("stream",ce,"must be writable");let pe=y(this,ce);return he!=null&&he.signal&&b(he.signal,pe),pe}function H(ce,he){if(typeof ce!="function")throw new n("fn",["Function","AsyncFunction"],ce);he!=null&&d(he,"options"),he?.signal!=null&&f(he.signal,"options.signal");let pe=1;he?.concurrency!=null&&(pe=w(he.concurrency));let Fe=pe-1;return he?.highWaterMark!=null&&(Fe=w(he.highWaterMark)),c(pe,"options.concurrency",1),c(Fe,"options.highWaterMark",0),Fe+=pe,(async function*(){let Re=Kr().AbortSignalAny([he?.signal].filter(L)),ee=this,te=[],ge={signal:Re},Ie,Ce,Ue=!1,le=0;function Ne(){Ue=!0,Ke()}function Ke(){le-=1,Ae()}function Ae(){Ce&&!Ue&&le<pe&&te.length<Fe&&(Ce(),Ce=null)}async function nt(){try{for await(let R of ee){if(Ue)return;if(Re.aborted)throw new u;try{if(R=ce(R,ge),R===Z)continue;R=P(R)}catch(D){R=B(D)}le+=1,$(R,Ke,Ne),te.push(R),Ie&&(Ie(),Ie=null),!Ue&&(te.length>=Fe||le>=pe)&&await new O(D=>{Ce=D})}te.push(X)}catch(R){let D=B(R);$(D,Ke,Ne),te.push(D)}finally{Ue=!0,Ie&&(Ie(),Ie=null)}}nt();try{for(;;){for(;te.length>0;){let R=await te[0];if(R===X)return;if(Re.aborted)throw new u;R!==Z&&(yield R),te.shift(),Ae()}await new O(R=>{Ie=R})}}finally{Ue=!0,Ce&&(Ce(),Ce=null)}}).call(this)}function K(ce=void 0){return ce!=null&&d(ce,"options"),ce?.signal!=null&&f(ce.signal,"options.signal"),(async function*(){let he=0;for await(let Fe of this){var pe;if(ce!=null&&(pe=ce.signal)!==null&&pe!==void 0&&pe.aborted)throw new u({cause:ce.signal.reason});yield[he++,Fe]}}).call(this)}async function z(ce,he=void 0){for await(let pe of N.call(this,ce,he))return!0;return!1}async function ie(ce,he=void 0){if(typeof ce!="function")throw new n("fn",["Function","AsyncFunction"],ce);return!await z.call(this,async(...pe)=>!await ce(...pe),he)}async function Y(ce,he){for await(let pe of N.call(this,ce,he))return pe}async function U(ce,he){if(typeof ce!="function")throw new n("fn",["Function","AsyncFunction"],ce);async function pe(Fe,Re){return await ce(Fe,Re),Z}for await(let Fe of H.call(this,pe,he));}function N(ce,he){if(typeof ce!="function")throw new n("fn",["Function","AsyncFunction"],ce);async function pe(Fe,Re){return await ce(Fe,Re)?Fe:Z}return H.call(this,pe,he)}var W=class extends s{constructor(){super("reduce"),this.message="Reduce of an empty stream requires an initial value"}};async function ue(ce,he,pe){var Fe;if(typeof ce!="function")throw new n("reducer",["Function","AsyncFunction"],ce);pe!=null&&d(pe,"options"),pe?.signal!=null&&f(pe.signal,"options.signal");let Re=arguments.length>1;if(pe!=null&&(Fe=pe.signal)!==null&&Fe!==void 0&&Fe.aborted){let Ce=new u(void 0,{cause:pe.signal.reason});throw this.once("error",()=>{}),await v(this.destroy(Ce)),Ce}let ee=new t,te=ee.signal;if(pe!=null&&pe.signal){let Ce={once:!0,[p]:this,[m]:!0};pe.signal.addEventListener("abort",()=>ee.abort(),Ce)}let ge=!1;try{for await(let Ce of this){var Ie;if(ge=!0,pe!=null&&(Ie=pe.signal)!==null&&Ie!==void 0&&Ie.aborted)throw new u;Re?he=await ce(he,Ce,{signal:te}):(he=Ce,Re=!0)}if(!ge&&!Re)throw new W}finally{ee.abort()}return he}async function ne(ce){ce!=null&&d(ce,"options"),ce?.signal!=null&&f(ce.signal,"options.signal");let he=[];for await(let Fe of this){var pe;if(ce!=null&&(pe=ce.signal)!==null&&pe!==void 0&&pe.aborted)throw new u(void 0,{cause:ce.signal.reason});A(he,Fe)}return he}function Ee(ce,he){let pe=H.call(this,ce,he);return(async function*(){for await(let Fe of pe)yield*Fe}).call(this)}function se(ce){if(ce=C(ce),I(ce))return 0;if(ce<0)throw new a("number",">= 0",ce);return ce}function J(ce,he=void 0){return he!=null&&d(he,"options"),he?.signal!=null&&f(he.signal,"options.signal"),ce=se(ce),(async function*(){var pe;if(he!=null&&(pe=he.signal)!==null&&pe!==void 0&&pe.aborted)throw new u;for await(let Re of this){var Fe;if(he!=null&&(Fe=he.signal)!==null&&Fe!==void 0&&Fe.aborted)throw new u;ce--<=0&&(yield Re)}}).call(this)}function me(ce,he=void 0){return he!=null&&d(he,"options"),he?.signal!=null&&f(he.signal,"options.signal"),ce=se(ce),(async function*(){var pe;if(he!=null&&(pe=he.signal)!==null&&pe!==void 0&&pe.aborted)throw new u;for await(let Re of this){var Fe;if(he!=null&&(Fe=he.signal)!==null&&Fe!==void 0&&Fe.aborted)throw new u;if(ce-- >0&&(yield Re),ce<=0)return}}).call(this)}e.exports.streamReturningOperators={asIndexedPairs:T(K,"readable.asIndexedPairs will be removed in a future version."),drop:J,filter:N,flatMap:Ee,map:H,take:me,compose:q},e.exports.promiseReturningOperators={every:ie,forEach:U,reduce:ue,toArray:ne,some:z,find:Y}}),Sx=je((l,e)=>{ke(),Pe(),Me();var{ArrayPrototypePop:t,Promise:r}=Kt(),{isIterable:n,isNodeStream:s,isWebStream:a}=xn(),{pipelineImpl:u}=vm(),{finished:f}=us();Tx();function c(...d){return new r((p,m)=>{let v,y,b=d[d.length-1];if(b&&typeof b=="object"&&!s(b)&&!n(b)&&!a(b)){let E=t(d);v=E.signal,y=E.end}u(d,(E,x)=>{E?m(E):p(x)},{signal:v,end:y})})}e.exports={finished:f,pipeline:c}}),Tx=je((l,e)=>{ke(),Pe(),Me();var{Buffer:t}=(hr(),Ct(fr)),{ObjectDefineProperty:r,ObjectKeys:n,ReflectApply:s}=Kt(),{promisify:{custom:a}}=Kr(),{streamReturningOperators:u,promiseReturningOperators:f}=dL(),{codes:{ERR_ILLEGAL_CONSTRUCTOR:c}}=Cr(),d=Ex(),{setDefaultHighWaterMark:p,getDefaultHighWaterMark:m}=$c(),{pipeline:v}=vm(),{destroyer:y}=Va(),b=us(),E=Sx(),x=xn(),T=e.exports=mm().Stream;T.isDestroyed=x.isDestroyed,T.isDisturbed=x.isDisturbed,T.isErrored=x.isErrored,T.isReadable=x.isReadable,T.isWritable=x.isWritable,T.Readable=Gc();for(let L of n(u)){let w=function(...I){if(new.target)throw c();return T.Readable.from(s(C,this,I))},C=u[L];r(w,"name",{__proto__:null,value:C.name}),r(w,"length",{__proto__:null,value:C.length}),r(T.Readable.prototype,L,{__proto__:null,value:w,enumerable:!1,configurable:!0,writable:!0})}for(let L of n(f)){let w=function(...I){if(new.target)throw c();return s(C,this,I)},C=f[L];r(w,"name",{__proto__:null,value:C.name}),r(w,"length",{__proto__:null,value:C.length}),r(T.Readable.prototype,L,{__proto__:null,value:w,enumerable:!1,configurable:!0,writable:!0})}T.Writable=ym(),T.Duplex=En(),T.Transform=vx(),T.PassThrough=bx(),T.pipeline=v;var{addAbortSignal:A}=jc();T.addAbortSignal=A,T.finished=b,T.destroy=y,T.compose=d,T.setDefaultHighWaterMark=p,T.getDefaultHighWaterMark=m,r(T,"promises",{__proto__:null,configurable:!0,enumerable:!0,get(){return E}}),r(v,a,{__proto__:null,enumerable:!0,get(){return E.pipeline}}),r(b,a,{__proto__:null,enumerable:!0,get(){return E.finished}}),T.Stream=T,T._isUint8Array=function(L){return L instanceof Uint8Array},T._uint8ArrayToBuffer=function(L){return t.from(L.buffer,L.byteOffset,L.byteLength)}}),js=je((l,e)=>{ke(),Pe(),Me();var t=Tx(),r=Sx(),n=t.Readable.destroy;e.exports=t.Readable,e.exports._uint8ArrayToBuffer=t._uint8ArrayToBuffer,e.exports._isUint8Array=t._isUint8Array,e.exports.isDisturbed=t.isDisturbed,e.exports.isErrored=t.isErrored,e.exports.isReadable=t.isReadable,e.exports.Readable=t.Readable,e.exports.Writable=t.Writable,e.exports.Duplex=t.Duplex,e.exports.Transform=t.Transform,e.exports.PassThrough=t.PassThrough,e.exports.addAbortSignal=t.addAbortSignal,e.exports.finished=t.finished,e.exports.destroy=t.destroy,e.exports.destroy=n,e.exports.pipeline=t.pipeline,e.exports.compose=t.compose,Object.defineProperty(t,"promises",{configurable:!0,enumerable:!0,get(){return r}}),e.exports.Stream=t.Stream,e.exports.default=e.exports}),pL=je((l,e)=>{ke(),Pe(),Me(),typeof Object.create=="function"?e.exports=function(t,r){r&&(t.super_=r,t.prototype=Object.create(r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(t,r){if(r){t.super_=r;var n=function(){};n.prototype=r.prototype,t.prototype=new n,t.prototype.constructor=t}}}),gL=je((l,e)=>{ke(),Pe(),Me();var{Buffer:t}=(hr(),Ct(fr)),r=Symbol.for("BufferList");function n(s){if(!(this instanceof n))return new n(s);n._init.call(this,s)}n._init=function(s){Object.defineProperty(this,r,{value:!0}),this._bufs=[],this.length=0,s&&this.append(s)},n.prototype._new=function(s){return new n(s)},n.prototype._offset=function(s){if(s===0)return[0,0];let a=0;for(let u=0;u<this._bufs.length;u++){let f=a+this._bufs[u].length;if(s<f||u===this._bufs.length-1)return[u,s-a];a=f}},n.prototype._reverseOffset=function(s){let a=s[0],u=s[1];for(let f=0;f<a;f++)u+=this._bufs[f].length;return u},n.prototype.getBuffers=function(){return this._bufs},n.prototype.get=function(s){if(s>this.length||s<0)return;let a=this._offset(s);return this._bufs[a[0]][a[1]]},n.prototype.slice=function(s,a){return typeof s=="number"&&s<0&&(s+=this.length),typeof a=="number"&&a<0&&(a+=this.length),this.copy(null,0,s,a)},n.prototype.copy=function(s,a,u,f){if((typeof u!="number"||u<0)&&(u=0),(typeof f!="number"||f>this.length)&&(f=this.length),u>=this.length||f<=0)return s||t.alloc(0);let c=!!s,d=this._offset(u),p=f-u,m=p,v=c&&a||0,y=d[1];if(u===0&&f===this.length){if(!c)return this._bufs.length===1?this._bufs[0]:t.concat(this._bufs,this.length);for(let b=0;b<this._bufs.length;b++)this._bufs[b].copy(s,v),v+=this._bufs[b].length;return s}if(m<=this._bufs[d[0]].length-y)return c?this._bufs[d[0]].copy(s,a,y,y+m):this._bufs[d[0]].slice(y,y+m);c||(s=t.allocUnsafe(p));for(let b=d[0];b<this._bufs.length;b++){let E=this._bufs[b].length-y;if(m>E)this._bufs[b].copy(s,v,y),v+=E;else{this._bufs[b].copy(s,v,y,y+m),v+=E;break}m-=E,y&&(y=0)}return s.length>v?s.slice(0,v):s},n.prototype.shallowSlice=function(s,a){if(s=s||0,a=typeof a!="number"?this.length:a,s<0&&(s+=this.length),a<0&&(a+=this.length),s===a)return this._new();let u=this._offset(s),f=this._offset(a),c=this._bufs.slice(u[0],f[0]+1);return f[1]===0?c.pop():c[c.length-1]=c[c.length-1].slice(0,f[1]),u[1]!==0&&(c[0]=c[0].slice(u[1])),this._new(c)},n.prototype.toString=function(s,a,u){return this.slice(a,u).toString(s)},n.prototype.consume=function(s){if(s=Math.trunc(s),Number.isNaN(s)||s<=0)return this;for(;this._bufs.length;)if(s>=this._bufs[0].length)s-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift();else{this._bufs[0]=this._bufs[0].slice(s),this.length-=s;break}return this},n.prototype.duplicate=function(){let s=this._new();for(let a=0;a<this._bufs.length;a++)s.append(this._bufs[a]);return s},n.prototype.append=function(s){return this._attach(s,n.prototype._appendBuffer)},n.prototype.prepend=function(s){return this._attach(s,n.prototype._prependBuffer,!0)},n.prototype._attach=function(s,a,u){if(s==null)return this;if(s.buffer)a.call(this,t.from(s.buffer,s.byteOffset,s.byteLength));else if(Array.isArray(s)){let[f,c]=u?[s.length-1,-1]:[0,1];for(let d=f;d>=0&&d<s.length;d+=c)this._attach(s[d],a,u)}else if(this._isBufferList(s)){let[f,c]=u?[s._bufs.length-1,-1]:[0,1];for(let d=f;d>=0&&d<s._bufs.length;d+=c)this._attach(s._bufs[d],a,u)}else typeof s=="number"&&(s=s.toString()),a.call(this,t.from(s));return this},n.prototype._appendBuffer=function(s){this._bufs.push(s),this.length+=s.length},n.prototype._prependBuffer=function(s){this._bufs.unshift(s),this.length+=s.length},n.prototype.indexOf=function(s,a,u){if(u===void 0&&typeof a=="string"&&(u=a,a=void 0),typeof s=="function"||Array.isArray(s))throw new TypeError('The "value" argument must be one of type string, Buffer, BufferList, or Uint8Array.');if(typeof s=="number"?s=t.from([s]):typeof s=="string"?s=t.from(s,u):this._isBufferList(s)?s=s.slice():Array.isArray(s.buffer)?s=t.from(s.buffer,s.byteOffset,s.byteLength):t.isBuffer(s)||(s=t.from(s)),a=Number(a||0),isNaN(a)&&(a=0),a<0&&(a=this.length+a),a<0&&(a=0),s.length===0)return a>this.length?this.length:a;let f=this._offset(a),c=f[0],d=f[1];for(;c<this._bufs.length;c++){let p=this._bufs[c];for(;d<p.length;)if(p.length-d>=s.length){let m=p.indexOf(s,d);if(m!==-1)return this._reverseOffset([c,m]);d=p.length-s.length+1}else{let m=this._reverseOffset([c,d]);if(this._match(m,s))return m;d++}d=0}return-1},n.prototype._match=function(s,a){if(this.length-s<a.length)return!1;for(let u=0;u<a.length;u++)if(this.get(s+u)!==a[u])return!1;return!0},(function(){let s={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readBigInt64BE:8,readBigInt64LE:8,readBigUInt64BE:8,readBigUInt64LE:8,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1,readIntBE:null,readIntLE:null,readUIntBE:null,readUIntLE:null};for(let a in s)(function(u){s[u]===null?n.prototype[u]=function(f,c){return this.slice(f,f+c)[u](0,c)}:n.prototype[u]=function(f=0){return this.slice(f,f+s[u])[u](0)}})(a)})(),n.prototype._isBufferList=function(s){return s instanceof n||n.isBufferList(s)},n.isBufferList=function(s){return s!=null&&s[r]},e.exports=n}),mL=je((l,e)=>{ke(),Pe(),Me();var t=js().Duplex,r=pL(),n=gL();function s(a){if(!(this instanceof s))return new s(a);if(typeof a=="function"){this._callback=a;let u=(function(f){this._callback&&(this._callback(f),this._callback=null)}).bind(this);this.on("pipe",function(f){f.on("error",u)}),this.on("unpipe",function(f){f.removeListener("error",u)}),a=null}n._init.call(this,a),t.call(this)}r(s,t),Object.assign(s.prototype,n.prototype),s.prototype._new=function(a){return new s(a)},s.prototype._write=function(a,u,f){this._appendBuffer(a),typeof f=="function"&&f()},s.prototype._read=function(a){if(!this.length)return this.push(null);a=Math.min(a,this.length),this.push(this.slice(0,a)),this.consume(a)},s.prototype.end=function(a){t.prototype.end.call(this,a),this._callback&&(this._callback(null,this.slice()),this._callback=null)},s.prototype._destroy=function(a,u){this._bufs.length=0,this.length=0,u(a)},s.prototype._isBufferList=function(a){return a instanceof s||a instanceof n||s.isBufferList(a)},s.isBufferList=n.isBufferList,e.exports=s,e.exports.BufferListStream=s,e.exports.BufferList=n}),yL=je((l,e)=>{ke(),Pe(),Me();var t=class{constructor(){this.cmd=null,this.retain=!1,this.qos=0,this.dup=!1,this.length=-1,this.topic=null,this.payload=null}};e.exports=t}),xx=je((l,e)=>{ke(),Pe(),Me();var t=e.exports,{Buffer:r}=(hr(),Ct(fr));t.types={0:"reserved",1:"connect",2:"connack",3:"publish",4:"puback",5:"pubrec",6:"pubrel",7:"pubcomp",8:"subscribe",9:"suback",10:"unsubscribe",11:"unsuback",12:"pingreq",13:"pingresp",14:"disconnect",15:"auth"},t.requiredHeaderFlags={1:0,2:0,4:0,5:0,6:2,7:0,8:2,9:0,10:2,11:0,12:0,13:0,14:0,15:0},t.requiredHeaderFlagsErrors={};for(let s in t.requiredHeaderFlags){let a=t.requiredHeaderFlags[s];t.requiredHeaderFlagsErrors[s]="Invalid header flag bits, must be 0x"+a.toString(16)+" for "+t.types[s]+" packet"}t.codes={};for(let s in t.types){let a=t.types[s];t.codes[a]=s}t.CMD_SHIFT=4,t.CMD_MASK=240,t.DUP_MASK=8,t.QOS_MASK=3,t.QOS_SHIFT=1,t.RETAIN_MASK=1,t.VARBYTEINT_MASK=127,t.VARBYTEINT_FIN_MASK=128,t.VARBYTEINT_MAX=268435455,t.SESSIONPRESENT_MASK=1,t.SESSIONPRESENT_HEADER=r.from([t.SESSIONPRESENT_MASK]),t.CONNACK_HEADER=r.from([t.codes.connack<<t.CMD_SHIFT]),t.USERNAME_MASK=128,t.PASSWORD_MASK=64,t.WILL_RETAIN_MASK=32,t.WILL_QOS_MASK=24,t.WILL_QOS_SHIFT=3,t.WILL_FLAG_MASK=4,t.CLEAN_SESSION_MASK=2,t.CONNECT_HEADER=r.from([t.codes.connect<<t.CMD_SHIFT]),t.properties={sessionExpiryInterval:17,willDelayInterval:24,receiveMaximum:33,maximumPacketSize:39,topicAliasMaximum:34,requestResponseInformation:25,requestProblemInformation:23,userProperties:38,authenticationMethod:21,authenticationData:22,payloadFormatIndicator:1,messageExpiryInterval:2,contentType:3,responseTopic:8,correlationData:9,maximumQoS:36,retainAvailable:37,assignedClientIdentifier:18,reasonString:31,wildcardSubscriptionAvailable:40,subscriptionIdentifiersAvailable:41,sharedSubscriptionAvailable:42,serverKeepAlive:19,responseInformation:26,serverReference:28,topicAlias:35,subscriptionIdentifier:11},t.propertiesCodes={};for(let s in t.properties){let a=t.properties[s];t.propertiesCodes[a]=s}t.propertiesTypes={sessionExpiryInterval:"int32",willDelayInterval:"int32",receiveMaximum:"int16",maximumPacketSize:"int32",topicAliasMaximum:"int16",requestResponseInformation:"byte",requestProblemInformation:"byte",userProperties:"pair",authenticationMethod:"string",authenticationData:"binary",payloadFormatIndicator:"byte",messageExpiryInterval:"int32",contentType:"string",responseTopic:"string",correlationData:"binary",maximumQoS:"int8",retainAvailable:"byte",assignedClientIdentifier:"string",reasonString:"string",wildcardSubscriptionAvailable:"byte",subscriptionIdentifiersAvailable:"byte",sharedSubscriptionAvailable:"byte",serverKeepAlive:"int16",responseInformation:"string",serverReference:"string",topicAlias:"int16",subscriptionIdentifier:"var"};function n(s){return[0,1,2].map(a=>[0,1].map(u=>[0,1].map(f=>{let c=r.alloc(1);return c.writeUInt8(t.codes[s]<<t.CMD_SHIFT|(u?t.DUP_MASK:0)|a<<t.QOS_SHIFT|f,0,!0),c})))}t.PUBLISH_HEADER=n("publish"),t.SUBSCRIBE_HEADER=n("subscribe"),t.SUBSCRIBE_OPTIONS_QOS_MASK=3,t.SUBSCRIBE_OPTIONS_NL_MASK=1,t.SUBSCRIBE_OPTIONS_NL_SHIFT=2,t.SUBSCRIBE_OPTIONS_RAP_MASK=1,t.SUBSCRIBE_OPTIONS_RAP_SHIFT=3,t.SUBSCRIBE_OPTIONS_RH_MASK=3,t.SUBSCRIBE_OPTIONS_RH_SHIFT=4,t.SUBSCRIBE_OPTIONS_RH=[0,16,32],t.SUBSCRIBE_OPTIONS_NL=4,t.SUBSCRIBE_OPTIONS_RAP=8,t.SUBSCRIBE_OPTIONS_QOS=[0,1,2],t.UNSUBSCRIBE_HEADER=n("unsubscribe"),t.ACKS={unsuback:n("unsuback"),puback:n("puback"),pubcomp:n("pubcomp"),pubrel:n("pubrel"),pubrec:n("pubrec")},t.SUBACK_HEADER=r.from([t.codes.suback<<t.CMD_SHIFT]),t.VERSION3=r.from([3]),t.VERSION4=r.from([4]),t.VERSION5=r.from([5]),t.VERSION131=r.from([131]),t.VERSION132=r.from([132]),t.QOS=[0,1,2].map(s=>r.from([s])),t.EMPTY={pingreq:r.from([t.codes.pingreq<<4,0]),pingresp:r.from([t.codes.pingresp<<4,0]),disconnect:r.from([t.codes.disconnect<<4,0])},t.MQTT5_PUBACK_PUBREC_CODES={0:"Success",16:"No matching subscribers",128:"Unspecified error",131:"Implementation specific error",135:"Not authorized",144:"Topic Name invalid",145:"Packet identifier in use",151:"Quota exceeded",153:"Payload format invalid"},t.MQTT5_PUBREL_PUBCOMP_CODES={0:"Success",146:"Packet Identifier not found"},t.MQTT5_SUBACK_CODES={0:"Granted QoS 0",1:"Granted QoS 1",2:"Granted QoS 2",128:"Unspecified error",131:"Implementation specific error",135:"Not authorized",143:"Topic Filter invalid",145:"Packet Identifier in use",151:"Quota exceeded",158:"Shared Subscriptions not supported",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"},t.MQTT5_UNSUBACK_CODES={0:"Success",17:"No subscription existed",128:"Unspecified error",131:"Implementation specific error",135:"Not authorized",143:"Topic Filter invalid",145:"Packet Identifier in use"},t.MQTT5_DISCONNECT_CODES={0:"Normal disconnection",4:"Disconnect with Will Message",128:"Unspecified error",129:"Malformed Packet",130:"Protocol Error",131:"Implementation specific error",135:"Not authorized",137:"Server busy",139:"Server shutting down",141:"Keep Alive timeout",142:"Session taken over",143:"Topic Filter invalid",144:"Topic Name invalid",147:"Receive Maximum exceeded",148:"Topic Alias invalid",149:"Packet too large",150:"Message rate too high",151:"Quota exceeded",152:"Administrative action",153:"Payload format invalid",154:"Retain not supported",155:"QoS not supported",156:"Use another server",157:"Server moved",158:"Shared Subscriptions not supported",159:"Connection rate exceeded",160:"Maximum connect time",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"},t.MQTT5_AUTH_CODES={0:"Success",24:"Continue authentication",25:"Re-authenticate"}}),vL=je((l,e)=>{ke(),Pe(),Me();var t=1e3,r=t*60,n=r*60,s=n*24,a=s*7,u=s*365.25;e.exports=function(m,v){v=v||{};var y=typeof m;if(y==="string"&&m.length>0)return f(m);if(y==="number"&&isFinite(m))return v.long?d(m):c(m);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(m))};function f(m){if(m=String(m),!(m.length>100)){var v=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(m);if(v){var y=parseFloat(v[1]),b=(v[2]||"ms").toLowerCase();switch(b){case"years":case"year":case"yrs":case"yr":case"y":return y*u;case"weeks":case"week":case"w":return y*a;case"days":case"day":case"d":return y*s;case"hours":case"hour":case"hrs":case"hr":case"h":return y*n;case"minutes":case"minute":case"mins":case"min":case"m":return y*r;case"seconds":case"second":case"secs":case"sec":case"s":return y*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return y;default:return}}}}function c(m){var v=Math.abs(m);return v>=s?Math.round(m/s)+"d":v>=n?Math.round(m/n)+"h":v>=r?Math.round(m/r)+"m":v>=t?Math.round(m/t)+"s":m+"ms"}function d(m){var v=Math.abs(m);return v>=s?p(m,v,s,"day"):v>=n?p(m,v,n,"hour"):v>=r?p(m,v,r,"minute"):v>=t?p(m,v,t,"second"):m+" ms"}function p(m,v,y,b){var E=v>=y*1.5;return Math.round(m/y)+" "+b+(E?"s":"")}}),bL=je((l,e)=>{ke(),Pe(),Me();function t(r){s.debug=s,s.default=s,s.coerce=p,s.disable=c,s.enable=u,s.enabled=d,s.humanize=vL(),s.destroy=m,Object.keys(r).forEach(v=>{s[v]=r[v]}),s.names=[],s.skips=[],s.formatters={};function n(v){let y=0;for(let b=0;b<v.length;b++)y=(y<<5)-y+v.charCodeAt(b),y|=0;return s.colors[Math.abs(y)%s.colors.length]}s.selectColor=n;function s(v){let y,b=null,E,x;function T(...A){if(!T.enabled)return;let L=T,w=Number(new Date),C=w-(y||w);L.diff=C,L.prev=y,L.curr=w,y=w,A[0]=s.coerce(A[0]),typeof A[0]!="string"&&A.unshift("%O");let I=0;A[0]=A[0].replace(/%([a-zA-Z%])/g,(O,B)=>{if(O==="%%")return"%";I++;let P=s.formatters[B];if(typeof P=="function"){let $=A[I];O=P.call(L,$),A.splice(I,1),I--}return O}),s.formatArgs.call(L,A),(L.log||s.log).apply(L,A)}return T.namespace=v,T.useColors=s.useColors(),T.color=s.selectColor(v),T.extend=a,T.destroy=s.destroy,Object.defineProperty(T,"enabled",{enumerable:!0,configurable:!1,get:()=>b!==null?b:(E!==s.namespaces&&(E=s.namespaces,x=s.enabled(v)),x),set:A=>{b=A}}),typeof s.init=="function"&&s.init(T),T}function a(v,y){let b=s(this.namespace+(typeof y>"u"?":":y)+v);return b.log=this.log,b}function u(v){s.save(v),s.namespaces=v,s.names=[],s.skips=[];let y=(typeof v=="string"?v:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(let b of y)b[0]==="-"?s.skips.push(b.slice(1)):s.names.push(b)}function f(v,y){let b=0,E=0,x=-1,T=0;for(;b<v.length;)if(E<y.length&&(y[E]===v[b]||y[E]==="*"))y[E]==="*"?(x=E,T=b,E++):(b++,E++);else if(x!==-1)E=x+1,T++,b=T;else return!1;for(;E<y.length&&y[E]==="*";)E++;return E===y.length}function c(){let v=[...s.names,...s.skips.map(y=>"-"+y)].join(",");return s.enable(""),v}function d(v){for(let y of s.skips)if(f(v,y))return!1;for(let y of s.names)if(f(v,y))return!0;return!1}function p(v){return v instanceof Error?v.stack||v.message:v}function m(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return s.enable(s.load()),s}e.exports=t}),Sn=je((l,e)=>{ke(),Pe(),Me(),l.formatArgs=r,l.save=n,l.load=s,l.useColors=t,l.storage=a(),l.destroy=(()=>{let f=!1;return()=>{f||(f=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),l.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let f;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(f=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(f[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function r(f){if(f[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+f[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;let c="color: "+this.color;f.splice(1,0,c,"color: inherit");let d=0,p=0;f[0].replace(/%[a-zA-Z%]/g,m=>{m!=="%%"&&(d++,m==="%c"&&(p=d))}),f.splice(p,0,c)}l.log=console.debug||console.log||(()=>{});function n(f){try{f?l.storage.setItem("debug",f):l.storage.removeItem("debug")}catch{}}function s(){let f;try{f=l.storage.getItem("debug")||l.storage.getItem("DEBUG")}catch{}return!f&&typeof Mt<"u"&&"env"in Mt&&(f=Mt.env.DEBUG),f}function a(){try{return localStorage}catch{}}e.exports=bL()(l);var{formatters:u}=e.exports;u.j=function(f){try{return JSON.stringify(f)}catch(c){return"[UnexpectedJSONParseError]: "+c.message}}}),EL=je((l,e)=>{ke(),Pe(),Me();var t=mL(),{EventEmitter:r}=(Bs(),Ct(ls)),n=yL(),s=xx(),a=Sn()("mqtt-packet:parser"),u=class Jp extends r{constructor(){super(),this.parser=this.constructor.parser}static parser(c){return this instanceof Jp?(this.settings=c||{},this._states=["_parseHeader","_parseLength","_parsePayload","_newPacket"],this._resetState(),this):new Jp().parser(c)}_resetState(){a("_resetState: resetting packet, error, _list, and _stateCounter"),this.packet=new n,this.error=null,this._list=t(),this._stateCounter=0}parse(c){for(this.error&&this._resetState(),this._list.append(c),a("parse: current state: %s",this._states[this._stateCounter]);(this.packet.length!==-1||this._list.length>0)&&this[this._states[this._stateCounter]]()&&!this.error;)this._stateCounter++,a("parse: state complete. _stateCounter is now: %d",this._stateCounter),a("parse: packet.length: %d, buffer list length: %d",this.packet.length,this._list.length),this._stateCounter>=this._states.length&&(this._stateCounter=0);return a("parse: exited while loop. packet: %d, buffer list length: %d",this.packet.length,this._list.length),this._list.length}_parseHeader(){let c=this._list.readUInt8(0),d=c>>s.CMD_SHIFT;this.packet.cmd=s.types[d];let p=c&15,m=s.requiredHeaderFlags[d];return m!=null&&p!==m?this._emitError(new Error(s.requiredHeaderFlagsErrors[d])):(this.packet.retain=(c&s.RETAIN_MASK)!==0,this.packet.qos=c>>s.QOS_SHIFT&s.QOS_MASK,this.packet.qos>2?this._emitError(new Error("Packet must not have both QoS bits set to 1")):(this.packet.dup=(c&s.DUP_MASK)!==0,a("_parseHeader: packet: %o",this.packet),this._list.consume(1),!0))}_parseLength(){let c=this._parseVarByteNum(!0);return c&&(this.packet.length=c.value,this._list.consume(c.bytes)),a("_parseLength %d",c.value),!!c}_parsePayload(){a("_parsePayload: payload %O",this._list);let c=!1;if(this.packet.length===0||this._list.length>=this.packet.length){switch(this._pos=0,this.packet.cmd){case"connect":this._parseConnect();break;case"connack":this._parseConnack();break;case"publish":this._parsePublish();break;case"puback":case"pubrec":case"pubrel":case"pubcomp":this._parseConfirmation();break;case"subscribe":this._parseSubscribe();break;case"suback":this._parseSuback();break;case"unsubscribe":this._parseUnsubscribe();break;case"unsuback":this._parseUnsuback();break;case"pingreq":case"pingresp":break;case"disconnect":this._parseDisconnect();break;case"auth":this._parseAuth();break;default:this._emitError(new Error("Not supported"))}c=!0}return a("_parsePayload complete result: %s",c),c}_parseConnect(){a("_parseConnect");let c,d,p,m,v={},y=this.packet,b=this._parseString();if(b===null)return this._emitError(new Error("Cannot parse protocolId"));if(b!=="MQTT"&&b!=="MQIsdp")return this._emitError(new Error("Invalid protocolId"));if(y.protocolId=b,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(y.protocolVersion=this._list.readUInt8(this._pos),y.protocolVersion>=128&&(y.bridgeMode=!0,y.protocolVersion=y.protocolVersion-128),y.protocolVersion!==3&&y.protocolVersion!==4&&y.protocolVersion!==5)return this._emitError(new Error("Invalid protocol version"));if(this._pos++,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(this._list.readUInt8(this._pos)&1)return this._emitError(new Error("Connect flag bit 0 must be 0, but got 1"));v.username=this._list.readUInt8(this._pos)&s.USERNAME_MASK,v.password=this._list.readUInt8(this._pos)&s.PASSWORD_MASK,v.will=this._list.readUInt8(this._pos)&s.WILL_FLAG_MASK;let E=!!(this._list.readUInt8(this._pos)&s.WILL_RETAIN_MASK),x=(this._list.readUInt8(this._pos)&s.WILL_QOS_MASK)>>s.WILL_QOS_SHIFT;if(v.will)y.will={},y.will.retain=E,y.will.qos=x;else{if(E)return this._emitError(new Error("Will Retain Flag must be set to zero when Will Flag is set to 0"));if(x)return this._emitError(new Error("Will QoS must be set to zero when Will Flag is set to 0"))}if(y.clean=(this._list.readUInt8(this._pos)&s.CLEAN_SESSION_MASK)!==0,this._pos++,y.keepalive=this._parseNum(),y.keepalive===-1)return this._emitError(new Error("Packet too short"));if(y.protocolVersion===5){let A=this._parseProperties();Object.getOwnPropertyNames(A).length&&(y.properties=A)}let T=this._parseString();if(T===null)return this._emitError(new Error("Packet too short"));if(y.clientId=T,a("_parseConnect: packet.clientId: %s",y.clientId),v.will){if(y.protocolVersion===5){let A=this._parseProperties();Object.getOwnPropertyNames(A).length&&(y.will.properties=A)}if(c=this._parseString(),c===null)return this._emitError(new Error("Cannot parse will topic"));if(y.will.topic=c,a("_parseConnect: packet.will.topic: %s",y.will.topic),d=this._parseBuffer(),d===null)return this._emitError(new Error("Cannot parse will payload"));y.will.payload=d,a("_parseConnect: packet.will.paylaod: %s",y.will.payload)}if(v.username){if(m=this._parseString(),m===null)return this._emitError(new Error("Cannot parse username"));y.username=m,a("_parseConnect: packet.username: %s",y.username)}if(v.password){if(p=this._parseBuffer(),p===null)return this._emitError(new Error("Cannot parse password"));y.password=p}return this.settings=y,a("_parseConnect: complete"),y}_parseConnack(){a("_parseConnack");let c=this.packet;if(this._list.length<1)return null;let d=this._list.readUInt8(this._pos++);if(d>1)return this._emitError(new Error("Invalid connack flags, bits 7-1 must be set to 0"));if(c.sessionPresent=!!(d&s.SESSIONPRESENT_MASK),this.settings.protocolVersion===5)this._list.length>=2?c.reasonCode=this._list.readUInt8(this._pos++):c.reasonCode=0;else{if(this._list.length<2)return null;c.returnCode=this._list.readUInt8(this._pos++)}if(c.returnCode===-1||c.reasonCode===-1)return this._emitError(new Error("Cannot parse return code"));if(this.settings.protocolVersion===5){let p=this._parseProperties();Object.getOwnPropertyNames(p).length&&(c.properties=p)}a("_parseConnack: complete")}_parsePublish(){a("_parsePublish");let c=this.packet;if(c.topic=this._parseString(),c.topic===null)return this._emitError(new Error("Cannot parse topic"));if(!(c.qos>0&&!this._parseMessageId())){if(this.settings.protocolVersion===5){let d=this._parseProperties();Object.getOwnPropertyNames(d).length&&(c.properties=d)}c.payload=this._list.slice(this._pos,c.length),a("_parsePublish: payload from buffer list: %o",c.payload)}}_parseSubscribe(){a("_parseSubscribe");let c=this.packet,d,p,m,v,y,b,E;if(c.subscriptions=[],!!this._parseMessageId()){if(this.settings.protocolVersion===5){let x=this._parseProperties();Object.getOwnPropertyNames(x).length&&(c.properties=x)}if(c.length<=0)return this._emitError(new Error("Malformed subscribe, no payload specified"));for(;this._pos<c.length;){if(d=this._parseString(),d===null)return this._emitError(new Error("Cannot parse topic"));if(this._pos>=c.length)return this._emitError(new Error("Malformed Subscribe Payload"));if(p=this._parseByte(),this.settings.protocolVersion===5){if(p&192)return this._emitError(new Error("Invalid subscribe topic flag bits, bits 7-6 must be 0"))}else if(p&252)return this._emitError(new Error("Invalid subscribe topic flag bits, bits 7-2 must be 0"));if(m=p&s.SUBSCRIBE_OPTIONS_QOS_MASK,m>2)return this._emitError(new Error("Invalid subscribe QoS, must be <= 2"));if(b=(p>>s.SUBSCRIBE_OPTIONS_NL_SHIFT&s.SUBSCRIBE_OPTIONS_NL_MASK)!==0,y=(p>>s.SUBSCRIBE_OPTIONS_RAP_SHIFT&s.SUBSCRIBE_OPTIONS_RAP_MASK)!==0,v=p>>s.SUBSCRIBE_OPTIONS_RH_SHIFT&s.SUBSCRIBE_OPTIONS_RH_MASK,v>2)return this._emitError(new Error("Invalid retain handling, must be <= 2"));E={topic:d,qos:m},this.settings.protocolVersion===5?(E.nl=b,E.rap=y,E.rh=v):this.settings.bridgeMode&&(E.rh=0,E.rap=!0,E.nl=!0),a("_parseSubscribe: push subscription `%s` to subscription",E),c.subscriptions.push(E)}}}_parseSuback(){a("_parseSuback");let c=this.packet;if(this.packet.granted=[],!!this._parseMessageId()){if(this.settings.protocolVersion===5){let d=this._parseProperties();Object.getOwnPropertyNames(d).length&&(c.properties=d)}if(c.length<=0)return this._emitError(new Error("Malformed suback, no payload specified"));for(;this._pos<this.packet.length;){let d=this._list.readUInt8(this._pos++);if(this.settings.protocolVersion===5){if(!s.MQTT5_SUBACK_CODES[d])return this._emitError(new Error("Invalid suback code"))}else if(d>2&&d!==128)return this._emitError(new Error("Invalid suback QoS, must be 0, 1, 2 or 128"));this.packet.granted.push(d)}}}_parseUnsubscribe(){a("_parseUnsubscribe");let c=this.packet;if(c.unsubscriptions=[],!!this._parseMessageId()){if(this.settings.protocolVersion===5){let d=this._parseProperties();Object.getOwnPropertyNames(d).length&&(c.properties=d)}if(c.length<=0)return this._emitError(new Error("Malformed unsubscribe, no payload specified"));for(;this._pos<c.length;){let d=this._parseString();if(d===null)return this._emitError(new Error("Cannot parse topic"));a("_parseUnsubscribe: push topic `%s` to unsubscriptions",d),c.unsubscriptions.push(d)}}}_parseUnsuback(){a("_parseUnsuback");let c=this.packet;if(!this._parseMessageId())return this._emitError(new Error("Cannot parse messageId"));if((this.settings.protocolVersion===3||this.settings.protocolVersion===4)&&c.length!==2)return this._emitError(new Error("Malformed unsuback, payload length must be 2"));if(c.length<=0)return this._emitError(new Error("Malformed unsuback, no payload specified"));if(this.settings.protocolVersion===5){let d=this._parseProperties();for(Object.getOwnPropertyNames(d).length&&(c.properties=d),c.granted=[];this._pos<this.packet.length;){let p=this._list.readUInt8(this._pos++);if(!s.MQTT5_UNSUBACK_CODES[p])return this._emitError(new Error("Invalid unsuback code"));this.packet.granted.push(p)}}}_parseConfirmation(){a("_parseConfirmation: packet.cmd: `%s`",this.packet.cmd);let c=this.packet;if(this._parseMessageId(),this.settings.protocolVersion===5){if(c.length>2){switch(c.reasonCode=this._parseByte(),this.packet.cmd){case"puback":case"pubrec":if(!s.MQTT5_PUBACK_PUBREC_CODES[c.reasonCode])return this._emitError(new Error("Invalid "+this.packet.cmd+" reason code"));break;case"pubrel":case"pubcomp":if(!s.MQTT5_PUBREL_PUBCOMP_CODES[c.reasonCode])return this._emitError(new Error("Invalid "+this.packet.cmd+" reason code"));break}a("_parseConfirmation: packet.reasonCode `%d`",c.reasonCode)}else c.reasonCode=0;if(c.length>3){let d=this._parseProperties();Object.getOwnPropertyNames(d).length&&(c.properties=d)}}return!0}_parseDisconnect(){let c=this.packet;if(a("_parseDisconnect"),this.settings.protocolVersion===5){this._list.length>0?(c.reasonCode=this._parseByte(),s.MQTT5_DISCONNECT_CODES[c.reasonCode]||this._emitError(new Error("Invalid disconnect reason code"))):c.reasonCode=0;let d=this._parseProperties();Object.getOwnPropertyNames(d).length&&(c.properties=d)}return a("_parseDisconnect result: true"),!0}_parseAuth(){a("_parseAuth");let c=this.packet;if(this.settings.protocolVersion!==5)return this._emitError(new Error("Not supported auth packet for this version MQTT"));if(c.reasonCode=this._parseByte(),!s.MQTT5_AUTH_CODES[c.reasonCode])return this._emitError(new Error("Invalid auth reason code"));let d=this._parseProperties();return Object.getOwnPropertyNames(d).length&&(c.properties=d),a("_parseAuth: result: true"),!0}_parseMessageId(){let c=this.packet;return c.messageId=this._parseNum(),c.messageId===null?(this._emitError(new Error("Cannot parse messageId")),!1):(a("_parseMessageId: packet.messageId %d",c.messageId),!0)}_parseString(c){let d=this._parseNum(),p=d+this._pos;if(d===-1||p>this._list.length||p>this.packet.length)return null;let m=this._list.toString("utf8",this._pos,p);return this._pos+=d,a("_parseString: result: %s",m),m}_parseStringPair(){return a("_parseStringPair"),{name:this._parseString(),value:this._parseString()}}_parseBuffer(){let c=this._parseNum(),d=c+this._pos;if(c===-1||d>this._list.length||d>this.packet.length)return null;let p=this._list.slice(this._pos,d);return this._pos+=c,a("_parseBuffer: result: %o",p),p}_parseNum(){if(this._list.length-this._pos<2)return-1;let c=this._list.readUInt16BE(this._pos);return this._pos+=2,a("_parseNum: result: %s",c),c}_parse4ByteNum(){if(this._list.length-this._pos<4)return-1;let c=this._list.readUInt32BE(this._pos);return this._pos+=4,a("_parse4ByteNum: result: %s",c),c}_parseVarByteNum(c){a("_parseVarByteNum");let d=4,p=0,m=1,v=0,y=!1,b,E=this._pos?this._pos:0;for(;p<d&&E+p<this._list.length;){if(b=this._list.readUInt8(E+p++),v+=m*(b&s.VARBYTEINT_MASK),m*=128,(b&s.VARBYTEINT_FIN_MASK)===0){y=!0;break}if(this._list.length<=p)break}return!y&&p===d&&this._list.length>=p&&this._emitError(new Error("Invalid variable byte integer")),E&&(this._pos+=p),y?c?y={bytes:p,value:v}:y=v:y=!1,a("_parseVarByteNum: result: %o",y),y}_parseByte(){let c;return this._pos<this._list.length&&(c=this._list.readUInt8(this._pos),this._pos++),a("_parseByte: result: %o",c),c}_parseByType(c){switch(a("_parseByType: type: %s",c),c){case"byte":return this._parseByte()!==0;case"int8":return this._parseByte();case"int16":return this._parseNum();case"int32":return this._parse4ByteNum();case"var":return this._parseVarByteNum();case"string":return this._parseString();case"pair":return this._parseStringPair();case"binary":return this._parseBuffer()}}_parseProperties(){a("_parseProperties");let c=this._parseVarByteNum(),d=this._pos+c,p={};for(;this._pos<d;){let m=this._parseByte();if(!m)return this._emitError(new Error("Cannot parse property code type")),!1;let v=s.propertiesCodes[m];if(!v)return this._emitError(new Error("Unknown property")),!1;if(v==="userProperties"){p[v]||(p[v]=Object.create(null));let y=this._parseByType(s.propertiesTypes[v]);if(p[v][y.name])if(Array.isArray(p[v][y.name]))p[v][y.name].push(y.value);else{let b=p[v][y.name];p[v][y.name]=[b],p[v][y.name].push(y.value)}else p[v][y.name]=y.value;continue}p[v]?Array.isArray(p[v])?p[v].push(this._parseByType(s.propertiesTypes[v])):(p[v]=[p[v]],p[v].push(this._parseByType(s.propertiesTypes[v]))):p[v]=this._parseByType(s.propertiesTypes[v])}return p}_newPacket(){return a("_newPacket"),this.packet&&(this._list.consume(this.packet.length),a("_newPacket: parser emit packet: packet.cmd: %s, packet.payload: %s, packet.length: %d",this.packet.cmd,this.packet.payload,this.packet.length),this.emit("packet",this.packet)),a("_newPacket: new packet"),this.packet=new n,this._pos=0,!0}_emitError(c){a("_emitError",c),this.error=c,this.emit("error",c)}};e.exports=u}),SL=je((l,e)=>{ke(),Pe(),Me();var{Buffer:t}=(hr(),Ct(fr)),r=65536,n={},s=t.isBuffer(t.from([1,2]).subarray(0,1));function a(d){let p=t.allocUnsafe(2);return p.writeUInt8(d>>8,0),p.writeUInt8(d&255,1),p}function u(){for(let d=0;d<r;d++)n[d]=a(d)}function f(d){let p=0,m=0,v=t.allocUnsafe(4);do p=d%128|0,d=d/128|0,d>0&&(p=p|128),v.writeUInt8(p,m++);while(d>0&&m<4);return d>0&&(m=0),s?v.subarray(0,m):v.slice(0,m)}function c(d){let p=t.allocUnsafe(4);return p.writeUInt32BE(d,0),p}e.exports={cache:n,generateCache:u,generateNumber:a,genBufVariableByteInt:f,generate4ByteBuffer:c}}),TL=je((l,e)=>{ke(),Pe(),Me(),typeof Mt>"u"||!Mt.version||Mt.version.indexOf("v0.")===0||Mt.version.indexOf("v1.")===0&&Mt.version.indexOf("v1.8.")!==0?e.exports={nextTick:t}:e.exports=Mt;function t(r,n,s,a){if(typeof r!="function")throw new TypeError('"callback" argument must be a function');var u=arguments.length,f,c;switch(u){case 0:case 1:return Mt.nextTick(r);case 2:return Mt.nextTick(function(){r.call(null,n)});case 3:return Mt.nextTick(function(){r.call(null,n,s)});case 4:return Mt.nextTick(function(){r.call(null,n,s,a)});default:for(f=new Array(u-1),c=0;c<f.length;)f[c++]=arguments[c];return Mt.nextTick(function(){r.apply(null,f)})}}}),_x=je((l,e)=>{ke(),Pe(),Me();var t=xx(),{Buffer:r}=(hr(),Ct(fr)),n=r.allocUnsafe(0),s=r.from([0]),a=SL(),u=TL().nextTick,f=Sn()("mqtt-packet:writeToStream"),c=a.cache,d=a.generateNumber,p=a.generateCache,m=a.genBufVariableByteInt,v=a.generate4ByteBuffer,y=K,b=!0;function E(se,J,me){switch(f("generate called"),J.cork&&(J.cork(),u(x,J)),b&&(b=!1,p()),f("generate: packet.cmd: %s",se.cmd),se.cmd){case"connect":return T(se,J);case"connack":return A(se,J,me);case"publish":return L(se,J,me);case"puback":case"pubrec":case"pubrel":case"pubcomp":return w(se,J,me);case"subscribe":return C(se,J,me);case"suback":return I(se,J,me);case"unsubscribe":return O(se,J,me);case"unsuback":return B(se,J,me);case"pingreq":case"pingresp":return P(se,J);case"disconnect":return $(se,J,me);case"auth":return F(se,J,me);default:return J.destroy(new Error("Unknown command")),!1}}Object.defineProperty(E,"cacheNumbers",{get(){return y===K},set(se){se?((!c||Object.keys(c).length===0)&&(b=!0),y=K):(b=!1,y=z)}});function x(se){se.uncork()}function T(se,J,me){let ce=se||{},he=ce.protocolId||"MQTT",pe=ce.protocolVersion||4,Fe=ce.will,Re=ce.clean,ee=ce.keepalive||0,te=ce.clientId||"",ge=ce.username,Ie=ce.password,Ce=ce.properties;Re===void 0&&(Re=!0);let Ue=0;if(typeof he!="string"&&!r.isBuffer(he))return J.destroy(new Error("Invalid protocolId")),!1;if(Ue+=he.length+2,pe!==3&&pe!==4&&pe!==5)return J.destroy(new Error("Invalid protocol version")),!1;if(Ue+=1,(typeof te=="string"||r.isBuffer(te))&&(te||pe>=4)&&(te||Re))Ue+=r.byteLength(te)+2;else{if(pe<4)return J.destroy(new Error("clientId must be supplied before 3.1.1")),!1;if(Re*1===0)return J.destroy(new Error("clientId must be given if cleanSession set to 0")),!1}if(typeof ee!="number"||ee<0||ee>65535||ee%1!==0)return J.destroy(new Error("Invalid keepalive")),!1;Ue+=2,Ue+=1;let le,Ne;if(pe===5){if(le=U(J,Ce),!le)return!1;Ue+=le.length}if(Fe){if(typeof Fe!="object")return J.destroy(new Error("Invalid will")),!1;if(!Fe.topic||typeof Fe.topic!="string")return J.destroy(new Error("Invalid will topic")),!1;if(Ue+=r.byteLength(Fe.topic)+2,Ue+=2,Fe.payload)if(Fe.payload.length>=0)typeof Fe.payload=="string"?Ue+=r.byteLength(Fe.payload):Ue+=Fe.payload.length;else return J.destroy(new Error("Invalid will payload")),!1;if(Ne={},pe===5){if(Ne=U(J,Fe.properties),!Ne)return!1;Ue+=Ne.length}}let Ke=!1;if(ge!=null)if(Ee(ge))Ke=!0,Ue+=r.byteLength(ge)+2;else return J.destroy(new Error("Invalid username")),!1;if(Ie!=null){if(!Ke)return J.destroy(new Error("Username is required to use password")),!1;if(Ee(Ie))Ue+=ne(Ie)+2;else return J.destroy(new Error("Invalid password")),!1}J.write(t.CONNECT_HEADER),X(J,Ue),Y(J,he),ce.bridgeMode&&(pe+=128),J.write(pe===131?t.VERSION131:pe===132?t.VERSION132:pe===4?t.VERSION4:pe===5?t.VERSION5:t.VERSION3);let Ae=0;return Ae|=ge!=null?t.USERNAME_MASK:0,Ae|=Ie!=null?t.PASSWORD_MASK:0,Ae|=Fe&&Fe.retain?t.WILL_RETAIN_MASK:0,Ae|=Fe&&Fe.qos?Fe.qos<<t.WILL_QOS_SHIFT:0,Ae|=Fe?t.WILL_FLAG_MASK:0,Ae|=Re?t.CLEAN_SESSION_MASK:0,J.write(r.from([Ae])),y(J,ee),pe===5&&le.write(),Y(J,te),Fe&&(pe===5&&Ne.write(),q(J,Fe.topic),Y(J,Fe.payload)),ge!=null&&Y(J,ge),Ie!=null&&Y(J,Ie),!0}function A(se,J,me){let ce=me?me.protocolVersion:4,he=se||{},pe=ce===5?he.reasonCode:he.returnCode,Fe=he.properties,Re=2;if(typeof pe!="number")return J.destroy(new Error("Invalid return code")),!1;let ee=null;if(ce===5){if(ee=U(J,Fe),!ee)return!1;Re+=ee.length}return J.write(t.CONNACK_HEADER),X(J,Re),J.write(he.sessionPresent?t.SESSIONPRESENT_HEADER:s),J.write(r.from([pe])),ee?.write(),!0}function L(se,J,me){f("publish: packet: %o",se);let ce=me?me.protocolVersion:4,he=se||{},pe=he.qos||0,Fe=he.retain?t.RETAIN_MASK:0,Re=he.topic,ee=he.payload||n,te=he.messageId,ge=he.properties,Ie=0;if(typeof Re=="string")Ie+=r.byteLength(Re)+2;else if(r.isBuffer(Re))Ie+=Re.length+2;else return J.destroy(new Error("Invalid topic")),!1;if(r.isBuffer(ee)?Ie+=ee.length:Ie+=r.byteLength(ee),pe&&typeof te!="number")return J.destroy(new Error("Invalid messageId")),!1;pe&&(Ie+=2);let Ce=null;if(ce===5){if(Ce=U(J,ge),!Ce)return!1;Ie+=Ce.length}return J.write(t.PUBLISH_HEADER[pe][he.dup?1:0][Fe?1:0]),X(J,Ie),y(J,ne(Re)),J.write(Re),pe>0&&y(J,te),Ce?.write(),f("publish: payload: %o",ee),J.write(ee)}function w(se,J,me){let ce=me?me.protocolVersion:4,he=se||{},pe=he.cmd||"puback",Fe=he.messageId,Re=he.dup&&pe==="pubrel"?t.DUP_MASK:0,ee=0,te=he.reasonCode,ge=he.properties,Ie=ce===5?3:2;if(pe==="pubrel"&&(ee=1),typeof Fe!="number")return J.destroy(new Error("Invalid messageId")),!1;let Ce=null;if(ce===5&&typeof ge=="object"){if(Ce=N(J,ge,me,Ie),!Ce)return!1;Ie+=Ce.length}return J.write(t.ACKS[pe][ee][Re][0]),Ie===3&&(Ie+=te!==0?1:-1),X(J,Ie),y(J,Fe),ce===5&&Ie!==2&&J.write(r.from([te])),Ce!==null?Ce.write():Ie===4&&J.write(r.from([0])),!0}function C(se,J,me){f("subscribe: packet: ");let ce=me?me.protocolVersion:4,he=se||{},pe=he.dup?t.DUP_MASK:0,Fe=he.messageId,Re=he.subscriptions,ee=he.properties,te=0;if(typeof Fe!="number")return J.destroy(new Error("Invalid messageId")),!1;te+=2;let ge=null;if(ce===5){if(ge=U(J,ee),!ge)return!1;te+=ge.length}if(typeof Re=="object"&&Re.length)for(let Ce=0;Ce<Re.length;Ce+=1){let Ue=Re[Ce].topic,le=Re[Ce].qos;if(typeof Ue!="string")return J.destroy(new Error("Invalid subscriptions - invalid topic")),!1;if(typeof le!="number")return J.destroy(new Error("Invalid subscriptions - invalid qos")),!1;if(ce===5){if(typeof(Re[Ce].nl||!1)!="boolean")return J.destroy(new Error("Invalid subscriptions - invalid No Local")),!1;if(typeof(Re[Ce].rap||!1)!="boolean")return J.destroy(new Error("Invalid subscriptions - invalid Retain as Published")),!1;let Ne=Re[Ce].rh||0;if(typeof Ne!="number"||Ne>2)return J.destroy(new Error("Invalid subscriptions - invalid Retain Handling")),!1}te+=r.byteLength(Ue)+2+1}else return J.destroy(new Error("Invalid subscriptions")),!1;f("subscribe: writing to stream: %o",t.SUBSCRIBE_HEADER),J.write(t.SUBSCRIBE_HEADER[1][pe?1:0][0]),X(J,te),y(J,Fe),ge!==null&&ge.write();let Ie=!0;for(let Ce of Re){let Ue=Ce.topic,le=Ce.qos,Ne=+Ce.nl,Ke=+Ce.rap,Ae=Ce.rh,nt;q(J,Ue),nt=t.SUBSCRIBE_OPTIONS_QOS[le],ce===5&&(nt|=Ne?t.SUBSCRIBE_OPTIONS_NL:0,nt|=Ke?t.SUBSCRIBE_OPTIONS_RAP:0,nt|=Ae?t.SUBSCRIBE_OPTIONS_RH[Ae]:0),Ie=J.write(r.from([nt]))}return Ie}function I(se,J,me){let ce=me?me.protocolVersion:4,he=se||{},pe=he.messageId,Fe=he.granted,Re=he.properties,ee=0;if(typeof pe!="number")return J.destroy(new Error("Invalid messageId")),!1;if(ee+=2,typeof Fe=="object"&&Fe.length)for(let ge=0;ge<Fe.length;ge+=1){if(typeof Fe[ge]!="number")return J.destroy(new Error("Invalid qos vector")),!1;ee+=1}else return J.destroy(new Error("Invalid qos vector")),!1;let te=null;if(ce===5){if(te=N(J,Re,me,ee),!te)return!1;ee+=te.length}return J.write(t.SUBACK_HEADER),X(J,ee),y(J,pe),te!==null&&te.write(),J.write(r.from(Fe))}function O(se,J,me){let ce=me?me.protocolVersion:4,he=se||{},pe=he.messageId,Fe=he.dup?t.DUP_MASK:0,Re=he.unsubscriptions,ee=he.properties,te=0;if(typeof pe!="number")return J.destroy(new Error("Invalid messageId")),!1;if(te+=2,typeof Re=="object"&&Re.length)for(let Ce=0;Ce<Re.length;Ce+=1){if(typeof Re[Ce]!="string")return J.destroy(new Error("Invalid unsubscriptions")),!1;te+=r.byteLength(Re[Ce])+2}else return J.destroy(new Error("Invalid unsubscriptions")),!1;let ge=null;if(ce===5){if(ge=U(J,ee),!ge)return!1;te+=ge.length}J.write(t.UNSUBSCRIBE_HEADER[1][Fe?1:0][0]),X(J,te),y(J,pe),ge!==null&&ge.write();let Ie=!0;for(let Ce=0;Ce<Re.length;Ce++)Ie=q(J,Re[Ce]);return Ie}function B(se,J,me){let ce=me?me.protocolVersion:4,he=se||{},pe=he.messageId,Fe=he.dup?t.DUP_MASK:0,Re=he.granted,ee=he.properties,te=he.cmd,ge=0,Ie=2;if(typeof pe!="number")return J.destroy(new Error("Invalid messageId")),!1;if(ce===5)if(typeof Re=="object"&&Re.length)for(let Ue=0;Ue<Re.length;Ue+=1){if(typeof Re[Ue]!="number")return J.destroy(new Error("Invalid qos vector")),!1;Ie+=1}else return J.destroy(new Error("Invalid qos vector")),!1;let Ce=null;if(ce===5){if(Ce=N(J,ee,me,Ie),!Ce)return!1;Ie+=Ce.length}return J.write(t.ACKS[te][ge][Fe][0]),X(J,Ie),y(J,pe),Ce!==null&&Ce.write(),ce===5&&J.write(r.from(Re)),!0}function P(se,J,me){return J.write(t.EMPTY[se.cmd])}function $(se,J,me){let ce=me?me.protocolVersion:4,he=se||{},pe=he.reasonCode,Fe=he.properties,Re=ce===5?1:0,ee=null;if(ce===5){if(ee=N(J,Fe,me,Re),!ee)return!1;Re+=ee.length}return J.write(r.from([t.codes.disconnect<<4])),X(J,Re),ce===5&&J.write(r.from([pe])),ee!==null&&ee.write(),!0}function F(se,J,me){let ce=me?me.protocolVersion:4,he=se||{},pe=he.reasonCode,Fe=he.properties,Re=ce===5?1:0;ce!==5&&J.destroy(new Error("Invalid mqtt version for auth packet"));let ee=N(J,Fe,me,Re);return ee?(Re+=ee.length,J.write(r.from([t.codes.auth<<4])),X(J,Re),J.write(r.from([pe])),ee!==null&&ee.write(),!0):!1}var Z={};function X(se,J){if(J>t.VARBYTEINT_MAX)return se.destroy(new Error(`Invalid variable byte integer: ${J}`)),!1;let me=Z[J];return me||(me=m(J),J<16384&&(Z[J]=me)),f("writeVarByteInt: writing to stream: %o",me),se.write(me)}function q(se,J){let me=r.byteLength(J);return y(se,me),f("writeString: %s",J),se.write(J,"utf8")}function H(se,J,me){q(se,J),q(se,me)}function K(se,J){return f("writeNumberCached: number: %d",J),f("writeNumberCached: %o",c[J]),se.write(c[J])}function z(se,J){let me=d(J);return f("writeNumberGenerated: %o",me),se.write(me)}function ie(se,J){let me=v(J);return f("write4ByteNumber: %o",me),se.write(me)}function Y(se,J){typeof J=="string"?q(se,J):J?(y(se,J.length),se.write(J)):y(se,0)}function U(se,J){if(typeof J!="object"||J.length!=null)return{length:1,write(){ue(se,{},0)}};let me=0;function ce(he,pe){let Fe=t.propertiesTypes[he],Re=0;switch(Fe){case"byte":{if(typeof pe!="boolean")return se.destroy(new Error(`Invalid ${he}: ${pe}`)),!1;Re+=2;break}case"int8":{if(typeof pe!="number"||pe<0||pe>255)return se.destroy(new Error(`Invalid ${he}: ${pe}`)),!1;Re+=2;break}case"binary":{if(pe&&pe===null)return se.destroy(new Error(`Invalid ${he}: ${pe}`)),!1;Re+=1+r.byteLength(pe)+2;break}case"int16":{if(typeof pe!="number"||pe<0||pe>65535)return se.destroy(new Error(`Invalid ${he}: ${pe}`)),!1;Re+=3;break}case"int32":{if(typeof pe!="number"||pe<0||pe>4294967295)return se.destroy(new Error(`Invalid ${he}: ${pe}`)),!1;Re+=5;break}case"var":{if(typeof pe!="number"||pe<0||pe>268435455)return se.destroy(new Error(`Invalid ${he}: ${pe}`)),!1;Re+=1+r.byteLength(m(pe));break}case"string":{if(typeof pe!="string")return se.destroy(new Error(`Invalid ${he}: ${pe}`)),!1;Re+=3+r.byteLength(pe.toString());break}case"pair":{if(typeof pe!="object")return se.destroy(new Error(`Invalid ${he}: ${pe}`)),!1;Re+=Object.getOwnPropertyNames(pe).reduce((ee,te)=>{let ge=pe[te];return Array.isArray(ge)?ee+=ge.reduce((Ie,Ce)=>(Ie+=3+r.byteLength(te.toString())+2+r.byteLength(Ce.toString()),Ie),0):ee+=3+r.byteLength(te.toString())+2+r.byteLength(pe[te].toString()),ee},0);break}default:return se.destroy(new Error(`Invalid property ${he}: ${pe}`)),!1}return Re}if(J)for(let he in J){let pe=0,Fe=0,Re=J[he];if(Re!==void 0){if(Array.isArray(Re))for(let ee=0;ee<Re.length;ee++){if(Fe=ce(he,Re[ee]),!Fe)return!1;pe+=Fe}else{if(Fe=ce(he,Re),!Fe)return!1;pe=Fe}if(!pe)return!1;me+=pe}}return{length:r.byteLength(m(me))+me,write(){ue(se,J,me)}}}function N(se,J,me,ce){let he=["reasonString","userProperties"],pe=me&&me.properties&&me.properties.maximumPacketSize?me.properties.maximumPacketSize:0,Fe=U(se,J);if(pe)for(;ce+Fe.length>pe;){let Re=he.shift();if(Re&&J[Re])delete J[Re],Fe=U(se,J);else return!1}return Fe}function W(se,J,me){switch(t.propertiesTypes[J]){case"byte":{se.write(r.from([t.properties[J]])),se.write(r.from([+me]));break}case"int8":{se.write(r.from([t.properties[J]])),se.write(r.from([me]));break}case"binary":{se.write(r.from([t.properties[J]])),Y(se,me);break}case"int16":{se.write(r.from([t.properties[J]])),y(se,me);break}case"int32":{se.write(r.from([t.properties[J]])),ie(se,me);break}case"var":{se.write(r.from([t.properties[J]])),X(se,me);break}case"string":{se.write(r.from([t.properties[J]])),q(se,me);break}case"pair":{Object.getOwnPropertyNames(me).forEach(ce=>{let he=me[ce];Array.isArray(he)?he.forEach(pe=>{se.write(r.from([t.properties[J]])),H(se,ce.toString(),pe.toString())}):(se.write(r.from([t.properties[J]])),H(se,ce.toString(),he.toString()))});break}default:return se.destroy(new Error(`Invalid property ${J} value: ${me}`)),!1}}function ue(se,J,me){X(se,me);for(let ce in J)if(Object.prototype.hasOwnProperty.call(J,ce)&&J[ce]!=null){let he=J[ce];if(Array.isArray(he))for(let pe=0;pe<he.length;pe++)W(se,ce,he[pe]);else W(se,ce,he)}}function ne(se){return se?se instanceof r?se.length:r.byteLength(se):0}function Ee(se){return typeof se=="string"||se instanceof r}e.exports=E}),xL=je((l,e)=>{ke(),Pe(),Me();var t=_x(),{EventEmitter:r}=(Bs(),Ct(ls)),{Buffer:n}=(hr(),Ct(fr));function s(u,f){let c=new a;return t(u,c,f),c.concat()}var a=class extends r{constructor(){super(),this._array=new Array(20),this._i=0}write(u){return this._array[this._i++]=u,!0}concat(){let u=0,f=new Array(this._array.length),c=this._array,d=0,p;for(p=0;p<c.length&&c[p]!==void 0;p++)typeof c[p]!="string"?f[p]=c[p].length:f[p]=n.byteLength(c[p]),u+=f[p];let m=n.allocUnsafe(u);for(p=0;p<c.length&&c[p]!==void 0;p++)typeof c[p]!="string"?(c[p].copy(m,d),d+=f[p]):(m.write(c[p],d),d+=f[p]);return m}destroy(u){u&&this.emit("error",u)}};e.exports=s}),_L=je(l=>{ke(),Pe(),Me(),l.parser=EL().parser,l.generate=xL(),l.writeToStream=_x()}),AL=je((l,e)=>{ke(),Pe(),Me(),e.exports=r;function t(s){return s instanceof _c?_c.from(s):new s.constructor(s.buffer.slice(),s.byteOffset,s.length)}function r(s){if(s=s||{},s.circles)return n(s);let a=new Map;if(a.set(Date,p=>new Date(p)),a.set(Map,(p,m)=>new Map(f(Array.from(p),m))),a.set(Set,(p,m)=>new Set(f(Array.from(p),m))),s.constructorHandlers)for(let p of s.constructorHandlers)a.set(p[0],p[1]);let u=null;return s.proto?d:c;function f(p,m){let v=Object.keys(p),y=new Array(v.length);for(let b=0;b<v.length;b++){let E=v[b],x=p[E];typeof x!="object"||x===null?y[E]=x:x.constructor!==Object&&(u=a.get(x.constructor))?y[E]=u(x,m):ArrayBuffer.isView(x)?y[E]=t(x):y[E]=m(x)}return y}function c(p){if(typeof p!="object"||p===null)return p;if(Array.isArray(p))return f(p,c);if(p.constructor!==Object&&(u=a.get(p.constructor)))return u(p,c);let m={};for(let v in p){if(Object.hasOwnProperty.call(p,v)===!1)continue;let y=p[v];typeof y!="object"||y===null?m[v]=y:y.constructor!==Object&&(u=a.get(y.constructor))?m[v]=u(y,c):ArrayBuffer.isView(y)?m[v]=t(y):m[v]=c(y)}return m}function d(p){if(typeof p!="object"||p===null)return p;if(Array.isArray(p))return f(p,d);if(p.constructor!==Object&&(u=a.get(p.constructor)))return u(p,d);let m={};for(let v in p){let y=p[v];typeof y!="object"||y===null?m[v]=y:y.constructor!==Object&&(u=a.get(y.constructor))?m[v]=u(y,d):ArrayBuffer.isView(y)?m[v]=t(y):m[v]=d(y)}return m}}function n(s){let a=[],u=[],f=new Map;if(f.set(Date,v=>new Date(v)),f.set(Map,(v,y)=>new Map(d(Array.from(v),y))),f.set(Set,(v,y)=>new Set(d(Array.from(v),y))),s.constructorHandlers)for(let v of s.constructorHandlers)f.set(v[0],v[1]);let c=null;return s.proto?m:p;function d(v,y){let b=Object.keys(v),E=new Array(b.length);for(let x=0;x<b.length;x++){let T=b[x],A=v[T];if(typeof A!="object"||A===null)E[T]=A;else if(A.constructor!==Object&&(c=f.get(A.constructor)))E[T]=c(A,y);else if(ArrayBuffer.isView(A))E[T]=t(A);else{let L=a.indexOf(A);L!==-1?E[T]=u[L]:E[T]=y(A)}}return E}function p(v){if(typeof v!="object"||v===null)return v;if(Array.isArray(v))return d(v,p);if(v.constructor!==Object&&(c=f.get(v.constructor)))return c(v,p);let y={};a.push(v),u.push(y);for(let b in v){if(Object.hasOwnProperty.call(v,b)===!1)continue;let E=v[b];if(typeof E!="object"||E===null)y[b]=E;else if(E.constructor!==Object&&(c=f.get(E.constructor)))y[b]=c(E,p);else if(ArrayBuffer.isView(E))y[b]=t(E);else{let x=a.indexOf(E);x!==-1?y[b]=u[x]:y[b]=p(E)}}return a.pop(),u.pop(),y}function m(v){if(typeof v!="object"||v===null)return v;if(Array.isArray(v))return d(v,m);if(v.constructor!==Object&&(c=f.get(v.constructor)))return c(v,m);let y={};a.push(v),u.push(y);for(let b in v){let E=v[b];if(typeof E!="object"||E===null)y[b]=E;else if(E.constructor!==Object&&(c=f.get(E.constructor)))y[b]=c(E,m);else if(ArrayBuffer.isView(E))y[b]=t(E);else{let x=a.indexOf(E);x!==-1?y[b]=u[x]:y[b]=m(E)}}return a.pop(),u.pop(),y}}}),wL=je((l,e)=>{ke(),Pe(),Me(),e.exports=AL()()}),RL=je(l=>{ke(),Pe(),Me(),Object.defineProperty(l,"__esModule",{value:!0}),l.validateTopic=e,l.validateTopics=t;function e(r){let n=r.split("/");for(let s=0;s<n.length;s++)if(n[s]!=="+"){if(n[s]==="#")return s===n.length-1;if(n[s].indexOf("+")!==-1||n[s].indexOf("#")!==-1)return!1}return!0}function t(r){if(r.length===0)return"empty_topic_list";for(let n=0;n<r.length;n++)if(!e(r[n]))return r[n];return null}}),Ax=je(l=>{ke(),Pe(),Me(),Object.defineProperty(l,"__esModule",{value:!0});var e=js(),t={objectMode:!0},r={clean:!0},n=class{options;_inflights;constructor(s){this.options=s||{},this.options={...r,...s},this._inflights=new Map}put(s,a){return this._inflights.set(s.messageId,s),a&&a(),this}createStream(){let s=new e.Readable(t),a=[],u=!1,f=0;return this._inflights.forEach((c,d)=>{a.push(c)}),s._read=()=>{!u&&f<a.length?s.push(a[f++]):s.push(null)},s.destroy=c=>{if(!u)return u=!0,setTimeout(()=>{s.emit("close")},0),s},s}del(s,a){let u=this._inflights.get(s.messageId);return u?(this._inflights.delete(s.messageId),a(null,u)):a&&a(new Error("missing packet")),this}get(s,a){let u=this._inflights.get(s.messageId);return u?a(null,u):a&&a(new Error("missing packet")),this}close(s){this.options.clean&&(this._inflights=null),s&&s()}};l.default=n}),IL=je(l=>{ke(),Pe(),Me(),Object.defineProperty(l,"__esModule",{value:!0});var e=[0,16,128,131,135,144,145,151,153],t=(r,n,s)=>{r.log("handlePublish: packet %o",n),s=typeof s<"u"?s:r.noop;let a=n.topic.toString(),u=n.payload,{qos:f}=n,{messageId:c}=n,{options:d}=r;if(r.options.protocolVersion===5){let p;if(n.properties&&(p=n.properties.topicAlias),typeof p<"u")if(a.length===0)if(p>0&&p<=65535){let m=r.topicAliasRecv.getTopicByAlias(p);if(m)a=m,r.log("handlePublish :: topic complemented by alias. topic: %s - alias: %d",a,p);else{r.log("handlePublish :: unregistered topic alias. alias: %d",p),r.emit("error",new Error("Received unregistered Topic Alias"));return}}else{r.log("handlePublish :: topic alias out of range. alias: %d",p),r.emit("error",new Error("Received Topic Alias is out of range"));return}else if(r.topicAliasRecv.put(a,p))r.log("handlePublish :: registered topic: %s - alias: %d",a,p);else{r.log("handlePublish :: topic alias out of range. alias: %d",p),r.emit("error",new Error("Received Topic Alias is out of range"));return}}switch(r.log("handlePublish: qos %d",f),f){case 2:{d.customHandleAcks(a,u,n,(p,m)=>{if(typeof p=="number"&&(m=p,p=null),p)return r.emit("error",p);if(e.indexOf(m)===-1)return r.emit("error",new Error("Wrong reason code for pubrec"));m?r._sendPacket({cmd:"pubrec",messageId:c,reasonCode:m},s):r.incomingStore.put(n,()=>{r._sendPacket({cmd:"pubrec",messageId:c},s)})});break}case 1:{d.customHandleAcks(a,u,n,(p,m)=>{if(typeof p=="number"&&(m=p,p=null),p)return r.emit("error",p);if(e.indexOf(m)===-1)return r.emit("error",new Error("Wrong reason code for puback"));m||r.emit("message",a,u,n),r.handleMessage(n,v=>{if(v)return s&&s(v);r._sendPacket({cmd:"puback",messageId:c,reasonCode:m},s)})});break}case 0:r.emit("message",a,u,n),r.handleMessage(n,s);break;default:r.log("handlePublish: unknown QoS. Doing nothing.");break}};l.default=t}),LL=je((l,e)=>{e.exports={version:"5.14.1"}}),za=je(l=>{ke(),Pe(),Me(),Object.defineProperty(l,"__esModule",{value:!0}),l.MQTTJS_VERSION=l.nextTick=l.ErrorWithSubackPacket=l.ErrorWithReasonCode=void 0,l.applyMixin=r;var e=class Rx extends Error{code;constructor(s,a){super(s),this.code=a,Object.setPrototypeOf(this,Rx.prototype),Object.getPrototypeOf(this).name="ErrorWithReasonCode"}};l.ErrorWithReasonCode=e;var t=class Ix extends Error{packet;constructor(s,a){super(s),this.packet=a,Object.setPrototypeOf(this,Ix.prototype),Object.getPrototypeOf(this).name="ErrorWithSubackPacket"}};l.ErrorWithSubackPacket=t;function r(n,s,a=!1){let u=[s];for(;;){let f=u[0],c=Object.getPrototypeOf(f);if(c?.prototype)u.unshift(c);else break}for(let f of u)for(let c of Object.getOwnPropertyNames(f.prototype))(a||c!=="constructor")&&Object.defineProperty(n.prototype,c,Object.getOwnPropertyDescriptor(f.prototype,c)??Object.create(null))}l.nextTick=typeof Mt?.nextTick=="function"?Mt.nextTick:n=>{setTimeout(n,0)},l.MQTTJS_VERSION=LL().version}),Hc=je(l=>{ke(),Pe(),Me(),Object.defineProperty(l,"__esModule",{value:!0}),l.ReasonCodes=void 0;var e=za();l.ReasonCodes={0:"",1:"Unacceptable protocol version",2:"Identifier rejected",3:"Server unavailable",4:"Bad username or password",5:"Not authorized",16:"No matching subscribers",17:"No subscription existed",128:"Unspecified error",129:"Malformed Packet",130:"Protocol Error",131:"Implementation specific error",132:"Unsupported Protocol Version",133:"Client Identifier not valid",134:"Bad User Name or Password",135:"Not authorized",136:"Server unavailable",137:"Server busy",138:"Banned",139:"Server shutting down",140:"Bad authentication method",141:"Keep Alive timeout",142:"Session taken over",143:"Topic Filter invalid",144:"Topic Name invalid",145:"Packet identifier in use",146:"Packet Identifier not found",147:"Receive Maximum exceeded",148:"Topic Alias invalid",149:"Packet too large",150:"Message rate too high",151:"Quota exceeded",152:"Administrative action",153:"Payload format invalid",154:"Retain not supported",155:"QoS not supported",156:"Use another server",157:"Server moved",158:"Shared Subscriptions not supported",159:"Connection rate exceeded",160:"Maximum connect time",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"};var t=(r,n)=>{let{messageId:s}=n,a=n.cmd,u=null,f=r.outgoing[s]?r.outgoing[s].cb:null,c=null;if(!f){r.log("_handleAck :: Server sent an ack in error. Ignoring.");return}switch(r.log("_handleAck :: packet type",a),a){case"pubcomp":case"puback":{let d=n.reasonCode;d&&d>0&&d!==16?(c=new e.ErrorWithReasonCode(`Publish error: ${l.ReasonCodes[d]}`,d),r._removeOutgoingAndStoreMessage(s,()=>{f(c,n)})):r._removeOutgoingAndStoreMessage(s,f);break}case"pubrec":{u={cmd:"pubrel",qos:2,messageId:s};let d=n.reasonCode;d&&d>0&&d!==16?(c=new e.ErrorWithReasonCode(`Publish error: ${l.ReasonCodes[d]}`,d),r._removeOutgoingAndStoreMessage(s,()=>{f(c,n)})):r._sendPacket(u);break}case"suback":{delete r.outgoing[s],r.messageIdProvider.deallocate(s);let d=n.granted;for(let p=0;p<d.length;p++){let m=d[p];if((m&128)!==0){c=new Error(`Subscribe error: ${l.ReasonCodes[m]}`),c.code=m;let v=r.messageIdToTopic[s];v&&v.forEach(y=>{delete r._resubscribeTopics[y]})}}delete r.messageIdToTopic[s],r._invokeStoreProcessingQueue(),f(c,n);break}case"unsuback":{delete r.outgoing[s],r.messageIdProvider.deallocate(s),r._invokeStoreProcessingQueue(),f(null,n);break}default:r.emit("error",new Error("unrecognized packet type"))}r.disconnecting&&Object.keys(r.outgoing).length===0&&r.emit("outgoingEmpty")};l.default=t}),CL=je(l=>{ke(),Pe(),Me(),Object.defineProperty(l,"__esModule",{value:!0});var e=za(),t=Hc(),r=(n,s)=>{let{options:a}=n,u=a.protocolVersion,f=u===5?s.reasonCode:s.returnCode;if(u!==5){let c=new e.ErrorWithReasonCode(`Protocol error: Auth packets are only supported in MQTT 5. Your version:${u}`,f);n.emit("error",c);return}n.handleAuth(s,(c,d)=>{if(c){n.emit("error",c);return}if(f===24)n.reconnecting=!1,n._sendPacket(d);else{let p=new e.ErrorWithReasonCode(`Connection refused: ${t.ReasonCodes[f]}`,f);n.emit("error",p)}})};l.default=r}),DL=je(l=>{ke(),Pe(),Me(),Object.defineProperty(l,"__esModule",{value:!0}),l.LRUCache=void 0;var e=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,t=new Set,r=typeof Mt=="object"&&Mt?Mt:{},n=(v,y,b,E)=>{typeof r.emitWarning=="function"?r.emitWarning(v,y,b,E):console.error(`[${b}] ${y}: ${v}`)},s=globalThis.AbortController,a=globalThis.AbortSignal;if(typeof s>"u"){a=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(b,E){this._onabort.push(E)}},s=class{constructor(){y()}signal=new a;abort(b){if(!this.signal.aborted){this.signal.reason=b,this.signal.aborted=!0;for(let E of this.signal._onabort)E(b);this.signal.onabort?.(b)}}};let v=r.env?.LRU_CACHE_IGNORE_AC_WARNING!=="1",y=()=>{v&&(v=!1,n("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",y))}}var u=v=>!t.has(v),f=v=>v&&v===Math.floor(v)&&v>0&&isFinite(v),c=v=>f(v)?v<=Math.pow(2,8)?Uint8Array:v<=Math.pow(2,16)?Uint16Array:v<=Math.pow(2,32)?Uint32Array:v<=Number.MAX_SAFE_INTEGER?d:null:null,d=class extends Array{constructor(v){super(v),this.fill(0)}},p=class Ko{heap;length;static#l=!1;static create(y){let b=c(y);if(!b)return[];Ko.#l=!0;let E=new Ko(y,b);return Ko.#l=!1,E}constructor(y,b){if(!Ko.#l)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new b(y),this.length=0}push(y){this.heap[this.length++]=y}pop(){return this.heap[--this.length]}},m=class Lx{#l;#f;#g;#m;#C;#D;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#n;#y;#i;#r;#e;#u;#h;#o;#s;#v;#a;#b;#E;#d;#S;#w;#c;static unsafeExposeInternals(y){return{starts:y.#E,ttls:y.#d,sizes:y.#b,keyMap:y.#i,keyList:y.#r,valList:y.#e,next:y.#u,prev:y.#h,get head(){return y.#o},get tail(){return y.#s},free:y.#v,isBackgroundFetch:b=>y.#t(b),backgroundFetch:(b,E,x,T)=>y.#M(b,E,x,T),moveToTail:b=>y.#L(b),indexes:b=>y.#T(b),rindexes:b=>y.#x(b),isStale:b=>y.#p(b)}}get max(){return this.#l}get maxSize(){return this.#f}get calculatedSize(){return this.#y}get size(){return this.#n}get fetchMethod(){return this.#C}get memoMethod(){return this.#D}get dispose(){return this.#g}get disposeAfter(){return this.#m}constructor(y){let{max:b=0,ttl:E,ttlResolution:x=1,ttlAutopurge:T,updateAgeOnGet:A,updateAgeOnHas:L,allowStale:w,dispose:C,disposeAfter:I,noDisposeOnSet:O,noUpdateTTL:B,maxSize:P=0,maxEntrySize:$=0,sizeCalculation:F,fetchMethod:Z,memoMethod:X,noDeleteOnFetchRejection:q,noDeleteOnStaleGet:H,allowStaleOnFetchRejection:K,allowStaleOnFetchAbort:z,ignoreFetchAbort:ie}=y;if(b!==0&&!f(b))throw new TypeError("max option must be a nonnegative integer");let Y=b?c(b):Array;if(!Y)throw new Error("invalid max value: "+b);if(this.#l=b,this.#f=P,this.maxEntrySize=$||this.#f,this.sizeCalculation=F,this.sizeCalculation){if(!this.#f&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(X!==void 0&&typeof X!="function")throw new TypeError("memoMethod must be a function if defined");if(this.#D=X,Z!==void 0&&typeof Z!="function")throw new TypeError("fetchMethod must be a function if specified");if(this.#C=Z,this.#w=!!Z,this.#i=new Map,this.#r=new Array(b).fill(void 0),this.#e=new Array(b).fill(void 0),this.#u=new Y(b),this.#h=new Y(b),this.#o=0,this.#s=0,this.#v=p.create(b),this.#n=0,this.#y=0,typeof C=="function"&&(this.#g=C),typeof I=="function"?(this.#m=I,this.#a=[]):(this.#m=void 0,this.#a=void 0),this.#S=!!this.#g,this.#c=!!this.#m,this.noDisposeOnSet=!!O,this.noUpdateTTL=!!B,this.noDeleteOnFetchRejection=!!q,this.allowStaleOnFetchRejection=!!K,this.allowStaleOnFetchAbort=!!z,this.ignoreFetchAbort=!!ie,this.maxEntrySize!==0){if(this.#f!==0&&!f(this.#f))throw new TypeError("maxSize must be a positive integer if specified");if(!f(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#$()}if(this.allowStale=!!w,this.noDeleteOnStaleGet=!!H,this.updateAgeOnGet=!!A,this.updateAgeOnHas=!!L,this.ttlResolution=f(x)||x===0?x:1,this.ttlAutopurge=!!T,this.ttl=E||0,this.ttl){if(!f(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#P()}if(this.#l===0&&this.ttl===0&&this.#f===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#l&&!this.#f){let U="LRU_CACHE_UNBOUNDED";u(U)&&(t.add(U),n("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",U,Lx))}}getRemainingTTL(y){return this.#i.has(y)?1/0:0}#P(){let y=new d(this.#l),b=new d(this.#l);this.#d=y,this.#E=b,this.#N=(T,A,L=e.now())=>{if(b[T]=A!==0?L:0,y[T]=A,A!==0&&this.ttlAutopurge){let w=setTimeout(()=>{this.#p(T)&&this.#_(this.#r[T],"expire")},A+1);w.unref&&w.unref()}},this.#R=T=>{b[T]=y[T]!==0?e.now():0},this.#A=(T,A)=>{if(y[A]){let L=y[A],w=b[A];if(!L||!w)return;T.ttl=L,T.start=w,T.now=E||x();let C=T.now-w;T.remainingTTL=L-C}};let E=0,x=()=>{let T=e.now();if(this.ttlResolution>0){E=T;let A=setTimeout(()=>E=0,this.ttlResolution);A.unref&&A.unref()}return T};this.getRemainingTTL=T=>{let A=this.#i.get(T);if(A===void 0)return 0;let L=y[A],w=b[A];if(!L||!w)return 1/0;let C=(E||x())-w;return L-C},this.#p=T=>{let A=b[T],L=y[T];return!!L&&!!A&&(E||x())-A>L}}#R=()=>{};#A=()=>{};#N=()=>{};#p=()=>!1;#$(){let y=new d(this.#l);this.#y=0,this.#b=y,this.#I=b=>{this.#y-=y[b],y[b]=0},this.#U=(b,E,x,T)=>{if(this.#t(E))return 0;if(!f(x))if(T){if(typeof T!="function")throw new TypeError("sizeCalculation must be a function");if(x=T(E,b),!f(x))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return x},this.#O=(b,E,x)=>{if(y[b]=E,this.#f){let T=this.#f-y[b];for(;this.#y>T;)this.#k(!0)}this.#y+=y[b],x&&(x.entrySize=E,x.totalCalculatedSize=this.#y)}}#I=y=>{};#O=(y,b,E)=>{};#U=(y,b,E,x)=>{if(E||x)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#T({allowStale:y=this.allowStale}={}){if(this.#n)for(let b=this.#s;!(!this.#B(b)||((y||!this.#p(b))&&(yield b),b===this.#o));)b=this.#h[b]}*#x({allowStale:y=this.allowStale}={}){if(this.#n)for(let b=this.#o;!(!this.#B(b)||((y||!this.#p(b))&&(yield b),b===this.#s));)b=this.#u[b]}#B(y){return y!==void 0&&this.#i.get(this.#r[y])===y}*entries(){for(let y of this.#T())this.#e[y]!==void 0&&this.#r[y]!==void 0&&!this.#t(this.#e[y])&&(yield[this.#r[y],this.#e[y]])}*rentries(){for(let y of this.#x())this.#e[y]!==void 0&&this.#r[y]!==void 0&&!this.#t(this.#e[y])&&(yield[this.#r[y],this.#e[y]])}*keys(){for(let y of this.#T()){let b=this.#r[y];b!==void 0&&!this.#t(this.#e[y])&&(yield b)}}*rkeys(){for(let y of this.#x()){let b=this.#r[y];b!==void 0&&!this.#t(this.#e[y])&&(yield b)}}*values(){for(let y of this.#T())this.#e[y]!==void 0&&!this.#t(this.#e[y])&&(yield this.#e[y])}*rvalues(){for(let y of this.#x())this.#e[y]!==void 0&&!this.#t(this.#e[y])&&(yield this.#e[y])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(y,b={}){for(let E of this.#T()){let x=this.#e[E],T=this.#t(x)?x.__staleWhileFetching:x;if(T!==void 0&&y(T,this.#r[E],this))return this.get(this.#r[E],b)}}forEach(y,b=this){for(let E of this.#T()){let x=this.#e[E],T=this.#t(x)?x.__staleWhileFetching:x;T!==void 0&&y.call(b,T,this.#r[E],this)}}rforEach(y,b=this){for(let E of this.#x()){let x=this.#e[E],T=this.#t(x)?x.__staleWhileFetching:x;T!==void 0&&y.call(b,T,this.#r[E],this)}}purgeStale(){let y=!1;for(let b of this.#x({allowStale:!0}))this.#p(b)&&(this.#_(this.#r[b],"expire"),y=!0);return y}info(y){let b=this.#i.get(y);if(b===void 0)return;let E=this.#e[b],x=this.#t(E)?E.__staleWhileFetching:E;if(x===void 0)return;let T={value:x};if(this.#d&&this.#E){let A=this.#d[b],L=this.#E[b];if(A&&L){let w=A-(e.now()-L);T.ttl=w,T.start=Date.now()}}return this.#b&&(T.size=this.#b[b]),T}dump(){let y=[];for(let b of this.#T({allowStale:!0})){let E=this.#r[b],x=this.#e[b],T=this.#t(x)?x.__staleWhileFetching:x;if(T===void 0||E===void 0)continue;let A={value:T};if(this.#d&&this.#E){A.ttl=this.#d[b];let L=e.now()-this.#E[b];A.start=Math.floor(Date.now()-L)}this.#b&&(A.size=this.#b[b]),y.unshift([E,A])}return y}load(y){this.clear();for(let[b,E]of y){if(E.start){let x=Date.now()-E.start;E.start=e.now()-x}this.set(b,E.value,E)}}set(y,b,E={}){if(b===void 0)return this.delete(y),this;let{ttl:x=this.ttl,start:T,noDisposeOnSet:A=this.noDisposeOnSet,sizeCalculation:L=this.sizeCalculation,status:w}=E,{noUpdateTTL:C=this.noUpdateTTL}=E,I=this.#U(y,b,E.size||0,L);if(this.maxEntrySize&&I>this.maxEntrySize)return w&&(w.set="miss",w.maxEntrySizeExceeded=!0),this.#_(y,"set"),this;let O=this.#n===0?void 0:this.#i.get(y);if(O===void 0)O=this.#n===0?this.#s:this.#v.length!==0?this.#v.pop():this.#n===this.#l?this.#k(!1):this.#n,this.#r[O]=y,this.#e[O]=b,this.#i.set(y,O),this.#u[this.#s]=O,this.#h[O]=this.#s,this.#s=O,this.#n++,this.#O(O,I,w),w&&(w.set="add"),C=!1;else{this.#L(O);let B=this.#e[O];if(b!==B){if(this.#w&&this.#t(B)){B.__abortController.abort(new Error("replaced"));let{__staleWhileFetching:P}=B;P!==void 0&&!A&&(this.#S&&this.#g?.(P,y,"set"),this.#c&&this.#a?.push([P,y,"set"]))}else A||(this.#S&&this.#g?.(B,y,"set"),this.#c&&this.#a?.push([B,y,"set"]));if(this.#I(O),this.#O(O,I,w),this.#e[O]=b,w){w.set="replace";let P=B&&this.#t(B)?B.__staleWhileFetching:B;P!==void 0&&(w.oldValue=P)}}else w&&(w.set="update")}if(x!==0&&!this.#d&&this.#P(),this.#d&&(C||this.#N(O,x,T),w&&this.#A(w,O)),!A&&this.#c&&this.#a){let B=this.#a,P;for(;P=B?.shift();)this.#m?.(...P)}return this}pop(){try{for(;this.#n;){let y=this.#e[this.#o];if(this.#k(!0),this.#t(y)){if(y.__staleWhileFetching)return y.__staleWhileFetching}else if(y!==void 0)return y}}finally{if(this.#c&&this.#a){let y=this.#a,b;for(;b=y?.shift();)this.#m?.(...b)}}}#k(y){let b=this.#o,E=this.#r[b],x=this.#e[b];return this.#w&&this.#t(x)?x.__abortController.abort(new Error("evicted")):(this.#S||this.#c)&&(this.#S&&this.#g?.(x,E,"evict"),this.#c&&this.#a?.push([x,E,"evict"])),this.#I(b),y&&(this.#r[b]=void 0,this.#e[b]=void 0,this.#v.push(b)),this.#n===1?(this.#o=this.#s=0,this.#v.length=0):this.#o=this.#u[b],this.#i.delete(E),this.#n--,b}has(y,b={}){let{updateAgeOnHas:E=this.updateAgeOnHas,status:x}=b,T=this.#i.get(y);if(T!==void 0){let A=this.#e[T];if(this.#t(A)&&A.__staleWhileFetching===void 0)return!1;if(this.#p(T))x&&(x.has="stale",this.#A(x,T));else return E&&this.#R(T),x&&(x.has="hit",this.#A(x,T)),!0}else x&&(x.has="miss");return!1}peek(y,b={}){let{allowStale:E=this.allowStale}=b,x=this.#i.get(y);if(x===void 0||!E&&this.#p(x))return;let T=this.#e[x];return this.#t(T)?T.__staleWhileFetching:T}#M(y,b,E,x){let T=b===void 0?void 0:this.#e[b];if(this.#t(T))return T;let A=new s,{signal:L}=E;L?.addEventListener("abort",()=>A.abort(L.reason),{signal:A.signal});let w={signal:A.signal,options:E,context:x},C=(F,Z=!1)=>{let{aborted:X}=A.signal,q=E.ignoreFetchAbort&&F!==void 0;if(E.status&&(X&&!Z?(E.status.fetchAborted=!0,E.status.fetchError=A.signal.reason,q&&(E.status.fetchAbortIgnored=!0)):E.status.fetchResolved=!0),X&&!q&&!Z)return O(A.signal.reason);let H=P;return this.#e[b]===P&&(F===void 0?H.__staleWhileFetching?this.#e[b]=H.__staleWhileFetching:this.#_(y,"fetch"):(E.status&&(E.status.fetchUpdated=!0),this.set(y,F,w.options))),F},I=F=>(E.status&&(E.status.fetchRejected=!0,E.status.fetchError=F),O(F)),O=F=>{let{aborted:Z}=A.signal,X=Z&&E.allowStaleOnFetchAbort,q=X||E.allowStaleOnFetchRejection,H=q||E.noDeleteOnFetchRejection,K=P;if(this.#e[b]===P&&(!H||K.__staleWhileFetching===void 0?this.#_(y,"fetch"):X||(this.#e[b]=K.__staleWhileFetching)),q)return E.status&&K.__staleWhileFetching!==void 0&&(E.status.returnedStale=!0),K.__staleWhileFetching;if(K.__returned===K)throw F},B=(F,Z)=>{let X=this.#C?.(y,T,w);X&&X instanceof Promise&&X.then(q=>F(q===void 0?void 0:q),Z),A.signal.addEventListener("abort",()=>{(!E.ignoreFetchAbort||E.allowStaleOnFetchAbort)&&(F(void 0),E.allowStaleOnFetchAbort&&(F=q=>C(q,!0)))})};E.status&&(E.status.fetchDispatched=!0);let P=new Promise(B).then(C,I),$=Object.assign(P,{__abortController:A,__staleWhileFetching:T,__returned:void 0});return b===void 0?(this.set(y,$,{...w.options,status:void 0}),b=this.#i.get(y)):this.#e[b]=$,$}#t(y){if(!this.#w)return!1;let b=y;return!!b&&b instanceof Promise&&b.hasOwnProperty("__staleWhileFetching")&&b.__abortController instanceof s}async fetch(y,b={}){let{allowStale:E=this.allowStale,updateAgeOnGet:x=this.updateAgeOnGet,noDeleteOnStaleGet:T=this.noDeleteOnStaleGet,ttl:A=this.ttl,noDisposeOnSet:L=this.noDisposeOnSet,size:w=0,sizeCalculation:C=this.sizeCalculation,noUpdateTTL:I=this.noUpdateTTL,noDeleteOnFetchRejection:O=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:B=this.allowStaleOnFetchRejection,ignoreFetchAbort:P=this.ignoreFetchAbort,allowStaleOnFetchAbort:$=this.allowStaleOnFetchAbort,context:F,forceRefresh:Z=!1,status:X,signal:q}=b;if(!this.#w)return X&&(X.fetch="get"),this.get(y,{allowStale:E,updateAgeOnGet:x,noDeleteOnStaleGet:T,status:X});let H={allowStale:E,updateAgeOnGet:x,noDeleteOnStaleGet:T,ttl:A,noDisposeOnSet:L,size:w,sizeCalculation:C,noUpdateTTL:I,noDeleteOnFetchRejection:O,allowStaleOnFetchRejection:B,allowStaleOnFetchAbort:$,ignoreFetchAbort:P,status:X,signal:q},K=this.#i.get(y);if(K===void 0){X&&(X.fetch="miss");let z=this.#M(y,K,H,F);return z.__returned=z}else{let z=this.#e[K];if(this.#t(z)){let N=E&&z.__staleWhileFetching!==void 0;return X&&(X.fetch="inflight",N&&(X.returnedStale=!0)),N?z.__staleWhileFetching:z.__returned=z}let ie=this.#p(K);if(!Z&&!ie)return X&&(X.fetch="hit"),this.#L(K),x&&this.#R(K),X&&this.#A(X,K),z;let Y=this.#M(y,K,H,F),U=Y.__staleWhileFetching!==void 0&&E;return X&&(X.fetch=ie?"stale":"refresh",U&&ie&&(X.returnedStale=!0)),U?Y.__staleWhileFetching:Y.__returned=Y}}async forceFetch(y,b={}){let E=await this.fetch(y,b);if(E===void 0)throw new Error("fetch() returned undefined");return E}memo(y,b={}){let E=this.#D;if(!E)throw new Error("no memoMethod provided to constructor");let{context:x,forceRefresh:T,...A}=b,L=this.get(y,A);if(!T&&L!==void 0)return L;let w=E(y,L,{options:A,context:x});return this.set(y,w,A),w}get(y,b={}){let{allowStale:E=this.allowStale,updateAgeOnGet:x=this.updateAgeOnGet,noDeleteOnStaleGet:T=this.noDeleteOnStaleGet,status:A}=b,L=this.#i.get(y);if(L!==void 0){let w=this.#e[L],C=this.#t(w);return A&&this.#A(A,L),this.#p(L)?(A&&(A.get="stale"),C?(A&&E&&w.__staleWhileFetching!==void 0&&(A.returnedStale=!0),E?w.__staleWhileFetching:void 0):(T||this.#_(y,"expire"),A&&E&&(A.returnedStale=!0),E?w:void 0)):(A&&(A.get="hit"),C?w.__staleWhileFetching:(this.#L(L),x&&this.#R(L),w))}else A&&(A.get="miss")}#F(y,b){this.#h[b]=y,this.#u[y]=b}#L(y){y!==this.#s&&(y===this.#o?this.#o=this.#u[y]:this.#F(this.#h[y],this.#u[y]),this.#F(this.#s,y),this.#s=y)}delete(y){return this.#_(y,"delete")}#_(y,b){let E=!1;if(this.#n!==0){let x=this.#i.get(y);if(x!==void 0)if(E=!0,this.#n===1)this.#j(b);else{this.#I(x);let T=this.#e[x];if(this.#t(T)?T.__abortController.abort(new Error("deleted")):(this.#S||this.#c)&&(this.#S&&this.#g?.(T,y,b),this.#c&&this.#a?.push([T,y,b])),this.#i.delete(y),this.#r[x]=void 0,this.#e[x]=void 0,x===this.#s)this.#s=this.#h[x];else if(x===this.#o)this.#o=this.#u[x];else{let A=this.#h[x];this.#u[A]=this.#u[x];let L=this.#u[x];this.#h[L]=this.#h[x]}this.#n--,this.#v.push(x)}}if(this.#c&&this.#a?.length){let x=this.#a,T;for(;T=x?.shift();)this.#m?.(...T)}return E}clear(){return this.#j("delete")}#j(y){for(let b of this.#x({allowStale:!0})){let E=this.#e[b];if(this.#t(E))E.__abortController.abort(new Error("deleted"));else{let x=this.#r[b];this.#S&&this.#g?.(E,x,y),this.#c&&this.#a?.push([E,x,y])}}if(this.#i.clear(),this.#e.fill(void 0),this.#r.fill(void 0),this.#d&&this.#E&&(this.#d.fill(0),this.#E.fill(0)),this.#b&&this.#b.fill(0),this.#o=0,this.#s=0,this.#v.length=0,this.#y=0,this.#n=0,this.#c&&this.#a){let b=this.#a,E;for(;E=b?.shift();)this.#m?.(...E)}}};l.LRUCache=m}),_n=je(l=>{ke(),Pe(),Me(),Object.defineProperty(l,"t",{value:!0}),l.ContainerIterator=l.Container=l.Base=void 0;var e=class{constructor(n=0){this.iteratorType=n}equals(n){return this.o===n.o}};l.ContainerIterator=e;var t=class{constructor(){this.i=0}get length(){return this.i}size(){return this.i}empty(){return this.i===0}};l.Base=t;var r=class extends t{};l.Container=r}),OL=je(l=>{ke(),Pe(),Me(),Object.defineProperty(l,"t",{value:!0}),l.default=void 0;var e=_n(),t=class extends e.Base{constructor(n=[]){super(),this.S=[];let s=this;n.forEach(function(a){s.push(a)})}clear(){this.i=0,this.S=[]}push(n){return this.S.push(n),this.i+=1,this.i}pop(){if(this.i!==0)return this.i-=1,this.S.pop()}top(){return this.S[this.i-1]}},r=t;l.default=r}),kL=je(l=>{ke(),Pe(),Me(),Object.defineProperty(l,"t",{value:!0}),l.default=void 0;var e=_n(),t=class extends e.Base{constructor(n=[]){super(),this.j=0,this.q=[];let s=this;n.forEach(function(a){s.push(a)})}clear(){this.q=[],this.i=this.j=0}push(n){let s=this.q.length;if(this.j/s>.5&&this.j+this.i>=s&&s>4096){let a=this.i;for(let u=0;u<a;++u)this.q[u]=this.q[this.j+u];this.j=0,this.q[this.i]=n}else this.q[this.j+this.i]=n;return++this.i}pop(){if(this.i===0)return;let n=this.q[this.j++];return this.i-=1,n}front(){if(this.i!==0)return this.q[this.j]}},r=t;l.default=r}),ML=je(l=>{ke(),Pe(),Me(),Object.defineProperty(l,"t",{value:!0}),l.default=void 0;var e=_n(),t=class extends e.Base{constructor(n=[],s=function(u,f){return u>f?-1:u<f?1:0},a=!0){if(super(),this.v=s,Array.isArray(n))this.C=a?[...n]:n;else{this.C=[];let f=this;n.forEach(function(c){f.C.push(c)})}this.i=this.C.length;let u=this.i>>1;for(let f=this.i-1>>1;f>=0;--f)this.k(f,u)}m(n){let s=this.C[n];for(;n>0;){let a=n-1>>1,u=this.C[a];if(this.v(u,s)<=0)break;this.C[n]=u,n=a}this.C[n]=s}k(n,s){let a=this.C[n];for(;n<s;){let u=n<<1|1,f=u+1,c=this.C[u];if(f<this.i&&this.v(c,this.C[f])>0&&(u=f,c=this.C[f]),this.v(c,a)>=0)break;this.C[n]=c,n=u}this.C[n]=a}clear(){this.i=0,this.C.length=0}push(n){this.C.push(n),this.m(this.i),this.i+=1}pop(){if(this.i===0)return;let n=this.C[0],s=this.C.pop();return this.i-=1,this.i&&(this.C[0]=s,this.k(0,this.i>>1)),n}top(){return this.C[0]}find(n){return this.C.indexOf(n)>=0}remove(n){let s=this.C.indexOf(n);return s<0?!1:(s===0?this.pop():s===this.i-1?(this.C.pop(),this.i-=1):(this.C.splice(s,1,this.C.pop()),this.i-=1,this.m(s),this.k(s,this.i>>1)),!0)}updateItem(n){let s=this.C.indexOf(n);return s<0?!1:(this.m(s),this.k(s,this.i>>1),!0)}toArray(){return[...this.C]}},r=t;l.default=r}),bm=je(l=>{ke(),Pe(),Me(),Object.defineProperty(l,"t",{value:!0}),l.default=void 0;var e=_n(),t=class extends e.Container{},r=t;l.default=r}),An=je(l=>{ke(),Pe(),Me(),Object.defineProperty(l,"t",{value:!0}),l.throwIteratorAccessError=e;function e(){throw new RangeError("Iterator access denied!")}}),Cx=je(l=>{ke(),Pe(),Me(),Object.defineProperty(l,"t",{value:!0}),l.RandomIterator=void 0;var e=_n(),t=An(),r=class extends e.ContainerIterator{constructor(n,s){super(s),this.o=n,this.iteratorType===0?(this.pre=function(){return this.o===0&&(0,t.throwIteratorAccessError)(),this.o-=1,this},this.next=function(){return this.o===this.container.size()&&(0,t.throwIteratorAccessError)(),this.o+=1,this}):(this.pre=function(){return this.o===this.container.size()-1&&(0,t.throwIteratorAccessError)(),this.o+=1,this},this.next=function(){return this.o===-1&&(0,t.throwIteratorAccessError)(),this.o-=1,this})}get pointer(){return this.container.getElementByPos(this.o)}set pointer(n){this.container.setElementByPos(this.o,n)}};l.RandomIterator=r}),PL=je(l=>{ke(),Pe(),Me(),Object.defineProperty(l,"t",{value:!0}),l.default=void 0;var e=r(bm()),t=Cx();function r(u){return u&&u.t?u:{default:u}}var n=class Dx extends t.RandomIterator{constructor(f,c,d){super(f,d),this.container=c}copy(){return new Dx(this.o,this.container,this.iteratorType)}},s=class extends e.default{constructor(u=[],f=!0){if(super(),Array.isArray(u))this.J=f?[...u]:u,this.i=u.length;else{this.J=[];let c=this;u.forEach(function(d){c.pushBack(d)})}}clear(){this.i=0,this.J.length=0}begin(){return new n(0,this)}end(){return new n(this.i,this)}rBegin(){return new n(this.i-1,this,1)}rEnd(){return new n(-1,this,1)}front(){return this.J[0]}back(){return this.J[this.i-1]}getElementByPos(u){if(u<0||u>this.i-1)throw new RangeError;return this.J[u]}eraseElementByPos(u){if(u<0||u>this.i-1)throw new RangeError;return this.J.splice(u,1),this.i-=1,this.i}eraseElementByValue(u){let f=0;for(let c=0;c<this.i;++c)this.J[c]!==u&&(this.J[f++]=this.J[c]);return this.i=this.J.length=f,this.i}eraseElementByIterator(u){let f=u.o;return u=u.next(),this.eraseElementByPos(f),u}pushBack(u){return this.J.push(u),this.i+=1,this.i}popBack(){if(this.i!==0)return this.i-=1,this.J.pop()}setElementByPos(u,f){if(u<0||u>this.i-1)throw new RangeError;this.J[u]=f}insert(u,f,c=1){if(u<0||u>this.i)throw new RangeError;return this.J.splice(u,0,...new Array(c).fill(f)),this.i+=c,this.i}find(u){for(let f=0;f<this.i;++f)if(this.J[f]===u)return new n(f,this);return this.end()}reverse(){this.J.reverse()}unique(){let u=1;for(let f=1;f<this.i;++f)this.J[f]!==this.J[f-1]&&(this.J[u++]=this.J[f]);return this.i=this.J.length=u,this.i}sort(u){this.J.sort(u)}forEach(u){for(let f=0;f<this.i;++f)u(this.J[f],f,this)}[Symbol.iterator](){return(function*(){yield*this.J}).bind(this)()}},a=s;l.default=a}),NL=je(l=>{ke(),Pe(),Me(),Object.defineProperty(l,"t",{value:!0}),l.default=void 0;var e=n(bm()),t=_n(),r=An();function n(f){return f&&f.t?f:{default:f}}var s=class Ox extends t.ContainerIterator{constructor(c,d,p,m){super(m),this.o=c,this.h=d,this.container=p,this.iteratorType===0?(this.pre=function(){return this.o.L===this.h&&(0,r.throwIteratorAccessError)(),this.o=this.o.L,this},this.next=function(){return this.o===this.h&&(0,r.throwIteratorAccessError)(),this.o=this.o.B,this}):(this.pre=function(){return this.o.B===this.h&&(0,r.throwIteratorAccessError)(),this.o=this.o.B,this},this.next=function(){return this.o===this.h&&(0,r.throwIteratorAccessError)(),this.o=this.o.L,this})}get pointer(){return this.o===this.h&&(0,r.throwIteratorAccessError)(),this.o.l}set pointer(c){this.o===this.h&&(0,r.throwIteratorAccessError)(),this.o.l=c}copy(){return new Ox(this.o,this.h,this.container,this.iteratorType)}},a=class extends e.default{constructor(f=[]){super(),this.h={},this.p=this._=this.h.L=this.h.B=this.h;let c=this;f.forEach(function(d){c.pushBack(d)})}V(f){let{L:c,B:d}=f;c.B=d,d.L=c,f===this.p&&(this.p=d),f===this._&&(this._=c),this.i-=1}G(f,c){let d=c.B,p={l:f,L:c,B:d};c.B=p,d.L=p,c===this.h&&(this.p=p),d===this.h&&(this._=p),this.i+=1}clear(){this.i=0,this.p=this._=this.h.L=this.h.B=this.h}begin(){return new s(this.p,this.h,this)}end(){return new s(this.h,this.h,this)}rBegin(){return new s(this._,this.h,this,1)}rEnd(){return new s(this.h,this.h,this,1)}front(){return this.p.l}back(){return this._.l}getElementByPos(f){if(f<0||f>this.i-1)throw new RangeError;let c=this.p;for(;f--;)c=c.B;return c.l}eraseElementByPos(f){if(f<0||f>this.i-1)throw new RangeError;let c=this.p;for(;f--;)c=c.B;return this.V(c),this.i}eraseElementByValue(f){let c=this.p;for(;c!==this.h;)c.l===f&&this.V(c),c=c.B;return this.i}eraseElementByIterator(f){let c=f.o;return c===this.h&&(0,r.throwIteratorAccessError)(),f=f.next(),this.V(c),f}pushBack(f){return this.G(f,this._),this.i}popBack(){if(this.i===0)return;let f=this._.l;return this.V(this._),f}pushFront(f){return this.G(f,this.h),this.i}popFront(){if(this.i===0)return;let f=this.p.l;return this.V(this.p),f}setElementByPos(f,c){if(f<0||f>this.i-1)throw new RangeError;let d=this.p;for(;f--;)d=d.B;d.l=c}insert(f,c,d=1){if(f<0||f>this.i)throw new RangeError;if(d<=0)return this.i;if(f===0)for(;d--;)this.pushFront(c);else if(f===this.i)for(;d--;)this.pushBack(c);else{let p=this.p;for(let v=1;v<f;++v)p=p.B;let m=p.B;for(this.i+=d;d--;)p.B={l:c,L:p},p.B.L=p,p=p.B;p.B=m,m.L=p}return this.i}find(f){let c=this.p;for(;c!==this.h;){if(c.l===f)return new s(c,this.h,this);c=c.B}return this.end()}reverse(){if(this.i<=1)return;let f=this.p,c=this._,d=0;for(;d<<1<this.i;){let p=f.l;f.l=c.l,c.l=p,f=f.B,c=c.L,d+=1}}unique(){if(this.i<=1)return this.i;let f=this.p;for(;f!==this.h;){let c=f;for(;c.B!==this.h&&c.l===c.B.l;)c=c.B,this.i-=1;f.B=c.B,f.B.L=f,f=f.B}return this.i}sort(f){if(this.i<=1)return;let c=[];this.forEach(function(p){c.push(p)}),c.sort(f);let d=this.p;c.forEach(function(p){d.l=p,d=d.B})}merge(f){let c=this;if(this.i===0)f.forEach(function(d){c.pushBack(d)});else{let d=this.p;f.forEach(function(p){for(;d!==c.h&&d.l<=p;)d=d.B;c.G(p,d.L)})}return this.i}forEach(f){let c=this.p,d=0;for(;c!==this.h;)f(c.l,d++,this),c=c.B}[Symbol.iterator](){return(function*(){if(this.i===0)return;let f=this.p;for(;f!==this.h;)yield f.l,f=f.B}).bind(this)()}},u=a;l.default=u}),UL=je(l=>{ke(),Pe(),Me(),Object.defineProperty(l,"t",{value:!0}),l.default=void 0;var e=r(bm()),t=Cx();function r(u){return u&&u.t?u:{default:u}}var n=class kx extends t.RandomIterator{constructor(f,c,d){super(f,d),this.container=c}copy(){return new kx(this.o,this.container,this.iteratorType)}},s=class extends e.default{constructor(u=[],f=4096){super(),this.j=0,this.D=0,this.R=0,this.N=0,this.P=0,this.A=[];let c=(()=>{if(typeof u.length=="number")return u.length;if(typeof u.size=="number")return u.size;if(typeof u.size=="function")return u.size();throw new TypeError("Cannot get the length or size of the container")})();this.F=f,this.P=Math.max(Math.ceil(c/this.F),1);for(let m=0;m<this.P;++m)this.A.push(new Array(this.F));let d=Math.ceil(c/this.F);this.j=this.R=(this.P>>1)-(d>>1),this.D=this.N=this.F-c%this.F>>1;let p=this;u.forEach(function(m){p.pushBack(m)})}T(){let u=[],f=Math.max(this.P>>1,1);for(let c=0;c<f;++c)u[c]=new Array(this.F);for(let c=this.j;c<this.P;++c)u[u.length]=this.A[c];for(let c=0;c<this.R;++c)u[u.length]=this.A[c];u[u.length]=[...this.A[this.R]],this.j=f,this.R=u.length-1;for(let c=0;c<f;++c)u[u.length]=new Array(this.F);this.A=u,this.P=u.length}O(u){let f=this.D+u+1,c=f%this.F,d=c-1,p=this.j+(f-c)/this.F;return c===0&&(p-=1),p%=this.P,d<0&&(d+=this.F),{curNodeBucketIndex:p,curNodePointerIndex:d}}clear(){this.A=[new Array(this.F)],this.P=1,this.j=this.R=this.i=0,this.D=this.N=this.F>>1}begin(){return new n(0,this)}end(){return new n(this.i,this)}rBegin(){return new n(this.i-1,this,1)}rEnd(){return new n(-1,this,1)}front(){if(this.i!==0)return this.A[this.j][this.D]}back(){if(this.i!==0)return this.A[this.R][this.N]}pushBack(u){return this.i&&(this.N<this.F-1?this.N+=1:this.R<this.P-1?(this.R+=1,this.N=0):(this.R=0,this.N=0),this.R===this.j&&this.N===this.D&&this.T()),this.i+=1,this.A[this.R][this.N]=u,this.i}popBack(){if(this.i===0)return;let u=this.A[this.R][this.N];return this.i!==1&&(this.N>0?this.N-=1:this.R>0?(this.R-=1,this.N=this.F-1):(this.R=this.P-1,this.N=this.F-1)),this.i-=1,u}pushFront(u){return this.i&&(this.D>0?this.D-=1:this.j>0?(this.j-=1,this.D=this.F-1):(this.j=this.P-1,this.D=this.F-1),this.j===this.R&&this.D===this.N&&this.T()),this.i+=1,this.A[this.j][this.D]=u,this.i}popFront(){if(this.i===0)return;let u=this.A[this.j][this.D];return this.i!==1&&(this.D<this.F-1?this.D+=1:this.j<this.P-1?(this.j+=1,this.D=0):(this.j=0,this.D=0)),this.i-=1,u}getElementByPos(u){if(u<0||u>this.i-1)throw new RangeError;let{curNodeBucketIndex:f,curNodePointerIndex:c}=this.O(u);return this.A[f][c]}setElementByPos(u,f){if(u<0||u>this.i-1)throw new RangeError;let{curNodeBucketIndex:c,curNodePointerIndex:d}=this.O(u);this.A[c][d]=f}insert(u,f,c=1){if(u<0||u>this.i)throw new RangeError;if(u===0)for(;c--;)this.pushFront(f);else if(u===this.i)for(;c--;)this.pushBack(f);else{let d=[];for(let p=u;p<this.i;++p)d.push(this.getElementByPos(p));this.cut(u-1);for(let p=0;p<c;++p)this.pushBack(f);for(let p=0;p<d.length;++p)this.pushBack(d[p])}return this.i}cut(u){if(u<0)return this.clear(),0;let{curNodeBucketIndex:f,curNodePointerIndex:c}=this.O(u);return this.R=f,this.N=c,this.i=u+1,this.i}eraseElementByPos(u){if(u<0||u>this.i-1)throw new RangeError;if(u===0)this.popFront();else if(u===this.i-1)this.popBack();else{let f=[];for(let d=u+1;d<this.i;++d)f.push(this.getElementByPos(d));this.cut(u),this.popBack();let c=this;f.forEach(function(d){c.pushBack(d)})}return this.i}eraseElementByValue(u){if(this.i===0)return 0;let f=[];for(let d=0;d<this.i;++d){let p=this.getElementByPos(d);p!==u&&f.push(p)}let c=f.length;for(let d=0;d<c;++d)this.setElementByPos(d,f[d]);return this.cut(c-1)}eraseElementByIterator(u){let f=u.o;return this.eraseElementByPos(f),u=u.next(),u}find(u){for(let f=0;f<this.i;++f)if(this.getElementByPos(f)===u)return new n(f,this);return this.end()}reverse(){let u=0,f=this.i-1;for(;u<f;){let c=this.getElementByPos(u);this.setElementByPos(u,this.getElementByPos(f)),this.setElementByPos(f,c),u+=1,f-=1}}unique(){if(this.i<=1)return this.i;let u=1,f=this.getElementByPos(0);for(let c=1;c<this.i;++c){let d=this.getElementByPos(c);d!==f&&(f=d,this.setElementByPos(u++,d))}for(;this.i>u;)this.popBack();return this.i}sort(u){let f=[];for(let c=0;c<this.i;++c)f.push(this.getElementByPos(c));f.sort(u);for(let c=0;c<this.i;++c)this.setElementByPos(c,f[c])}shrinkToFit(){if(this.i===0)return;let u=[];this.forEach(function(f){u.push(f)}),this.P=Math.max(Math.ceil(this.i/this.F),1),this.i=this.j=this.R=this.D=this.N=0,this.A=[];for(let f=0;f<this.P;++f)this.A.push(new Array(this.F));for(let f=0;f<u.length;++f)this.pushBack(u[f])}forEach(u){for(let f=0;f<this.i;++f)u(this.getElementByPos(f),f,this)}[Symbol.iterator](){return(function*(){for(let u=0;u<this.i;++u)yield this.getElementByPos(u)}).bind(this)()}},a=s;l.default=a}),BL=je(l=>{ke(),Pe(),Me(),Object.defineProperty(l,"t",{value:!0}),l.TreeNodeEnableIndex=l.TreeNode=void 0;var e=class{constructor(r,n){this.ee=1,this.u=void 0,this.l=void 0,this.U=void 0,this.W=void 0,this.tt=void 0,this.u=r,this.l=n}L(){let r=this;if(r.ee===1&&r.tt.tt===r)r=r.W;else if(r.U)for(r=r.U;r.W;)r=r.W;else{let n=r.tt;for(;n.U===r;)r=n,n=r.tt;r=n}return r}B(){let r=this;if(r.W){for(r=r.W;r.U;)r=r.U;return r}else{let n=r.tt;for(;n.W===r;)r=n,n=r.tt;return r.W!==n?n:r}}te(){let r=this.tt,n=this.W,s=n.U;return r.tt===this?r.tt=n:r.U===this?r.U=n:r.W=n,n.tt=r,n.U=this,this.tt=n,this.W=s,s&&(s.tt=this),n}se(){let r=this.tt,n=this.U,s=n.W;return r.tt===this?r.tt=n:r.U===this?r.U=n:r.W=n,n.tt=r,n.W=this,this.tt=n,this.U=s,s&&(s.tt=this),n}};l.TreeNode=e;var t=class extends e{constructor(){super(...arguments),this.rt=1}te(){let r=super.te();return this.ie(),r.ie(),r}se(){let r=super.se();return this.ie(),r.ie(),r}ie(){this.rt=1,this.U&&(this.rt+=this.U.rt),this.W&&(this.rt+=this.W.rt)}};l.TreeNodeEnableIndex=t}),Mx=je(l=>{ke(),Pe(),Me(),Object.defineProperty(l,"t",{value:!0}),l.default=void 0;var e=BL(),t=_n(),r=An(),n=class extends t.Container{constructor(a=function(f,c){return f<c?-1:f>c?1:0},u=!1){super(),this.Y=void 0,this.v=a,u?(this.re=e.TreeNodeEnableIndex,this.M=function(f,c,d){let p=this.ne(f,c,d);if(p){let m=p.tt;for(;m!==this.h;)m.rt+=1,m=m.tt;let v=this.he(p);if(v){let{parentNode:y,grandParent:b,curNode:E}=v;y.ie(),b.ie(),E.ie()}}return this.i},this.V=function(f){let c=this.fe(f);for(;c!==this.h;)c.rt-=1,c=c.tt}):(this.re=e.TreeNode,this.M=function(f,c,d){let p=this.ne(f,c,d);return p&&this.he(p),this.i},this.V=this.fe),this.h=new this.re}X(a,u){let f=this.h;for(;a;){let c=this.v(a.u,u);if(c<0)a=a.W;else if(c>0)f=a,a=a.U;else return a}return f}Z(a,u){let f=this.h;for(;a;)this.v(a.u,u)<=0?a=a.W:(f=a,a=a.U);return f}$(a,u){let f=this.h;for(;a;){let c=this.v(a.u,u);if(c<0)f=a,a=a.W;else if(c>0)a=a.U;else return a}return f}rr(a,u){let f=this.h;for(;a;)this.v(a.u,u)<0?(f=a,a=a.W):a=a.U;return f}ue(a){for(;;){let u=a.tt;if(u===this.h)return;if(a.ee===1){a.ee=0;return}if(a===u.U){let f=u.W;if(f.ee===1)f.ee=0,u.ee=1,u===this.Y?this.Y=u.te():u.te();else if(f.W&&f.W.ee===1){f.ee=u.ee,u.ee=0,f.W.ee=0,u===this.Y?this.Y=u.te():u.te();return}else f.U&&f.U.ee===1?(f.ee=1,f.U.ee=0,f.se()):(f.ee=1,a=u)}else{let f=u.U;if(f.ee===1)f.ee=0,u.ee=1,u===this.Y?this.Y=u.se():u.se();else if(f.U&&f.U.ee===1){f.ee=u.ee,u.ee=0,f.U.ee=0,u===this.Y?this.Y=u.se():u.se();return}else f.W&&f.W.ee===1?(f.ee=1,f.W.ee=0,f.te()):(f.ee=1,a=u)}}}fe(a){if(this.i===1)return this.clear(),this.h;let u=a;for(;u.U||u.W;){if(u.W)for(u=u.W;u.U;)u=u.U;else u=u.U;[a.u,u.u]=[u.u,a.u],[a.l,u.l]=[u.l,a.l],a=u}this.h.U===u?this.h.U=u.tt:this.h.W===u&&(this.h.W=u.tt),this.ue(u);let f=u.tt;return u===f.U?f.U=void 0:f.W=void 0,this.i-=1,this.Y.ee=0,f}oe(a,u){return a===void 0?!1:this.oe(a.U,u)||u(a)?!0:this.oe(a.W,u)}he(a){for(;;){let u=a.tt;if(u.ee===0)return;let f=u.tt;if(u===f.U){let c=f.W;if(c&&c.ee===1){if(c.ee=u.ee=0,f===this.Y)return;f.ee=1,a=f;continue}else if(a===u.W){if(a.ee=0,a.U&&(a.U.tt=u),a.W&&(a.W.tt=f),u.W=a.U,f.U=a.W,a.U=u,a.W=f,f===this.Y)this.Y=a,this.h.tt=a;else{let d=f.tt;d.U===f?d.U=a:d.W=a}return a.tt=f.tt,u.tt=a,f.tt=a,f.ee=1,{parentNode:u,grandParent:f,curNode:a}}else u.ee=0,f===this.Y?this.Y=f.se():f.se(),f.ee=1}else{let c=f.U;if(c&&c.ee===1){if(c.ee=u.ee=0,f===this.Y)return;f.ee=1,a=f;continue}else if(a===u.U){if(a.ee=0,a.U&&(a.U.tt=f),a.W&&(a.W.tt=u),f.W=a.U,u.U=a.W,a.U=f,a.W=u,f===this.Y)this.Y=a,this.h.tt=a;else{let d=f.tt;d.U===f?d.U=a:d.W=a}return a.tt=f.tt,u.tt=a,f.tt=a,f.ee=1,{parentNode:u,grandParent:f,curNode:a}}else u.ee=0,f===this.Y?this.Y=f.te():f.te(),f.ee=1}return}}ne(a,u,f){if(this.Y===void 0){this.i+=1,this.Y=new this.re(a,u),this.Y.ee=0,this.Y.tt=this.h,this.h.tt=this.Y,this.h.U=this.Y,this.h.W=this.Y;return}let c,d=this.h.U,p=this.v(d.u,a);if(p===0){d.l=u;return}else if(p>0)d.U=new this.re(a,u),d.U.tt=d,c=d.U,this.h.U=c;else{let m=this.h.W,v=this.v(m.u,a);if(v===0){m.l=u;return}else if(v<0)m.W=new this.re(a,u),m.W.tt=m,c=m.W,this.h.W=c;else{if(f!==void 0){let y=f.o;if(y!==this.h){let b=this.v(y.u,a);if(b===0){y.l=u;return}else if(b>0){let E=y.L(),x=this.v(E.u,a);if(x===0){E.l=u;return}else x<0&&(c=new this.re(a,u),E.W===void 0?(E.W=c,c.tt=E):(y.U=c,c.tt=y))}}}if(c===void 0)for(c=this.Y;;){let y=this.v(c.u,a);if(y>0){if(c.U===void 0){c.U=new this.re(a,u),c.U.tt=c,c=c.U;break}c=c.U}else if(y<0){if(c.W===void 0){c.W=new this.re(a,u),c.W.tt=c,c=c.W;break}c=c.W}else{c.l=u;return}}}}return this.i+=1,c}I(a,u){for(;a;){let f=this.v(a.u,u);if(f<0)a=a.W;else if(f>0)a=a.U;else return a}return a||this.h}clear(){this.i=0,this.Y=void 0,this.h.tt=void 0,this.h.U=this.h.W=void 0}updateKeyByIterator(a,u){let f=a.o;if(f===this.h&&(0,r.throwIteratorAccessError)(),this.i===1)return f.u=u,!0;if(f===this.h.U)return this.v(f.B().u,u)>0?(f.u=u,!0):!1;if(f===this.h.W)return this.v(f.L().u,u)<0?(f.u=u,!0):!1;let c=f.L().u;if(this.v(c,u)>=0)return!1;let d=f.B().u;return this.v(d,u)<=0?!1:(f.u=u,!0)}eraseElementByPos(a){if(a<0||a>this.i-1)throw new RangeError;let u=0,f=this;return this.oe(this.Y,function(c){return a===u?(f.V(c),!0):(u+=1,!1)}),this.i}eraseElementByKey(a){if(this.i===0)return!1;let u=this.I(this.Y,a);return u===this.h?!1:(this.V(u),!0)}eraseElementByIterator(a){let u=a.o;u===this.h&&(0,r.throwIteratorAccessError)();let f=u.W===void 0;return a.iteratorType===0?f&&a.next():(!f||u.U===void 0)&&a.next(),this.V(u),a}forEach(a){let u=0;for(let f of this)a(f,u++,this)}getElementByPos(a){if(a<0||a>this.i-1)throw new RangeError;let u,f=0;for(let c of this){if(f===a){u=c;break}f+=1}return u}getHeight(){if(this.i===0)return 0;let a=function(u){return u?Math.max(a(u.U),a(u.W))+1:0};return a(this.Y)}},s=n;l.default=s}),Px=je(l=>{ke(),Pe(),Me(),Object.defineProperty(l,"t",{value:!0}),l.default=void 0;var e=_n(),t=An(),r=class extends e.ContainerIterator{constructor(s,a,u){super(u),this.o=s,this.h=a,this.iteratorType===0?(this.pre=function(){return this.o===this.h.U&&(0,t.throwIteratorAccessError)(),this.o=this.o.L(),this},this.next=function(){return this.o===this.h&&(0,t.throwIteratorAccessError)(),this.o=this.o.B(),this}):(this.pre=function(){return this.o===this.h.W&&(0,t.throwIteratorAccessError)(),this.o=this.o.B(),this},this.next=function(){return this.o===this.h&&(0,t.throwIteratorAccessError)(),this.o=this.o.L(),this})}get index(){let s=this.o,a=this.h.tt;if(s===this.h)return a?a.rt-1:0;let u=0;for(s.U&&(u+=s.U.rt);s!==a;){let f=s.tt;s===f.W&&(u+=1,f.U&&(u+=f.U.rt)),s=f}return u}},n=r;l.default=n}),FL=je(l=>{ke(),Pe(),Me(),Object.defineProperty(l,"t",{value:!0}),l.default=void 0;var e=n(Mx()),t=n(Px()),r=An();function n(f){return f&&f.t?f:{default:f}}var s=class Nx extends t.default{constructor(c,d,p,m){super(c,d,m),this.container=p}get pointer(){return this.o===this.h&&(0,r.throwIteratorAccessError)(),this.o.u}copy(){return new Nx(this.o,this.h,this.container,this.iteratorType)}},a=class extends e.default{constructor(f=[],c,d){super(c,d);let p=this;f.forEach(function(m){p.insert(m)})}*K(f){f!==void 0&&(yield*this.K(f.U),yield f.u,yield*this.K(f.W))}begin(){return new s(this.h.U||this.h,this.h,this)}end(){return new s(this.h,this.h,this)}rBegin(){return new s(this.h.W||this.h,this.h,this,1)}rEnd(){return new s(this.h,this.h,this,1)}front(){return this.h.U?this.h.U.u:void 0}back(){return this.h.W?this.h.W.u:void 0}insert(f,c){return this.M(f,void 0,c)}find(f){let c=this.I(this.Y,f);return new s(c,this.h,this)}lowerBound(f){let c=this.X(this.Y,f);return new s(c,this.h,this)}upperBound(f){let c=this.Z(this.Y,f);return new s(c,this.h,this)}reverseLowerBound(f){let c=this.$(this.Y,f);return new s(c,this.h,this)}reverseUpperBound(f){let c=this.rr(this.Y,f);return new s(c,this.h,this)}union(f){let c=this;return f.forEach(function(d){c.insert(d)}),this.i}[Symbol.iterator](){return this.K(this.Y)}},u=a;l.default=u}),jL=je(l=>{ke(),Pe(),Me(),Object.defineProperty(l,"t",{value:!0}),l.default=void 0;var e=n(Mx()),t=n(Px()),r=An();function n(f){return f&&f.t?f:{default:f}}var s=class Ux extends t.default{constructor(c,d,p,m){super(c,d,m),this.container=p}get pointer(){this.o===this.h&&(0,r.throwIteratorAccessError)();let c=this;return new Proxy([],{get(d,p){if(p==="0")return c.o.u;if(p==="1")return c.o.l},set(d,p,m){if(p!=="1")throw new TypeError("props must be 1");return c.o.l=m,!0}})}copy(){return new Ux(this.o,this.h,this.container,this.iteratorType)}},a=class extends e.default{constructor(f=[],c,d){super(c,d);let p=this;f.forEach(function(m){p.setElement(m[0],m[1])})}*K(f){f!==void 0&&(yield*this.K(f.U),yield[f.u,f.l],yield*this.K(f.W))}begin(){return new s(this.h.U||this.h,this.h,this)}end(){return new s(this.h,this.h,this)}rBegin(){return new s(this.h.W||this.h,this.h,this,1)}rEnd(){return new s(this.h,this.h,this,1)}front(){if(this.i===0)return;let f=this.h.U;return[f.u,f.l]}back(){if(this.i===0)return;let f=this.h.W;return[f.u,f.l]}lowerBound(f){let c=this.X(this.Y,f);return new s(c,this.h,this)}upperBound(f){let c=this.Z(this.Y,f);return new s(c,this.h,this)}reverseLowerBound(f){let c=this.$(this.Y,f);return new s(c,this.h,this)}reverseUpperBound(f){let c=this.rr(this.Y,f);return new s(c,this.h,this)}setElement(f,c,d){return this.M(f,c,d)}find(f){let c=this.I(this.Y,f);return new s(c,this.h,this)}getElementByKey(f){return this.I(this.Y,f).l}union(f){let c=this;return f.forEach(function(d){c.setElement(d[0],d[1])}),this.i}[Symbol.iterator](){return this.K(this.Y)}},u=a;l.default=u}),Bx=je(l=>{ke(),Pe(),Me(),Object.defineProperty(l,"t",{value:!0}),l.default=e;function e(t){let r=typeof t;return r==="object"&&t!==null||r==="function"}}),Fx=je(l=>{ke(),Pe(),Me(),Object.defineProperty(l,"t",{value:!0}),l.HashContainerIterator=l.HashContainer=void 0;var e=_n(),t=n(Bx()),r=An();function n(u){return u&&u.t?u:{default:u}}var s=class extends e.ContainerIterator{constructor(u,f,c){super(c),this.o=u,this.h=f,this.iteratorType===0?(this.pre=function(){return this.o.L===this.h&&(0,r.throwIteratorAccessError)(),this.o=this.o.L,this},this.next=function(){return this.o===this.h&&(0,r.throwIteratorAccessError)(),this.o=this.o.B,this}):(this.pre=function(){return this.o.B===this.h&&(0,r.throwIteratorAccessError)(),this.o=this.o.B,this},this.next=function(){return this.o===this.h&&(0,r.throwIteratorAccessError)(),this.o=this.o.L,this})}};l.HashContainerIterator=s;var a=class extends e.Container{constructor(){super(),this.H=[],this.g={},this.HASH_TAG=Symbol("@@HASH_TAG"),Object.setPrototypeOf(this.g,null),this.h={},this.h.L=this.h.B=this.p=this._=this.h}V(u){let{L:f,B:c}=u;f.B=c,c.L=f,u===this.p&&(this.p=c),u===this._&&(this._=f),this.i-=1}M(u,f,c){c===void 0&&(c=(0,t.default)(u));let d;if(c){let p=u[this.HASH_TAG];if(p!==void 0)return this.H[p].l=f,this.i;Object.defineProperty(u,this.HASH_TAG,{value:this.H.length,configurable:!0}),d={u,l:f,L:this._,B:this.h},this.H.push(d)}else{let p=this.g[u];if(p)return p.l=f,this.i;d={u,l:f,L:this._,B:this.h},this.g[u]=d}return this.i===0?(this.p=d,this.h.B=d):this._.B=d,this._=d,this.h.L=d,++this.i}I(u,f){if(f===void 0&&(f=(0,t.default)(u)),f){let c=u[this.HASH_TAG];return c===void 0?this.h:this.H[c]}else return this.g[u]||this.h}clear(){let u=this.HASH_TAG;this.H.forEach(function(f){delete f.u[u]}),this.H=[],this.g={},Object.setPrototypeOf(this.g,null),this.i=0,this.p=this._=this.h.L=this.h.B=this.h}eraseElementByKey(u,f){let c;if(f===void 0&&(f=(0,t.default)(u)),f){let d=u[this.HASH_TAG];if(d===void 0)return!1;delete u[this.HASH_TAG],c=this.H[d],delete this.H[d]}else{if(c=this.g[u],c===void 0)return!1;delete this.g[u]}return this.V(c),!0}eraseElementByIterator(u){let f=u.o;return f===this.h&&(0,r.throwIteratorAccessError)(),this.V(f),u.next()}eraseElementByPos(u){if(u<0||u>this.i-1)throw new RangeError;let f=this.p;for(;u--;)f=f.B;return this.V(f),this.i}};l.HashContainer=a}),$L=je(l=>{ke(),Pe(),Me(),Object.defineProperty(l,"t",{value:!0}),l.default=void 0;var e=Fx(),t=An(),r=class jx extends e.HashContainerIterator{constructor(u,f,c,d){super(u,f,d),this.container=c}get pointer(){return this.o===this.h&&(0,t.throwIteratorAccessError)(),this.o.u}copy(){return new jx(this.o,this.h,this.container,this.iteratorType)}},n=class extends e.HashContainer{constructor(a=[]){super();let u=this;a.forEach(function(f){u.insert(f)})}begin(){return new r(this.p,this.h,this)}end(){return new r(this.h,this.h,this)}rBegin(){return new r(this._,this.h,this,1)}rEnd(){return new r(this.h,this.h,this,1)}front(){return this.p.u}back(){return this._.u}insert(a,u){return this.M(a,void 0,u)}getElementByPos(a){if(a<0||a>this.i-1)throw new RangeError;let u=this.p;for(;a--;)u=u.B;return u.u}find(a,u){let f=this.I(a,u);return new r(f,this.h,this)}forEach(a){let u=0,f=this.p;for(;f!==this.h;)a(f.u,u++,this),f=f.B}[Symbol.iterator](){return(function*(){let a=this.p;for(;a!==this.h;)yield a.u,a=a.B}).bind(this)()}},s=n;l.default=s}),GL=je(l=>{ke(),Pe(),Me(),Object.defineProperty(l,"t",{value:!0}),l.default=void 0;var e=Fx(),t=n(Bx()),r=An();function n(f){return f&&f.t?f:{default:f}}var s=class $x extends e.HashContainerIterator{constructor(c,d,p,m){super(c,d,m),this.container=p}get pointer(){this.o===this.h&&(0,r.throwIteratorAccessError)();let c=this;return new Proxy([],{get(d,p){if(p==="0")return c.o.u;if(p==="1")return c.o.l},set(d,p,m){if(p!=="1")throw new TypeError("props must be 1");return c.o.l=m,!0}})}copy(){return new $x(this.o,this.h,this.container,this.iteratorType)}},a=class extends e.HashContainer{constructor(f=[]){super();let c=this;f.forEach(function(d){c.setElement(d[0],d[1])})}begin(){return new s(this.p,this.h,this)}end(){return new s(this.h,this.h,this)}rBegin(){return new s(this._,this.h,this,1)}rEnd(){return new s(this.h,this.h,this,1)}front(){if(this.i!==0)return[this.p.u,this.p.l]}back(){if(this.i!==0)return[this._.u,this._.l]}setElement(f,c,d){return this.M(f,c,d)}getElementByKey(f,c){if(c===void 0&&(c=(0,t.default)(f)),c){let p=f[this.HASH_TAG];return p!==void 0?this.H[p].l:void 0}let d=this.g[f];return d?d.l:void 0}getElementByPos(f){if(f<0||f>this.i-1)throw new RangeError;let c=this.p;for(;f--;)c=c.B;return[c.u,c.l]}find(f,c){let d=this.I(f,c);return new s(d,this.h,this)}forEach(f){let c=0,d=this.p;for(;d!==this.h;)f([d.u,d.l],c++,this),d=d.B}[Symbol.iterator](){return(function*(){let f=this.p;for(;f!==this.h;)yield[f.u,f.l],f=f.B}).bind(this)()}},u=a;l.default=u}),HL=je(l=>{ke(),Pe(),Me(),Object.defineProperty(l,"t",{value:!0}),Object.defineProperty(l,"Deque",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(l,"HashMap",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(l,"HashSet",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(l,"LinkList",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(l,"OrderedMap",{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(l,"OrderedSet",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(l,"PriorityQueue",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(l,"Queue",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(l,"Stack",{enumerable:!0,get:function(){return e.default}}),Object.defineProperty(l,"Vector",{enumerable:!0,get:function(){return n.default}});var e=p(OL()),t=p(kL()),r=p(ML()),n=p(PL()),s=p(NL()),a=p(UL()),u=p(FL()),f=p(jL()),c=p($L()),d=p(GL());function p(m){return m&&m.t?m:{default:m}}}),KL=je((l,e)=>{ke(),Pe(),Me();var t=HL().OrderedSet,r=Sn()("number-allocator:trace"),n=Sn()("number-allocator:error");function s(u,f){this.low=u,this.high=f}s.prototype.equals=function(u){return this.low===u.low&&this.high===u.high},s.prototype.compare=function(u){return this.low<u.low&&this.high<u.low?-1:u.low<this.low&&u.high<this.low?1:0};function a(u,f){if(!(this instanceof a))return new a(u,f);this.min=u,this.max=f,this.ss=new t([],(c,d)=>c.compare(d)),r("Create"),this.clear()}a.prototype.firstVacant=function(){return this.ss.size()===0?null:this.ss.front().low},a.prototype.alloc=function(){if(this.ss.size()===0)return r("alloc():empty"),null;let u=this.ss.begin(),f=u.pointer.low,c=u.pointer.high,d=f;return d+1<=c?this.ss.updateKeyByIterator(u,new s(f+1,c)):this.ss.eraseElementByPos(0),r("alloc():"+d),d},a.prototype.use=function(u){let f=new s(u,u),c=this.ss.lowerBound(f);if(!c.equals(this.ss.end())){let d=c.pointer.low,p=c.pointer.high;return c.pointer.equals(f)?(this.ss.eraseElementByIterator(c),r("use():"+u),!0):d>u?!1:d===u?(this.ss.updateKeyByIterator(c,new s(d+1,p)),r("use():"+u),!0):p===u?(this.ss.updateKeyByIterator(c,new s(d,p-1)),r("use():"+u),!0):(this.ss.updateKeyByIterator(c,new s(u+1,p)),this.ss.insert(new s(d,u-1)),r("use():"+u),!0)}return r("use():failed"),!1},a.prototype.free=function(u){if(u<this.min||u>this.max){n("free():"+u+" is out of range");return}let f=new s(u,u),c=this.ss.upperBound(f);if(c.equals(this.ss.end())){if(c.equals(this.ss.begin())){this.ss.insert(f);return}c.pre();let d=c.pointer.high;c.pointer.high+1===u?this.ss.updateKeyByIterator(c,new s(d,u)):this.ss.insert(f)}else if(c.equals(this.ss.begin()))if(u+1===c.pointer.low){let d=c.pointer.high;this.ss.updateKeyByIterator(c,new s(u,d))}else this.ss.insert(f);else{let d=c.pointer.low,p=c.pointer.high;c.pre();let m=c.pointer.low;c.pointer.high+1===u?u+1===d?(this.ss.eraseElementByIterator(c),this.ss.updateKeyByIterator(c,new s(m,p))):this.ss.updateKeyByIterator(c,new s(m,u)):u+1===d?(this.ss.eraseElementByIterator(c.next()),this.ss.insert(new s(u,p))):this.ss.insert(f)}r("free():"+u)},a.prototype.clear=function(){r("clear()"),this.ss.clear(),this.ss.insert(new s(this.min,this.max))},a.prototype.intervalCount=function(){return this.ss.size()},a.prototype.dump=function(){console.log("length:"+this.ss.size());for(let u of this.ss)console.log(u)},e.exports=a}),Gx=je((l,e)=>{ke(),Pe(),Me();var t=KL();e.exports.NumberAllocator=t}),VL=je(l=>{ke(),Pe(),Me(),Object.defineProperty(l,"__esModule",{value:!0});var e=DL(),t=Gx(),r=class{aliasToTopic;topicToAlias;max;numberAllocator;length;constructor(n){n>0&&(this.aliasToTopic=new e.LRUCache({max:n}),this.topicToAlias={},this.numberAllocator=new t.NumberAllocator(1,n),this.max=n,this.length=0)}put(n,s){if(s===0||s>this.max)return!1;let a=this.aliasToTopic.get(s);return a&&delete this.topicToAlias[a],this.aliasToTopic.set(s,n),this.topicToAlias[n]=s,this.numberAllocator.use(s),this.length=this.aliasToTopic.size,!0}getTopicByAlias(n){return this.aliasToTopic.get(n)}getAliasByTopic(n){let s=this.topicToAlias[n];return typeof s<"u"&&this.aliasToTopic.get(s),s}clear(){this.aliasToTopic.clear(),this.topicToAlias={},this.numberAllocator.clear(),this.length=0}getLruAlias(){return this.numberAllocator.firstVacant()||[...this.aliasToTopic.keys()][this.aliasToTopic.size-1]}};l.default=r}),zL=je(l=>{ke(),Pe(),Me();var e=l&&l.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(l,"__esModule",{value:!0});var t=Hc(),r=e(VL()),n=za(),s=(a,u)=>{a.log("_handleConnack");let{options:f}=a,c=f.protocolVersion===5?u.reasonCode:u.returnCode;if(clearTimeout(a.connackTimer),delete a.topicAliasSend,u.properties){if(u.properties.topicAliasMaximum){if(u.properties.topicAliasMaximum>65535){a.emit("error",new Error("topicAliasMaximum from broker is out of range"));return}u.properties.topicAliasMaximum>0&&(a.topicAliasSend=new r.default(u.properties.topicAliasMaximum))}u.properties.serverKeepAlive&&f.keepalive&&(f.keepalive=u.properties.serverKeepAlive),u.properties.maximumPacketSize&&(f.properties||(f.properties={}),f.properties.maximumPacketSize=u.properties.maximumPacketSize)}if(c===0)a.reconnecting=!1,a._onConnect(u);else if(c>0){let d=new n.ErrorWithReasonCode(`Connection refused: ${t.ReasonCodes[c]}`,c);a.emit("error",d),a.options.reconnectOnConnackError&&a._cleanUp(!0)}};l.default=s}),qL=je(l=>{ke(),Pe(),Me(),Object.defineProperty(l,"__esModule",{value:!0});var e=(t,r,n)=>{t.log("handling pubrel packet");let s=typeof n<"u"?n:t.noop,{messageId:a}=r,u={cmd:"pubcomp",messageId:a};t.incomingStore.get(r,(f,c)=>{f?t._sendPacket(u,s):(t.emit("message",c.topic,c.payload,c),t.handleMessage(c,d=>{if(d)return s(d);t.incomingStore.del(c,t.noop),t._sendPacket(u,s)}))})};l.default=e}),YL=je(l=>{ke(),Pe(),Me();var e=l&&l.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(l,"__esModule",{value:!0});var t=e(IL()),r=e(CL()),n=e(zL()),s=e(Hc()),a=e(qL()),u=(f,c,d)=>{let{options:p}=f;if(p.protocolVersion===5&&p.properties&&p.properties.maximumPacketSize&&p.properties.maximumPacketSize<c.length)return f.emit("error",new Error(`exceeding packets size ${c.cmd}`)),f.end({reasonCode:149,properties:{reasonString:"Maximum packet size was exceeded"}}),f;switch(f.log("_handlePacket :: emitting packetreceive"),f.emit("packetreceive",c),c.cmd){case"publish":(0,t.default)(f,c,d);break;case"puback":case"pubrec":case"pubcomp":case"suback":case"unsuback":f.reschedulePing(),(0,s.default)(f,c),d();break;case"pubrel":f.reschedulePing(),(0,a.default)(f,c,d);break;case"connack":(0,n.default)(f,c),d();break;case"auth":f.reschedulePing(),(0,r.default)(f,c),d();break;case"pingresp":f.log("_handlePacket :: received pingresp"),f.reschedulePing(!0),d();break;case"disconnect":f.emit("disconnect",c),d();break;default:f.log("_handlePacket :: unknown command"),d();break}};l.default=u}),Hx=je(l=>{ke(),Pe(),Me(),Object.defineProperty(l,"__esModule",{value:!0});var e=class{nextId;constructor(){this.nextId=Math.max(1,Math.floor(Math.random()*65535))}allocate(){let t=this.nextId++;return this.nextId===65536&&(this.nextId=1),t}getLastAllocated(){return this.nextId===1?65535:this.nextId-1}register(t){return!0}deallocate(t){}clear(){}};l.default=e}),WL=je(l=>{ke(),Pe(),Me(),Object.defineProperty(l,"__esModule",{value:!0});var e=class{aliasToTopic;max;length;constructor(t){this.aliasToTopic={},this.max=t}put(t,r){return r===0||r>this.max?!1:(this.aliasToTopic[r]=t,this.length=Object.keys(this.aliasToTopic).length,!0)}getTopicByAlias(t){return this.aliasToTopic[t]}clear(){this.aliasToTopic={}}};l.default=e}),QL=je(l=>{ke(),Pe(),Me();var e=l&&l.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(l,"__esModule",{value:!0}),l.TypedEventEmitter=void 0;var t=e((Bs(),Ct(ls))),r=za(),n=class{};l.TypedEventEmitter=n,(0,r.applyMixin)(n,t.default)}),Kc=je((l,e)=>{ke(),Pe(),Me();function t(r){"@babel/helpers - typeof";return e.exports=t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}),XL=je((l,e)=>{ke(),Pe(),Me();var t=Kc().default;function r(n,s){if(t(n)!="object"||!n)return n;var a=n[Symbol.toPrimitive];if(a!==void 0){var u=a.call(n,s||"default");if(t(u)!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(n)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports}),ZL=je((l,e)=>{ke(),Pe(),Me();var t=Kc().default,r=XL();function n(s){var a=r(s,"string");return t(a)=="symbol"?a:a+""}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports}),JL=je((l,e)=>{ke(),Pe(),Me();var t=ZL();function r(n,s,a){return(s=t(s))in n?Object.defineProperty(n,s,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[s]=a,n}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports}),eC=je((l,e)=>{ke(),Pe(),Me();function t(r){if(Array.isArray(r))return r}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}),tC=je((l,e)=>{ke(),Pe(),Me();function t(r,n){var s=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(s!=null){var a,u,f,c,d=[],p=!0,m=!1;try{if(f=(s=s.call(r)).next,n===0){if(Object(s)!==s)return;p=!1}else for(;!(p=(a=f.call(s)).done)&&(d.push(a.value),d.length!==n);p=!0);}catch(v){m=!0,u=v}finally{try{if(!p&&s.return!=null&&(c=s.return(),Object(c)!==c))return}finally{if(m)throw u}}return d}}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}),rC=je((l,e)=>{ke(),Pe(),Me();function t(r,n){(n==null||n>r.length)&&(n=r.length);for(var s=0,a=Array(n);s<n;s++)a[s]=r[s];return a}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}),iC=je((l,e)=>{ke(),Pe(),Me();var t=rC();function r(n,s){if(n){if(typeof n=="string")return t(n,s);var a={}.toString.call(n).slice(8,-1);return a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set"?Array.from(n):a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?t(n,s):void 0}}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports}),nC=je((l,e)=>{ke(),Pe(),Me();function t(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}),sC=je((l,e)=>{ke(),Pe(),Me();var t=eC(),r=tC(),n=iC(),s=nC();function a(u,f){return t(u)||r(u,f)||n(u,f)||s()}e.exports=a,e.exports.__esModule=!0,e.exports.default=e.exports}),Kx=je((l,e)=>{ke(),Pe(),Me(),(function(t,r){typeof l=="object"&&typeof e<"u"?r(l):typeof define=="function"&&define.amd?define(["exports"],r):(t=typeof globalThis<"u"?globalThis:t||self,r(t.fastUniqueNumbers={}))})(l,function(t){var r=function(v){return function(y){var b=v(y);return y.add(b),b}},n=function(v){return function(y,b){return v.set(y,b),b}},s=Number.MAX_SAFE_INTEGER===void 0?9007199254740991:Number.MAX_SAFE_INTEGER,a=536870912,u=a*2,f=function(v,y){return function(b){var E=y.get(b),x=E===void 0?b.size:E<u?E+1:0;if(!b.has(x))return v(b,x);if(b.size<a){for(;b.has(x);)x=Math.floor(Math.random()*u);return v(b,x)}if(b.size>s)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;b.has(x);)x=Math.floor(Math.random()*s);return v(b,x)}},c=new WeakMap,d=n(c),p=f(d,c),m=r(p);t.addUniqueNumber=m,t.generateUniqueNumber=p})}),aC=je((l,e)=>{ke(),Pe(),Me();function t(n,s,a,u,f,c,d){try{var p=n[c](d),m=p.value}catch(v){return void a(v)}p.done?s(m):Promise.resolve(m).then(u,f)}function r(n){return function(){var s=this,a=arguments;return new Promise(function(u,f){var c=n.apply(s,a);function d(m){t(c,u,f,d,p,"next",m)}function p(m){t(c,u,f,d,p,"throw",m)}d(void 0)})}}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports}),Vx=je((l,e)=>{ke(),Pe(),Me();function t(r,n){this.v=r,this.k=n}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}),zx=je((l,e)=>{ke(),Pe(),Me();function t(r,n,s,a){var u=Object.defineProperty;try{u({},"",{})}catch{u=0}e.exports=t=function(f,c,d,p){function m(v,y){t(f,v,function(b){return this._invoke(v,y,b)})}c?u?u(f,c,{value:d,enumerable:!p,configurable:!p,writable:!p}):f[c]=d:(m("next",0),m("throw",1),m("return",2))},e.exports.__esModule=!0,e.exports.default=e.exports,t(r,n,s,a)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}),qx=je((l,e)=>{ke(),Pe(),Me();var t=zx();function r(){var n,s,a=typeof Symbol=="function"?Symbol:{},u=a.iterator||"@@iterator",f=a.toStringTag||"@@toStringTag";function c(x,T,A,L){var w=T&&T.prototype instanceof p?T:p,C=Object.create(w.prototype);return t(C,"_invoke",(function(I,O,B){var P,$,F,Z=0,X=B||[],q=!1,H={p:0,n:0,v:n,a:K,f:K.bind(n,4),d:function(z,ie){return P=z,$=0,F=n,H.n=ie,d}};function K(z,ie){for($=z,F=ie,s=0;!q&&Z&&!Y&&s<X.length;s++){var Y,U=X[s],N=H.p,W=U[2];z>3?(Y=W===ie)&&(F=U[($=U[4])?5:($=3,3)],U[4]=U[5]=n):U[0]<=N&&((Y=z<2&&N<U[1])?($=0,H.v=ie,H.n=U[1]):N<W&&(Y=z<3||U[0]>ie||ie>W)&&(U[4]=z,U[5]=ie,H.n=W,$=0))}if(Y||z>1)return d;throw q=!0,ie}return function(z,ie,Y){if(Z>1)throw TypeError("Generator is already running");for(q&&ie===1&&K(ie,Y),$=ie,F=Y;(s=$<2?n:F)||!q;){P||($?$<3?($>1&&(H.n=-1),K($,F)):H.n=F:H.v=F);try{if(Z=2,P){if($||(z="next"),s=P[z]){if(!(s=s.call(P,F)))throw TypeError("iterator result is not an object");if(!s.done)return s;F=s.value,$<2&&($=0)}else $===1&&(s=P.return)&&s.call(P),$<2&&(F=TypeError("The iterator does not provide a '"+z+"' method"),$=1);P=n}else if((s=(q=H.n<0)?F:I.call(O,H))!==d)break}catch(U){P=n,$=1,F=U}finally{Z=1}}return{value:s,done:q}}})(x,A,L),!0),C}var d={};function p(){}function m(){}function v(){}s=Object.getPrototypeOf;var y=[][u]?s(s([][u]())):(t(s={},u,function(){return this}),s),b=v.prototype=p.prototype=Object.create(y);function E(x){return Object.setPrototypeOf?Object.setPrototypeOf(x,v):(x.__proto__=v,t(x,f,"GeneratorFunction")),x.prototype=Object.create(b),x}return m.prototype=v,t(b,"constructor",v),t(v,"constructor",m),m.displayName="GeneratorFunction",t(v,f,"GeneratorFunction"),t(b),t(b,f,"Generator"),t(b,u,function(){return this}),t(b,"toString",function(){return"[object Generator]"}),(e.exports=r=function(){return{w:c,m:E}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports}),Yx=je((l,e)=>{ke(),Pe(),Me();var t=Vx(),r=zx();function n(s,a){function u(c,d,p,m){try{var v=s[c](d),y=v.value;return y instanceof t?a.resolve(y.v).then(function(b){u("next",b,p,m)},function(b){u("throw",b,p,m)}):a.resolve(y).then(function(b){v.value=b,p(v)},function(b){return u("throw",b,p,m)})}catch(b){m(b)}}var f;this.next||(r(n.prototype),r(n.prototype,typeof Symbol=="function"&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),r(this,"_invoke",function(c,d,p){function m(){return new a(function(v,y){u(c,p,v,y)})}return f=f?f.then(m,m):m()},!0)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports}),Wx=je((l,e)=>{ke(),Pe(),Me();var t=qx(),r=Yx();function n(s,a,u,f,c){return new r(t().w(s,a,u,f),c||Promise)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports}),oC=je((l,e)=>{ke(),Pe(),Me();var t=Wx();function r(n,s,a,u,f){var c=t(n,s,a,u,f);return c.next().then(function(d){return d.done?d.value:c.next()})}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports}),lC=je((l,e)=>{ke(),Pe(),Me();function t(r){var n=Object(r),s=[];for(var a in n)s.unshift(a);return function u(){for(;s.length;)if((a=s.pop())in n)return u.value=a,u.done=!1,u;return u.done=!0,u}}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}),uC=je((l,e)=>{ke(),Pe(),Me();var t=Kc().default;function r(n){if(n!=null){var s=n[typeof Symbol=="function"&&Symbol.iterator||"@@iterator"],a=0;if(s)return s.call(n);if(typeof n.next=="function")return n;if(!isNaN(n.length))return{next:function(){return n&&a>=n.length&&(n=void 0),{value:n&&n[a++],done:!n}}}}throw new TypeError(t(n)+" is not iterable")}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports}),cC=je((l,e)=>{ke(),Pe(),Me();var t=Vx(),r=qx(),n=oC(),s=Wx(),a=Yx(),u=lC(),f=uC();function c(){var d=r(),p=d.m(c),m=(Object.getPrototypeOf?Object.getPrototypeOf(p):p.__proto__).constructor;function v(E){var x=typeof E=="function"&&E.constructor;return!!x&&(x===m||(x.displayName||x.name)==="GeneratorFunction")}var y={throw:1,return:2,break:3,continue:3};function b(E){var x,T;return function(A){x||(x={stop:function(){return T(A.a,2)},catch:function(){return A.v},abrupt:function(L,w){return T(A.a,y[L],w)},delegateYield:function(L,w,C){return x.resultName=w,T(A.d,f(L),C)},finish:function(L){return T(A.f,L)}},T=function(L,w,C){A.p=x.prev,A.n=x.next;try{return L(w,C)}finally{x.next=A.n}}),x.resultName&&(x[x.resultName]=A.v,x.resultName=void 0),x.sent=A.v,x.next=A.n;try{return E.call(this,x)}finally{A.p=x.prev,A.n=x.next}}}return(e.exports=c=function(){return{wrap:function(E,x,T,A){return d.w(b(E),x,T,A&&A.reverse())},isGeneratorFunction:v,mark:d.m,awrap:function(E,x){return new t(E,x)},AsyncIterator:a,async:function(E,x,T,A,L){return(v(x)?s:n)(b(E),x,T,A,L)},keys:u,values:f}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=c,e.exports.__esModule=!0,e.exports.default=e.exports}),fC=je((l,e)=>{ke(),Pe(),Me();var t=cC()();e.exports=t;try{regeneratorRuntime=t}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}}),hC=je((l,e)=>{ke(),Pe(),Me(),(function(t,r){typeof l=="object"&&typeof e<"u"?r(l,JL(),sC(),Kx(),aC(),fC()):typeof define=="function"&&define.amd?define(["exports","@babel/runtime/helpers/defineProperty","@babel/runtime/helpers/slicedToArray","fast-unique-numbers","@babel/runtime/helpers/asyncToGenerator","@babel/runtime/regenerator"],r):(t=typeof globalThis<"u"?globalThis:t||self,r(t.brokerFactory={},t._defineProperty,t._slicedToArray,t.fastUniqueNumbers,t._asyncToGenerator,t._regeneratorRuntime))})(l,function(t,r,n,s,a,u){var f=function(T){return typeof T.start=="function"},c=new WeakMap;function d(T,A){var L=Object.keys(T);if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(T);A&&(w=w.filter(function(C){return Object.getOwnPropertyDescriptor(T,C).enumerable})),L.push.apply(L,w)}return L}function p(T){for(var A=1;A<arguments.length;A++){var L=arguments[A]!=null?arguments[A]:{};A%2?d(Object(L),!0).forEach(function(w){r(T,w,L[w])}):Object.getOwnPropertyDescriptors?Object.defineProperties(T,Object.getOwnPropertyDescriptors(L)):d(Object(L)).forEach(function(w){Object.defineProperty(T,w,Object.getOwnPropertyDescriptor(L,w))})}return T}var m=function(T){return p(p({},T),{},{connect:function(A){var L=A.call;return a(u.mark(function w(){var C,I,O,B;return u.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return C=new MessageChannel,I=C.port1,O=C.port2,P.next=1,L("connect",{port:I},[I]);case 1:return B=P.sent,c.set(O,B),P.abrupt("return",O);case 2:case"end":return P.stop()}},w)}))},disconnect:function(A){var L=A.call;return(function(){var w=a(u.mark(function C(I){var O;return u.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(O=c.get(I),O!==void 0){B.next=1;break}throw new Error("The given port is not connected.");case 1:return B.next=2,L("disconnect",{portId:O});case 2:case"end":return B.stop()}},C)}));return function(C){return w.apply(this,arguments)}})()},isSupported:function(A){var L=A.call;return function(){return L("isSupported")}}})};function v(T,A){var L=Object.keys(T);if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(T);A&&(w=w.filter(function(C){return Object.getOwnPropertyDescriptor(T,C).enumerable})),L.push.apply(L,w)}return L}function y(T){for(var A=1;A<arguments.length;A++){var L=arguments[A]!=null?arguments[A]:{};A%2?v(Object(L),!0).forEach(function(w){r(T,w,L[w])}):Object.getOwnPropertyDescriptors?Object.defineProperties(T,Object.getOwnPropertyDescriptors(L)):v(Object(L)).forEach(function(w){Object.defineProperty(T,w,Object.getOwnPropertyDescriptor(L,w))})}return T}var b=new WeakMap,E=function(T){if(b.has(T))return b.get(T);var A=new Map;return b.set(T,A),A},x=function(T){var A=m(T);return function(L){var w=E(L);L.addEventListener("message",function(X){var q=X.data,H=q.id;if(H!==null&&w.has(H)){var K=w.get(H),z=K.reject,ie=K.resolve;w.delete(H),q.error===void 0?ie(q.result):z(new Error(q.error.message))}}),f(L)&&L.start();for(var C=function(X){var q=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,H=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];return new Promise(function(K,z){var ie=s.generateUniqueNumber(w);w.set(ie,{reject:z,resolve:K}),q===null?L.postMessage({id:ie,method:X},H):L.postMessage({id:ie,method:X,params:q},H)})},I=function(X,q){var H=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];L.postMessage({id:null,method:X,params:q},H)},O={},B=0,P=Object.entries(A);B<P.length;B++){var $=n(P[B],2),F=$[0],Z=$[1];O=y(y({},O),{},r({},F,Z({call:C,notify:I})))}return y({},O)}};t.createBroker=x})}),dC=je((l,e)=>{ke(),Pe(),Me(),(function(t,r){typeof l=="object"&&typeof e<"u"?r(l,Kc(),hC(),Kx()):typeof define=="function"&&define.amd?define(["exports","@babel/runtime/helpers/typeof","broker-factory","fast-unique-numbers"],r):(t=typeof globalThis<"u"?globalThis:t||self,r(t.workerTimersBroker={},t._typeof,t.brokerFactory,t.fastUniqueNumbers))})(l,function(t,r,n,s){var a=new Map([[0,null]]),u=new Map([[0,null]]),f=n.createBroker({clearInterval:function(d){var p=d.call;return function(m){r(a.get(m))==="symbol"&&(a.set(m,null),p("clear",{timerId:m,timerType:"interval"}).then(function(){a.delete(m)}))}},clearTimeout:function(d){var p=d.call;return function(m){r(u.get(m))==="symbol"&&(u.set(m,null),p("clear",{timerId:m,timerType:"timeout"}).then(function(){u.delete(m)}))}},setInterval:function(d){var p=d.call;return function(m){for(var v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,y=arguments.length,b=new Array(y>2?y-2:0),E=2;E<y;E++)b[E-2]=arguments[E];var x=Symbol(),T=s.generateUniqueNumber(a);a.set(T,x);var A=function(){return p("set",{delay:v,now:performance.timeOrigin+performance.now(),timerId:T,timerType:"interval"}).then(function(){var L=a.get(T);if(L===void 0)throw new Error("The timer is in an undefined state.");L===x&&(m.apply(void 0,b),a.get(T)===x&&A())})};return A(),T}},setTimeout:function(d){var p=d.call;return function(m){for(var v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,y=arguments.length,b=new Array(y>2?y-2:0),E=2;E<y;E++)b[E-2]=arguments[E];var x=Symbol(),T=s.generateUniqueNumber(u);return u.set(T,x),p("set",{delay:v,now:performance.timeOrigin+performance.now(),timerId:T,timerType:"timeout"}).then(function(){var A=u.get(T);if(A===void 0)throw new Error("The timer is in an undefined state.");A===x&&(u.delete(T),m.apply(void 0,b))}),T}}}),c=function(d){var p=new Worker(d);return f(p)};t.load=c,t.wrap=f})}),pC=je((l,e)=>{ke(),Pe(),Me(),(function(t,r){typeof l=="object"&&typeof e<"u"?r(l,dC()):typeof define=="function"&&define.amd?define(["exports","worker-timers-broker"],r):(t=typeof globalThis<"u"?globalThis:t||self,r(t.workerTimers={},t.workerTimersBroker))})(l,function(t,r){var n=function(p,m){var v=null;return function(){if(v!==null)return v;var y=new Blob([m],{type:"application/javascript; charset=utf-8"}),b=URL.createObjectURL(y);return v=p(b),setTimeout(function(){return URL.revokeObjectURL(b)}),v}},s=`(()=>{var e={45:(e,t,r)=>{var n=r(738).default;e.exports=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports},79:e=>{e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n},e.exports.__esModule=!0,e.exports.default=e.exports},122:(e,t,r)=>{var n=r(79);e.exports=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports},156:e=>{e.exports=function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,u,a,i=[],s=!0,c=!1;try{if(u=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=u.call(r)).done)&&(i.push(n.value),i.length!==t);s=!0);}catch(e){c=!0,o=e}finally{try{if(!s&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw o}}return i}},e.exports.__esModule=!0,e.exports.default=e.exports},172:e=>{e.exports=function(e,t){this.v=e,this.k=t},e.exports.__esModule=!0,e.exports.default=e.exports},293:e=>{function t(e,t,r,n,o,u,a){try{var i=e[u](a),s=i.value}catch(e){return void r(e)}i.done?t(s):Promise.resolve(s).then(n,o)}e.exports=function(e){return function(){var r=this,n=arguments;return new Promise((function(o,u){var a=e.apply(r,n);function i(e){t(a,o,u,i,s,"next",e)}function s(e){t(a,o,u,i,s,"throw",e)}i(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports},373:e=>{e.exports=function(e){var t=Object(e),r=[];for(var n in t)r.unshift(n);return function e(){for(;r.length;)if((n=r.pop())in t)return e.value=n,e.done=!1,e;return e.done=!0,e}},e.exports.__esModule=!0,e.exports.default=e.exports},389:function(e,t){!function(e){"use strict";var t=function(e){return function(t){var r=e(t);return t.add(r),r}},r=function(e){return function(t,r){return e.set(t,r),r}},n=void 0===Number.MAX_SAFE_INTEGER?9007199254740991:Number.MAX_SAFE_INTEGER,o=536870912,u=2*o,a=function(e,t){return function(r){var a=t.get(r),i=void 0===a?r.size:a<u?a+1:0;if(!r.has(i))return e(r,i);if(r.size<o){for(;r.has(i);)i=Math.floor(Math.random()*u);return e(r,i)}if(r.size>n)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;r.has(i);)i=Math.floor(Math.random()*n);return e(r,i)}},i=new WeakMap,s=r(i),c=a(s,i),f=t(c);e.addUniqueNumber=f,e.generateUniqueNumber=c}(t)},472:function(e,t,r){!function(e,t,r,n){"use strict";var o=function(e,t){return function(r){var o=t.get(r);if(void 0===o)return Promise.resolve(!1);var u=n(o,2),a=u[0],i=u[1];return e(a),t.delete(r),i(!1),Promise.resolve(!0)}},u=function(e,t){var r=function(n,o,u,a){var i=n-e.now();i>0?o.set(a,[t(r,i,n,o,u,a),u]):(o.delete(a),u(!0))};return r},a=function(e,t,r,n){return function(o,u,a){var i=o+u-t.timeOrigin,s=i-t.now();return new Promise((function(t){e.set(a,[r(n,s,i,e,t,a),t])}))}},i=new Map,s=o(globalThis.clearTimeout,i),c=new Map,f=o(globalThis.clearTimeout,c),l=u(performance,globalThis.setTimeout),p=a(i,performance,globalThis.setTimeout,l),d=a(c,performance,globalThis.setTimeout,l);r.createWorker(self,{clear:function(){var r=e(t.mark((function e(r){var n,o,u;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.timerId,o=r.timerType,e.next=1,"interval"===o?s(n):f(n);case 1:return u=e.sent,e.abrupt("return",{result:u});case 2:case"end":return e.stop()}}),e)})));function n(e){return r.apply(this,arguments)}return n}(),set:function(){var r=e(t.mark((function e(r){var n,o,u,a,i;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.delay,o=r.now,u=r.timerId,a=r.timerType,e.next=1,("interval"===a?p:d)(n,o,u);case 1:return i=e.sent,e.abrupt("return",{result:i});case 2:case"end":return e.stop()}}),e)})));function n(e){return r.apply(this,arguments)}return n}()})}(r(293),r(756),r(623),r(715))},546:e=>{function t(r,n,o,u){var a=Object.defineProperty;try{a({},"",{})}catch(r){a=0}e.exports=t=function(e,r,n,o){if(r)a?a(e,r,{value:n,enumerable:!o,configurable:!o,writable:!o}):e[r]=n;else{var u=function(r,n){t(e,r,(function(e){return this._invoke(r,n,e)}))};u("next",0),u("throw",1),u("return",2)}},e.exports.__esModule=!0,e.exports.default=e.exports,t(r,n,o,u)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},579:(e,t,r)=>{var n=r(738).default;e.exports=function(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],r=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}throw new TypeError(n(e)+" is not iterable")},e.exports.__esModule=!0,e.exports.default=e.exports},623:function(e,t,r){!function(e,t,r,n,o){"use strict";var u={INTERNAL_ERROR:-32603,INVALID_PARAMS:-32602,METHOD_NOT_FOUND:-32601},a=function(e,t){return Object.assign(new Error(e),{status:t})},i=function(e){return a('The requested method called "'.concat(e,'" is not supported.'),u.METHOD_NOT_FOUND)},s=function(e){return a('The handler of the method called "'.concat(e,'" returned no required result.'),u.INTERNAL_ERROR)},c=function(e){return a('The handler of the method called "'.concat(e,'" returned an unexpected result.'),u.INTERNAL_ERROR)},f=function(e){return a('The specified parameter called "portId" with the given value "'.concat(e,'" does not identify a port connected to this worker.'),u.INVALID_PARAMS)},l=function(e,n){return function(){var o=t(r.mark((function t(o){var u,a,f,l,p,d,v,x,y,b,h,m,_,g,w;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(u=o.data,a=u.id,f=u.method,l=u.params,p=n[f],t.prev=1,void 0!==p){t.next=2;break}throw i(f);case 2:if(void 0!==(d=void 0===l?p():p(l))){t.next=3;break}throw s(f);case 3:if(!(d instanceof Promise)){t.next=5;break}return t.next=4,d;case 4:g=t.sent,t.next=6;break;case 5:g=d;case 6:if(v=g,null!==a){t.next=8;break}if(void 0===v.result){t.next=7;break}throw c(f);case 7:t.next=10;break;case 8:if(void 0!==v.result){t.next=9;break}throw c(f);case 9:x=v.result,y=v.transferables,b=void 0===y?[]:y,e.postMessage({id:a,result:x},b);case 10:t.next=12;break;case 11:t.prev=11,w=t.catch(1),h=w.message,m=w.status,_=void 0===m?-32603:m,e.postMessage({error:{code:_,message:h},id:a});case 12:case"end":return t.stop()}}),t,null,[[1,11]])})));return function(e){return o.apply(this,arguments)}}()},p=function(){return new Promise((function(e){var t=new ArrayBuffer(0),r=new MessageChannel,n=r.port1,o=r.port2;n.onmessage=function(t){var r=t.data;return e(null!==r)},o.postMessage(t,[t])}))};function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var x=new Map,y=function(e,n,u){return v(v({},n),{},{connect:function(t){var r=t.port;r.start();var u=e(r,n),a=o.generateUniqueNumber(x);return x.set(a,(function(){u(),r.close(),x.delete(a)})),{result:a}},disconnect:function(e){var t=e.portId,r=x.get(t);if(void 0===r)throw f(t);return r(),{result:null}},isSupported:function(){var e=t(r.mark((function e(){var t,n,o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,p();case 1:if(!e.sent){e.next=5;break}if(!((t=u())instanceof Promise)){e.next=3;break}return e.next=2,t;case 2:o=e.sent,e.next=4;break;case 3:o=t;case 4:return n=o,e.abrupt("return",{result:n});case 5:return e.abrupt("return",{result:!1});case 6:case"end":return e.stop()}}),e)})));function n(){return e.apply(this,arguments)}return n}()})},b=function(e,t){var r=y(b,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){return!0}),n=l(e,r);return e.addEventListener("message",n),function(){return e.removeEventListener("message",n)}};e.createWorker=b,e.isSupported=p}(t,r(293),r(756),r(693),r(389))},633:(e,t,r)=>{var n=r(172),o=r(993),u=r(869),a=r(887),i=r(791),s=r(373),c=r(579);function f(){"use strict";var t=o(),r=t.m(f),l=(Object.getPrototypeOf?Object.getPrototypeOf(r):r.__proto__).constructor;function p(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===l||"GeneratorFunction"===(t.displayName||t.name))}var d={throw:1,return:2,break:3,continue:3};function v(e){var t,r;return function(n){t||(t={stop:function(){return r(n.a,2)},catch:function(){return n.v},abrupt:function(e,t){return r(n.a,d[e],t)},delegateYield:function(e,o,u){return t.resultName=o,r(n.d,c(e),u)},finish:function(e){return r(n.f,e)}},r=function(e,r,o){n.p=t.prev,n.n=t.next;try{return e(r,o)}finally{t.next=n.n}}),t.resultName&&(t[t.resultName]=n.v,t.resultName=void 0),t.sent=n.v,t.next=n.n;try{return e.call(this,t)}finally{n.p=t.prev,n.n=t.next}}}return(e.exports=f=function(){return{wrap:function(e,r,n,o){return t.w(v(e),r,n,o&&o.reverse())},isGeneratorFunction:p,mark:t.m,awrap:function(e,t){return new n(e,t)},AsyncIterator:i,async:function(e,t,r,n,o){return(p(t)?a:u)(v(e),t,r,n,o)},keys:s,values:c}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=f,e.exports.__esModule=!0,e.exports.default=e.exports},693:(e,t,r)=>{var n=r(736);e.exports=function(e,t,r){return(t=n(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},e.exports.__esModule=!0,e.exports.default=e.exports},715:(e,t,r)=>{var n=r(987),o=r(156),u=r(122),a=r(752);e.exports=function(e,t){return n(e)||o(e,t)||u(e,t)||a()},e.exports.__esModule=!0,e.exports.default=e.exports},736:(e,t,r)=>{var n=r(738).default,o=r(45);e.exports=function(e){var t=o(e,"string");return"symbol"==n(t)?t:t+""},e.exports.__esModule=!0,e.exports.default=e.exports},738:e=>{function t(r){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},752:e=>{e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},756:(e,t,r)=>{var n=r(633)();e.exports=n;try{regeneratorRuntime=n}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}},791:(e,t,r)=>{var n=r(172),o=r(546);e.exports=function e(t,r){function u(e,o,a,i){try{var s=t[e](o),c=s.value;return c instanceof n?r.resolve(c.v).then((function(e){u("next",e,a,i)}),(function(e){u("throw",e,a,i)})):r.resolve(c).then((function(e){s.value=e,a(s)}),(function(e){return u("throw",e,a,i)}))}catch(e){i(e)}}var a;this.next||(o(e.prototype),o(e.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",(function(){return this}))),o(this,"_invoke",(function(e,t,n){function o(){return new r((function(t,r){u(e,n,t,r)}))}return a=a?a.then(o,o):o()}),!0)},e.exports.__esModule=!0,e.exports.default=e.exports},869:(e,t,r)=>{var n=r(887);e.exports=function(e,t,r,o,u){var a=n(e,t,r,o,u);return a.next().then((function(e){return e.done?e.value:a.next()}))},e.exports.__esModule=!0,e.exports.default=e.exports},887:(e,t,r)=>{var n=r(993),o=r(791);e.exports=function(e,t,r,u,a){return new o(n().w(e,t,r,u),a||Promise)},e.exports.__esModule=!0,e.exports.default=e.exports},987:e=>{e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports},993:(e,t,r)=>{var n=r(546);function o(){var t,r,u="function"==typeof Symbol?Symbol:{},a=u.iterator||"@@iterator",i=u.toStringTag||"@@toStringTag";function s(e,o,u,a){var i=o&&o.prototype instanceof f?o:f,s=Object.create(i.prototype);return n(s,"_invoke",function(e,n,o){var u,a,i,s=0,f=o||[],l=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,r){return u=e,a=0,i=t,p.n=r,c}};function d(e,n){for(a=e,i=n,r=0;!l&&s&&!o&&r<f.length;r++){var o,u=f[r],d=p.p,v=u[2];e>3?(o=v===n)&&(i=u[(a=u[4])?5:(a=3,3)],u[4]=u[5]=t):u[0]<=d&&((o=e<2&&d<u[1])?(a=0,p.v=n,p.n=u[1]):d<v&&(o=e<3||u[0]>n||n>v)&&(u[4]=e,u[5]=n,p.n=v,a=0))}if(o||e>1)return c;throw l=!0,n}return function(o,f,v){if(s>1)throw TypeError("Generator is already running");for(l&&1===f&&d(f,v),a=f,i=v;(r=a<2?t:i)||!l;){u||(a?a<3?(a>1&&(p.n=-1),d(a,i)):p.n=i:p.v=i);try{if(s=2,u){if(a||(o="next"),r=u[o]){if(!(r=r.call(u,i)))throw TypeError("iterator result is not an object");if(!r.done)return r;i=r.value,a<2&&(a=0)}else 1===a&&(r=u.return)&&r.call(u),a<2&&(i=TypeError("The iterator does not provide a '"+o+"' method"),a=1);u=t}else if((r=(l=p.n<0)?i:e.call(n,p))!==c)break}catch(e){u=t,a=1,i=e}finally{s=1}}return{value:r,done:l}}}(e,u,a),!0),s}var c={};function f(){}function l(){}function p(){}r=Object.getPrototypeOf;var d=[][a]?r(r([][a]())):(n(r={},a,(function(){return this})),r),v=p.prototype=f.prototype=Object.create(d);function x(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,n(e,i,"GeneratorFunction")),e.prototype=Object.create(v),e}return l.prototype=p,n(v,"constructor",p),n(p,"constructor",l),l.displayName="GeneratorFunction",n(p,i,"GeneratorFunction"),n(v),n(v,i,"Generator"),n(v,a,(function(){return this})),n(v,"toString",(function(){return"[object Generator]"})),(e.exports=o=function(){return{w:s,m:x}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=o,e.exports.__esModule=!0,e.exports.default=e.exports}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var u=t[n]={exports:{}};return e[n].call(u.exports,u,u.exports,r),u.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";r(472)})()})();`,a=n(r.load,s),u=function(p){return a().clearInterval(p)},f=function(p){return a().clearTimeout(p)},c=function(){var p;return(p=a()).setInterval.apply(p,arguments)},d=function(){var p;return(p=a()).setTimeout.apply(p,arguments)};t.clearInterval=u,t.clearTimeout=f,t.setInterval=c,t.setTimeout=d})}),Vc=je(l=>{ke(),Pe(),Me(),Object.defineProperty(l,"__esModule",{value:!0}),l.isReactNativeBrowser=l.isWebWorker=void 0;var e=()=>typeof window<"u"?typeof navigator<"u"&&navigator.userAgent?.toLowerCase().indexOf(" electron/")>-1&&Mt?.versions?!Object.prototype.hasOwnProperty.call(Mt.versions,"electron"):typeof window.document<"u":!1,t=()=>!!(typeof self=="object"&&self?.constructor?.name?.includes("WorkerGlobalScope")&&typeof Deno>"u"),r=()=>typeof navigator<"u"&&navigator.product==="ReactNative",n=e()||t()||r();l.isWebWorker=t(),l.isReactNativeBrowser=r(),l.default=n}),gC=je(l=>{ke(),Pe(),Me();var e=l&&l.__createBinding||(Object.create?function(c,d,p,m){m===void 0&&(m=p);var v=Object.getOwnPropertyDescriptor(d,p);(!v||("get"in v?!d.__esModule:v.writable||v.configurable))&&(v={enumerable:!0,get:function(){return d[p]}}),Object.defineProperty(c,m,v)}:function(c,d,p,m){m===void 0&&(m=p),c[m]=d[p]}),t=l&&l.__setModuleDefault||(Object.create?function(c,d){Object.defineProperty(c,"default",{enumerable:!0,value:d})}:function(c,d){c.default=d}),r=l&&l.__importStar||(function(){var c=function(d){return c=Object.getOwnPropertyNames||function(p){var m=[];for(var v in p)Object.prototype.hasOwnProperty.call(p,v)&&(m[m.length]=v);return m},c(d)};return function(d){if(d&&d.__esModule)return d;var p={};if(d!=null)for(var m=c(d),v=0;v<m.length;v++)m[v]!=="default"&&e(p,d,m[v]);return t(p,d),p}})();Object.defineProperty(l,"__esModule",{value:!0});var n=pC(),s=r(Vc()),a={set:n.setInterval,clear:n.clearInterval},u={set:(c,d)=>setInterval(c,d),clear:c=>clearInterval(c)},f=c=>{switch(c){case"native":return u;case"worker":return a;case"auto":default:return s.default&&!s.isWebWorker&&!s.isReactNativeBrowser?a:u}};l.default=f}),Qx=je(l=>{ke(),Pe(),Me();var e=l&&l.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(l,"__esModule",{value:!0});var t=e(gC()),r=class{_keepalive;timerId;timer;destroyed=!1;counter;client;_keepaliveTimeoutTimestamp;_intervalEvery;get keepaliveTimeoutTimestamp(){return this._keepaliveTimeoutTimestamp}get intervalEvery(){return this._intervalEvery}get keepalive(){return this._keepalive}constructor(n,s){this.client=n,this.timer=typeof s=="object"&&"set"in s&&"clear"in s?s:(0,t.default)(s),this.setKeepalive(n.options.keepalive)}clear(){this.timerId&&(this.timer.clear(this.timerId),this.timerId=null)}setKeepalive(n){if(n*=1e3,isNaN(n)||n<=0||n>2147483647)throw new Error(`Keepalive value must be an integer between 0 and 2147483647. Provided value is ${n}`);this._keepalive=n,this.reschedule(),this.client.log(`KeepaliveManager: set keepalive to ${n}ms`)}destroy(){this.clear(),this.destroyed=!0}reschedule(){if(this.destroyed)return;this.clear(),this.counter=0;let n=Math.ceil(this._keepalive*1.5);this._keepaliveTimeoutTimestamp=Date.now()+n,this._intervalEvery=Math.ceil(this._keepalive/2),this.timerId=this.timer.set(()=>{this.destroyed||(this.counter+=1,this.counter===2?this.client.sendPing():this.counter>2&&this.client.onKeepaliveTimeout())},this._intervalEvery)}};l.default=r}),eg=je(l=>{ke(),Pe(),Me();var e=l&&l.__createBinding||(Object.create?function(w,C,I,O){O===void 0&&(O=I);var B=Object.getOwnPropertyDescriptor(C,I);(!B||("get"in B?!C.__esModule:B.writable||B.configurable))&&(B={enumerable:!0,get:function(){return C[I]}}),Object.defineProperty(w,O,B)}:function(w,C,I,O){O===void 0&&(O=I),w[O]=C[I]}),t=l&&l.__setModuleDefault||(Object.create?function(w,C){Object.defineProperty(w,"default",{enumerable:!0,value:C})}:function(w,C){w.default=C}),r=l&&l.__importStar||(function(){var w=function(C){return w=Object.getOwnPropertyNames||function(I){var O=[];for(var B in I)Object.prototype.hasOwnProperty.call(I,B)&&(O[O.length]=B);return O},w(C)};return function(C){if(C&&C.__esModule)return C;var I={};if(C!=null)for(var O=w(C),B=0;B<O.length;B++)O[B]!=="default"&&e(I,C,O[B]);return t(I,C),I}})(),n=l&&l.__importDefault||function(w){return w&&w.__esModule?w:{default:w}};Object.defineProperty(l,"__esModule",{value:!0});var s=n(_L()),a=js(),u=n(wL()),f=n(Sn()),c=r(RL()),d=n(Ax()),p=n(YL()),m=n(Hx()),v=n(WL()),y=za(),b=QL(),E=n(Qx()),x=r(Vc()),T=globalThis.setImmediate||((...w)=>{let C=w.shift();(0,y.nextTick)(()=>{C(...w)})}),A={keepalive:60,reschedulePings:!0,protocolId:"MQTT",protocolVersion:4,reconnectPeriod:1e3,connectTimeout:30*1e3,clean:!0,resubscribe:!0,subscribeBatchSize:null,writeCache:!0,timerVariant:"auto"},L=class tg extends b.TypedEventEmitter{static VERSION=y.MQTTJS_VERSION;connected;disconnecting;disconnected;reconnecting;incomingStore;outgoingStore;options;queueQoSZero;_reconnectCount;log;messageIdProvider;outgoing;messageIdToTopic;noop;keepaliveManager;stream;queue;streamBuilder;_resubscribeTopics;connackTimer;reconnectTimer;_storeProcessing;_packetIdsDuringStoreProcessing;_storeProcessingQueue;_firstConnection;topicAliasRecv;topicAliasSend;_deferredReconnect;connackPacket;static defaultId(){return`mqttjs_${Math.random().toString(16).substr(2,8)}`}constructor(C,I){super(),this.options=I||{};for(let O in A)typeof this.options[O]>"u"?this.options[O]=A[O]:this.options[O]=I[O];this.log=this.options.log||(0,f.default)("mqttjs:client"),this.noop=this._noop.bind(this),this.log("MqttClient :: version:",tg.VERSION),x.isWebWorker?this.log("MqttClient :: environment","webworker"):this.log("MqttClient :: environment",x.default?"browser":"node"),this.log("MqttClient :: options.protocol",I.protocol),this.log("MqttClient :: options.protocolVersion",I.protocolVersion),this.log("MqttClient :: options.username",I.username),this.log("MqttClient :: options.keepalive",I.keepalive),this.log("MqttClient :: options.reconnectPeriod",I.reconnectPeriod),this.log("MqttClient :: options.rejectUnauthorized",I.rejectUnauthorized),this.log("MqttClient :: options.properties.topicAliasMaximum",I.properties?I.properties.topicAliasMaximum:void 0),this.options.clientId=typeof I.clientId=="string"?I.clientId:tg.defaultId(),this.log("MqttClient :: clientId",this.options.clientId),this.options.customHandleAcks=I.protocolVersion===5&&I.customHandleAcks?I.customHandleAcks:(...O)=>{O[3](null,0)},this.options.writeCache||(s.default.writeToStream.cacheNumbers=!1),this.streamBuilder=C,this.messageIdProvider=typeof this.options.messageIdProvider>"u"?new m.default:this.options.messageIdProvider,this.outgoingStore=I.outgoingStore||new d.default,this.incomingStore=I.incomingStore||new d.default,this.queueQoSZero=I.queueQoSZero===void 0?!0:I.queueQoSZero,this._resubscribeTopics={},this.messageIdToTopic={},this.keepaliveManager=null,this.connected=!1,this.disconnecting=!1,this.reconnecting=!1,this.queue=[],this.connackTimer=null,this.reconnectTimer=null,this._storeProcessing=!1,this._packetIdsDuringStoreProcessing={},this._storeProcessingQueue=[],this.outgoing={},this._firstConnection=!0,I.properties&&I.properties.topicAliasMaximum>0&&(I.properties.topicAliasMaximum>65535?this.log("MqttClient :: options.properties.topicAliasMaximum is out of range"):this.topicAliasRecv=new v.default(I.properties.topicAliasMaximum)),this.on("connect",()=>{let{queue:O}=this,B=()=>{let P=O.shift();this.log("deliver :: entry %o",P);let $=null;if(!P){this._resubscribe();return}$=P.packet,this.log("deliver :: call _sendPacket for %o",$);let F=!0;$.messageId&&$.messageId!==0&&(this.messageIdProvider.register($.messageId)||(F=!1)),F?this._sendPacket($,Z=>{P.cb&&P.cb(Z),B()}):(this.log("messageId: %d has already used. The message is skipped and removed.",$.messageId),B())};this.log("connect :: sending queued packets"),B()}),this.on("close",()=>{this.log("close :: connected set to `false`"),this.connected=!1,this.log("close :: clearing connackTimer"),clearTimeout(this.connackTimer),this._destroyKeepaliveManager(),this.topicAliasRecv&&this.topicAliasRecv.clear(),this.log("close :: calling _setupReconnect"),this._setupReconnect()}),this.options.manualConnect||(this.log("MqttClient :: setting up stream"),this.connect())}handleAuth(C,I){I()}handleMessage(C,I){I()}_nextId(){return this.messageIdProvider.allocate()}getLastMessageId(){return this.messageIdProvider.getLastAllocated()}connect(){let C=new a.Writable,I=s.default.parser(this.options),O=null,B=[];this.log("connect :: calling method to clear reconnect"),this._clearReconnect(),this.disconnected&&!this.reconnecting&&(this.incomingStore=this.options.incomingStore||new d.default,this.outgoingStore=this.options.outgoingStore||new d.default,this.disconnecting=!1,this.disconnected=!1),this.log("connect :: using streamBuilder provided to client to create stream"),this.stream=this.streamBuilder(this),I.on("packet",X=>{this.log("parser :: on packet push to packets array."),B.push(X)});let P=()=>{this.log("work :: getting next packet in queue");let X=B.shift();if(X)this.log("work :: packet pulled from queue"),(0,p.default)(this,X,$);else{this.log("work :: no packets in queue");let q=O;O=null,this.log("work :: done flag is %s",!!q),q&&q()}},$=()=>{if(B.length)(0,y.nextTick)(P);else{let X=O;O=null,X()}};C._write=(X,q,H)=>{O=H,this.log("writable stream :: parsing buffer"),I.parse(X),P()};let F=X=>{this.log("streamErrorHandler :: error",X.message),X.code?(this.log("streamErrorHandler :: emitting error"),this.emit("error",X)):this.noop(X)};this.log("connect :: pipe stream to writable stream"),this.stream.pipe(C),this.stream.on("error",F),this.stream.on("close",()=>{this.log("(%s)stream :: on close",this.options.clientId),this._flushVolatile(),this.log("stream: emit close to MqttClient"),this.emit("close")}),this.log("connect: sending packet `connect`");let Z={cmd:"connect",protocolId:this.options.protocolId,protocolVersion:this.options.protocolVersion,clean:this.options.clean,clientId:this.options.clientId,keepalive:this.options.keepalive,username:this.options.username,password:this.options.password,properties:this.options.properties};if(this.options.will&&(Z.will={...this.options.will,payload:this.options.will?.payload}),this.topicAliasRecv&&(Z.properties||(Z.properties={}),this.topicAliasRecv&&(Z.properties.topicAliasMaximum=this.topicAliasRecv.max)),this._writePacket(Z),I.on("error",this.emit.bind(this,"error")),this.options.properties){if(!this.options.properties.authenticationMethod&&this.options.properties.authenticationData)return this.end(()=>this.emit("error",new Error("Packet has no Authentication Method"))),this;if(this.options.properties.authenticationMethod&&this.options.authPacket&&typeof this.options.authPacket=="object"){let X={cmd:"auth",reasonCode:0,...this.options.authPacket};this._writePacket(X)}}return this.stream.setMaxListeners(1e3),clearTimeout(this.connackTimer),this.connackTimer=setTimeout(()=>{this.log("!!connectTimeout hit!! Calling _cleanUp with force `true`"),this.emit("error",new Error("connack timeout")),this._cleanUp(!0)},this.options.connectTimeout),this}publish(C,I,O,B){this.log("publish :: message `%s` to topic `%s`",I,C);let{options:P}=this;typeof O=="function"&&(B=O,O=null),O=O||{},O={qos:0,retain:!1,dup:!1,...O};let{qos:$,retain:F,dup:Z,properties:X,cbStorePut:q}=O;if(this._checkDisconnecting(B))return this;let H=()=>{let K=0;if(($===1||$===2)&&(K=this._nextId(),K===null))return this.log("No messageId left"),!1;let z={cmd:"publish",topic:C,payload:I,qos:$,retain:F,messageId:K,dup:Z};switch(P.protocolVersion===5&&(z.properties=X),this.log("publish :: qos",$),$){case 1:case 2:this.outgoing[z.messageId]={volatile:!1,cb:B||this.noop},this.log("MqttClient:publish: packet cmd: %s",z.cmd),this._sendPacket(z,void 0,q);break;default:this.log("MqttClient:publish: packet cmd: %s",z.cmd),this._sendPacket(z,B,q);break}return!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!H())&&this._storeProcessingQueue.push({invoke:H,cbStorePut:O.cbStorePut,callback:B}),this}publishAsync(C,I,O){return new Promise((B,P)=>{this.publish(C,I,O,($,F)=>{$?P($):B(F)})})}subscribe(C,I,O){let B=this.options.protocolVersion;typeof I=="function"&&(O=I),O=O||this.noop;let P=!1,$=[];typeof C=="string"?(C=[C],$=C):Array.isArray(C)?$=C:typeof C=="object"&&(P=C.resubscribe,delete C.resubscribe,$=Object.keys(C));let F=c.validateTopics($);if(F!==null)return T(O,new Error(`Invalid topic ${F}`)),this;if(this._checkDisconnecting(O))return this.log("subscribe: discconecting true"),this;let Z={qos:0};B===5&&(Z.nl=!1,Z.rap=!1,Z.rh=0),I={...Z,...I};let{properties:X}=I,q=[],H=(ie,Y)=>{if(Y=Y||I,!Object.prototype.hasOwnProperty.call(this._resubscribeTopics,ie)||this._resubscribeTopics[ie].qos<Y.qos||P){let U={topic:ie,qos:Y.qos};B===5&&(U.nl=Y.nl,U.rap=Y.rap,U.rh=Y.rh,U.properties=X),this.log("subscribe: pushing topic `%s` and qos `%s` to subs list",U.topic,U.qos),q.push(U)}};if(Array.isArray(C)?C.forEach(ie=>{this.log("subscribe: array topic %s",ie),H(ie)}):Object.keys(C).forEach(ie=>{this.log("subscribe: object topic %s, %o",ie,C[ie]),H(ie,C[ie])}),!q.length)return O(null,[]),this;let K=(ie,Y)=>{let U={cmd:"subscribe",subscriptions:ie,messageId:Y};if(X&&(U.properties=X),this.options.resubscribe){this.log("subscribe :: resubscribe true");let W=[];ie.forEach(ue=>{if(this.options.reconnectPeriod>0){let ne={qos:ue.qos};B===5&&(ne.nl=ue.nl||!1,ne.rap=ue.rap||!1,ne.rh=ue.rh||0,ne.properties=ue.properties),this._resubscribeTopics[ue.topic]=ne,W.push(ue.topic)}}),this.messageIdToTopic[U.messageId]=W}let N=new Promise((W,ue)=>{this.outgoing[U.messageId]={volatile:!0,cb(ne,Ee){if(!ne){let{granted:se}=Ee;for(let J=0;J<se.length;J+=1)ie[J].qos=se[J]}ne?ue(new y.ErrorWithSubackPacket(ne.message,Ee)):W(Ee)}}});return this.log("subscribe :: call _sendPacket"),this._sendPacket(U),N},z=()=>{let ie=this.options.subscribeBatchSize??q.length,Y=[];for(let U=0;U<q.length;U+=ie){let N=q.slice(U,U+ie),W=this._nextId();if(W===null)return this.log("No messageId left"),!1;Y.push(K(N,W))}return Promise.all(Y).then(U=>{O(null,q,U.at(-1))}).catch(U=>{O(U,q,U.packet)}),!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!z())&&this._storeProcessingQueue.push({invoke:z,callback:O}),this}subscribeAsync(C,I){return new Promise((O,B)=>{this.subscribe(C,I,(P,$)=>{P?B(P):O($)})})}unsubscribe(C,I,O){typeof C=="string"&&(C=[C]),typeof I=="function"&&(O=I),O=O||this.noop;let B=c.validateTopics(C);if(B!==null)return T(O,new Error(`Invalid topic ${B}`)),this;if(this._checkDisconnecting(O))return this;let P=()=>{let $=this._nextId();if($===null)return this.log("No messageId left"),!1;let F={cmd:"unsubscribe",messageId:$,unsubscriptions:[]};return typeof C=="string"?F.unsubscriptions=[C]:Array.isArray(C)&&(F.unsubscriptions=C),this.options.resubscribe&&F.unsubscriptions.forEach(Z=>{delete this._resubscribeTopics[Z]}),typeof I=="object"&&I.properties&&(F.properties=I.properties),this.outgoing[F.messageId]={volatile:!0,cb:O},this.log("unsubscribe: call _sendPacket"),this._sendPacket(F),!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!P())&&this._storeProcessingQueue.push({invoke:P,callback:O}),this}unsubscribeAsync(C,I){return new Promise((O,B)=>{this.unsubscribe(C,I,(P,$)=>{P?B(P):O($)})})}end(C,I,O){this.log("end :: (%s)",this.options.clientId),(C==null||typeof C!="boolean")&&(O=O||I,I=C,C=!1),typeof I!="object"&&(O=O||I,I=null),this.log("end :: cb? %s",!!O),(!O||typeof O!="function")&&(O=this.noop);let B=()=>{this.log("end :: closeStores: closing incoming and outgoing stores"),this.disconnected=!0,this.incomingStore.close($=>{this.outgoingStore.close(F=>{if(this.log("end :: closeStores: emitting end"),this.emit("end"),O){let Z=$||F;this.log("end :: closeStores: invoking callback with args"),O(Z)}})}),this._deferredReconnect?this._deferredReconnect():(this.options.reconnectPeriod===0||this.options.manualConnect)&&(this.disconnecting=!1)},P=()=>{this.log("end :: (%s) :: finish :: calling _cleanUp with force %s",this.options.clientId,C),this._cleanUp(C,()=>{this.log("end :: finish :: calling process.nextTick on closeStores"),(0,y.nextTick)(B)},I)};return this.disconnecting?(O(),this):(this._clearReconnect(),this.disconnecting=!0,!C&&Object.keys(this.outgoing).length>0?(this.log("end :: (%s) :: calling finish in 10ms once outgoing is empty",this.options.clientId),this.once("outgoingEmpty",setTimeout.bind(null,P,10))):(this.log("end :: (%s) :: immediately calling finish",this.options.clientId),P()),this)}endAsync(C,I){return new Promise((O,B)=>{this.end(C,I,P=>{P?B(P):O()})})}removeOutgoingMessage(C){if(this.outgoing[C]){let{cb:I}=this.outgoing[C];this._removeOutgoingAndStoreMessage(C,()=>{I(new Error("Message removed"))})}return this}reconnect(C){this.log("client reconnect");let I=()=>{C?(this.options.incomingStore=C.incomingStore,this.options.outgoingStore=C.outgoingStore):(this.options.incomingStore=null,this.options.outgoingStore=null),this.incomingStore=this.options.incomingStore||new d.default,this.outgoingStore=this.options.outgoingStore||new d.default,this.disconnecting=!1,this.disconnected=!1,this._deferredReconnect=null,this._reconnect()};return this.disconnecting&&!this.disconnected?this._deferredReconnect=I:I(),this}_flushVolatile(){this.outgoing&&(this.log("_flushVolatile :: deleting volatile messages from the queue and setting their callbacks as error function"),Object.keys(this.outgoing).forEach(C=>{this.outgoing[C].volatile&&typeof this.outgoing[C].cb=="function"&&(this.outgoing[C].cb(new Error("Connection closed")),delete this.outgoing[C])}))}_flush(){this.outgoing&&(this.log("_flush: queue exists? %b",!!this.outgoing),Object.keys(this.outgoing).forEach(C=>{typeof this.outgoing[C].cb=="function"&&(this.outgoing[C].cb(new Error("Connection closed")),delete this.outgoing[C])}))}_removeTopicAliasAndRecoverTopicName(C){let I;C.properties&&(I=C.properties.topicAlias);let O=C.topic.toString();if(this.log("_removeTopicAliasAndRecoverTopicName :: alias %d, topic %o",I,O),O.length===0){if(typeof I>"u")return new Error("Unregistered Topic Alias");if(O=this.topicAliasSend.getTopicByAlias(I),typeof O>"u")return new Error("Unregistered Topic Alias");C.topic=O}I&&delete C.properties.topicAlias}_checkDisconnecting(C){return this.disconnecting&&(C&&C!==this.noop?C(new Error("client disconnecting")):this.emit("error",new Error("client disconnecting"))),this.disconnecting}_reconnect(){this.log("_reconnect: emitting reconnect to client"),this.emit("reconnect"),this.connected?(this.end(()=>{this.connect()}),this.log("client already connected. disconnecting first.")):(this.log("_reconnect: calling connect"),this.connect())}_setupReconnect(){!this.disconnecting&&!this.reconnectTimer&&this.options.reconnectPeriod>0?(this.reconnecting||(this.log("_setupReconnect :: emit `offline` state"),this.emit("offline"),this.log("_setupReconnect :: set `reconnecting` to `true`"),this.reconnecting=!0),this.log("_setupReconnect :: setting reconnectTimer for %d ms",this.options.reconnectPeriod),this.reconnectTimer=setInterval(()=>{this.log("reconnectTimer :: reconnect triggered!"),this._reconnect()},this.options.reconnectPeriod)):this.log("_setupReconnect :: doing nothing...")}_clearReconnect(){this.log("_clearReconnect : clearing reconnect timer"),this.reconnectTimer&&(clearInterval(this.reconnectTimer),this.reconnectTimer=null)}_cleanUp(C,I,O={}){if(I&&(this.log("_cleanUp :: done callback provided for on stream close"),this.stream.on("close",I)),this.log("_cleanUp :: forced? %s",C),C)this.options.reconnectPeriod===0&&this.options.clean&&this._flush(),this.log("_cleanUp :: (%s) :: destroying stream",this.options.clientId),this.stream.destroy();else{let B={cmd:"disconnect",...O};this.log("_cleanUp :: (%s) :: call _sendPacket with disconnect packet",this.options.clientId),this._sendPacket(B,()=>{this.log("_cleanUp :: (%s) :: destroying stream",this.options.clientId),T(()=>{this.stream.end(()=>{this.log("_cleanUp :: (%s) :: stream destroyed",this.options.clientId)})})})}!this.disconnecting&&!this.reconnecting&&(this.log("_cleanUp :: client not disconnecting/reconnecting. Clearing and resetting reconnect."),this._clearReconnect(),this._setupReconnect()),this._destroyKeepaliveManager(),I&&!this.connected&&(this.log("_cleanUp :: (%s) :: removing stream `done` callback `close` listener",this.options.clientId),this.stream.removeListener("close",I),I())}_storeAndSend(C,I,O){this.log("storeAndSend :: store packet with cmd %s to outgoingStore",C.cmd);let B=C,P;if(B.cmd==="publish"&&(B=(0,u.default)(C),P=this._removeTopicAliasAndRecoverTopicName(B),P))return I&&I(P);this.outgoingStore.put(B,$=>{if($)return I&&I($);O(),this._writePacket(C,I)})}_applyTopicAlias(C){if(this.options.protocolVersion===5&&C.cmd==="publish"){let I;C.properties&&(I=C.properties.topicAlias);let O=C.topic.toString();if(this.topicAliasSend)if(I){if(O.length!==0&&(this.log("applyTopicAlias :: register topic: %s - alias: %d",O,I),!this.topicAliasSend.put(O,I)))return this.log("applyTopicAlias :: error out of range. topic: %s - alias: %d",O,I),new Error("Sending Topic Alias out of range")}else O.length!==0&&(this.options.autoAssignTopicAlias?(I=this.topicAliasSend.getAliasByTopic(O),I?(C.topic="",C.properties={...C.properties,topicAlias:I},this.log("applyTopicAlias :: auto assign(use) topic: %s - alias: %d",O,I)):(I=this.topicAliasSend.getLruAlias(),this.topicAliasSend.put(O,I),C.properties={...C.properties,topicAlias:I},this.log("applyTopicAlias :: auto assign topic: %s - alias: %d",O,I))):this.options.autoUseTopicAlias&&(I=this.topicAliasSend.getAliasByTopic(O),I&&(C.topic="",C.properties={...C.properties,topicAlias:I},this.log("applyTopicAlias :: auto use topic: %s - alias: %d",O,I))));else if(I)return this.log("applyTopicAlias :: error out of range. topic: %s - alias: %d",O,I),new Error("Sending Topic Alias out of range")}}_noop(C){this.log("noop ::",C)}_writePacket(C,I){this.log("_writePacket :: packet: %O",C),this.log("_writePacket :: emitting `packetsend`"),this.emit("packetsend",C),this.log("_writePacket :: writing to stream");let O=s.default.writeToStream(C,this.stream,this.options);this.log("_writePacket :: writeToStream result %s",O),!O&&I&&I!==this.noop?(this.log("_writePacket :: handle events on `drain` once through callback."),this.stream.once("drain",I)):I&&(this.log("_writePacket :: invoking cb"),I())}_sendPacket(C,I,O,B){this.log("_sendPacket :: (%s) ::  start",this.options.clientId),O=O||this.noop,I=I||this.noop;let P=this._applyTopicAlias(C);if(P){I(P);return}if(!this.connected){if(C.cmd==="auth"){this._writePacket(C,I);return}this.log("_sendPacket :: client not connected. Storing packet offline."),this._storePacket(C,I,O);return}if(B){this._writePacket(C,I);return}switch(C.cmd){case"publish":break;case"pubrel":this._storeAndSend(C,I,O);return;default:this._writePacket(C,I);return}switch(C.qos){case 2:case 1:this._storeAndSend(C,I,O);break;case 0:default:this._writePacket(C,I);break}this.log("_sendPacket :: (%s) ::  end",this.options.clientId)}_storePacket(C,I,O){this.log("_storePacket :: packet: %o",C),this.log("_storePacket :: cb? %s",!!I),O=O||this.noop;let B=C;if(B.cmd==="publish"){B=(0,u.default)(C);let $=this._removeTopicAliasAndRecoverTopicName(B);if($)return I&&I($)}let P=B.qos||0;P===0&&this.queueQoSZero||B.cmd!=="publish"?this.queue.push({packet:B,cb:I}):P>0?(I=this.outgoing[B.messageId]?this.outgoing[B.messageId].cb:null,this.outgoingStore.put(B,$=>{if($)return I&&I($);O()})):I&&I(new Error("No connection to broker"))}_setupKeepaliveManager(){this.log("_setupKeepaliveManager :: keepalive %d (seconds)",this.options.keepalive),!this.keepaliveManager&&this.options.keepalive&&(this.keepaliveManager=new E.default(this,this.options.timerVariant))}_destroyKeepaliveManager(){this.keepaliveManager&&(this.log("_destroyKeepaliveManager :: destroying keepalive manager"),this.keepaliveManager.destroy(),this.keepaliveManager=null)}reschedulePing(C=!1){this.keepaliveManager&&this.options.keepalive&&(C||this.options.reschedulePings)&&this._reschedulePing()}_reschedulePing(){this.log("_reschedulePing :: rescheduling ping"),this.keepaliveManager.reschedule()}sendPing(){this.log("_sendPing :: sending pingreq"),this._sendPacket({cmd:"pingreq"})}onKeepaliveTimeout(){this.emit("error",new Error("Keepalive timeout")),this.log("onKeepaliveTimeout :: calling _cleanUp with force true"),this._cleanUp(!0)}_resubscribe(){this.log("_resubscribe");let C=Object.keys(this._resubscribeTopics);if(!this._firstConnection&&(this.options.clean||this.options.protocolVersion>=4&&!this.connackPacket.sessionPresent)&&C.length>0)if(this.options.resubscribe)if(this.options.protocolVersion===5){this.log("_resubscribe: protocolVersion 5");for(let I=0;I<C.length;I++){let O={};O[C[I]]=this._resubscribeTopics[C[I]],O.resubscribe=!0,this.subscribe(O,{properties:O[C[I]].properties})}}else this._resubscribeTopics.resubscribe=!0,this.subscribe(this._resubscribeTopics);else this._resubscribeTopics={};this._firstConnection=!1}_onConnect(C){if(this.disconnected){this.emit("connect",C);return}this.connackPacket=C,this.messageIdProvider.clear(),this._setupKeepaliveManager(),this.connected=!0;let I=()=>{let O=this.outgoingStore.createStream(),B=()=>{O.destroy(),O=null,this._flushStoreProcessingQueue(),P()},P=()=>{this._storeProcessing=!1,this._packetIdsDuringStoreProcessing={}};this.once("close",B),O.on("error",F=>{P(),this._flushStoreProcessingQueue(),this.removeListener("close",B),this.emit("error",F)});let $=()=>{if(!O)return;let F=O.read(1),Z;if(!F){O.once("readable",$);return}if(this._storeProcessing=!0,this._packetIdsDuringStoreProcessing[F.messageId]){$();return}!this.disconnecting&&!this.reconnectTimer?(Z=this.outgoing[F.messageId]?this.outgoing[F.messageId].cb:null,this.outgoing[F.messageId]={volatile:!1,cb(X,q){Z&&Z(X,q),$()}},this._packetIdsDuringStoreProcessing[F.messageId]=!0,this.messageIdProvider.register(F.messageId)?this._sendPacket(F,void 0,void 0,!0):this.log("messageId: %d has already used.",F.messageId)):O.destroy&&O.destroy()};O.on("end",()=>{let F=!0;for(let Z in this._packetIdsDuringStoreProcessing)if(!this._packetIdsDuringStoreProcessing[Z]){F=!1;break}this.removeListener("close",B),F?(P(),this._invokeAllStoreProcessingQueue(),this.emit("connect",C)):I()}),$()};I()}_invokeStoreProcessingQueue(){if(!this._storeProcessing&&this._storeProcessingQueue.length>0){let C=this._storeProcessingQueue[0];if(C&&C.invoke())return this._storeProcessingQueue.shift(),!0}return!1}_invokeAllStoreProcessingQueue(){for(;this._invokeStoreProcessingQueue(););}_flushStoreProcessingQueue(){for(let C of this._storeProcessingQueue)C.cbStorePut&&C.cbStorePut(new Error("Connection closed")),C.callback&&C.callback(new Error("Connection closed"));this._storeProcessingQueue.splice(0)}_removeOutgoingAndStoreMessage(C,I){delete this.outgoing[C],this.outgoingStore.del({messageId:C},(O,B)=>{I(O,B),this.messageIdProvider.deallocate(C),this._invokeStoreProcessingQueue()})}};l.default=L}),mC=je(l=>{ke(),Pe(),Me(),Object.defineProperty(l,"__esModule",{value:!0});var e=Gx(),t=class{numberAllocator;lastId;constructor(){this.numberAllocator=new e.NumberAllocator(1,65535)}allocate(){return this.lastId=this.numberAllocator.alloc(),this.lastId}getLastAllocated(){return this.lastId}register(r){return this.numberAllocator.use(r)}deallocate(r){this.numberAllocator.free(r)}clear(){this.numberAllocator.clear()}};l.default=t});function yC(){if(rg)return zu;rg=!0;let l=2147483647,e=36,t=1,r=26,n=38,s=700,a=72,u=128,f="-",c=/^xn--/,d=/[^\0-\x7F]/,p=/[\x2E\u3002\uFF0E\uFF61]/g,m={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},v=e-t,y=Math.floor,b=String.fromCharCode;function E(P){throw new RangeError(m[P])}function x(P,$){let F=[],Z=P.length;for(;Z--;)F[Z]=$(P[Z]);return F}function T(P,$){let F=P.split("@"),Z="";F.length>1&&(Z=F[0]+"@",P=F[1]),P=P.replace(p,".");let X=P.split("."),q=x(X,$).join(".");return Z+q}function A(P){let $=[],F=0,Z=P.length;for(;F<Z;){let X=P.charCodeAt(F++);if(X>=55296&&X<=56319&&F<Z){let q=P.charCodeAt(F++);(q&64512)==56320?$.push(((X&1023)<<10)+(q&1023)+65536):($.push(X),F--)}else $.push(X)}return $}let L=P=>String.fromCodePoint(...P),w=function(P){return P>=48&&P<58?26+(P-48):P>=65&&P<91?P-65:P>=97&&P<123?P-97:e},C=function(P,$){return P+22+75*(P<26)-(($!=0)<<5)},I=function(P,$,F){let Z=0;for(P=F?y(P/s):P>>1,P+=y(P/$);P>v*r>>1;Z+=e)P=y(P/v);return y(Z+(v+1)*P/(P+n))},O=function(P){let $=[],F=P.length,Z=0,X=u,q=a,H=P.lastIndexOf(f);H<0&&(H=0);for(let K=0;K<H;++K)P.charCodeAt(K)>=128&&E("not-basic"),$.push(P.charCodeAt(K));for(let K=H>0?H+1:0;K<F;){let z=Z;for(let Y=1,U=e;;U+=e){K>=F&&E("invalid-input");let N=w(P.charCodeAt(K++));N>=e&&E("invalid-input"),N>y((l-Z)/Y)&&E("overflow"),Z+=N*Y;let W=U<=q?t:U>=q+r?r:U-q;if(N<W)break;let ue=e-W;Y>y(l/ue)&&E("overflow"),Y*=ue}let ie=$.length+1;q=I(Z-z,ie,z==0),y(Z/ie)>l-X&&E("overflow"),X+=y(Z/ie),Z%=ie,$.splice(Z++,0,X)}return String.fromCodePoint(...$)},B=function(P){let $=[];P=A(P);let F=P.length,Z=u,X=0,q=a;for(let z of P)z<128&&$.push(b(z));let H=$.length,K=H;for(H&&$.push(f);K<F;){let z=l;for(let Y of P)Y>=Z&&Y<z&&(z=Y);let ie=K+1;z-Z>y((l-X)/ie)&&E("overflow"),X+=(z-Z)*ie,Z=z;for(let Y of P)if(Y<Z&&++X>l&&E("overflow"),Y===Z){let U=X;for(let N=e;;N+=e){let W=N<=q?t:N>=q+r?r:N-q;if(U<W)break;let ue=U-W,ne=e-W;$.push(b(C(W+ue%ne,0))),U=y(ue/ne)}$.push(b(C(U,0))),q=I(X,ie,K===H),X=0,++K}++X,++Z}return $.join("")};return zu={version:"2.3.1",ucs2:{decode:A,encode:L},decode:O,encode:B,toASCII:function(P){return T(P,function($){return d.test($)?"xn--"+B($):$})},toUnicode:function(P){return T(P,function($){return c.test($)?O($.slice(4).toLowerCase()):$})}},zu}var zu,rg,es,vC=Vr(()=>{ke(),Pe(),Me(),zu={},rg=!1,es=yC(),es.decode,es.encode,es.toASCII,es.toUnicode,es.ucs2,es.version});function bC(){return ng||(ng=!0,ig=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var l={},e=Symbol("test"),t=Object(e);if(typeof e=="string"||Object.prototype.toString.call(e)!=="[object Symbol]"||Object.prototype.toString.call(t)!=="[object Symbol]")return!1;var r=42;l[e]=r;for(e in l)return!1;if(typeof Object.keys=="function"&&Object.keys(l).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(l).length!==0)return!1;var n=Object.getOwnPropertySymbols(l);if(n.length!==1||n[0]!==e||!Object.prototype.propertyIsEnumerable.call(l,e))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var s=Object.getOwnPropertyDescriptor(l,e);if(s.value!==r||s.enumerable!==!0)return!1}return!0}),ig}function EC(){return ag||(ag=!0,sg=Error),sg}function SC(){return lg||(lg=!0,og=EvalError),og}function TC(){return cg||(cg=!0,ug=RangeError),ug}function xC(){return hg||(hg=!0,fg=ReferenceError),fg}function Xx(){return pg||(pg=!0,dg=SyntaxError),dg}function cl(){return mg||(mg=!0,gg=TypeError),gg}function _C(){return vg||(vg=!0,yg=URIError),yg}function AC(){if(bg)return qu;bg=!0;var l=typeof Symbol<"u"&&Symbol,e=bC();return qu=function(){return typeof l!="function"||typeof Symbol!="function"||typeof l("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},qu}function wC(){if(Eg)return Yu;Eg=!0;var l={__proto__:null,foo:{}},e=Object;return Yu=function(){return{__proto__:l}.foo===l.foo&&!(l instanceof e)},Yu}function RC(){if(Sg)return Wu;Sg=!0;var l="Function.prototype.bind called on incompatible ",e=Object.prototype.toString,t=Math.max,r="[object Function]",n=function(u,f){for(var c=[],d=0;d<u.length;d+=1)c[d]=u[d];for(var p=0;p<f.length;p+=1)c[p+u.length]=f[p];return c},s=function(u,f){for(var c=[],d=f,p=0;d<u.length;d+=1,p+=1)c[p]=u[d];return c},a=function(u,f){for(var c="",d=0;d<u.length;d+=1)c+=u[d],d+1<u.length&&(c+=f);return c};return Wu=function(u){var f=this;if(typeof f!="function"||e.apply(f)!==r)throw new TypeError(l+f);for(var c=s(arguments,1),d,p=function(){if(this instanceof d){var E=f.apply(this,n(c,arguments));return Object(E)===E?E:this}return f.apply(u,n(c,arguments))},m=t(0,f.length-c.length),v=[],y=0;y<m;y++)v[y]="$"+y;if(d=Function("binder","return function ("+a(v,",")+"){ return binder.apply(this,arguments); }")(p),f.prototype){var b=function(){};b.prototype=f.prototype,d.prototype=new b,b.prototype=null}return d},Wu}function Em(){if(Tg)return Qu;Tg=!0;var l=RC();return Qu=Function.prototype.bind||l,Qu}function IC(){if(xg)return Xu;xg=!0;var l=Function.prototype.call,e=Object.prototype.hasOwnProperty,t=Em();return Xu=t.call(l,e),Xu}function qa(){if(_g)return Zu;_g=!0;var l,e=EC(),t=SC(),r=TC(),n=xC(),s=Xx(),a=cl(),u=_C(),f=Function,c=function(K){try{return f('"use strict"; return ('+K+").constructor;")()}catch{}},d=Object.getOwnPropertyDescriptor;if(d)try{d({},"")}catch{d=null}var p=function(){throw new a},m=d?(function(){try{return arguments.callee,p}catch{try{return d(arguments,"callee").get}catch{return p}}})():p,v=AC()(),y=wC()(),b=Object.getPrototypeOf||(y?function(K){return K.__proto__}:null),E={},x=typeof Uint8Array>"u"||!b?l:b(Uint8Array),T={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?l:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?l:ArrayBuffer,"%ArrayIteratorPrototype%":v&&b?b([][Symbol.iterator]()):l,"%AsyncFromSyncIteratorPrototype%":l,"%AsyncFunction%":E,"%AsyncGenerator%":E,"%AsyncGeneratorFunction%":E,"%AsyncIteratorPrototype%":E,"%Atomics%":typeof Atomics>"u"?l:Atomics,"%BigInt%":typeof BigInt>"u"?l:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?l:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?l:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?l:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":e,"%eval%":eval,"%EvalError%":t,"%Float32Array%":typeof Float32Array>"u"?l:Float32Array,"%Float64Array%":typeof Float64Array>"u"?l:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?l:FinalizationRegistry,"%Function%":f,"%GeneratorFunction%":E,"%Int8Array%":typeof Int8Array>"u"?l:Int8Array,"%Int16Array%":typeof Int16Array>"u"?l:Int16Array,"%Int32Array%":typeof Int32Array>"u"?l:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":v&&b?b(b([][Symbol.iterator]())):l,"%JSON%":typeof JSON=="object"?JSON:l,"%Map%":typeof Map>"u"?l:Map,"%MapIteratorPrototype%":typeof Map>"u"||!v||!b?l:b(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?l:Promise,"%Proxy%":typeof Proxy>"u"?l:Proxy,"%RangeError%":r,"%ReferenceError%":n,"%Reflect%":typeof Reflect>"u"?l:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?l:Set,"%SetIteratorPrototype%":typeof Set>"u"||!v||!b?l:b(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?l:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":v&&b?b(""[Symbol.iterator]()):l,"%Symbol%":v?Symbol:l,"%SyntaxError%":s,"%ThrowTypeError%":m,"%TypedArray%":x,"%TypeError%":a,"%Uint8Array%":typeof Uint8Array>"u"?l:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?l:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?l:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?l:Uint32Array,"%URIError%":u,"%WeakMap%":typeof WeakMap>"u"?l:WeakMap,"%WeakRef%":typeof WeakRef>"u"?l:WeakRef,"%WeakSet%":typeof WeakSet>"u"?l:WeakSet};if(b)try{null.error}catch(K){var A=b(b(K));T["%Error.prototype%"]=A}var L=function K(z){var ie;if(z==="%AsyncFunction%")ie=c("async function () {}");else if(z==="%GeneratorFunction%")ie=c("function* () {}");else if(z==="%AsyncGeneratorFunction%")ie=c("async function* () {}");else if(z==="%AsyncGenerator%"){var Y=K("%AsyncGeneratorFunction%");Y&&(ie=Y.prototype)}else if(z==="%AsyncIteratorPrototype%"){var U=K("%AsyncGenerator%");U&&b&&(ie=b(U.prototype))}return T[z]=ie,ie},w={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},C=Em(),I=IC(),O=C.call(Function.call,Array.prototype.concat),B=C.call(Function.apply,Array.prototype.splice),P=C.call(Function.call,String.prototype.replace),$=C.call(Function.call,String.prototype.slice),F=C.call(Function.call,RegExp.prototype.exec),Z=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,X=/\\(\\)?/g,q=function(K){var z=$(K,0,1),ie=$(K,-1);if(z==="%"&&ie!=="%")throw new s("invalid intrinsic syntax, expected closing `%`");if(ie==="%"&&z!=="%")throw new s("invalid intrinsic syntax, expected opening `%`");var Y=[];return P(K,Z,function(U,N,W,ue){Y[Y.length]=W?P(ue,X,"$1"):N||U}),Y},H=function(K,z){var ie=K,Y;if(I(w,ie)&&(Y=w[ie],ie="%"+Y[0]+"%"),I(T,ie)){var U=T[ie];if(U===E&&(U=L(ie)),typeof U>"u"&&!z)throw new a("intrinsic "+K+" exists, but is not available. Please file an issue!");return{alias:Y,name:ie,value:U}}throw new s("intrinsic "+K+" does not exist!")};return Zu=function(K,z){if(typeof K!="string"||K.length===0)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof z!="boolean")throw new a('"allowMissing" argument must be a boolean');if(F(/^%?[^%]*%?$/,K)===null)throw new s("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var ie=q(K),Y=ie.length>0?ie[0]:"",U=H("%"+Y+"%",z),N=U.name,W=U.value,ue=!1,ne=U.alias;ne&&(Y=ne[0],B(ie,O([0,1],ne)));for(var Ee=1,se=!0;Ee<ie.length;Ee+=1){var J=ie[Ee],me=$(J,0,1),ce=$(J,-1);if((me==='"'||me==="'"||me==="`"||ce==='"'||ce==="'"||ce==="`")&&me!==ce)throw new s("property names with quotes must have matching quotes");if((J==="constructor"||!se)&&(ue=!0),Y+="."+J,N="%"+Y+"%",I(T,N))W=T[N];else if(W!=null){if(!(J in W)){if(!z)throw new a("base intrinsic for "+K+" exists, but the property is not available.");return}if(d&&Ee+1>=ie.length){var he=d(W,J);se=!!he,se&&"get"in he&&!("originalValue"in he.get)?W=he.get:W=W[J]}else se=I(W,J),W=W[J];se&&!ue&&(T[N]=W)}}return W},Zu}function Sm(){if(Ag)return Ju;Ag=!0;var l=qa(),e=l("%Object.defineProperty%",!0)||!1;if(e)try{e({},"a",{value:1})}catch{e=!1}return Ju=e,Ju}function Zx(){if(wg)return ec;wg=!0;var l=qa(),e=l("%Object.getOwnPropertyDescriptor%",!0);if(e)try{e([],"length")}catch{e=null}return ec=e,ec}function LC(){if(Rg)return tc;Rg=!0;var l=Sm(),e=Xx(),t=cl(),r=Zx();return tc=function(n,s,a){if(!n||typeof n!="object"&&typeof n!="function")throw new t("`obj` must be an object or a function`");if(typeof s!="string"&&typeof s!="symbol")throw new t("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new t("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new t("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new t("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new t("`loose`, if provided, must be a boolean");var u=arguments.length>3?arguments[3]:null,f=arguments.length>4?arguments[4]:null,c=arguments.length>5?arguments[5]:null,d=arguments.length>6?arguments[6]:!1,p=!!r&&r(n,s);if(l)l(n,s,{configurable:c===null&&p?p.configurable:!c,enumerable:u===null&&p?p.enumerable:!u,value:a,writable:f===null&&p?p.writable:!f});else if(d||!u&&!f&&!c)n[s]=a;else throw new e("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},tc}function CC(){if(Ig)return rc;Ig=!0;var l=Sm(),e=function(){return!!l};return e.hasArrayLengthDefineBug=function(){if(!l)return null;try{return l([],"length",{value:1}).length!==1}catch{return!0}},rc=e,rc}function DC(){if(Lg)return ic;Lg=!0;var l=qa(),e=LC(),t=CC()(),r=Zx(),n=cl(),s=l("%Math.floor%");return ic=function(a,u){if(typeof a!="function")throw new n("`fn` is not a function");if(typeof u!="number"||u<0||u>4294967295||s(u)!==u)throw new n("`length` must be a positive 32-bit integer");var f=arguments.length>2&&!!arguments[2],c=!0,d=!0;if("length"in a&&r){var p=r(a,"length");p&&!p.configurable&&(c=!1),p&&!p.writable&&(d=!1)}return(c||d||!f)&&(t?e(a,"length",u,!0,!0):e(a,"length",u)),a},ic}function OC(){if(Cg)return Oa;Cg=!0;var l=Em(),e=qa(),t=DC(),r=cl(),n=e("%Function.prototype.apply%"),s=e("%Function.prototype.call%"),a=e("%Reflect.apply%",!0)||l.call(s,n),u=Sm(),f=e("%Math.max%");Oa=function(d){if(typeof d!="function")throw new r("a function is required");var p=a(l,s,arguments);return t(p,1+f(0,d.length-(arguments.length-1)),!0)};var c=function(){return a(l,n,arguments)};return u?u(Oa,"apply",{value:c}):Oa.apply=c,Oa}function kC(){if(Dg)return nc;Dg=!0;var l=qa(),e=OC(),t=e(l("String.prototype.indexOf"));return nc=function(r,n){var s=l(r,!!n);return typeof s=="function"&&t(r,".prototype.")>-1?e(s):s},nc}var ig,ng,sg,ag,og,lg,ug,cg,fg,hg,dg,pg,gg,mg,yg,vg,qu,bg,Yu,Eg,Wu,Sg,Qu,Tg,Xu,xg,Zu,_g,Ju,Ag,ec,wg,tc,Rg,rc,Ig,ic,Lg,Oa,Cg,nc,Dg,MC=Vr(()=>{ke(),Pe(),Me(),ig={},ng=!1,sg={},ag=!1,og={},lg=!1,ug={},cg=!1,fg={},hg=!1,dg={},pg=!1,gg={},mg=!1,yg={},vg=!1,qu={},bg=!1,Yu={},Eg=!1,Wu={},Sg=!1,Qu={},Tg=!1,Xu={},xg=!1,Zu={},_g=!1,Ju={},Ag=!1,ec={},wg=!1,tc={},Rg=!1,rc={},Ig=!1,ic={},Lg=!1,Oa={},Cg=!1,nc={},Dg=!1});function Tm(l){throw new Error("Node.js process "+l+" is not supported by JSPM core outside of Node.js")}function PC(){!Ms||!Os||(Ms=!1,Os.length?Ni=Os.concat(Ni):qo=-1,Ni.length&&Jx())}function Jx(){if(!Ms){var l=setTimeout(PC,0);Ms=!0;for(var e=Ni.length;e;){for(Os=Ni,Ni=[];++qo<e;)Os&&Os[qo].run();qo=-1,e=Ni.length}Os=null,Ms=!1,clearTimeout(l)}}function NC(l){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];Ni.push(new e_(l,e)),Ni.length===1&&!Ms&&setTimeout(Jx,0)}function e_(l,e){this.fun=l,this.array=e}function Tr(){}function UC(l){Tm("_linkedBinding")}function BC(l){Tm("dlopen")}function FC(){return[]}function jC(){return[]}function $C(l,e){if(!l)throw new Error(e||"assertion error")}function GC(){return!1}function HC(){return yn.now()/1e3}function gd(l){var e=Math.floor((Date.now()-yn.now())*.001),t=yn.now()*.001,r=Math.floor(t)+e,n=Math.floor(t%1*1e9);return l&&(r=r-l[0],n=n-l[1],n<0&&(r--,n+=sc)),[r,n]}function Qn(){return xm}function KC(l){return[]}var Ni,Ms,Os,qo,iE,nE,sE,aE,oE,lE,uE,cE,fE,hE,dE,pE,gE,mE,yE,vE,bE,EE,SE,TE,xE,_u,_E,AE,wE,RE,IE,LE,CE,DE,OE,kE,ME,PE,NE,UE,BE,FE,jE,$E,GE,HE,KE,VE,zE,qE,YE,yn,md,sc,WE,QE,XE,ZE,JE,eS,tS,rS,iS,nS,sS,xm,t_=Vr(()=>{ke(),Pe(),Me(),Ni=[],Ms=!1,qo=-1,e_.prototype.run=function(){this.fun.apply(null,this.array)},iE="browser",nE="x64",sE="browser",aE={PATH:"/usr/bin",LANG:navigator.language+".UTF-8",PWD:"/",HOME:"/home",TMP:"/tmp"},oE=["/usr/bin/node"],lE=[],uE="v16.8.0",cE={},fE=function(l,e){console.warn((e?e+": ":"")+l)},hE=function(l){Tm("binding")},dE=function(l){return 0},pE=function(){return"/"},gE=function(l){},mE={name:"node",sourceUrl:"",headersUrl:"",libUrl:""},yE=Tr,vE=[],bE={},EE=!1,SE={},TE=Tr,xE=Tr,_u=function(){return{}},_E=_u,AE=_u,wE=Tr,RE=Tr,IE=Tr,LE={},CE={inspector:!1,debug:!1,uv:!1,ipv6:!1,tls_alpn:!1,tls_sni:!1,tls_ocsp:!1,tls:!1,cached_builtins:!0},DE=Tr,OE=Tr,kE=Tr,ME=Tr,PE=Tr,NE=Tr,UE=Tr,BE=void 0,FE=void 0,jE=void 0,$E=Tr,GE=2,HE=1,KE="/bin/usr/node",VE=9229,zE="node",qE=[],YE=Tr,yn={now:typeof performance<"u"?performance.now.bind(performance):void 0,timing:typeof performance<"u"?performance.timing:void 0},yn.now===void 0&&(md=Date.now(),yn.timing&&yn.timing.navigationStart&&(md=yn.timing.navigationStart),yn.now=()=>Date.now()-md),sc=1e9,gd.bigint=function(l){var e=gd(l);return typeof BigInt>"u"?e[0]*sc+e[1]:BigInt(e[0]*sc)+BigInt(e[1])},WE=10,QE={},XE=0,ZE=Qn,JE=Qn,eS=Qn,tS=Qn,rS=Qn,iS=Tr,nS=Qn,sS=Qn,xm={version:uE,versions:cE,arch:nE,platform:sE,release:mE,_rawDebug:yE,moduleLoadList:vE,binding:hE,_linkedBinding:UC,_events:QE,_eventsCount:XE,_maxListeners:WE,on:Qn,addListener:ZE,once:JE,off:eS,removeListener:tS,removeAllListeners:rS,emit:iS,prependListener:nS,prependOnceListener:sS,listeners:KC,domain:bE,_exiting:EE,config:SE,dlopen:BC,uptime:HC,_getActiveRequests:FC,_getActiveHandles:jC,reallyExit:TE,_kill:xE,cpuUsage:_u,resourceUsage:_E,memoryUsage:AE,kill:wE,exit:RE,openStdin:IE,allowedNodeEnvironmentFlags:LE,assert:$C,features:CE,_fatalExceptions:DE,setUncaughtExceptionCaptureCallback:OE,hasUncaughtExceptionCaptureCallback:GC,emitWarning:fE,nextTick:NC,_tickCallback:kE,_debugProcess:ME,_debugEnd:PE,_startProfilerIdleNotifier:NE,_stopProfilerIdleNotifier:UE,stdout:BE,stdin:jE,stderr:FE,abort:$E,umask:dE,chdir:gE,cwd:pE,env:aE,title:iE,argv:oE,execArgv:lE,pid:GE,ppid:HE,execPath:KE,debugPort:VE,hrtime:gd,argv0:zE,_preload_modules:qE,setSourceMapsEnabled:YE}});function VC(){if(Og)return ac;Og=!0;var l=xm;function e(s){if(typeof s!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(s))}function t(s,a){for(var u="",f=0,c=-1,d=0,p,m=0;m<=s.length;++m){if(m<s.length)p=s.charCodeAt(m);else{if(p===47)break;p=47}if(p===47){if(!(c===m-1||d===1))if(c!==m-1&&d===2){if(u.length<2||f!==2||u.charCodeAt(u.length-1)!==46||u.charCodeAt(u.length-2)!==46){if(u.length>2){var v=u.lastIndexOf("/");if(v!==u.length-1){v===-1?(u="",f=0):(u=u.slice(0,v),f=u.length-1-u.lastIndexOf("/")),c=m,d=0;continue}}else if(u.length===2||u.length===1){u="",f=0,c=m,d=0;continue}}a&&(u.length>0?u+="/..":u="..",f=2)}else u.length>0?u+="/"+s.slice(c+1,m):u=s.slice(c+1,m),f=m-c-1;c=m,d=0}else p===46&&d!==-1?++d:d=-1}return u}function r(s,a){var u=a.dir||a.root,f=a.base||(a.name||"")+(a.ext||"");return u?u===a.root?u+f:u+s+f:f}var n={resolve:function(){for(var s="",a=!1,u,f=arguments.length-1;f>=-1&&!a;f--){var c;f>=0?c=arguments[f]:(u===void 0&&(u=l.cwd()),c=u),e(c),c.length!==0&&(s=c+"/"+s,a=c.charCodeAt(0)===47)}return s=t(s,!a),a?s.length>0?"/"+s:"/":s.length>0?s:"."},normalize:function(s){if(e(s),s.length===0)return".";var a=s.charCodeAt(0)===47,u=s.charCodeAt(s.length-1)===47;return s=t(s,!a),s.length===0&&!a&&(s="."),s.length>0&&u&&(s+="/"),a?"/"+s:s},isAbsolute:function(s){return e(s),s.length>0&&s.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var s,a=0;a<arguments.length;++a){var u=arguments[a];e(u),u.length>0&&(s===void 0?s=u:s+="/"+u)}return s===void 0?".":n.normalize(s)},relative:function(s,a){if(e(s),e(a),s===a||(s=n.resolve(s),a=n.resolve(a),s===a))return"";for(var u=1;u<s.length&&s.charCodeAt(u)===47;++u);for(var f=s.length,c=f-u,d=1;d<a.length&&a.charCodeAt(d)===47;++d);for(var p=a.length,m=p-d,v=c<m?c:m,y=-1,b=0;b<=v;++b){if(b===v){if(m>v){if(a.charCodeAt(d+b)===47)return a.slice(d+b+1);if(b===0)return a.slice(d+b)}else c>v&&(s.charCodeAt(u+b)===47?y=b:b===0&&(y=0));break}var E=s.charCodeAt(u+b),x=a.charCodeAt(d+b);if(E!==x)break;E===47&&(y=b)}var T="";for(b=u+y+1;b<=f;++b)(b===f||s.charCodeAt(b)===47)&&(T.length===0?T+="..":T+="/..");return T.length>0?T+a.slice(d+y):(d+=y,a.charCodeAt(d)===47&&++d,a.slice(d))},_makeLong:function(s){return s},dirname:function(s){if(e(s),s.length===0)return".";for(var a=s.charCodeAt(0),u=a===47,f=-1,c=!0,d=s.length-1;d>=1;--d)if(a=s.charCodeAt(d),a===47){if(!c){f=d;break}}else c=!1;return f===-1?u?"/":".":u&&f===1?"//":s.slice(0,f)},basename:function(s,a){if(a!==void 0&&typeof a!="string")throw new TypeError('"ext" argument must be a string');e(s);var u=0,f=-1,c=!0,d;if(a!==void 0&&a.length>0&&a.length<=s.length){if(a.length===s.length&&a===s)return"";var p=a.length-1,m=-1;for(d=s.length-1;d>=0;--d){var v=s.charCodeAt(d);if(v===47){if(!c){u=d+1;break}}else m===-1&&(c=!1,m=d+1),p>=0&&(v===a.charCodeAt(p)?--p===-1&&(f=d):(p=-1,f=m))}return u===f?f=m:f===-1&&(f=s.length),s.slice(u,f)}else{for(d=s.length-1;d>=0;--d)if(s.charCodeAt(d)===47){if(!c){u=d+1;break}}else f===-1&&(c=!1,f=d+1);return f===-1?"":s.slice(u,f)}},extname:function(s){e(s);for(var a=-1,u=0,f=-1,c=!0,d=0,p=s.length-1;p>=0;--p){var m=s.charCodeAt(p);if(m===47){if(!c){u=p+1;break}continue}f===-1&&(c=!1,f=p+1),m===46?a===-1?a=p:d!==1&&(d=1):a!==-1&&(d=-1)}return a===-1||f===-1||d===0||d===1&&a===f-1&&a===u+1?"":s.slice(a,f)},format:function(s){if(s===null||typeof s!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof s);return r("/",s)},parse:function(s){e(s);var a={root:"",dir:"",base:"",ext:"",name:""};if(s.length===0)return a;var u=s.charCodeAt(0),f=u===47,c;f?(a.root="/",c=1):c=0;for(var d=-1,p=0,m=-1,v=!0,y=s.length-1,b=0;y>=c;--y){if(u=s.charCodeAt(y),u===47){if(!v){p=y+1;break}continue}m===-1&&(v=!1,m=y+1),u===46?d===-1?d=y:b!==1&&(b=1):d!==-1&&(b=-1)}return d===-1||m===-1||b===0||b===1&&d===m-1&&d===p+1?m!==-1&&(p===0&&f?a.base=a.name=s.slice(1,m):a.base=a.name=s.slice(p,m)):(p===0&&f?(a.name=s.slice(1,d),a.base=s.slice(1,m)):(a.name=s.slice(p,d),a.base=s.slice(p,m)),a.ext=s.slice(d,m)),p>0?a.dir=s.slice(0,p-1):f&&(a.dir="/"),a},sep:"/",delimiter:":",win32:null,posix:null};return n.posix=n,ac=n,ac}var ac,Og,kg,zC=Vr(()=>{ke(),Pe(),Me(),t_(),ac={},Og=!1,kg=VC()}),r_={};Ka(r_,{URL:()=>h_,Url:()=>o_,default:()=>xr,fileURLToPath:()=>n_,format:()=>l_,parse:()=>f_,pathToFileURL:()=>s_,resolve:()=>u_,resolveObject:()=>c_});function qC(){if(Mg)return oc;Mg=!0;var l=typeof Map=="function"&&Map.prototype,e=Object.getOwnPropertyDescriptor&&l?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,t=l&&e&&typeof e.get=="function"?e.get:null,r=l&&Map.prototype.forEach,n=typeof Set=="function"&&Set.prototype,s=Object.getOwnPropertyDescriptor&&n?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,a=n&&s&&typeof s.get=="function"?s.get:null,u=n&&Set.prototype.forEach,f=typeof WeakMap=="function"&&WeakMap.prototype,c=f?WeakMap.prototype.has:null,d=typeof WeakSet=="function"&&WeakSet.prototype,p=d?WeakSet.prototype.has:null,m=typeof WeakRef=="function"&&WeakRef.prototype,v=m?WeakRef.prototype.deref:null,y=Boolean.prototype.valueOf,b=Object.prototype.toString,E=Function.prototype.toString,x=String.prototype.match,T=String.prototype.slice,A=String.prototype.replace,L=String.prototype.toUpperCase,w=String.prototype.toLowerCase,C=RegExp.prototype.test,I=Array.prototype.concat,O=Array.prototype.join,B=Array.prototype.slice,P=Math.floor,$=typeof BigInt=="function"?BigInt.prototype.valueOf:null,F=Object.getOwnPropertySymbols,Z=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,X=typeof Symbol=="function"&&typeof Symbol.iterator=="object",q=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===X||!0)?Symbol.toStringTag:null,H=Object.prototype.propertyIsEnumerable,K=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(de){return de.__proto__}:null);function z(de,Te){if(de===1/0||de===-1/0||de!==de||de&&de>-1e3&&de<1e3||C.call(/e/,Te))return Te;var Ze=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof de=="number"){var We=de<0?-P(-de):P(de);if(We!==de){var at=String(We),ut=T.call(Te,at.length+1);return A.call(at,Ze,"$&_")+"."+A.call(A.call(ut,/([0-9]{3})/g,"$&_"),/_$/,"")}}return A.call(Te,Ze,"$&_")}var ie=a_,Y=ie.custom,U=he(Y)?Y:null;oc=function de(Te,Ze,We,at){var ut=Ze||{};if(Re(ut,"quoteStyle")&&ut.quoteStyle!=="single"&&ut.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Re(ut,"maxStringLength")&&(typeof ut.maxStringLength=="number"?ut.maxStringLength<0&&ut.maxStringLength!==1/0:ut.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var ai=Re(ut,"customInspect")?ut.customInspect:!0;if(typeof ai!="boolean"&&ai!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Re(ut,"indent")&&ut.indent!==null&&ut.indent!=="	"&&!(parseInt(ut.indent,10)===ut.indent&&ut.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Re(ut,"numericSeparator")&&typeof ut.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var _r=ut.numericSeparator;if(typeof Te>"u")return"undefined";if(Te===null)return"null";if(typeof Te=="boolean")return Te?"true":"false";if(typeof Te=="string")return Ae(Te,ut);if(typeof Te=="number"){if(Te===0)return 1/0/Te>0?"0":"-0";var Yt=String(Te);return _r?z(Te,Yt):Yt}if(typeof Te=="bigint"){var Ar=String(Te)+"n";return _r?z(Te,Ar):Ar}var Dr=typeof ut.depth>"u"?5:ut.depth;if(typeof We>"u"&&(We=0),We>=Dr&&Dr>0&&typeof Te=="object")return ue(Te)?"[Array]":"[Object]";var wr=ye(ut,We);if(typeof at>"u")at=[];else if(ge(at,Te)>=0)return"[Circular]";function rr(Pr,Ai,Ki){if(Ai&&(at=B.call(at),at.push(Ai)),Ki){var zr={depth:ut.depth};return Re(ut,"quoteStyle")&&(zr.quoteStyle=ut.quoteStyle),de(Pr,zr,We+1,at)}return de(Pr,ut,We+1,at)}if(typeof Te=="function"&&!Ee(Te)){var $s=te(Te),Gi=ze(Te,rr);return"[Function"+($s?": "+$s:" (anonymous)")+"]"+(Gi.length>0?" { "+O.call(Gi,", ")+" }":"")}if(he(Te)){var Hi=X?A.call(String(Te),/^(Symbol\(.*\))_[^)]*$/,"$1"):Z.call(Te);return typeof Te=="object"&&!X?R(Hi):Hi}if(Ke(Te)){for(var Q="<"+w.call(String(Te.nodeName)),re=Te.attributes||[],Ve=0;Ve<re.length;Ve++)Q+=" "+re[Ve].name+"="+N(W(re[Ve].value),"double",ut);return Q+=">",Te.childNodes&&Te.childNodes.length&&(Q+="..."),Q+="</"+w.call(String(Te.nodeName))+">",Q}if(ue(Te)){if(Te.length===0)return"[]";var qe=ze(Te,rr);return wr&&!ae(qe)?"["+De(qe,wr)+"]":"[ "+O.call(qe,", ")+" ]"}if(se(Te)){var Qe=ze(Te,rr);return!("cause"in Error.prototype)&&"cause"in Te&&!H.call(Te,"cause")?"{ ["+String(Te)+"] "+O.call(I.call("[cause]: "+rr(Te.cause),Qe),", ")+" }":Qe.length===0?"["+String(Te)+"]":"{ ["+String(Te)+"] "+O.call(Qe,", ")+" }"}if(typeof Te=="object"&&ai){if(U&&typeof Te[U]=="function"&&ie)return ie(Te,{depth:Dr-We});if(ai!=="symbol"&&typeof Te.inspect=="function")return Te.inspect()}if(Ie(Te)){var Ft=[];return r&&r.call(Te,function(Pr,Ai){Ft.push(rr(Ai,Te,!0)+" => "+rr(Pr,Te))}),j("Map",t.call(Te),Ft,wr)}if(le(Te)){var ir=[];return u&&u.call(Te,function(Pr){ir.push(rr(Pr,Te))}),j("Set",a.call(Te),ir,wr)}if(Ce(Te))return D("WeakMap");if(Ne(Te))return D("WeakSet");if(Ue(Te))return D("WeakRef");if(me(Te))return R(rr(Number(Te)));if(pe(Te))return R(rr($.call(Te)));if(ce(Te))return R(y.call(Te));if(J(Te))return R(rr(String(Te)));if(typeof window<"u"&&Te===window)return"{ [object Window] }";if(typeof globalThis<"u"&&Te===globalThis||typeof lc<"u"&&Te===lc)return"{ [object globalThis] }";if(!ne(Te)&&!Ee(Te)){var Or=ze(Te,rr),wn=K?K(Te)===Object.prototype:Te instanceof Object||Te.constructor===Object,kr=Te instanceof Object?"":"null prototype",jt=!wn&&q&&Object(Te)===Te&&q in Te?T.call(ee(Te),8,-1):kr?"Object":"",nr=wn||typeof Te.constructor!="function"?"":Te.constructor.name?Te.constructor.name+" ":"",Mr=nr+(jt||kr?"["+O.call(I.call([],jt||[],kr||[]),": ")+"] ":"");return Or.length===0?Mr+"{}":wr?Mr+"{"+De(Or,wr)+"}":Mr+"{ "+O.call(Or,", ")+" }"}return String(Te)};function N(de,Te,Ze){var We=(Ze.quoteStyle||Te)==="double"?'"':"'";return We+de+We}function W(de){return A.call(String(de),/"/g,"&quot;")}function ue(de){return ee(de)==="[object Array]"&&(!q||!(typeof de=="object"&&q in de))}function ne(de){return ee(de)==="[object Date]"&&(!q||!(typeof de=="object"&&q in de))}function Ee(de){return ee(de)==="[object RegExp]"&&(!q||!(typeof de=="object"&&q in de))}function se(de){return ee(de)==="[object Error]"&&(!q||!(typeof de=="object"&&q in de))}function J(de){return ee(de)==="[object String]"&&(!q||!(typeof de=="object"&&q in de))}function me(de){return ee(de)==="[object Number]"&&(!q||!(typeof de=="object"&&q in de))}function ce(de){return ee(de)==="[object Boolean]"&&(!q||!(typeof de=="object"&&q in de))}function he(de){if(X)return de&&typeof de=="object"&&de instanceof Symbol;if(typeof de=="symbol")return!0;if(!de||typeof de!="object"||!Z)return!1;try{return Z.call(de),!0}catch{}return!1}function pe(de){if(!de||typeof de!="object"||!$)return!1;try{return $.call(de),!0}catch{}return!1}var Fe=Object.prototype.hasOwnProperty||function(de){return de in(this||lc)};function Re(de,Te){return Fe.call(de,Te)}function ee(de){return b.call(de)}function te(de){if(de.name)return de.name;var Te=x.call(E.call(de),/^function\s*([\w$]+)/);return Te?Te[1]:null}function ge(de,Te){if(de.indexOf)return de.indexOf(Te);for(var Ze=0,We=de.length;Ze<We;Ze++)if(de[Ze]===Te)return Ze;return-1}function Ie(de){if(!t||!de||typeof de!="object")return!1;try{t.call(de);try{a.call(de)}catch{return!0}return de instanceof Map}catch{}return!1}function Ce(de){if(!c||!de||typeof de!="object")return!1;try{c.call(de,c);try{p.call(de,p)}catch{return!0}return de instanceof WeakMap}catch{}return!1}function Ue(de){if(!v||!de||typeof de!="object")return!1;try{return v.call(de),!0}catch{}return!1}function le(de){if(!a||!de||typeof de!="object")return!1;try{a.call(de);try{t.call(de)}catch{return!0}return de instanceof Set}catch{}return!1}function Ne(de){if(!p||!de||typeof de!="object")return!1;try{p.call(de,p);try{c.call(de,c)}catch{return!0}return de instanceof WeakSet}catch{}return!1}function Ke(de){return!de||typeof de!="object"?!1:typeof HTMLElement<"u"&&de instanceof HTMLElement?!0:typeof de.nodeName=="string"&&typeof de.getAttribute=="function"}function Ae(de,Te){if(de.length>Te.maxStringLength){var Ze=de.length-Te.maxStringLength,We="... "+Ze+" more character"+(Ze>1?"s":"");return Ae(T.call(de,0,Te.maxStringLength),Te)+We}var at=A.call(A.call(de,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,nt);return N(at,"single",Te)}function nt(de){var Te=de.charCodeAt(0),Ze={8:"b",9:"t",10:"n",12:"f",13:"r"}[Te];return Ze?"\\"+Ze:"\\x"+(Te<16?"0":"")+L.call(Te.toString(16))}function R(de){return"Object("+de+")"}function D(de){return de+" { ? }"}function j(de,Te,Ze,We){var at=We?De(Ze,We):O.call(Ze,", ");return de+" ("+Te+") {"+at+"}"}function ae(de){for(var Te=0;Te<de.length;Te++)if(ge(de[Te],`
`)>=0)return!1;return!0}function ye(de,Te){var Ze;if(de.indent==="	")Ze="	";else if(typeof de.indent=="number"&&de.indent>0)Ze=O.call(Array(de.indent+1)," ");else return null;return{base:Ze,prev:O.call(Array(Te+1),Ze)}}function De(de,Te){if(de.length===0)return"";var Ze=`
`+Te.prev+Te.base;return Ze+O.call(de,","+Ze)+`
`+Te.prev}function ze(de,Te){var Ze=ue(de),We=[];if(Ze){We.length=de.length;for(var at=0;at<de.length;at++)We[at]=Re(de,at)?Te(de[at],de):""}var ut=typeof F=="function"?F(de):[],ai;if(X){ai={};for(var _r=0;_r<ut.length;_r++)ai["$"+ut[_r]]=ut[_r]}for(var Yt in de)Re(de,Yt)&&(Ze&&String(Number(Yt))===Yt&&Yt<de.length||X&&ai["$"+Yt]instanceof Symbol||(C.call(/[^\w$]/,Yt)?We.push(Te(Yt,de)+": "+Te(de[Yt],de)):We.push(Yt+": "+Te(de[Yt],de))));if(typeof F=="function")for(var Ar=0;Ar<ut.length;Ar++)H.call(de,ut[Ar])&&We.push("["+Te(ut[Ar])+"]: "+Te(de[ut[Ar]],de));return We}return oc}function YC(){if(Pg)return uc;Pg=!0;var l=qa(),e=kC(),t=qC(),r=cl(),n=l("%WeakMap%",!0),s=l("%Map%",!0),a=e("WeakMap.prototype.get",!0),u=e("WeakMap.prototype.set",!0),f=e("WeakMap.prototype.has",!0),c=e("Map.prototype.get",!0),d=e("Map.prototype.set",!0),p=e("Map.prototype.has",!0),m=function(E,x){for(var T=E,A;(A=T.next)!==null;T=A)if(A.key===x)return T.next=A.next,A.next=E.next,E.next=A,A},v=function(E,x){var T=m(E,x);return T&&T.value},y=function(E,x,T){var A=m(E,x);A?A.value=T:E.next={key:x,next:E.next,value:T}},b=function(E,x){return!!m(E,x)};return uc=function(){var E,x,T,A={assert:function(L){if(!A.has(L))throw new r("Side channel does not contain "+t(L))},get:function(L){if(n&&L&&(typeof L=="object"||typeof L=="function")){if(E)return a(E,L)}else if(s){if(x)return c(x,L)}else if(T)return v(T,L)},has:function(L){if(n&&L&&(typeof L=="object"||typeof L=="function")){if(E)return f(E,L)}else if(s){if(x)return p(x,L)}else if(T)return b(T,L);return!1},set:function(L,w){n&&L&&(typeof L=="object"||typeof L=="function")?(E||(E=new n),u(E,L,w)):s?(x||(x=new s),d(x,L,w)):(T||(T={key:{},next:null}),y(T,L,w))}};return A},uc}function _m(){if(Ng)return cc;Ng=!0;var l=String.prototype.replace,e=/%20/g,t={RFC1738:"RFC1738",RFC3986:"RFC3986"};return cc={default:t.RFC3986,formatters:{RFC1738:function(r){return l.call(r,e,"+")},RFC3986:function(r){return String(r)}},RFC1738:t.RFC1738,RFC3986:t.RFC3986},cc}function i_(){if(Ug)return fc;Ug=!0;var l=_m(),e=Object.prototype.hasOwnProperty,t=Array.isArray,r=(function(){for(var E=[],x=0;x<256;++x)E.push("%"+((x<16?"0":"")+x.toString(16)).toUpperCase());return E})(),n=function(E){for(;E.length>1;){var x=E.pop(),T=x.obj[x.prop];if(t(T)){for(var A=[],L=0;L<T.length;++L)typeof T[L]<"u"&&A.push(T[L]);x.obj[x.prop]=A}}},s=function(E,x){for(var T=x&&x.plainObjects?Object.create(null):{},A=0;A<E.length;++A)typeof E[A]<"u"&&(T[A]=E[A]);return T},a=function E(x,T,A){if(!T)return x;if(typeof T!="object"){if(t(x))x.push(T);else if(x&&typeof x=="object")(A&&(A.plainObjects||A.allowPrototypes)||!e.call(Object.prototype,T))&&(x[T]=!0);else return[x,T];return x}if(!x||typeof x!="object")return[x].concat(T);var L=x;return t(x)&&!t(T)&&(L=s(x,A)),t(x)&&t(T)?(T.forEach(function(w,C){if(e.call(x,C)){var I=x[C];I&&typeof I=="object"&&w&&typeof w=="object"?x[C]=E(I,w,A):x.push(w)}else x[C]=w}),x):Object.keys(T).reduce(function(w,C){var I=T[C];return e.call(w,C)?w[C]=E(w[C],I,A):w[C]=I,w},L)},u=function(E,x){return Object.keys(x).reduce(function(T,A){return T[A]=x[A],T},E)},f=function(E,x,T){var A=E.replace(/\+/g," ");if(T==="iso-8859-1")return A.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(A)}catch{return A}},c=1024,d=function(E,x,T,A,L){if(E.length===0)return E;var w=E;if(typeof E=="symbol"?w=Symbol.prototype.toString.call(E):typeof E!="string"&&(w=String(E)),T==="iso-8859-1")return escape(w).replace(/%u[0-9a-f]{4}/gi,function(F){return"%26%23"+parseInt(F.slice(2),16)+"%3B"});for(var C="",I=0;I<w.length;I+=c){for(var O=w.length>=c?w.slice(I,I+c):w,B=[],P=0;P<O.length;++P){var $=O.charCodeAt(P);if($===45||$===46||$===95||$===126||$>=48&&$<=57||$>=65&&$<=90||$>=97&&$<=122||L===l.RFC1738&&($===40||$===41)){B[B.length]=O.charAt(P);continue}if($<128){B[B.length]=r[$];continue}if($<2048){B[B.length]=r[192|$>>6]+r[128|$&63];continue}if($<55296||$>=57344){B[B.length]=r[224|$>>12]+r[128|$>>6&63]+r[128|$&63];continue}P+=1,$=65536+(($&1023)<<10|O.charCodeAt(P)&1023),B[B.length]=r[240|$>>18]+r[128|$>>12&63]+r[128|$>>6&63]+r[128|$&63]}C+=B.join("")}return C},p=function(E){for(var x=[{obj:{o:E},prop:"o"}],T=[],A=0;A<x.length;++A)for(var L=x[A],w=L.obj[L.prop],C=Object.keys(w),I=0;I<C.length;++I){var O=C[I],B=w[O];typeof B=="object"&&B!==null&&T.indexOf(B)===-1&&(x.push({obj:w,prop:O}),T.push(B))}return n(x),E},m=function(E){return Object.prototype.toString.call(E)==="[object RegExp]"},v=function(E){return!E||typeof E!="object"?!1:!!(E.constructor&&E.constructor.isBuffer&&E.constructor.isBuffer(E))},y=function(E,x){return[].concat(E,x)},b=function(E,x){if(t(E)){for(var T=[],A=0;A<E.length;A+=1)T.push(x(E[A]));return T}return x(E)};return fc={arrayToObject:s,assign:u,combine:y,compact:p,decode:f,encode:d,isBuffer:v,isRegExp:m,maybeMap:b,merge:a},fc}function WC(){if(Bg)return hc;Bg=!0;var l=YC(),e=i_(),t=_m(),r=Object.prototype.hasOwnProperty,n={brackets:function(b){return b+"[]"},comma:"comma",indices:function(b,E){return b+"["+E+"]"},repeat:function(b){return b}},s=Array.isArray,a=Array.prototype.push,u=function(b,E){a.apply(b,s(E)?E:[E])},f=Date.prototype.toISOString,c=t.default,d={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:e.encode,encodeValuesOnly:!1,format:c,formatter:t.formatters[c],indices:!1,serializeDate:function(b){return f.call(b)},skipNulls:!1,strictNullHandling:!1},p=function(b){return typeof b=="string"||typeof b=="number"||typeof b=="boolean"||typeof b=="symbol"||typeof b=="bigint"},m={},v=function b(E,x,T,A,L,w,C,I,O,B,P,$,F,Z,X,q,H,K){for(var z=E,ie=K,Y=0,U=!1;(ie=ie.get(m))!==void 0&&!U;){var N=ie.get(E);if(Y+=1,typeof N<"u"){if(N===Y)throw new RangeError("Cyclic object value");U=!0}typeof ie.get(m)>"u"&&(Y=0)}if(typeof B=="function"?z=B(x,z):z instanceof Date?z=F(z):T==="comma"&&s(z)&&(z=e.maybeMap(z,function(ee){return ee instanceof Date?F(ee):ee})),z===null){if(w)return O&&!q?O(x,d.encoder,H,"key",Z):x;z=""}if(p(z)||e.isBuffer(z)){if(O){var W=q?x:O(x,d.encoder,H,"key",Z);return[X(W)+"="+X(O(z,d.encoder,H,"value",Z))]}return[X(x)+"="+X(String(z))]}var ue=[];if(typeof z>"u")return ue;var ne;if(T==="comma"&&s(z))q&&O&&(z=e.maybeMap(z,O)),ne=[{value:z.length>0?z.join(",")||null:void 0}];else if(s(B))ne=B;else{var Ee=Object.keys(z);ne=P?Ee.sort(P):Ee}var se=I?x.replace(/\./g,"%2E"):x,J=A&&s(z)&&z.length===1?se+"[]":se;if(L&&s(z)&&z.length===0)return J+"[]";for(var me=0;me<ne.length;++me){var ce=ne[me],he=typeof ce=="object"&&typeof ce.value<"u"?ce.value:z[ce];if(!(C&&he===null)){var pe=$&&I?ce.replace(/\./g,"%2E"):ce,Fe=s(z)?typeof T=="function"?T(J,pe):J:J+($?"."+pe:"["+pe+"]");K.set(E,Y);var Re=l();Re.set(m,K),u(ue,b(he,Fe,T,A,L,w,C,I,T==="comma"&&q&&s(z)?null:O,B,P,$,F,Z,X,q,H,Re))}}return ue},y=function(b){if(!b)return d;if(typeof b.allowEmptyArrays<"u"&&typeof b.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof b.encodeDotInKeys<"u"&&typeof b.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(b.encoder!==null&&typeof b.encoder<"u"&&typeof b.encoder!="function")throw new TypeError("Encoder has to be a function.");var E=b.charset||d.charset;if(typeof b.charset<"u"&&b.charset!=="utf-8"&&b.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var x=t.default;if(typeof b.format<"u"){if(!r.call(t.formatters,b.format))throw new TypeError("Unknown format option provided.");x=b.format}var T=t.formatters[x],A=d.filter;(typeof b.filter=="function"||s(b.filter))&&(A=b.filter);var L;if(b.arrayFormat in n?L=b.arrayFormat:"indices"in b?L=b.indices?"indices":"repeat":L=d.arrayFormat,"commaRoundTrip"in b&&typeof b.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var w=typeof b.allowDots>"u"?b.encodeDotInKeys===!0?!0:d.allowDots:!!b.allowDots;return{addQueryPrefix:typeof b.addQueryPrefix=="boolean"?b.addQueryPrefix:d.addQueryPrefix,allowDots:w,allowEmptyArrays:typeof b.allowEmptyArrays=="boolean"?!!b.allowEmptyArrays:d.allowEmptyArrays,arrayFormat:L,charset:E,charsetSentinel:typeof b.charsetSentinel=="boolean"?b.charsetSentinel:d.charsetSentinel,commaRoundTrip:b.commaRoundTrip,delimiter:typeof b.delimiter>"u"?d.delimiter:b.delimiter,encode:typeof b.encode=="boolean"?b.encode:d.encode,encodeDotInKeys:typeof b.encodeDotInKeys=="boolean"?b.encodeDotInKeys:d.encodeDotInKeys,encoder:typeof b.encoder=="function"?b.encoder:d.encoder,encodeValuesOnly:typeof b.encodeValuesOnly=="boolean"?b.encodeValuesOnly:d.encodeValuesOnly,filter:A,format:x,formatter:T,serializeDate:typeof b.serializeDate=="function"?b.serializeDate:d.serializeDate,skipNulls:typeof b.skipNulls=="boolean"?b.skipNulls:d.skipNulls,sort:typeof b.sort=="function"?b.sort:null,strictNullHandling:typeof b.strictNullHandling=="boolean"?b.strictNullHandling:d.strictNullHandling}};return hc=function(b,E){var x=b,T=y(E),A,L;typeof T.filter=="function"?(L=T.filter,x=L("",x)):s(T.filter)&&(L=T.filter,A=L);var w=[];if(typeof x!="object"||x===null)return"";var C=n[T.arrayFormat],I=C==="comma"&&T.commaRoundTrip;A||(A=Object.keys(x)),T.sort&&A.sort(T.sort);for(var O=l(),B=0;B<A.length;++B){var P=A[B];T.skipNulls&&x[P]===null||u(w,v(x[P],P,C,I,T.allowEmptyArrays,T.strictNullHandling,T.skipNulls,T.encodeDotInKeys,T.encode?T.encoder:null,T.filter,T.sort,T.allowDots,T.serializeDate,T.format,T.formatter,T.encodeValuesOnly,T.charset,O))}var $=w.join(T.delimiter),F=T.addQueryPrefix===!0?"?":"";return T.charsetSentinel&&(T.charset==="iso-8859-1"?F+="utf8=%26%2310003%3B&":F+="utf8=%E2%9C%93&"),$.length>0?F+$:""},hc}function QC(){if(Fg)return dc;Fg=!0;var l=i_(),e=Object.prototype.hasOwnProperty,t=Array.isArray,r={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:l.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1},n=function(m){return m.replace(/&#(\d+);/g,function(v,y){return String.fromCharCode(parseInt(y,10))})},s=function(m,v){return m&&typeof m=="string"&&v.comma&&m.indexOf(",")>-1?m.split(","):m},a="utf8=%26%2310003%3B",u="utf8=%E2%9C%93",f=function(m,v){var y={__proto__:null},b=v.ignoreQueryPrefix?m.replace(/^\?/,""):m;b=b.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var E=v.parameterLimit===1/0?void 0:v.parameterLimit,x=b.split(v.delimiter,E),T=-1,A,L=v.charset;if(v.charsetSentinel)for(A=0;A<x.length;++A)x[A].indexOf("utf8=")===0&&(x[A]===u?L="utf-8":x[A]===a&&(L="iso-8859-1"),T=A,A=x.length);for(A=0;A<x.length;++A)if(A!==T){var w=x[A],C=w.indexOf("]="),I=C===-1?w.indexOf("="):C+1,O,B;I===-1?(O=v.decoder(w,r.decoder,L,"key"),B=v.strictNullHandling?null:""):(O=v.decoder(w.slice(0,I),r.decoder,L,"key"),B=l.maybeMap(s(w.slice(I+1),v),function($){return v.decoder($,r.decoder,L,"value")})),B&&v.interpretNumericEntities&&L==="iso-8859-1"&&(B=n(B)),w.indexOf("[]=")>-1&&(B=t(B)?[B]:B);var P=e.call(y,O);P&&v.duplicates==="combine"?y[O]=l.combine(y[O],B):(!P||v.duplicates==="last")&&(y[O]=B)}return y},c=function(m,v,y,b){for(var E=b?v:s(v,y),x=m.length-1;x>=0;--x){var T,A=m[x];if(A==="[]"&&y.parseArrays)T=y.allowEmptyArrays&&(E===""||y.strictNullHandling&&E===null)?[]:[].concat(E);else{T=y.plainObjects?Object.create(null):{};var L=A.charAt(0)==="["&&A.charAt(A.length-1)==="]"?A.slice(1,-1):A,w=y.decodeDotInKeys?L.replace(/%2E/g,"."):L,C=parseInt(w,10);!y.parseArrays&&w===""?T={0:E}:!isNaN(C)&&A!==w&&String(C)===w&&C>=0&&y.parseArrays&&C<=y.arrayLimit?(T=[],T[C]=E):w!=="__proto__"&&(T[w]=E)}E=T}return E},d=function(m,v,y,b){if(m){var E=y.allowDots?m.replace(/\.([^.[]+)/g,"[$1]"):m,x=/(\[[^[\]]*])/,T=/(\[[^[\]]*])/g,A=y.depth>0&&x.exec(E),L=A?E.slice(0,A.index):E,w=[];if(L){if(!y.plainObjects&&e.call(Object.prototype,L)&&!y.allowPrototypes)return;w.push(L)}for(var C=0;y.depth>0&&(A=T.exec(E))!==null&&C<y.depth;){if(C+=1,!y.plainObjects&&e.call(Object.prototype,A[1].slice(1,-1))&&!y.allowPrototypes)return;w.push(A[1])}if(A){if(y.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+y.depth+" and strictDepth is true");w.push("["+E.slice(A.index)+"]")}return c(w,v,y,b)}},p=function(m){if(!m)return r;if(typeof m.allowEmptyArrays<"u"&&typeof m.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof m.decodeDotInKeys<"u"&&typeof m.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(m.decoder!==null&&typeof m.decoder<"u"&&typeof m.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof m.charset<"u"&&m.charset!=="utf-8"&&m.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var v=typeof m.charset>"u"?r.charset:m.charset,y=typeof m.duplicates>"u"?r.duplicates:m.duplicates;if(y!=="combine"&&y!=="first"&&y!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var b=typeof m.allowDots>"u"?m.decodeDotInKeys===!0?!0:r.allowDots:!!m.allowDots;return{allowDots:b,allowEmptyArrays:typeof m.allowEmptyArrays=="boolean"?!!m.allowEmptyArrays:r.allowEmptyArrays,allowPrototypes:typeof m.allowPrototypes=="boolean"?m.allowPrototypes:r.allowPrototypes,allowSparse:typeof m.allowSparse=="boolean"?m.allowSparse:r.allowSparse,arrayLimit:typeof m.arrayLimit=="number"?m.arrayLimit:r.arrayLimit,charset:v,charsetSentinel:typeof m.charsetSentinel=="boolean"?m.charsetSentinel:r.charsetSentinel,comma:typeof m.comma=="boolean"?m.comma:r.comma,decodeDotInKeys:typeof m.decodeDotInKeys=="boolean"?m.decodeDotInKeys:r.decodeDotInKeys,decoder:typeof m.decoder=="function"?m.decoder:r.decoder,delimiter:typeof m.delimiter=="string"||l.isRegExp(m.delimiter)?m.delimiter:r.delimiter,depth:typeof m.depth=="number"||m.depth===!1?+m.depth:r.depth,duplicates:y,ignoreQueryPrefix:m.ignoreQueryPrefix===!0,interpretNumericEntities:typeof m.interpretNumericEntities=="boolean"?m.interpretNumericEntities:r.interpretNumericEntities,parameterLimit:typeof m.parameterLimit=="number"?m.parameterLimit:r.parameterLimit,parseArrays:m.parseArrays!==!1,plainObjects:typeof m.plainObjects=="boolean"?m.plainObjects:r.plainObjects,strictDepth:typeof m.strictDepth=="boolean"?!!m.strictDepth:r.strictDepth,strictNullHandling:typeof m.strictNullHandling=="boolean"?m.strictNullHandling:r.strictNullHandling}};return dc=function(m,v){var y=p(v);if(m===""||m===null||typeof m>"u")return y.plainObjects?Object.create(null):{};for(var b=typeof m=="string"?f(m,y):m,E=y.plainObjects?Object.create(null):{},x=Object.keys(b),T=0;T<x.length;++T){var A=x[T],L=d(A,b[A],y,typeof m=="string");E=l.merge(E,L,y)}return y.allowSparse===!0?E:l.compact(E)},dc}function XC(){if(jg)return pc;jg=!0;var l=WC(),e=QC(),t=_m();return pc={formats:t,parse:e,stringify:l},pc}function ZC(){if($g)return ts;$g=!0;var l=es;function e(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var t=/^([a-z0-9.+-]+:)/i,r=/:[0-9]*$/,n=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,s=["<",">",'"',"`"," ","\r",`
`,"	"],a=["{","}","|","\\","^","`"].concat(s),u=["'"].concat(a),f=["%","/","?",";","#"].concat(u),c=["/","?","#"],d=255,p=/^[+a-z0-9A-Z_-]{0,63}$/,m=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,v={javascript:!0,"javascript:":!0},y={javascript:!0,"javascript:":!0},b={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},E=XC();function x(w,C,I){if(w&&typeof w=="object"&&w instanceof e)return w;var O=new e;return O.parse(w,C,I),O}e.prototype.parse=function(w,C,I){if(typeof w!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof w);var O=w.indexOf("?"),B=O!==-1&&O<w.indexOf("#")?"?":"#",P=w.split(B),$=/\\/g;P[0]=P[0].replace($,"/"),w=P.join(B);var F=w;if(F=F.trim(),!I&&w.split("#").length===1){var Z=n.exec(F);if(Z)return this.path=F,this.href=F,this.pathname=Z[1],Z[2]?(this.search=Z[2],C?this.query=E.parse(this.search.substr(1)):this.query=this.search.substr(1)):C&&(this.search="",this.query={}),this}var X=t.exec(F);if(X){X=X[0];var q=X.toLowerCase();this.protocol=q,F=F.substr(X.length)}if(I||X||F.match(/^\/\/[^@/]+@[^@/]+/)){var H=F.substr(0,2)==="//";H&&!(X&&y[X])&&(F=F.substr(2),this.slashes=!0)}if(!y[X]&&(H||X&&!b[X])){for(var K=-1,z=0;z<c.length;z++){var ie=F.indexOf(c[z]);ie!==-1&&(K===-1||ie<K)&&(K=ie)}var Y,U;K===-1?U=F.lastIndexOf("@"):U=F.lastIndexOf("@",K),U!==-1&&(Y=F.slice(0,U),F=F.slice(U+1),this.auth=decodeURIComponent(Y)),K=-1;for(var z=0;z<f.length;z++){var ie=F.indexOf(f[z]);ie!==-1&&(K===-1||ie<K)&&(K=ie)}K===-1&&(K=F.length),this.host=F.slice(0,K),F=F.slice(K),this.parseHost(),this.hostname=this.hostname||"";var N=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!N)for(var W=this.hostname.split(/\./),z=0,ue=W.length;z<ue;z++){var ne=W[z];if(ne&&!ne.match(p)){for(var Ee="",se=0,J=ne.length;se<J;se++)ne.charCodeAt(se)>127?Ee+="x":Ee+=ne[se];if(!Ee.match(p)){var me=W.slice(0,z),ce=W.slice(z+1),he=ne.match(m);he&&(me.push(he[1]),ce.unshift(he[2])),ce.length&&(F="/"+ce.join(".")+F),this.hostname=me.join(".");break}}}this.hostname.length>d?this.hostname="":this.hostname=this.hostname.toLowerCase(),N||(this.hostname=l.toASCII(this.hostname));var pe=this.port?":"+this.port:"",Fe=this.hostname||"";this.host=Fe+pe,this.href+=this.host,N&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),F[0]!=="/"&&(F="/"+F))}if(!v[q])for(var z=0,ue=u.length;z<ue;z++){var Re=u[z];if(F.indexOf(Re)!==-1){var ee=encodeURIComponent(Re);ee===Re&&(ee=escape(Re)),F=F.split(Re).join(ee)}}var te=F.indexOf("#");te!==-1&&(this.hash=F.substr(te),F=F.slice(0,te));var ge=F.indexOf("?");if(ge!==-1?(this.search=F.substr(ge),this.query=F.substr(ge+1),C&&(this.query=E.parse(this.query)),F=F.slice(0,ge)):C&&(this.search="",this.query={}),F&&(this.pathname=F),b[q]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var pe=this.pathname||"",Ie=this.search||"";this.path=pe+Ie}return this.href=this.format(),this};function T(w){return typeof w=="string"&&(w=x(w)),w instanceof e?w.format():e.prototype.format.call(w)}e.prototype.format=function(){var w=this.auth||"";w&&(w=encodeURIComponent(w),w=w.replace(/%3A/i,":"),w+="@");var C=this.protocol||"",I=this.pathname||"",O=this.hash||"",B=!1,P="";this.host?B=w+this.host:this.hostname&&(B=w+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(B+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(P=E.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var $=this.search||P&&"?"+P||"";return C&&C.substr(-1)!==":"&&(C+=":"),this.slashes||(!C||b[C])&&B!==!1?(B="//"+(B||""),I&&I.charAt(0)!=="/"&&(I="/"+I)):B||(B=""),O&&O.charAt(0)!=="#"&&(O="#"+O),$&&$.charAt(0)!=="?"&&($="?"+$),I=I.replace(/[?#]/g,function(F){return encodeURIComponent(F)}),$=$.replace("#","%23"),C+B+I+$+O};function A(w,C){return x(w,!1,!0).resolve(C)}e.prototype.resolve=function(w){return this.resolveObject(x(w,!1,!0)).format()};function L(w,C){return w?x(w,!1,!0).resolveObject(C):C}return e.prototype.resolveObject=function(w){if(typeof w=="string"){var C=new e;C.parse(w,!1,!0),w=C}for(var I=new e,O=Object.keys(this),B=0;B<O.length;B++){var P=O[B];I[P]=this[P]}if(I.hash=w.hash,w.href==="")return I.href=I.format(),I;if(w.slashes&&!w.protocol){for(var $=Object.keys(w),F=0;F<$.length;F++){var Z=$[F];Z!=="protocol"&&(I[Z]=w[Z])}return b[I.protocol]&&I.hostname&&!I.pathname&&(I.pathname="/",I.path=I.pathname),I.href=I.format(),I}if(w.protocol&&w.protocol!==I.protocol){if(!b[w.protocol]){for(var X=Object.keys(w),q=0;q<X.length;q++){var H=X[q];I[H]=w[H]}return I.href=I.format(),I}if(I.protocol=w.protocol,!w.host&&!y[w.protocol]){for(var ue=(w.pathname||"").split("/");ue.length&&!(w.host=ue.shift()););w.host||(w.host=""),w.hostname||(w.hostname=""),ue[0]!==""&&ue.unshift(""),ue.length<2&&ue.unshift(""),I.pathname=ue.join("/")}else I.pathname=w.pathname;if(I.search=w.search,I.query=w.query,I.host=w.host||"",I.auth=w.auth,I.hostname=w.hostname||w.host,I.port=w.port,I.pathname||I.search){var K=I.pathname||"",z=I.search||"";I.path=K+z}return I.slashes=I.slashes||w.slashes,I.href=I.format(),I}var ie=I.pathname&&I.pathname.charAt(0)==="/",Y=w.host||w.pathname&&w.pathname.charAt(0)==="/",U=Y||ie||I.host&&w.pathname,N=U,W=I.pathname&&I.pathname.split("/")||[],ue=w.pathname&&w.pathname.split("/")||[],ne=I.protocol&&!b[I.protocol];if(ne&&(I.hostname="",I.port=null,I.host&&(W[0]===""?W[0]=I.host:W.unshift(I.host)),I.host="",w.protocol&&(w.hostname=null,w.port=null,w.host&&(ue[0]===""?ue[0]=w.host:ue.unshift(w.host)),w.host=null),U=U&&(ue[0]===""||W[0]==="")),Y)I.host=w.host||w.host===""?w.host:I.host,I.hostname=w.hostname||w.hostname===""?w.hostname:I.hostname,I.search=w.search,I.query=w.query,W=ue;else if(ue.length)W||(W=[]),W.pop(),W=W.concat(ue),I.search=w.search,I.query=w.query;else if(w.search!=null){if(ne){I.host=W.shift(),I.hostname=I.host;var Ee=I.host&&I.host.indexOf("@")>0?I.host.split("@"):!1;Ee&&(I.auth=Ee.shift(),I.hostname=Ee.shift(),I.host=I.hostname)}return I.search=w.search,I.query=w.query,(I.pathname!==null||I.search!==null)&&(I.path=(I.pathname?I.pathname:"")+(I.search?I.search:"")),I.href=I.format(),I}if(!W.length)return I.pathname=null,I.search?I.path="/"+I.search:I.path=null,I.href=I.format(),I;for(var se=W.slice(-1)[0],J=(I.host||w.host||W.length>1)&&(se==="."||se==="..")||se==="",me=0,ce=W.length;ce>=0;ce--)se=W[ce],se==="."?W.splice(ce,1):se===".."?(W.splice(ce,1),me++):me&&(W.splice(ce,1),me--);if(!U&&!N)for(;me--;me)W.unshift("..");U&&W[0]!==""&&(!W[0]||W[0].charAt(0)!=="/")&&W.unshift(""),J&&W.join("/").substr(-1)!=="/"&&W.push("");var he=W[0]===""||W[0]&&W[0].charAt(0)==="/";if(ne){I.hostname=he?"":W.length?W.shift():"",I.host=I.hostname;var Ee=I.host&&I.host.indexOf("@")>0?I.host.split("@"):!1;Ee&&(I.auth=Ee.shift(),I.hostname=Ee.shift(),I.host=I.hostname)}return U=U||I.host&&W.length,U&&!he&&W.unshift(""),W.length>0?I.pathname=W.join("/"):(I.pathname=null,I.path=null),(I.pathname!==null||I.search!==null)&&(I.path=(I.pathname?I.pathname:"")+(I.search?I.search:"")),I.auth=w.auth||I.auth,I.slashes=I.slashes||w.slashes,I.href=I.format(),I},e.prototype.parseHost=function(){var w=this.host,C=r.exec(w);C&&(C=C[0],C!==":"&&(this.port=C.substr(1)),w=w.substr(0,w.length-C.length)),w&&(this.hostname=w)},ts.parse=x,ts.resolve=A,ts.resolveObject=L,ts.format=T,ts.Url=e,ts}function n_(l){if(typeof l=="string")l=new URL(l);else if(!(l instanceof URL))throw new Deno.errors.InvalidData("invalid argument path , must be a string or URL");if(l.protocol!=="file:")throw new Deno.errors.InvalidData("invalid url scheme");return Ac?JC(l):eD(l)}function JC(l){let e=l.hostname,t=l.pathname;for(let r=0;r<t.length;r++)if(t[r]==="%"){let n=t.codePointAt(r+2)||32;if(t[r+1]==="2"&&n===102||t[r+1]==="5"&&n===99)throw new Deno.errors.InvalidData("must not include encoded \\ or / characters")}if(t=t.replace(y_,"\\"),t=decodeURIComponent(t),e!=="")return`\\\\${e}${t}`;{let r=t.codePointAt(1)|32,n=t[2];if(r<g_||r>m_||n!==":")throw new Deno.errors.InvalidData("file url path must be absolute");return t.slice(1)}}function eD(l){if(l.hostname!=="")throw new Deno.errors.InvalidData("invalid file url hostname");let e=l.pathname;for(let t=0;t<e.length;t++)if(e[t]==="%"){let r=e.codePointAt(t+2)||32;if(e[t+1]==="2"&&r===102)throw new Deno.errors.InvalidData("must not include encoded / characters")}return decodeURIComponent(e)}function s_(l){let e=kg.resolve(l),t=l.charCodeAt(l.length-1);(t===p_||Ac&&t===d_)&&e[e.length-1]!==kg.sep&&(e+="/");let r=new URL("file://");return e.includes("%")&&(e=e.replace(v_,"%25")),!Ac&&e.includes("\\")&&(e=e.replace(b_,"%5C")),e.includes(`
`)&&(e=e.replace(E_,"%0A")),e.includes("\r")&&(e=e.replace(S_,"%0D")),e.includes("	")&&(e=e.replace(T_,"%09")),r.pathname=e,r}var a_,oc,Mg,lc,uc,Pg,cc,Ng,fc,Ug,hc,Bg,dc,Fg,pc,jg,ts,$g,xr,aS,o_,l_,u_,c_,f_,h_,d_,p_,g_,m_,Ac,y_,v_,b_,E_,S_,T_,tD=Vr(()=>{ke(),Pe(),Me(),vC(),MC(),zC(),t_(),a_=Object.freeze(Object.create(null)),oc={},Mg=!1,lc=typeof globalThis<"u"?globalThis:typeof self<"u"?self:global,uc={},Pg=!1,cc={},Ng=!1,fc={},Ug=!1,hc={},Bg=!1,dc={},Fg=!1,pc={},jg=!1,ts={},$g=!1,xr=ZC(),xr.parse,xr.resolve,xr.resolveObject,xr.format,xr.Url,aS=typeof Deno<"u"?Deno.build.os==="windows"?"win32":Deno.build.os:void 0,xr.URL=typeof URL<"u"?URL:null,xr.pathToFileURL=s_,xr.fileURLToPath=n_,o_=xr.Url,l_=xr.format,u_=xr.resolve,c_=xr.resolveObject,f_=xr.parse,h_=xr.URL,d_=92,p_=47,g_=97,m_=122,Ac=aS==="win32",y_=/\//g,v_=/%/g,b_=/\\/g,E_=/\n/g,S_=/\r/g,T_=/\t/g}),rD=je((l,e)=>{ke(),Pe(),Me(),e.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}}),Am=je(l=>{ke(),Pe(),Me(),Object.defineProperty(l,"__esModule",{value:!0}),l.BufferedDuplex=void 0,l.writev=r;var e=js(),t=(hr(),Ct(fr));function r(s,a){let u=new Array(s.length);for(let f=0;f<s.length;f++)typeof s[f].chunk=="string"?u[f]=t.Buffer.from(s[f].chunk,"utf8"):u[f]=s[f].chunk;this._write(t.Buffer.concat(u),"binary",a)}var n=class extends e.Duplex{socket;proxy;isSocketOpen;writeQueue;constructor(s,a,u){super({objectMode:!0}),this.proxy=a,this.socket=u,this.writeQueue=[],s.objectMode||(this._writev=r.bind(this)),this.isSocketOpen=!1,this.proxy.on("data",f=>{!this.destroyed&&this.readable&&this.push(f)})}_read(s){this.proxy.read(s)}_write(s,a,u){this.isSocketOpen?this.writeToProxy(s,a,u):this.writeQueue.push({chunk:s,encoding:a,cb:u})}_final(s){this.writeQueue=[],this.proxy.end(s)}_destroy(s,a){this.writeQueue=[],this.proxy.destroy(),a(s)}socketReady(){this.emit("connect"),this.isSocketOpen=!0,this.processWriteQueue()}writeToProxy(s,a,u){this.proxy.write(s,a)===!1?this.proxy.once("drain",u):u()}processWriteQueue(){for(;this.writeQueue.length>0;){let{chunk:s,encoding:a,cb:u}=this.writeQueue.shift();this.writeToProxy(s,a,u)}}};l.BufferedDuplex=n}),Au=je(l=>{ke(),Pe(),Me();var e=l&&l.__importDefault||function(x){return x&&x.__esModule?x:{default:x}};Object.defineProperty(l,"__esModule",{value:!0}),l.streamBuilder=l.browserStreamBuilder=void 0;var t=(hr(),Ct(fr)),r=e(rD()),n=e(Sn()),s=js(),a=e(Vc()),u=Am(),f=(0,n.default)("mqttjs:ws"),c=["rejectUnauthorized","ca","cert","key","pfx","passphrase"];function d(x,T){let A=`${x.protocol}://${x.hostname}:${x.port}${x.path}`;return typeof x.transformWsUrl=="function"&&(A=x.transformWsUrl(A,x,T)),A}function p(x){let T=x;return x.port||(x.protocol==="wss"?T.port=443:T.port=80),x.path||(T.path="/"),x.wsOptions||(T.wsOptions={}),!a.default&&!x.forceNativeWebSocket&&x.protocol==="wss"&&c.forEach(A=>{Object.prototype.hasOwnProperty.call(x,A)&&!Object.prototype.hasOwnProperty.call(x.wsOptions,A)&&(T.wsOptions[A]=x[A])}),T}function m(x){let T=p(x);if(T.hostname||(T.hostname=T.host),!T.hostname){if(typeof document>"u")throw new Error("Could not determine host. Specify host manually.");let A=new URL(document.URL);T.hostname=A.hostname,T.port||(T.port=Number(A.port))}return T.objectMode===void 0&&(T.objectMode=!(T.binary===!0||T.binary===void 0)),T}function v(x,T,A){f("createWebSocket"),f(`protocol: ${A.protocolId} ${A.protocolVersion}`);let L=A.protocolId==="MQIsdp"&&A.protocolVersion===3?"mqttv3.1":"mqtt";f(`creating new Websocket for url: ${T} and protocol: ${L}`);let w;return A.createWebsocket?w=A.createWebsocket(T,[L],A):w=new r.default(T,[L],A.wsOptions),w}function y(x,T){let A=T.protocolId==="MQIsdp"&&T.protocolVersion===3?"mqttv3.1":"mqtt",L=d(T,x),w;return T.createWebsocket?w=T.createWebsocket(L,[A],T):w=new WebSocket(L,[A]),w.binaryType="arraybuffer",w}var b=(x,T)=>{f("streamBuilder");let A=p(T);A.hostname=A.hostname||A.host||"localhost";let L=d(A,x),w=v(x,L,A),C=r.default.createWebSocketStream(w,A.wsOptions);return C.url=L,w.on("close",()=>{C.destroy()}),C};l.streamBuilder=b;var E=(x,T)=>{f("browserStreamBuilder");let A,L=m(T).browserBufferSize||1024*512,w=T.browserBufferTimeout||1e3,C=!T.objectMode,I=y(x,T),O=P(T,q,H);T.objectMode||(O._writev=u.writev.bind(O)),O.on("close",()=>{I.close()});let B=typeof I.addEventListener<"u";I.readyState===I.OPEN?(A=O,A.socket=I):(A=new u.BufferedDuplex(T,O,I),B?I.addEventListener("open",$):I.onopen=$),B?(I.addEventListener("close",F),I.addEventListener("error",Z),I.addEventListener("message",X)):(I.onclose=F,I.onerror=Z,I.onmessage=X);function P(K,z,ie){let Y=new s.Transform({objectMode:K.objectMode});return Y._write=z,Y._flush=ie,Y}function $(){f("WebSocket onOpen"),A instanceof u.BufferedDuplex&&A.socketReady()}function F(K){f("WebSocket onClose",K),A.end(),A.destroy()}function Z(K){f("WebSocket onError",K);let z=new Error("WebSocket error");z.event=K,A.destroy(z)}async function X(K){if(!O||!O.readable||!O.writable)return;let{data:z}=K;z instanceof ArrayBuffer?z=t.Buffer.from(z):z instanceof Blob?z=t.Buffer.from(await new Response(z).arrayBuffer()):z=t.Buffer.from(z,"utf8"),O.push(z)}function q(K,z,ie){if(I.bufferedAmount>L){setTimeout(q,w,K,z,ie);return}C&&typeof K=="string"&&(K=t.Buffer.from(K,"utf8"));try{I.send(K)}catch(Y){return ie(Y)}ie()}function H(K){I.close(),K()}return A};l.browserStreamBuilder=E}),wm={};Ka(wm,{Server:()=>Bt,Socket:()=>Bt,Stream:()=>Bt,_createServerHandle:()=>Bt,_normalizeArgs:()=>Bt,_setSimultaneousAccepts:()=>Bt,connect:()=>Bt,createConnection:()=>Bt,createServer:()=>Bt,default:()=>x_,isIP:()=>Bt,isIPv4:()=>Bt,isIPv6:()=>Bt});function Bt(){throw new Error("Node.js net module is not supported by JSPM core outside of Node.js")}var x_,__=Vr(()=>{ke(),Pe(),Me(),x_={_createServerHandle:Bt,_normalizeArgs:Bt,_setSimultaneousAccepts:Bt,connect:Bt,createConnection:Bt,createServer:Bt,isIP:Bt,isIPv4:Bt,isIPv6:Bt,Server:Bt,Socket:Bt,Stream:Bt}}),A_=je((l,e)=>{ke(),Pe(),Me(),e.exports={}}),oS=je(l=>{ke(),Pe(),Me();var e=l&&l.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(l,"__esModule",{value:!0});var t=e((__(),Ct(wm))),r=e(Sn()),n=e(A_()),s=(0,r.default)("mqttjs:tcp"),a=(u,f)=>{if(f.port=f.port||1883,f.hostname=f.hostname||f.host||"localhost",f.socksProxy)return(0,n.default)(f.hostname,f.port,f.socksProxy,{timeout:f.socksTimeout});let{port:c,path:d}=f,p=f.hostname;return s("port %d and host %s",c,p),t.default.createConnection({port:c,host:p,path:d})};l.default=a}),w_={};Ka(w_,{default:()=>R_});var R_,iD=Vr(()=>{ke(),Pe(),Me(),R_={}}),lS=je(l=>{ke(),Pe(),Me();var e=l&&l.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(l,"__esModule",{value:!0});var t=(iD(),Ct(w_)),r=e((__(),Ct(wm))),n=e(Sn()),s=e(A_()),a=(0,n.default)("mqttjs:tls");function u(c){let{host:d,port:p,socksProxy:m,...v}=c;if(m!==void 0){let y=(0,s.default)(d,p,m,{timeout:c.socksTimeout});return(0,t.connect)({...v,socket:y})}return(0,t.connect)(c)}var f=(c,d)=>{d.port=d.port||8883,d.host=d.hostname||d.host||"localhost",r.default.isIP(d.host)===0&&(d.servername=d.host),d.rejectUnauthorized=d.rejectUnauthorized!==!1,delete d.path,a("port %d host %s rejectUnauthorized %b",d.port,d.host,d.rejectUnauthorized);let p=u(d);p.on("secureConnect",()=>{d.rejectUnauthorized&&!p.authorized?p.emit("error",new Error("TLS not authorized")):p.removeListener("error",m)});function m(v){d.rejectUnauthorized&&c.emit("error",v),p.end()}return p.on("error",m),p};l.default=f}),uS=je(l=>{ke(),Pe(),Me(),Object.defineProperty(l,"__esModule",{value:!0});var e=(hr(),Ct(fr)),t=js(),r=Am(),n,s,a;function u(){let m=new t.Transform;return m._write=(v,y,b)=>{n.send({data:v.buffer,success(){b()},fail(E){b(new Error(E))}})},m._flush=v=>{n.close({success(){v()}})},m}function f(m){m.hostname||(m.hostname="localhost"),m.path||(m.path="/"),m.wsOptions||(m.wsOptions={})}function c(m,v){let y=m.protocol==="wxs"?"wss":"ws",b=`${y}://${m.hostname}${m.path}`;return m.port&&m.port!==80&&m.port!==443&&(b=`${y}://${m.hostname}:${m.port}${m.path}`),typeof m.transformWsUrl=="function"&&(b=m.transformWsUrl(b,m,v)),b}function d(){n.onOpen(()=>{a.socketReady()}),n.onMessage(m=>{let{data:v}=m;v instanceof ArrayBuffer?v=e.Buffer.from(v):v=e.Buffer.from(v,"utf8"),s.push(v)}),n.onClose(()=>{a.emit("close"),a.end(),a.destroy()}),n.onError(m=>{let v=new Error(m.errMsg);a.destroy(v)})}var p=(m,v)=>{if(v.hostname=v.hostname||v.host,!v.hostname)throw new Error("Could not determine host. Specify host manually.");let y=v.protocolId==="MQIsdp"&&v.protocolVersion===3?"mqttv3.1":"mqtt";f(v);let b=c(v,m);n=wx.connectSocket({url:b,protocols:[y]}),s=u(),a=new r.BufferedDuplex(v,s,n),a._destroy=(x,T)=>{n.close({success(){T&&T(x)}})};let E=a.destroy;return a.destroy=(x,T)=>(a.destroy=E,setTimeout(()=>{n.close({fail(){a._destroy(x,T)}})},0),a),d(),a};l.default=p}),cS=je(l=>{ke(),Pe(),Me(),Object.defineProperty(l,"__esModule",{value:!0});var e=(hr(),Ct(fr)),t=js(),r=Am(),n,s,a,u=!1;function f(){let v=new t.Transform;return v._write=(y,b,E)=>{n.sendSocketMessage({data:y.buffer,success(){E()},fail(){E(new Error)}})},v._flush=y=>{n.closeSocket({success(){y()}})},v}function c(v){v.hostname||(v.hostname="localhost"),v.path||(v.path="/"),v.wsOptions||(v.wsOptions={})}function d(v,y){let b=v.protocol==="alis"?"wss":"ws",E=`${b}://${v.hostname}${v.path}`;return v.port&&v.port!==80&&v.port!==443&&(E=`${b}://${v.hostname}:${v.port}${v.path}`),typeof v.transformWsUrl=="function"&&(E=v.transformWsUrl(E,v,y)),E}function p(){u||(u=!0,n.onSocketOpen(()=>{a.socketReady()}),n.onSocketMessage(v=>{if(typeof v.data=="string"){let y=e.Buffer.from(v.data,"base64");s.push(y)}else{let y=new FileReader;y.addEventListener("load",()=>{if(y.result instanceof ArrayBuffer){s.push(e.Buffer.from(y.result));return}s.push(e.Buffer.from(y.result,"utf-8"))}),y.readAsArrayBuffer(v.data)}}),n.onSocketClose(()=>{a.end(),a.destroy()}),n.onSocketError(v=>{a.destroy(v)}))}var m=(v,y)=>{if(y.hostname=y.hostname||y.host,!y.hostname)throw new Error("Could not determine host. Specify host manually.");let b=y.protocolId==="MQIsdp"&&y.protocolVersion===3?"mqttv3.1":"mqtt";c(y);let E=d(y,v);return n=y.my,n.connectSocket({url:E,protocols:b}),s=f(),a=new r.BufferedDuplex(y,s,n),p(),a};l.default=m}),nD=je(l=>{ke(),Pe(),Me();var e=l&&l.__importDefault||function(p){return p&&p.__esModule?p:{default:p}};Object.defineProperty(l,"__esModule",{value:!0}),l.connectAsync=d;var t=e(Sn()),r=e((tD(),Ct(r_))),n=e(eg()),s=e(Vc());typeof Mt?.nextTick!="function"&&(Mt.nextTick=setImmediate);var a=(0,t.default)("mqttjs"),u=null;function f(p){let m;if(p.auth)if(m=p.auth.match(/^(.+):(.+)$/),m){let[,v,y]=m;p.username=v,p.password=y}else p.username=p.auth}function c(p,m){if(a("connecting to an MQTT broker..."),typeof p=="object"&&!m&&(m=p,p=""),m=m||{},p&&typeof p=="string"){let b=r.default.parse(p,!0),E={};if(b.port!=null&&(E.port=Number(b.port)),E.host=b.hostname,E.query=b.query,E.auth=b.auth,E.protocol=b.protocol,E.path=b.path,m={...E,...m},!m.protocol)throw new Error("Missing protocol");m.protocol=m.protocol.replace(/:$/,"")}if(m.unixSocket=m.unixSocket||m.protocol?.includes("+unix"),m.unixSocket?m.protocol=m.protocol.replace("+unix",""):!m.protocol?.startsWith("ws")&&!m.protocol?.startsWith("wx")&&delete m.path,f(m),m.query&&typeof m.query.clientId=="string"&&(m.clientId=m.query.clientId),s.default||m.unixSocket?m.socksProxy=void 0:m.socksProxy===void 0&&typeof Mt<"u"&&(m.socksProxy=Mt.env.MQTTJS_SOCKS_PROXY),m.cert&&m.key)if(m.protocol){if(["mqtts","wss","wxs","alis"].indexOf(m.protocol)===-1)switch(m.protocol){case"mqtt":m.protocol="mqtts";break;case"ws":m.protocol="wss";break;case"wx":m.protocol="wxs";break;case"ali":m.protocol="alis";break;default:throw new Error(`Unknown protocol for secure connection: "${m.protocol}"!`)}}else throw new Error("Missing secure protocol key");if(u||(u={},!s.default&&!m.forceNativeWebSocket?(u.ws=Au().streamBuilder,u.wss=Au().streamBuilder,u.mqtt=oS().default,u.tcp=oS().default,u.ssl=lS().default,u.tls=u.ssl,u.mqtts=lS().default):(u.ws=Au().browserStreamBuilder,u.wss=Au().browserStreamBuilder,u.wx=uS().default,u.wxs=uS().default,u.ali=cS().default,u.alis=cS().default)),!u[m.protocol]){let b=["mqtts","wss"].indexOf(m.protocol)!==-1;m.protocol=["mqtt","mqtts","ws","wss","wx","wxs","ali","alis"].filter((E,x)=>b&&x%2===0?!1:typeof u[E]=="function")[0]}if(m.clean===!1&&!m.clientId)throw new Error("Missing clientId for unclean clients");m.protocol&&(m.defaultProtocol=m.protocol);function v(b){return m.servers&&((!b._reconnectCount||b._reconnectCount===m.servers.length)&&(b._reconnectCount=0),m.host=m.servers[b._reconnectCount].host,m.port=m.servers[b._reconnectCount].port,m.protocol=m.servers[b._reconnectCount].protocol?m.servers[b._reconnectCount].protocol:m.defaultProtocol,m.hostname=m.host,b._reconnectCount++),a("calling streambuilder for",m.protocol),u[m.protocol](b,m)}let y=new n.default(v,m);return y.on("error",()=>{}),y}function d(p,m,v=!0){return new Promise((y,b)=>{let E=c(p,m),x={connect:A=>{T(),y(E)},end:()=>{T(),y(E)},error:A=>{T(),E.end(),b(A)}};v===!1&&(x.close=()=>{x.error(new Error("Couldn't connect to server"))});function T(){Object.keys(x).forEach(A=>{E.off(A,x[A])})}Object.keys(x).forEach(A=>{E.on(A,x[A])})})}l.default=c}),fS=je(l=>{ke(),Pe(),Me();var e=l&&l.__createBinding||(Object.create?function(v,y,b,E){E===void 0&&(E=b);var x=Object.getOwnPropertyDescriptor(y,b);(!x||("get"in x?!y.__esModule:x.writable||x.configurable))&&(x={enumerable:!0,get:function(){return y[b]}}),Object.defineProperty(v,E,x)}:function(v,y,b,E){E===void 0&&(E=b),v[E]=y[b]}),t=l&&l.__setModuleDefault||(Object.create?function(v,y){Object.defineProperty(v,"default",{enumerable:!0,value:y})}:function(v,y){v.default=y}),r=l&&l.__importStar||(function(){var v=function(y){return v=Object.getOwnPropertyNames||function(b){var E=[];for(var x in b)Object.prototype.hasOwnProperty.call(b,x)&&(E[E.length]=x);return E},v(y)};return function(y){if(y&&y.__esModule)return y;var b={};if(y!=null)for(var E=v(y),x=0;x<E.length;x++)E[x]!=="default"&&e(b,y,E[x]);return t(b,y),b}})(),n=l&&l.__exportStar||function(v,y){for(var b in v)b!=="default"&&!Object.prototype.hasOwnProperty.call(y,b)&&e(y,v,b)},s=l&&l.__importDefault||function(v){return v&&v.__esModule?v:{default:v}};Object.defineProperty(l,"__esModule",{value:!0}),l.ReasonCodes=l.KeepaliveManager=l.UniqueMessageIdProvider=l.DefaultMessageIdProvider=l.Store=l.MqttClient=l.connectAsync=l.connect=l.Client=void 0;var a=s(eg());l.MqttClient=a.default;var u=s(Hx());l.DefaultMessageIdProvider=u.default;var f=s(mC());l.UniqueMessageIdProvider=f.default;var c=s(Ax());l.Store=c.default;var d=r(nD());l.connect=d.default,Object.defineProperty(l,"connectAsync",{enumerable:!0,get:function(){return d.connectAsync}});var p=s(Qx());l.KeepaliveManager=p.default,l.Client=a.default,n(eg(),l),n(za(),l);var m=Hc();Object.defineProperty(l,"ReasonCodes",{enumerable:!0,get:function(){return m.ReasonCodes}})}),sD=je(l=>{ke(),Pe(),Me();var e=l&&l.__createBinding||(Object.create?function(a,u,f,c){c===void 0&&(c=f);var d=Object.getOwnPropertyDescriptor(u,f);(!d||("get"in d?!u.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return u[f]}}),Object.defineProperty(a,c,d)}:function(a,u,f,c){c===void 0&&(c=f),a[c]=u[f]}),t=l&&l.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),r=l&&l.__importStar||(function(){var a=function(u){return a=Object.getOwnPropertyNames||function(f){var c=[];for(var d in f)Object.prototype.hasOwnProperty.call(f,d)&&(c[c.length]=d);return c},a(u)};return function(u){if(u&&u.__esModule)return u;var f={};if(u!=null)for(var c=a(u),d=0;d<c.length;d++)c[d]!=="default"&&e(f,u,c[d]);return t(f,u),f}})(),n=l&&l.__exportStar||function(a,u){for(var f in a)f!=="default"&&!Object.prototype.hasOwnProperty.call(u,f)&&e(u,a,f)};Object.defineProperty(l,"__esModule",{value:!0});var s=r(fS());l.default=s,n(fS(),l)});const aD=sD();const oD="22ada06fd6cf4059bd700ddbf6004d68.s1.eu.hivemq.cloud",lD="8884",uD="esp32-client-01",cD="Qjawns3445";let Oi=null;const Pa=[];function Rm(){if(Oi)return Oi;const l=`wss://${oD}:${lD}/mqtt`;return console.log(` Connecting to HiveMQ Cloud: ${l}`),Oi=aD.connect(l,{username:uD,password:cD,clean:!0,reconnectPeriod:3e3,clientId:`tansaeng-web-${Math.random().toString(16).slice(2,10)}`}),Oi.on("connect",()=>{console.log(" MQTT Connected to HiveMQ Cloud"),Pa.forEach(e=>e(!0))}),Oi.on("error",e=>{console.error(" MQTT Connection Error:",e),Pa.forEach(t=>t(!1))}),Oi.on("reconnect",()=>{console.log(" MQTT Reconnecting...")}),Oi.on("offline",()=>{console.log(" MQTT Offline"),Pa.forEach(e=>e(!1))}),Oi}function I_(l){return Pa.push(l),Oi&&l(Oi.connected),()=>{const e=Pa.indexOf(l);e>-1&&Pa.splice(e,1)}}function wc(l,e){const t=Rm();let r;"power"in e?r=e.power.toUpperCase():r=JSON.stringify(e),t.publish(l,r,{qos:1},n=>{n?console.error(` Failed to publish to ${l}:`,n):console.log(` Published to ${l}:`,r)})}function fD({deviceState:l,setDeviceState:e}){const[t,r]=Le.useState(!1),n=hd("fan"),s=hd("vent"),a=hd("pump");Le.useEffect(()=>I_(d=>{r(d)}),[]);const u=(c,d)=>{const p={...l,[c]:{...l[c],power:d?"on":"off",lastSavedAt:new Date().toISOString()}};e(p);const m=[...n,...s,...a].find(v=>v.id===c);m&&wc(m.commandTopic,{power:d?"on":"off"})},f=(c,d)=>{const p={...l,[c]:{...l[c],targetPercentage:d,lastSavedAt:new Date().toISOString()}};e(p);const m=s.find(v=>v.id===c);m&&wc(m.commandTopic,{target:d})};return V.jsx("div",{className:"bg-gray-50",children:V.jsxs("div",{className:"max-w-screen-2xl mx-auto p-3",children:[V.jsx("header",{className:"bg-white border-2 border-farm-500 px-4 py-3 rounded-lg mb-3 shadow-md",children:V.jsxs("div",{className:"flex items-center justify-between",children:[V.jsxs("div",{children:[V.jsx("h1",{className:"text-xl font-bold mb-1 text-gray-900",children:"  "}),V.jsx("p",{className:"text-xs text-gray-600",children:", ,     "})]}),V.jsxs("div",{className:"flex items-center gap-2 bg-farm-50 border border-farm-200 px-3 py-1.5 rounded-md",children:[V.jsx("div",{className:`
                w-2.5 h-2.5 rounded-full
                ${t?"bg-farm-500 animate-pulse":"bg-red-500"}
              `}),V.jsx("span",{className:"text-xs font-medium text-gray-900",children:t?"ESP32 ":"ESP32  "})]})]})}),V.jsxs("section",{className:"mb-3",children:[V.jsxs("header",{className:"bg-farm-500 px-4 py-2.5 rounded-t-lg flex items-center justify-between",children:[V.jsx("h2",{className:"text-base font-semibold flex items-center gap-1.5 text-gray-900",children:"  "}),V.jsxs("span",{className:"text-xs text-gray-800",children:[" ",n.length,""]})]}),V.jsx("div",{className:"bg-white shadow-sm rounded-b-lg p-3",children:V.jsx("div",{className:"grid grid-cols-[repeat(auto-fit,minmax(280px,1fr))] gap-3",children:n.map(c=>V.jsx(dd,{device:c,power:l[c.id]?.power??"off",lastSavedAt:l[c.id]?.lastSavedAt,onToggle:d=>u(c.id,d)},c.id))})})]}),V.jsxs("section",{className:"mb-3",children:[V.jsxs("header",{className:"bg-farm-500 px-4 py-2.5 rounded-t-lg flex items-center justify-between",children:[V.jsx("h2",{className:"text-base font-semibold flex items-center gap-1.5 text-gray-900",children:"  "}),V.jsxs("span",{className:"text-xs text-gray-800",children:[" ",s.length,""]})]}),V.jsx("div",{className:"bg-white shadow-sm rounded-b-lg p-3",children:V.jsx("div",{className:"grid grid-cols-[repeat(auto-fit,minmax(350px,1fr))] gap-3",children:s.map(c=>V.jsx(dd,{device:c,power:l[c.id]?.power??"off",percentage:l[c.id]?.targetPercentage??0,lastSavedAt:l[c.id]?.lastSavedAt,onPercentageChange:d=>f(c.id,d)},c.id))})})]}),V.jsxs("section",{className:"mb-3",children:[V.jsxs("header",{className:"bg-farm-500 px-4 py-2.5 rounded-t-lg flex items-center justify-between",children:[V.jsx("h2",{className:"text-base font-semibold flex items-center gap-1.5 text-gray-900",children:"  "}),V.jsxs("span",{className:"text-xs text-gray-800",children:[" ",a.length,""]})]}),V.jsx("div",{className:"bg-white shadow-sm rounded-b-lg p-3",children:V.jsx("div",{className:"grid grid-cols-[repeat(auto-fit,minmax(280px,1fr))] gap-3",children:a.map(c=>V.jsx(dd,{device:c,power:l[c.id]?.power??"off",lastSavedAt:l[c.id]?.lastSavedAt,onToggle:d=>u(c.id,d)},c.id))})})]})]})})}function hD({zones:l,setZones:e}){const t=(a,u)=>{e(f=>f.map(c=>c.id===a?{...c,...u}:c))},r=a=>{if(a.mode==="AUTO"){if(!a.intervalMinutes||!a.spraySeconds){alert("AUTO       .");return}if(a.startTime&&a.endTime&&a.startTime>=a.endTime){alert("     .");return}}wc(`tansaeng/mist/${a.id}/config`,{mode:a.mode,intervalMinutes:a.intervalMinutes,spraySeconds:a.spraySeconds,startTime:a.startTime,endTime:a.endTime,allowNightOperation:a.allowNightOperation}),alert(`${a.name}  .`)},n=a=>{wc(`tansaeng/mist/${a.id}/manual`,{action:"spray"}),alert(`${a.name}    .`)},s=a=>a==="OFF"?{bg:"#f3f4f6",text:"#4b5563"}:a==="MANUAL"?{bg:"#dbeafe",text:"#1e40af"}:{bg:"#d1fae5",text:"#065f46"};return V.jsx("div",{className:"bg-gray-50",children:V.jsxs("div",{className:"max-w-7xl mx-auto px-4",children:[V.jsxs("div",{className:"bg-gradient-to-r from-farm-500 to-farm-600 rounded-2xl px-6 py-4 mb-6",children:[V.jsx("h1",{className:"text-gray-900 font-bold text-2xl m-0",children:"  "}),V.jsx("p",{className:"text-white/80 text-sm mt-1 m-0",children:" Zone      "})]}),l.map(a=>{const u=s(a.mode);return V.jsxs("div",{className:"bg-white rounded-2xl shadow-card hover:shadow-card-hover transition-all duration-200 p-6 mb-6",children:[V.jsxs("div",{className:"flex items-center justify-between mb-4",children:[V.jsx("h2",{className:"text-xl font-semibold text-gray-800 m-0",children:a.name}),V.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium",style:{background:u.bg,color:u.text},children:a.mode})]}),V.jsxs("div",{className:"mb-4",children:[V.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:" "}),V.jsx("div",{className:"flex gap-4",children:["OFF","MANUAL","AUTO"].map(f=>V.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[V.jsx("input",{type:"radio",name:`mode-${a.id}`,checked:a.mode===f,onChange:()=>t(a.id,{mode:f}),className:"w-4 h-4 accent-farm-500"}),V.jsx("span",{className:"text-gray-700",children:f})]},f))})]}),a.mode==="MANUAL"&&V.jsx("div",{className:"mb-4",children:V.jsx("button",{onClick:()=>n(a),className:"w-full bg-blue-600 hover:bg-blue-700 text-gray-900 font-medium px-4 py-3 rounded-lg border-none cursor-pointer transition-all duration-200 hover:-translate-y-0.5",children:"  "})}),a.mode==="AUTO"&&V.jsxs("div",{children:[V.jsxs("div",{className:"grid grid-cols-[repeat(auto-fit,minmax(200px,1fr))] gap-4 mb-4",children:[V.jsxs("div",{children:[V.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"  ()"}),V.jsx("input",{type:"number",min:"1",value:a.intervalMinutes??"",onChange:f=>t(a.id,{intervalMinutes:Number(f.target.value)||null}),placeholder:": 30",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-base"})]}),V.jsxs("div",{children:[V.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"  ()"}),V.jsx("input",{type:"number",min:"1",value:a.spraySeconds??"",onChange:f=>t(a.id,{spraySeconds:Number(f.target.value)||null}),placeholder:": 10",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-base"})]})]}),V.jsxs("div",{className:"grid grid-cols-[repeat(auto-fit,minmax(200px,1fr))] gap-4 mb-4",children:[V.jsxs("div",{children:[V.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:" "}),V.jsx("input",{type:"time",value:a.startTime,onChange:f=>t(a.id,{startTime:f.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-base"})]}),V.jsxs("div",{children:[V.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:" "}),V.jsx("input",{type:"time",value:a.endTime,onChange:f=>t(a.id,{endTime:f.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-base"})]})]}),V.jsx("div",{className:"mb-4",children:V.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[V.jsx("input",{type:"checkbox",checked:a.allowNightOperation,onChange:f=>t(a.id,{allowNightOperation:f.target.checked}),className:"w-4 h-4 accent-farm-500"}),V.jsx("span",{className:"text-gray-700",children:"  "})]})}),V.jsx("button",{onClick:()=>r(a),className:"w-full bg-farm-500 hover:bg-farm-600 text-gray-900 font-medium px-4 py-3 rounded-lg border-none cursor-pointer transition-all duration-200 hover:-translate-y-0.5",children:" "})]})]},a.id)})]})})}function hS({icon:l,title:e,value:t,unit:r,maxValue:n,color:s="green"}){const a=t!=null,u=a?Math.min(t/n*100,100):0,f={green:"#059669",blue:"#2563eb",orange:"#f97316"};return V.jsxs("div",{className:"bg-white rounded-xl shadow-card hover:shadow-card-hover transition-all duration-200 p-6",children:[V.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[V.jsx("span",{className:"text-3xl",children:l}),V.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:e})]}),V.jsxs("div",{className:"text-center mb-4",children:[V.jsxs("div",{className:`text-5xl font-bold ${a?"text-farm-600":"text-gray-300"}`,children:[a?t:"-",a&&V.jsx("span",{className:"text-2xl font-normal ml-2",children:r})]}),!a&&V.jsx("div",{className:"text-sm text-gray-500 mt-2",children:" "})]}),V.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 overflow-hidden",children:V.jsx("div",{className:"h-full transition-all duration-500",style:{background:f[s],width:`${u}%`}})})]})}function Rs({label:l,value:e,unit:t}){const r=e!=null;return V.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-100",children:[V.jsx("dt",{className:"text-sm text-gray-600",children:l}),V.jsx("dd",{className:`text-base font-semibold ${r?"text-gray-800":"text-gray-400"}`,children:r?`${e}${t}`:" "})]})}function dD(){const[l,e]=Le.useState("24h"),[t,r]=Le.useState("all"),[n,s]=Le.useState(!1),[a,u]=Le.useState({airTemp:null,airHumidity:null,rootTemp:null,rootHumidity:null,ec:null,ph:null,tankLevel:null,co2:null,ppfd:null});Le.useEffect(()=>I_(d=>{s(d)}),[]),Le.useEffect(()=>{const c=Rm(),d="tansaeng/ctlr-0001/dht11/temperature",p="tansaeng/ctlr-0001/dht11/humidity",m=(v,y)=>{const b=parseFloat(y.toString());v===d?u(E=>({...E,airTemp:b})):v===p&&u(E=>({...E,airHumidity:b}))};return c.on("message",m),c.subscribe(d),c.subscribe(p),()=>{c.off("message",m),c.unsubscribe(d),c.unsubscribe(p)}},[]);const[f]=Le.useState([]);return V.jsx("div",{className:"bg-gray-50",children:V.jsxs("div",{className:"max-w-7xl mx-auto px-4",children:[V.jsx("header",{className:"bg-farm-500 p-4 sm:px-6 rounded-xl mb-6",children:V.jsxs("div",{className:"flex items-center justify-between",children:[V.jsxs("div",{children:[V.jsx("h1",{className:"text-2xl font-bold m-0",children:"  "}),V.jsx("p",{className:"text-sm text-gray-800 mt-1 m-0",children:", , EC, pH     "})]}),V.jsxs("div",{className:"flex items-center gap-2 bg-white/20 px-4 py-2 rounded-lg",children:[V.jsx("div",{className:`w-3 h-3 rounded-full ${n?"bg-green-300 animate-pulse":"bg-red-300"}`}),V.jsx("span",{className:"text-sm font-medium",children:n?"ESP32 ":"ESP32  "})]})]})}),V.jsxs("section",{className:"mb-6",children:[V.jsx("header",{className:"bg-farm-500 px-6 py-4 rounded-t-xl",children:V.jsx("h2",{className:"text-xl font-semibold m-0",children:"  "})}),V.jsx("div",{className:"bg-white rounded-b-xl shadow-card p-6",children:V.jsxs("div",{className:"grid grid-cols-[repeat(auto-fit,minmax(250px,1fr))] gap-4",children:[V.jsxs("div",{children:[V.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:""}),V.jsxs("select",{value:l,onChange:c=>e(c.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg text-base",children:[V.jsx("option",{value:"1h",children:" 1"}),V.jsx("option",{value:"today",children:""}),V.jsx("option",{value:"24h",children:"24"}),V.jsx("option",{value:"7d",children:"7"})]})]}),V.jsxs("div",{children:[V.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Zone"}),V.jsxs("select",{value:t,onChange:c=>r(c.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg text-base",children:[V.jsx("option",{value:"all",children:""}),V.jsx("option",{value:"zone_a",children:"Zone A ()"}),V.jsx("option",{value:"zone_b",children:"Zone B ()"}),V.jsx("option",{value:"zone_c",children:"Zone C ()"})]})]})]})})]}),V.jsxs("div",{className:"grid grid-cols-[repeat(auto-fit,minmax(300px,1fr))] gap-6 mb-6",children:[V.jsx(hS,{icon:"",title:" ",value:a.airTemp,unit:"C",maxValue:50,color:"green"}),V.jsx(hS,{icon:"",title:" ",value:a.airHumidity,unit:"%",maxValue:100,color:"blue"})]}),V.jsxs("section",{className:"mb-6",children:[V.jsx("header",{className:"bg-farm-500 px-6 py-4 rounded-t-xl",children:V.jsx("h2",{className:"text-xl font-semibold m-0",children:"   "})}),V.jsx("div",{className:"bg-white rounded-b-xl shadow-card p-6",children:V.jsxs("dl",{className:"grid grid-cols-[repeat(auto-fit,minmax(250px,1fr))] gap-3",children:[V.jsx(Rs,{label:" ",value:a.rootTemp,unit:"C"}),V.jsx(Rs,{label:" ",value:a.rootHumidity,unit:"%"}),V.jsx(Rs,{label:"EC",value:a.ec,unit:"mS/cm"}),V.jsx(Rs,{label:"pH",value:a.ph,unit:""}),V.jsx(Rs,{label:" ",value:a.tankLevel,unit:"%"}),V.jsx(Rs,{label:"CO",value:a.co2,unit:"ppm"}),V.jsx(Rs,{label:"PPFD",value:a.ppfd,unit:"mol/m/s"})]})})]}),V.jsxs("section",{className:"mb-6",children:[V.jsx("header",{className:"bg-farm-500 px-6 py-4 rounded-t-xl",children:V.jsx("h2",{className:"text-xl font-semibold m-0",children:" / "})}),V.jsx("div",{className:"bg-white rounded-b-xl shadow-card p-6",children:f.length===0?V.jsx("div",{className:"flex items-center justify-center h-64 text-gray-500",children:" "}):V.jsxs("div",{className:"h-64 flex items-center justify-center text-gray-400",children:[" : ",f.length," "]})})]}),V.jsxs("section",{className:"mb-6",children:[V.jsx("header",{className:"bg-farm-500 px-6 py-4 rounded-t-xl",children:V.jsx("h2",{className:"text-xl font-semibold m-0",children:" EC/pH/ "})}),V.jsx("div",{className:"bg-white rounded-b-xl shadow-card p-6",children:f.length===0?V.jsx("div",{className:"flex items-center justify-center h-64 text-gray-500",children:" "}):V.jsxs("div",{className:"h-64 flex items-center justify-center text-gray-400",children:[" : ",f.length," "]})})]})]})})}const Ye=Number.isFinite||function(l){return typeof l=="number"&&isFinite(l)},pD=Number.isSafeInteger||function(l){return typeof l=="number"&&Math.abs(l)<=gD},gD=Number.MAX_SAFE_INTEGER||9007199254740991;let tt=(function(l){return l.NETWORK_ERROR="networkError",l.MEDIA_ERROR="mediaError",l.KEY_SYSTEM_ERROR="keySystemError",l.MUX_ERROR="muxError",l.OTHER_ERROR="otherError",l})({}),Se=(function(l){return l.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",l.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",l.KEY_SYSTEM_NO_SESSION="keySystemNoSession",l.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",l.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",l.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",l.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",l.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",l.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",l.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",l.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",l.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",l.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",l.MANIFEST_LOAD_ERROR="manifestLoadError",l.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",l.MANIFEST_PARSING_ERROR="manifestParsingError",l.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",l.LEVEL_EMPTY_ERROR="levelEmptyError",l.LEVEL_LOAD_ERROR="levelLoadError",l.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",l.LEVEL_PARSING_ERROR="levelParsingError",l.LEVEL_SWITCH_ERROR="levelSwitchError",l.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",l.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",l.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",l.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",l.FRAG_LOAD_ERROR="fragLoadError",l.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",l.FRAG_DECRYPT_ERROR="fragDecryptError",l.FRAG_PARSING_ERROR="fragParsingError",l.FRAG_GAP="fragGap",l.REMUX_ALLOC_ERROR="remuxAllocError",l.KEY_LOAD_ERROR="keyLoadError",l.KEY_LOAD_TIMEOUT="keyLoadTimeOut",l.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",l.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",l.BUFFER_APPEND_ERROR="bufferAppendError",l.BUFFER_APPENDING_ERROR="bufferAppendingError",l.BUFFER_STALLED_ERROR="bufferStalledError",l.BUFFER_FULL_ERROR="bufferFullError",l.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",l.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",l.ASSET_LIST_LOAD_ERROR="assetListLoadError",l.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",l.ASSET_LIST_PARSING_ERROR="assetListParsingError",l.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",l.INTERNAL_EXCEPTION="internalException",l.INTERNAL_ABORTED="aborted",l.ATTACH_MEDIA_ERROR="attachMediaError",l.UNKNOWN="unknown",l})({}),M=(function(l){return l.MEDIA_ATTACHING="hlsMediaAttaching",l.MEDIA_ATTACHED="hlsMediaAttached",l.MEDIA_DETACHING="hlsMediaDetaching",l.MEDIA_DETACHED="hlsMediaDetached",l.MEDIA_ENDED="hlsMediaEnded",l.STALL_RESOLVED="hlsStallResolved",l.BUFFER_RESET="hlsBufferReset",l.BUFFER_CODECS="hlsBufferCodecs",l.BUFFER_CREATED="hlsBufferCreated",l.BUFFER_APPENDING="hlsBufferAppending",l.BUFFER_APPENDED="hlsBufferAppended",l.BUFFER_EOS="hlsBufferEos",l.BUFFERED_TO_END="hlsBufferedToEnd",l.BUFFER_FLUSHING="hlsBufferFlushing",l.BUFFER_FLUSHED="hlsBufferFlushed",l.MANIFEST_LOADING="hlsManifestLoading",l.MANIFEST_LOADED="hlsManifestLoaded",l.MANIFEST_PARSED="hlsManifestParsed",l.LEVEL_SWITCHING="hlsLevelSwitching",l.LEVEL_SWITCHED="hlsLevelSwitched",l.LEVEL_LOADING="hlsLevelLoading",l.LEVEL_LOADED="hlsLevelLoaded",l.LEVEL_UPDATED="hlsLevelUpdated",l.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",l.LEVELS_UPDATED="hlsLevelsUpdated",l.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",l.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",l.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",l.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",l.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",l.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",l.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",l.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",l.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",l.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",l.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",l.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",l.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",l.CUES_PARSED="hlsCuesParsed",l.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",l.INIT_PTS_FOUND="hlsInitPtsFound",l.FRAG_LOADING="hlsFragLoading",l.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",l.FRAG_LOADED="hlsFragLoaded",l.FRAG_DECRYPTED="hlsFragDecrypted",l.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",l.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",l.FRAG_PARSING_METADATA="hlsFragParsingMetadata",l.FRAG_PARSED="hlsFragParsed",l.FRAG_BUFFERED="hlsFragBuffered",l.FRAG_CHANGED="hlsFragChanged",l.FPS_DROP="hlsFpsDrop",l.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",l.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",l.ERROR="hlsError",l.DESTROYING="hlsDestroying",l.KEY_LOADING="hlsKeyLoading",l.KEY_LOADED="hlsKeyLoaded",l.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",l.BACK_BUFFER_REACHED="hlsBackBufferReached",l.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",l.ASSET_LIST_LOADING="hlsAssetListLoading",l.ASSET_LIST_LOADED="hlsAssetListLoaded",l.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",l.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",l.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",l.INTERSTITIAL_STARTED="hlsInterstitialStarted",l.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",l.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",l.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",l.INTERSTITIAL_ENDED="hlsInterstitialEnded",l.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",l.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",l.EVENT_CUE_ENTER="hlsEventCueEnter",l})({});var dt={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},Xe={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class Aa{constructor(e,t=0,r=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}sample(e,t){const r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class mD{constructor(e,t,r,n=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Aa(e),this.fast_=new Aa(t),this.defaultTTFB_=n,this.ttfb_=new Aa(e)}update(e,t){const{slow_:r,fast_:n,ttfb_:s}=this;r.halfLife!==e&&(this.slow_=new Aa(e,r.getEstimate(),r.getTotalWeight())),n.halfLife!==t&&(this.fast_=new Aa(t,n.getEstimate(),n.getTotalWeight())),s.halfLife!==e&&(this.ttfb_=new Aa(e,s.getEstimate(),s.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const r=8*t,n=e/1e3,s=r/n;this.fast_.sample(n,s),this.slow_.sample(n,s)}sampleTTFB(e){const t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function yD(l,e,t){return(e=bD(e))in l?Object.defineProperty(l,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):l[e]=t,l}function Lt(){return Lt=Object.assign?Object.assign.bind():function(l){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(l[r]=t[r])}return l},Lt.apply(null,arguments)}function dS(l,e){var t=Object.keys(l);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(l);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(l,n).enumerable})),t.push.apply(t,r)}return t}function _t(l){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?dS(Object(t),!0).forEach(function(r){yD(l,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(t)):dS(Object(t)).forEach(function(r){Object.defineProperty(l,r,Object.getOwnPropertyDescriptor(t,r))})}return l}function vD(l,e){if(typeof l!="object"||!l)return l;var t=l[Symbol.toPrimitive];if(t!==void 0){var r=t.call(l,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(l)}function bD(l){var e=vD(l,"string");return typeof e=="symbol"?e:e+""}class vi{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const r=`[${e}]:`;this.trace=rs,this.debug=t.debug.bind(null,r),this.log=t.log.bind(null,r),this.warn=t.warn.bind(null,r),this.info=t.info.bind(null,r),this.error=t.error.bind(null,r)}}const rs=function(){},ED={trace:rs,debug:rs,log:rs,warn:rs,info:rs,error:rs};function Gg(){return Lt({},ED)}function SD(l,e){const t=self.console[l];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${l}] >`):rs}function pS(l,e,t){return e[l]?e[l].bind(e):SD(l,t)}const Hg=Gg();function TD(l,e,t){const r=Gg();if(typeof console=="object"&&l===!0||typeof l=="object"){const n=["debug","log","info","warn","error"];n.forEach(s=>{r[s]=pS(s,l,t)});try{r.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return Gg()}n.forEach(s=>{Hg[s]=pS(s,l)})}else Lt(Hg,r);return r}const At=Hg;function as(l=!0){return typeof self>"u"?void 0:(l||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function xD(l){return typeof self<"u"&&l===self.ManagedMediaSource}function L_(l,e){const t=Object.keys(l),r=Object.keys(e),n=t.length,s=r.length;return!n||!s||n===s&&!t.some(a=>r.indexOf(a)===-1)}function si(l,e=!1){if(typeof TextDecoder<"u"){const c=new TextDecoder("utf-8").decode(l);if(e){const d=c.indexOf("\0");return d!==-1?c.substring(0,d):c}return c.replace(/\0/g,"")}const t=l.length;let r,n,s,a="",u=0;for(;u<t;){if(r=l[u++],r===0&&e)return a;if(r===0||r===3)continue;switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(r);break;case 12:case 13:n=l[u++],a+=String.fromCharCode((r&31)<<6|n&63);break;case 14:n=l[u++],s=l[u++],a+=String.fromCharCode((r&15)<<12|(n&63)<<6|(s&63)<<0);break}}return a}function vr(l){let e="";for(let t=0;t<l.length;t++){let r=l[t].toString(16);r.length<2&&(r="0"+r),e+=r}return e}function C_(l){return Uint8Array.from(l.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function _D(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var yd={exports:{}},gS;function AD(){return gS||(gS=1,(function(l,e){(function(t){var r=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,n=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,u={buildAbsoluteURL:function(f,c,d){if(d=d||{},f=f.trim(),c=c.trim(),!c){if(!d.alwaysNormalize)return f;var p=u.parseURL(f);if(!p)throw new Error("Error trying to parse base URL.");return p.path=u.normalizePath(p.path),u.buildURLFromParts(p)}var m=u.parseURL(c);if(!m)throw new Error("Error trying to parse relative URL.");if(m.scheme)return d.alwaysNormalize?(m.path=u.normalizePath(m.path),u.buildURLFromParts(m)):c;var v=u.parseURL(f);if(!v)throw new Error("Error trying to parse base URL.");if(!v.netLoc&&v.path&&v.path[0]!=="/"){var y=n.exec(v.path);v.netLoc=y[1],v.path=y[2]}v.netLoc&&!v.path&&(v.path="/");var b={scheme:v.scheme,netLoc:m.netLoc,path:null,params:m.params,query:m.query,fragment:m.fragment};if(!m.netLoc&&(b.netLoc=v.netLoc,m.path[0]!=="/"))if(!m.path)b.path=v.path,m.params||(b.params=v.params,m.query||(b.query=v.query));else{var E=v.path,x=E.substring(0,E.lastIndexOf("/")+1)+m.path;b.path=u.normalizePath(x)}return b.path===null&&(b.path=d.alwaysNormalize?u.normalizePath(m.path):m.path),u.buildURLFromParts(b)},parseURL:function(f){var c=r.exec(f);return c?{scheme:c[1]||"",netLoc:c[2]||"",path:c[3]||"",params:c[4]||"",query:c[5]||"",fragment:c[6]||""}:null},normalizePath:function(f){for(f=f.split("").reverse().join("").replace(s,"");f.length!==(f=f.replace(a,"")).length;);return f.split("").reverse().join("")},buildURLFromParts:function(f){return f.scheme+f.netLoc+f.path+f.params+f.query+f.fragment}};l.exports=u})()})(yd)),yd.exports}var Im=AD();class Lm{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Ot={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class D_{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,RD(this,"stats")}setByteRange(e,t){const r=e.split("@",2);let n;r.length===1?n=t?.byteRangeEndOffset||0:n=parseInt(r[1]),this._byteRange=[n,parseInt(r[0])+n]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[Ot.AUDIO]:null,[Ot.VIDEO]:null,[Ot.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new Lm),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Im.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[Ot.AUDIO]=null,e[Ot.VIDEO]=null,e[Ot.AUDIOVIDEO]=null}}function Xt(l){return l.sn!=="initSegment"}class vd extends D_{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(Ye(e)&&Ye(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const r=Object.keys(t);if(r.length===1){const n=this._decryptdata=t[r[0]]||null;n&&(this._decryptdata=n.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=Ye(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const r=Object.keys(this.levelkeys),n=r.length;if(n>1||n===1&&(t=this.levelkeys[r[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!Ye(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return Xt(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var r;const n=t[e];n&&!((r=this._decryptdata)!=null&&r.keyId)&&(this._decryptdata=n.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,r,n,s,a=!1){const{elementaryStreams:u}=this,f=u[e];if(!f){u[e]={startPTS:t,endPTS:r,startDTS:n,endDTS:s,partial:a};return}f.startPTS=Math.min(f.startPTS,t),f.endPTS=Math.max(f.endPTS,r),f.startDTS=Math.min(f.startDTS,n),f.endDTS=Math.max(f.endDTS,s)}}class wD extends D_{constructor(e,t,r,n,s){super(r),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=n;const a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,s),s&&(this.fragOffset=s.fragOffset+s.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function O_(l,e){const t=Object.getPrototypeOf(l);if(t){const r=Object.getOwnPropertyDescriptor(t,e);return r||O_(t,e)}}function RD(l,e){const t=O_(l,e);t&&(t.enumerable=!0,Object.defineProperty(l,e,t))}const mS=Math.pow(2,32)-1,ID=[].push,k_={video:1,audio:2,id3:3,text:4};function ar(l){return String.fromCharCode.apply(null,l)}function M_(l,e){const t=l[e]<<8|l[e+1];return t<0?65536+t:t}function st(l,e){const t=P_(l,e);return t<0?4294967296+t:t}function yS(l,e){let t=st(l,e);return t*=Math.pow(2,32),t+=st(l,e+4),t}function P_(l,e){return l[e]<<24|l[e+1]<<16|l[e+2]<<8|l[e+3]}function LD(l){const e=l.byteLength;for(let t=0;t<e;){const r=st(l,t);if(r>8&&l[t+4]===109&&l[t+5]===111&&l[t+6]===111&&l[t+7]===102)return!0;t=r>1?t+r:e}return!1}function ht(l,e){const t=[];if(!e.length)return t;const r=l.byteLength;for(let n=0;n<r;){const s=st(l,n),a=ar(l.subarray(n+4,n+8)),u=s>1?n+s:r;if(a===e[0])if(e.length===1)t.push(l.subarray(n+8,u));else{const f=ht(l.subarray(n+8,u),e.slice(1));f.length&&ID.apply(t,f)}n=u}return t}function CD(l){const e=[],t=l[0];let r=8;const n=st(l,r);r+=4;let s=0,a=0;t===0?(s=st(l,r),a=st(l,r+4),r+=8):(s=yS(l,r),a=yS(l,r+8),r+=16),r+=2;let u=l.length+a;const f=M_(l,r);r+=2;for(let c=0;c<f;c++){let d=r;const p=st(l,d);d+=4;const m=p&2147483647;if((p&2147483648)>>>31===1)return At.warn("SIDX has hierarchical references (not supported)"),null;const y=st(l,d);d+=4,e.push({referenceSize:m,subsegmentDuration:y,info:{duration:y/n,start:u,end:u+m-1}}),u+=m,d+=4,r=d}return{earliestPresentationTime:s,timescale:n,version:t,referencesCount:f,references:e}}function N_(l){const e=[],t=ht(l,["moov","trak"]);for(let n=0;n<t.length;n++){const s=t[n],a=ht(s,["tkhd"])[0];if(a){let u=a[0];const f=st(a,u===0?12:20),c=ht(s,["mdia","mdhd"])[0];if(c){u=c[0];const d=st(c,u===0?12:20),p=ht(s,["mdia","hdlr"])[0];if(p){const m=ar(p.subarray(8,12)),v={soun:Ot.AUDIO,vide:Ot.VIDEO}[m],y=ht(s,["mdia","minf","stbl","stsd"])[0],b=DD(y);v?(e[f]={timescale:d,type:v,stsd:b},e[v]=_t({timescale:d,id:f},b)):e[f]={timescale:d,type:m,stsd:b}}}}}return ht(l,["moov","mvex","trex"]).forEach(n=>{const s=st(n,4),a=e[s];a&&(a.default={duration:st(n,12),flags:st(n,20)})}),e}function DD(l){const e=l.subarray(8),t=e.subarray(86),r=ar(e.subarray(4,8));let n=r,s;const a=r==="enca"||r==="encv";if(a){const c=ht(e,[r])[0].subarray(r==="enca"?28:78);ht(c,["sinf"]).forEach(p=>{const m=ht(p,["schm"])[0];if(m){const v=ar(m.subarray(4,8));if(v==="cbcs"||v==="cenc"){const y=ht(p,["frma"])[0];y&&(n=ar(y))}}})}const u=n;switch(n){case"avc1":case"avc2":case"avc3":case"avc4":{const f=ht(t,["avcC"])[0];f&&f.length>3&&(n+="."+Ru(f[1])+Ru(f[2])+Ru(f[3]),s=wu(u==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const f=ht(e,[r])[0],c=ht(f.subarray(28),["esds"])[0];if(c&&c.length>7){let d=4;if(c[d++]!==3)break;d=bd(c,d),d+=2;const p=c[d++];if(p&128&&(d+=2),p&64&&(d+=c[d++]),c[d++]!==4)break;d=bd(c,d);const m=c[d++];if(m===64)n+="."+Ru(m);else break;if(d+=12,c[d++]!==5)break;d=bd(c,d);const v=c[d++];let y=(v&248)>>3;y===31&&(y+=1+((v&7)<<3)+((c[d]&224)>>5)),n+="."+y}break}case"hvc1":case"hev1":{const f=ht(t,["hvcC"])[0];if(f&&f.length>12){const c=f[1],d=["","A","B","C"][c>>6],p=c&31,m=st(f,2),v=(c&32)>>5?"H":"L",y=f[12],b=f.subarray(6,12);n+="."+d+p,n+="."+OD(m).toString(16).toUpperCase(),n+="."+v+y;let E="";for(let x=b.length;x--;){const T=b[x];(T||E)&&(E="."+T.toString(16).toUpperCase()+E)}n+=E}s=wu(u=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{n=wu(n,t)||n;break}case"vp09":{const f=ht(t,["vpcC"])[0];if(f&&f.length>6){const c=f[4],d=f[5],p=f[6]>>4&15;n+="."+ki(c)+"."+ki(d)+"."+ki(p)}break}case"av01":{const f=ht(t,["av1C"])[0];if(f&&f.length>2){const c=f[1]>>>5,d=f[1]&31,p=f[2]>>>7?"H":"M",m=(f[2]&64)>>6,v=(f[2]&32)>>5,y=c===2&&m?v?12:10:m?10:8,b=(f[2]&16)>>4,E=(f[2]&8)>>3,x=(f[2]&4)>>2,T=f[2]&3;n+="."+c+"."+ki(d)+p+"."+ki(y)+"."+b+"."+E+x+T+"."+ki(1)+"."+ki(1)+"."+ki(1)+"."+0,s=wu("dav1",t)}break}}return{codec:n,encrypted:a,supplemental:s}}function wu(l,e){const t=ht(e,["dvvC"]),r=t.length?t[0]:ht(e,["dvcC"])[0];if(r){const n=r[2]>>1&127,s=r[2]<<5&32|r[3]>>3&31;return l+"."+ki(n)+"."+ki(s)}}function OD(l){let e=0;for(let t=0;t<32;t++)e|=(l>>t&1)<<31-t;return e>>>0}function bd(l,e){const t=e+5;for(;l[e++]&128&&e<t;);return e}function Ru(l){return("0"+l.toString(16).toUpperCase()).slice(-2)}function ki(l){return(l<10?"0":"")+l}function kD(l,e){if(!l||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&U_(l,(r,n)=>{const s=r.subarray(8,24);s.some(a=>a!==0)||(At.log(`[eme] Patching keyId in 'enc${n?"a":"v"}>sinf>>tenc' box: ${vr(s)} -> ${vr(t)}`),r.set(t,8))})}function MD(l){const e=[];return U_(l,t=>e.push(t.subarray(8,24))),e}function U_(l,e){ht(l,["moov","trak"]).forEach(r=>{const n=ht(r,["mdia","minf","stbl","stsd"])[0];if(!n)return;const s=n.subarray(8);let a=ht(s,["enca"]);const u=a.length>0;u||(a=ht(s,["encv"])),a.forEach(f=>{const c=u?f.subarray(28):f.subarray(78);ht(c,["sinf"]).forEach(p=>{const m=B_(p);m&&e(m,u)})})})}function B_(l){const e=ht(l,["schm"])[0];if(e){const t=ar(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const r=ht(l,["schi","tenc"])[0];if(r)return r}}}function PD(l,e,t){const r={},n=ht(l,["moof","traf"]);for(let s=0;s<n.length;s++){const a=n[s],u=ht(a,["tfhd"])[0],f=st(u,4),c=e[f];if(!c)continue;r[f]||(r[f]={start:NaN,duration:0,sampleCount:0,timescale:c.timescale,type:c.type});const d=r[f],p=ht(a,["tfdt"])[0];if(p){const A=p[0];let L=st(p,4);A===1&&(L===mS?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(L*=mS+1,L+=st(p,8))),Ye(L)&&(!Ye(d.start)||L<d.start)&&(d.start=L)}const m=c.default,v=st(u,0)|m?.flags;let y=m?.duration||0;v&8&&(v&2?y=st(u,12):y=st(u,8));const b=ht(a,["trun"]);let E=d.start||0,x=0,T=y;for(let A=0;A<b.length;A++){const L=b[A],w=st(L,4),C=d.sampleCount;d.sampleCount+=w;const I=L[3]&1,O=L[3]&4,B=L[2]&1,P=L[2]&2,$=L[2]&4,F=L[2]&8;let Z=8,X=w;for(I&&(Z+=4),O&&w&&(!(L[Z+1]&1)&&d.keyFrameIndex===void 0&&(d.keyFrameIndex=C),Z+=4,B?(T=st(L,Z),Z+=4):T=y,P&&(Z+=4),F&&(Z+=4),E+=T,x+=T,X--);X--;)B?(T=st(L,Z),Z+=4):T=y,P&&(Z+=4),$&&(L[Z+1]&1||d.keyFrameIndex===void 0&&(d.keyFrameIndex=d.sampleCount-(X+1),d.keyFrameStart=E),Z+=4),F&&(Z+=4),E+=T,x+=T;!x&&y&&(x+=y*w)}d.duration+=x}if(!Object.keys(r).some(s=>r[s].duration)){let s=1/0,a=0;const u=ht(l,["sidx"]);for(let f=0;f<u.length;f++){const c=CD(u[f]);if(c!=null&&c.references){s=Math.min(s,c.earliestPresentationTime/c.timescale);const d=c.references.reduce((p,m)=>p+m.info.duration||0,0);a=Math.max(a,d+c.earliestPresentationTime/c.timescale)}}a&&Ye(a)&&Object.keys(r).forEach(f=>{r[f].duration||(r[f].duration=a*r[f].timescale-r[f].start)})}return r}function ND(l){const e={valid:null,remainder:null},t=ht(l,["moof"]);if(t.length<2)return e.remainder=l,e;const r=t[t.length-1];return e.valid=l.slice(0,r.byteOffset-8),e.remainder=l.slice(r.byteOffset-8),e}function yi(l,e){const t=new Uint8Array(l.length+e.length);return t.set(l),t.set(e,l.length),t}function vS(l,e){const t=[],r=e.samples,n=e.timescale,s=e.id;let a=!1;return ht(r,["moof"]).map(f=>{const c=f.byteOffset-8;ht(f,["traf"]).map(p=>{const m=ht(p,["tfdt"]).map(v=>{const y=v[0];let b=st(v,4);return y===1&&(b*=Math.pow(2,32),b+=st(v,8)),b/n})[0];return m!==void 0&&(l=m),ht(p,["tfhd"]).map(v=>{const y=st(v,4),b=st(v,0)&16777215,E=(b&1)!==0,x=(b&2)!==0,T=(b&8)!==0;let A=0;const L=(b&16)!==0;let w=0;const C=(b&32)!==0;let I=8;y===s&&(E&&(I+=8),x&&(I+=4),T&&(A=st(v,I),I+=4),L&&(w=st(v,I),I+=4),C&&(I+=4),e.type==="video"&&(a=zc(e.codec)),ht(p,["trun"]).map(O=>{const B=O[0],P=st(O,0)&16777215,$=(P&1)!==0;let F=0;const Z=(P&4)!==0,X=(P&256)!==0;let q=0;const H=(P&512)!==0;let K=0;const z=(P&1024)!==0,ie=(P&2048)!==0;let Y=0;const U=st(O,4);let N=8;$&&(F=st(O,N),N+=4),Z&&(N+=4);let W=F+c;for(let ue=0;ue<U;ue++){if(X?(q=st(O,N),N+=4):q=A,H?(K=st(O,N),N+=4):K=w,z&&(N+=4),ie&&(B===0?Y=st(O,N):Y=P_(O,N),N+=4),e.type===Ot.VIDEO){let ne=0;for(;ne<K;){const Ee=st(r,W);if(W+=4,UD(a,r[W])){const se=r.subarray(W,W+Ee);Cm(se,a?2:1,l+Y/n,t)}W+=Ee,ne+=Ee+4}}l+=q/n}}))})})}),t}function zc(l){if(!l)return!1;const e=l.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function UD(l,e){if(l){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function Cm(l,e,t,r){const n=F_(l);let s=0;s+=e;let a=0,u=0,f=0;for(;s<n.length;){a=0;do{if(s>=n.length)break;f=n[s++],a+=f}while(f===255);u=0;do{if(s>=n.length)break;f=n[s++],u+=f}while(f===255);const c=n.length-s;let d=s;if(u<c)s+=u;else if(u>c){At.error(`Malformed SEI payload. ${u} is too small, only ${c} bytes left to parse.`);break}if(a===4){if(n[d++]===181){const m=M_(n,d);if(d+=2,m===49){const v=st(n,d);if(d+=4,v===1195456820){const y=n[d++];if(y===3){const b=n[d++],E=31&b,x=64&b,T=x?2+E*3:0,A=new Uint8Array(T);if(x){A[0]=b;for(let L=1;L<T;L++)A[L]=n[d++]}r.push({type:y,payloadType:a,pts:t,bytes:A})}}}}}else if(a===5&&u>16){const p=[];for(let y=0;y<16;y++){const b=n[d++].toString(16);p.push(b.length==1?"0"+b:b),(y===3||y===5||y===7||y===9)&&p.push("-")}const m=u-16,v=new Uint8Array(m);for(let y=0;y<m;y++)v[y]=n[d++];r.push({payloadType:a,pts:t,uuid:p.join(""),userData:si(v),userDataBytes:v})}}}function F_(l){const e=l.byteLength,t=[];let r=1;for(;r<e-2;)l[r]===0&&l[r+1]===0&&l[r+2]===3?(t.push(r+2),r+=2):r++;if(t.length===0)return l;const n=e-t.length,s=new Uint8Array(n);let a=0;for(r=0;r<n;a++,r++)a===t[0]&&(a++,t.shift()),s[r]=l[a];return s}function BD(l){const e=l[0];let t="",r="",n=0,s=0,a=0,u=0,f=0,c=0;if(e===0){for(;ar(l.subarray(c,c+1))!=="\0";)t+=ar(l.subarray(c,c+1)),c+=1;for(t+=ar(l.subarray(c,c+1)),c+=1;ar(l.subarray(c,c+1))!=="\0";)r+=ar(l.subarray(c,c+1)),c+=1;r+=ar(l.subarray(c,c+1)),c+=1,n=st(l,12),s=st(l,16),u=st(l,20),f=st(l,24),c=28}else if(e===1){c+=4,n=st(l,c),c+=4;const p=st(l,c);c+=4;const m=st(l,c);for(c+=4,a=2**32*p+m,pD(a)||(a=Number.MAX_SAFE_INTEGER,At.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),u=st(l,c),c+=4,f=st(l,c),c+=4;ar(l.subarray(c,c+1))!=="\0";)t+=ar(l.subarray(c,c+1)),c+=1;for(t+=ar(l.subarray(c,c+1)),c+=1;ar(l.subarray(c,c+1))!=="\0";)r+=ar(l.subarray(c,c+1)),c+=1;r+=ar(l.subarray(c,c+1)),c+=1}const d=l.subarray(c,l.byteLength);return{schemeIdUri:t,value:r,timeScale:n,presentationTime:a,presentationTimeDelta:s,eventDuration:u,id:f,payload:d}}function FD(l,...e){const t=e.length;let r=8,n=t;for(;n--;)r+=e[n].byteLength;const s=new Uint8Array(r);for(s[0]=r>>24&255,s[1]=r>>16&255,s[2]=r>>8&255,s[3]=r&255,s.set(l,4),n=0,r=8;n<t;n++)s.set(e[n],r),r+=e[n].byteLength;return s}function jD(l,e,t){if(l.byteLength!==16)throw new RangeError("Invalid system id");let r,n;r=0,n=new Uint8Array;let s;r>0?(s=new Uint8Array(4),e.length>0&&new DataView(s.buffer).setUint32(0,e.length,!1)):s=new Uint8Array;const a=new Uint8Array(4);return t.byteLength>0&&new DataView(a.buffer).setUint32(0,t.byteLength,!1),FD([112,115,115,104],new Uint8Array([r,0,0,0]),l,s,n,a,t)}function $D(l){const e=[];if(l instanceof ArrayBuffer){const t=l.byteLength;let r=0;for(;r+32<t;){const n=new DataView(l,r),s=GD(n);e.push(s),r+=s.size}}return e}function GD(l){const e=l.getUint32(0),t=l.byteOffset,r=l.byteLength;if(r<e)return{offset:t,size:r};if(l.getUint32(4)!==1886614376)return{offset:t,size:e};const s=l.getUint32(8)>>>24;if(s!==0&&s!==1)return{offset:t,size:e};const a=l.buffer,u=vr(new Uint8Array(a,t+12,16));let f=null,c=null,d=0;if(s===0)d=28;else{const m=l.getUint32(28);if(!m||r<32+m*16)return{offset:t,size:e};f=[];for(let v=0;v<m;v++)f.push(new Uint8Array(a,t+32+v*16,16));d=32+m*16}if(!d)return{offset:t,size:e};const p=l.getUint32(d);return e-32<p?{offset:t,size:e}:(c=new Uint8Array(a,t+d+4,p),{version:s,systemId:u,kids:f,data:c,offset:t,size:e})}const j_=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),ja={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Dm(l,e){const t=ja[e];return!!t&&!!t[l.slice(0,4)]}function Jo(l,e,t=!0){return!l.split(",").some(r=>!Om(r,e,t))}function Om(l,e,t=!0){var r;const n=as(t);return(r=n?.isTypeSupported(el(l,e)))!=null?r:!1}function el(l,e){return`${e}/mp4;codecs=${l}`}function bS(l){if(l){const e=l.substring(0,4);return ja.video[e]}return 2}function Rc(l){const e=j_();return l.split(",").reduce((t,r)=>{const s=e&&zc(r)?9:ja.video[r];return s?(s*2+t)/(t?3:2):(ja.audio[r]+t)/(t?2:1)},0)}const Ed={};function HD(l,e=!0){if(Ed[l])return Ed[l];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[l];for(let n=0;n<t.length;n++){var r;if(Om(t[n],"audio",e))return Ed[l]=t[n],t[n];if(t[n]==="mp3"&&(r=as(e))!=null&&r.isTypeSupported("audio/mpeg"))return""}return l}const KD=/flac|opus|mp4a\.40\.34/i;function Ic(l,e=!0){return l.replace(KD,t=>HD(t.toLowerCase(),e))}function VD(l,e){const t=[];if(l){const r=l.split(",");for(let n=0;n<r.length;n++)Dm(r[n],"video")||t.push(r[n])}return e&&t.push(e),t.join(",")}function gc(l,e){if(l&&(l.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(l)!==-1)&&(ES(l,"audio")||ES(l,"video")))return l;if(e){const t=e.split(",");if(t.length>1){if(l){for(let r=t.length;r--;)if(t[r].substring(0,4)===l.substring(0,4))return t[r]}return t[0]}}return e||l}function ES(l,e){return Dm(l,e)&&Om(l,e)}function zD(l){const e=l.split(",");for(let t=0;t<e.length;t++){const r=e[t].split(".");r.length>2&&r[0]==="avc1"&&(e[t]=`avc1.${parseInt(r[1]).toString(16)}${("000"+parseInt(r[2]).toString(16)).slice(-4)}`)}return e.join(",")}function qD(l){if(l.startsWith("av01.")){const e=l.split("."),t=["0","111","01","01","01","0"];for(let r=e.length;r>4&&r<10;r++)e[r]=t[r-4];return e.join(".")}return l}function SS(l){const e=as(l)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Kg(l){return l.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const YD={supported:!0,powerEfficient:!0,smooth:!0},WD={supported:!1,smooth:!1,powerEfficient:!1},$_={supported:!0,configurations:[],decodingInfoResults:[YD]};function G_(l,e){return{supported:!1,configurations:e,decodingInfoResults:[WD],error:l}}function QD(l,e,t,r,n,s){const a=l.videoCodec,u=l.audioCodec?l.audioGroups:null,f=s?.audioCodec,c=s?.channels,d=c?parseInt(c):f?1/0:2;let p=null;if(u!=null&&u.length)try{u.length===1&&u[0]?p=e.groups[u[0]].channels:p=u.reduce((m,v)=>{if(v){const y=e.groups[v];if(!y)throw new Error(`Audio track group ${v} not found`);Object.keys(y.channels).forEach(b=>{m[b]=(m[b]||0)+y.channels[b]})}return m},{2:0})}catch{return!0}return a!==void 0&&(a.split(",").some(m=>zc(m))||l.width>1920&&l.height>1088||l.height>1920&&l.width>1088||l.frameRate>Math.max(r,30)||l.videoRange!=="SDR"&&l.videoRange!==t||l.bitrate>Math.max(n,8e6))||!!p&&Ye(d)&&Object.keys(p).some(m=>parseInt(m)>d)}function H_(l,e,t,r={}){const n=l.videoCodec;if(!n&&!l.audioCodec||!t)return Promise.resolve($_);const s=[],a=XD(l),u=a.length,f=ZD(l,e,u>0),c=f.length;for(let d=u||1*c||1;d--;){const p={type:"media-source"};if(u&&(p.video=a[d%u]),c){p.audio=f[d%c];const m=p.audio.bitrate;p.video&&m&&(p.video.bitrate-=m)}s.push(p)}if(n){const d=navigator.userAgent;if(n.split(",").some(p=>zc(p))&&j_())return Promise.resolve(G_(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${d})`),s))}return Promise.all(s.map(d=>{const p=eO(d);return r[p]||(r[p]=t.decodingInfo(d))})).then(d=>({supported:!d.some(p=>!p.supported),configurations:s,decodingInfoResults:d})).catch(d=>({supported:!1,configurations:s,decodingInfoResults:[],error:d}))}function XD(l){var e;const t=(e=l.videoCodec)==null?void 0:e.split(","),r=K_(l),n=l.width||640,s=l.height||480,a=l.frameRate||30,u=l.videoRange.toLowerCase();return t?t.map(f=>{const c={contentType:el(qD(f),"video"),width:n,height:s,bitrate:r,framerate:a};return u!=="sdr"&&(c.transferFunction=u),c}):[]}function ZD(l,e,t){var r;const n=(r=l.audioCodec)==null?void 0:r.split(","),s=K_(l);return n&&l.audioGroups?l.audioGroups.reduce((a,u)=>{var f;const c=u?(f=e.groups[u])==null?void 0:f.tracks:null;return c?c.reduce((d,p)=>{if(p.groupId===u){const m=parseFloat(p.channels||"");n.forEach(v=>{const y={contentType:el(v,"audio"),bitrate:t?JD(v,s):s};m&&(y.channels=""+m),d.push(y)})}return d},a):a},[]):[]}function JD(l,e){if(e<=1)return 1;let t=128e3;return l==="ec-3"?t=768e3:l==="ac-3"&&(t=64e4),Math.min(e/2,t)}function K_(l){return Math.ceil(Math.max(l.bitrate*.9,l.averageBitrate)/1e3)*1e3||1}function eO(l){let e="";const{audio:t,video:r}=l;if(r){const n=Kg(r.contentType);e+=`${n}_r${r.height}x${r.width}f${Math.ceil(r.framerate)}${r.transferFunction||"sd"}_${Math.ceil(r.bitrate/1e5)}`}if(t){const n=Kg(t.contentType);e+=`${r?"_":""}${n}_c${t.channels}`}return e}const Vg=["NONE","TYPE-0","TYPE-1",null];function tO(l){return Vg.indexOf(l)>-1}const Lc=["SDR","PQ","HLG"];function rO(l){return!!l&&Lc.indexOf(l)>-1}var mc={No:"",Yes:"YES",v2:"v2"};function TS(l){const{canSkipUntil:e,canSkipDateRanges:t,age:r}=l,n=r<e/2;return e&&n?t?mc.v2:mc.Yes:mc.No}class xS{constructor(e,t,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=r}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class tl{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(r=>!!r).map(r=>r.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const r=(t=e.supplemental)==null?void 0:t.videoCodec;r&&r!==e.videoCodec&&(this.codecSet+=`,${r.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return _S(this._audioGroups,e)}hasSubtitleGroup(e){return _S(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let r=this._audioGroups;r||(r=this._audioGroups=[]),r.indexOf(t)===-1&&r.push(t)}else if(e==="text"){let r=this._subtitleGroups;r||(r=this._subtitleGroups=[]),r.indexOf(t)===-1&&r.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function _S(l,e){return!e||!l?!1:l.indexOf(e)!==-1}function iO(){if(typeof matchMedia=="function"){const l=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(l.media!==e.media)return l.matches===!0}return!1}function nO(l,e){let t=!1,r=[];if(l&&(t=l!=="SDR",r=[l]),e){r=e.allowedVideoRanges||Lc.slice(0);const n=r.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:n&&iO(),t||(r=["SDR"])}return{preferHDR:t,allowedVideoRanges:r}}const sO=l=>{const e=new WeakSet;return(t,r)=>{if(l&&(r=l(t,r)),typeof r=="object"&&r!==null){if(e.has(r))return;e.add(r)}return r}},kt=(l,e)=>JSON.stringify(l,sO(e));function aO(l,e,t,r,n){const s=Object.keys(l),a=r?.channels,u=r?.audioCodec,f=n?.videoCodec,c=a&&parseInt(a)===2;let d=!1,p=!1,m=1/0,v=1/0,y=1/0,b=1/0,E=0,x=[];const{preferHDR:T,allowedVideoRanges:A}=nO(e,n);for(let O=s.length;O--;){const B=l[s[O]];d||(d=B.channels[2]>0),m=Math.min(m,B.minHeight),v=Math.min(v,B.minFramerate),y=Math.min(y,B.minBitrate),A.filter($=>B.videoRanges[$]>0).length>0&&(p=!0)}m=Ye(m)?m:0,v=Ye(v)?v:0;const L=Math.max(1080,m),w=Math.max(30,v);y=Ye(y)?y:t,t=Math.max(y,t),p||(e=void 0);const C=s.length>1;return{codecSet:s.reduce((O,B)=>{const P=l[B];if(B===O)return O;if(x=p?A.filter($=>P.videoRanges[$]>0):[],C){if(P.minBitrate>t)return Ci(B,`min bitrate of ${P.minBitrate} > current estimate of ${t}`),O;if(!P.hasDefaultAudio)return Ci(B,"no renditions with default or auto-select sound found"),O;if(u&&B.indexOf(u.substring(0,4))%5!==0)return Ci(B,`audio codec preference "${u}" not found`),O;if(a&&!c){if(!P.channels[a])return Ci(B,`no renditions with ${a} channel sound found (channels options: ${Object.keys(P.channels)})`),O}else if((!u||c)&&d&&P.channels[2]===0)return Ci(B,"no renditions with stereo sound found"),O;if(P.minHeight>L)return Ci(B,`min resolution of ${P.minHeight} > maximum of ${L}`),O;if(P.minFramerate>w)return Ci(B,`min framerate of ${P.minFramerate} > maximum of ${w}`),O;if(!x.some($=>P.videoRanges[$]>0))return Ci(B,`no variants with VIDEO-RANGE of ${kt(x)} found`),O;if(f&&B.indexOf(f.substring(0,4))%5!==0)return Ci(B,`video codec preference "${f}" not found`),O;if(P.maxScore<E)return Ci(B,`max score of ${P.maxScore} < selected max of ${E}`),O}return O&&(Rc(B)>=Rc(O)||P.fragmentError>l[O].fragmentError)?O:(b=P.minIndex,E=P.maxScore,B)},void 0),videoRanges:x,preferHDR:T,minFramerate:v,minBitrate:y,minIndex:b}}function Ci(l,e){At.log(`[abr] start candidates with "${l}" ignored because ${e}`)}function V_(l){return l.reduce((e,t)=>{let r=e.groups[t.groupId];r||(r=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),r.tracks.push(t);const n=t.channels||"2";return r.channels[n]=(r.channels[n]||0)+1,r.hasDefault=r.hasDefault||t.default,r.hasAutoSelect=r.hasAutoSelect||t.autoselect,r.hasDefault&&(e.hasDefaultAudio=!0),r.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function oO(l,e,t,r){return l.slice(t,r+1).reduce((n,s,a)=>{if(!s.codecSet)return n;const u=s.audioGroups;let f=n[s.codecSet];f||(n[s.codecSet]=f={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:a,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!u,fragmentError:0}),f.minBitrate=Math.min(f.minBitrate,s.bitrate);const c=Math.min(s.height,s.width);return f.minHeight=Math.min(f.minHeight,c),f.minFramerate=Math.min(f.minFramerate,s.frameRate),f.minIndex=Math.min(f.minIndex,a),f.maxScore=Math.max(f.maxScore,s.score),f.fragmentError+=s.fragmentError,f.videoRanges[s.videoRange]=(f.videoRanges[s.videoRange]||0)+1,u&&u.forEach(d=>{if(!d)return;const p=e.groups[d];p&&(f.hasDefaultAudio=f.hasDefaultAudio||e.hasDefaultAudio?p.hasDefault:p.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(p.channels).forEach(m=>{f.channels[m]=(f.channels[m]||0)+p.channels[m]}))}),n},{})}function AS(l){if(!l)return l;const{lang:e,assocLang:t,characteristics:r,channels:n,audioCodec:s}=l;return{lang:e,assocLang:t,characteristics:r,channels:n,audioCodec:s}}function Ui(l,e,t){if("attrs"in l){const r=e.indexOf(l);if(r!==-1)return r}for(let r=0;r<e.length;r++){const n=e[r];if(Ps(l,n,t))return r}return-1}function Ps(l,e,t){const{groupId:r,name:n,lang:s,assocLang:a,default:u}=l,f=l.forced;return(r===void 0||e.groupId===r)&&(n===void 0||e.name===n)&&(s===void 0||lO(s,e.lang))&&(s===void 0||e.assocLang===a)&&(u===void 0||e.default===u)&&(f===void 0||e.forced===f)&&(!("characteristics"in l)||uO(l.characteristics||"",e.characteristics))&&(t===void 0||t(l,e))}function lO(l,e="--"){return l.length===e.length?l===e:l.startsWith(e)||e.startsWith(l)}function uO(l,e=""){const t=l.split(","),r=e.split(",");return t.length===r.length&&!t.some(n=>r.indexOf(n)===-1)}function Cs(l,e){const{audioCodec:t,channels:r}=l;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(r===void 0||r===(e.channels||"2"))}function cO(l,e,t,r,n){const s=e[r],u=e.reduce((m,v,y)=>{const b=v.uri;return(m[b]||(m[b]=[])).push(y),m},{})[s.uri];u.length>1&&(r=Math.max.apply(Math,u));const f=s.videoRange,c=s.frameRate,d=s.codecSet.substring(0,4),p=wS(e,r,m=>{if(m.videoRange!==f||m.frameRate!==c||m.codecSet.substring(0,4)!==d)return!1;const v=m.audioGroups,y=t.filter(b=>!v||v.indexOf(b.groupId)!==-1);return Ui(l,y,n)>-1});return p>-1?p:wS(e,r,m=>{const v=m.audioGroups,y=t.filter(b=>!v||v.indexOf(b.groupId)!==-1);return Ui(l,y,n)>-1})}function wS(l,e,t){for(let r=e;r>-1;r--)if(t(l[r]))return r;for(let r=e+1;r<l.length;r++)if(t(l[r]))return r;return-1}function Cc(l,e){var t;return!!l&&l!==((t=e.loadLevelObj)==null?void 0:t.uri)}class fO extends vi{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var r;const{fragCurrent:n,partCurrent:s,hls:a}=this,{autoLevelEnabled:u,media:f}=a;if(!n||!f)return;const c=performance.now(),d=s?s.stats:n.stats,p=s?s.duration:n.duration,m=c-d.loading.start,v=a.minAutoLevel,y=n.level,b=this._nextAutoLevel;if(d.aborted||d.loaded&&d.loaded===d.total||y<=v){this.clearTimer(),this._nextAutoLevel=-1;return}if(!u)return;const E=b>-1&&b!==y,x=!!t||E;if(!x&&(f.paused||!f.playbackRate||!f.readyState))return;const T=a.mainForwardBufferInfo;if(!x&&T===null)return;const A=this.bwEstimator.getEstimateTTFB(),L=Math.abs(f.playbackRate);if(m<=Math.max(A,1e3*(p/(L*2))))return;const w=T?T.len/L:0,C=d.loading.first?d.loading.first-d.loading.start:-1,I=d.loaded&&C>-1,O=this.getBwEstimate(),B=a.levels,P=B[y],$=Math.max(d.loaded,Math.round(p*(n.bitrate||P.averageBitrate)/8));let F=I?m-C:m;F<1&&I&&(F=Math.min(m,d.loaded*8/O));const Z=I?d.loaded*1e3/F:0,X=A/1e3,q=Z?($-d.loaded)/Z:$*8/O+X;if(q<=w)return;const H=Z?Z*8:O,K=((r=t?.details||this.hls.latestLevelDetails)==null?void 0:r.live)===!0,z=this.hls.config.abrBandWidthUpFactor;let ie=Number.POSITIVE_INFINITY,Y;for(Y=y-1;Y>v;Y--){const ue=B[Y].maxBitrate,ne=!B[Y].details||K;if(ie=this.getTimeToLoadFrag(X,H,p*ue,ne),ie<Math.min(w,p+X))break}if(ie>=q||ie>p*10)return;I?this.bwEstimator.sample(m-Math.min(A,C),d.loaded):this.bwEstimator.sampleTTFB(m);const U=B[Y].maxBitrate;this.getBwEstimate()*z>U&&this.resetEstimator(U);const N=this.findBestLevel(U,v,Y,0,w,1,1);N>-1&&(Y=N),this.warn(`Fragment ${n.sn}${s?" part "+s.index:""} of level ${y} is loading too slowly;
      Fragment duration: ${n.duration.toFixed(3)}
      Time to underbuffer: ${w.toFixed(3)} s
      Estimated load time for current fragment: ${q.toFixed(3)} s
      Estimated load time for down switch fragment: ${ie.toFixed(3)} s
      TTFB estimate: ${C|0} ms
      Current BW estimate: ${Ye(O)?O|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${Y} @ ${U|0} bps`),a.nextLoadLevel=a.nextAutoLevel=Y,this.clearTimer();const W=()=>{if(this.clearTimer(),this.fragCurrent===n&&this.hls.loadLevel===Y&&Y>0){const ue=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${Y>0?"and switching down":""}
      Fragment duration: ${n.duration.toFixed(3)} s
      Time to underbuffer: ${ue.toFixed(3)} s`),n.abortRequests(),this.fragCurrent=this.partCurrent=null,Y>v){let ne=this.findBestLevel(this.hls.levels[v].bitrate,v,Y,0,ue,1,1);ne===-1&&(ne=v),this.hls.nextLoadLevel=this.hls.nextAutoLevel=ne,this.resetEstimator(this.hls.levels[ne].bitrate)}}};E||q>ie*2?W():this.timer=self.setInterval(W,ie*1e3),a.trigger(M.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,part:s,stats:d})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new mD(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(M.MANIFEST_LOADING,this.onManifestLoading,this),e.on(M.FRAG_LOADING,this.onFragLoading,this),e.on(M.FRAG_LOADED,this.onFragLoaded,this),e.on(M.FRAG_BUFFERED,this.onFragBuffered,this),e.on(M.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(M.LEVEL_LOADED,this.onLevelLoaded,this),e.on(M.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(M.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(M.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(M.MANIFEST_LOADING,this.onManifestLoading,this),e.off(M.FRAG_LOADING,this.onFragLoading,this),e.off(M.FRAG_LOADED,this.onFragLoaded,this),e.off(M.FRAG_BUFFERED,this.onFragBuffered,this),e.off(M.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(M.LEVEL_LOADED,this.onLevelLoaded,this),e.off(M.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(M.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(M.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const r=t.frag;if(!this.ignoreFragment(r)){if(!r.bitrateTest){var n;this.fragCurrent=r,this.partCurrent=(n=t.part)!=null?n:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case Se.BUFFER_ADD_CODEC_ERROR:case Se.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case Se.FRAG_LOAD_TIMEOUT:{const r=t.frag,{fragCurrent:n,partCurrent:s}=this;if(r&&n&&r.sn===n.sn&&r.level===n.level){const a=performance.now(),u=s?s.stats:r.stats,f=a-u.loading.start,c=u.loading.first?u.loading.first-u.loading.start:-1;if(u.loaded&&c>-1){const p=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(f-Math.min(p,c),u.loaded)}else this.bwEstimator.sampleTTFB(f)}break}}}getTimeToLoadFrag(e,t,r,n){const s=e+r/t,a=n?e+this.lastLevelLoadSec:0;return s+a}onLevelLoaded(e,t){const r=this.hls.config,{loading:n}=t.stats,s=n.end-n.first;Ye(s)&&(this.lastLevelLoadSec=s/1e3),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:r}){const n=r?r.stats:t.stats;if(t.type===Xe.MAIN&&this.bwEstimator.sampleTTFB(n.loading.first-n.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const s=r?r.duration:t.duration,a=this.hls.levels[t.level],u=(a.loaded?a.loaded.bytes:0)+n.loaded,f=(a.loaded?a.loaded.duration:0)+s;a.loaded={bytes:u,duration:f},a.realBitrate=Math.round(8*u/f)}if(t.bitrateTest){const s={stats:n,frag:t,part:r,id:t.type};this.onFragBuffered(M.FRAG_BUFFERED,s),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:r,part:n}=t,s=n!=null&&n.stats.loaded?n.stats:r.stats;if(s.aborted||this.ignoreFragment(r))return;const a=s.parsing.end-s.loading.start-Math.min(s.loading.first-s.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,s.loaded),s.bwEstimate=this.getBwEstimate(),r.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==Xe.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,r=this.getBwEstimate(),n=this.hls.config.maxStarvationDelay,s=this.findBestLevel(r,t,e,0,n,1,1);if(s>-1)return s;const a=this.hls.firstLevel,u=Math.min(Math.max(a,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${a} clamped to ${u}`),u}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,r=this.bwEstimator.canEstimate(),n=this.lastLoadedFragLevel>-1;if(e!==-1&&(!r||!n||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const s=r&&n?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const a=this.hls.levels;if(a.length>Math.max(e,s)&&a[e].loadError<=a[s].loadError)return e}return this._nextAutoLevel=s,this.nextAutoLevelKey=this.getAutoLevelKey(),s}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:r}=this;if(r.levels.length<=1)return r.loadLevel;const{maxAutoLevel:n,config:s,minAutoLevel:a}=r,u=t?t.duration:e?e.duration:0,f=this.getBwEstimate(),c=this.getStarvationDelay();let d=s.abrBandWidthFactor,p=s.abrBandWidthUpFactor;if(c){const E=this.findBestLevel(f,a,n,c,0,d,p);if(E>=0)return this.rebufferNotice=-1,E}let m=u?Math.min(u,s.maxStarvationDelay):s.maxStarvationDelay;if(!c){const E=this.bitrateTestDelay;E&&(m=(u?Math.min(u,s.maxLoadingDelay):s.maxLoadingDelay)-E,this.info(`bitrate test took ${Math.round(1e3*E)}ms, set first fragment max fetchDuration to ${Math.round(1e3*m)} ms`),d=p=1)}const v=this.findBestLevel(f,a,n,c,m,d,p);if(this.rebufferNotice!==v&&(this.rebufferNotice=v,this.info(`${c?"rebuffering expected":"buffer is empty"}, optimal quality level ${v}`)),v>-1)return v;const y=r.levels[a],b=r.loadLevelObj;return b&&y?.bitrate<b.bitrate?a:r.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const r=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,n=e.mainForwardBufferInfo;return(n?n.len:0)/r}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,r,n,s,a,u){var f;const c=n+s,d=this.lastLoadedFragLevel,p=d===-1?this.hls.firstLevel:d,{fragCurrent:m,partCurrent:v}=this,{levels:y,allAudioTracks:b,loadLevel:E,config:x}=this.hls;if(y.length===1)return 0;const T=y[p],A=!!((f=this.hls.latestLevelDetails)!=null&&f.live),L=E===-1||d===-1;let w,C="SDR",I=T?.frameRate||0;const{audioPreference:O,videoPreference:B}=x,P=this.audioTracksByGroup||(this.audioTracksByGroup=V_(b));let $=-1;if(L){if(this.firstSelection!==-1)return this.firstSelection;const H=this.codecTiers||(this.codecTiers=oO(y,P,t,r)),K=aO(H,C,e,O,B),{codecSet:z,videoRanges:ie,minFramerate:Y,minBitrate:U,minIndex:N,preferHDR:W}=K;$=N,w=z,C=W?ie[ie.length-1]:ie[0],I=Y,e=Math.max(e,U),this.log(`picked start tier ${kt(K)}`)}else w=T?.codecSet,C=T?.videoRange;const F=v?v.duration:m?m.duration:0,Z=this.bwEstimator.getEstimateTTFB()/1e3,X=[];for(let H=r;H>=t;H--){var q;const K=y[H],z=H>p;if(!K)continue;if(x.useMediaCapabilities&&!K.supportedResult&&!K.supportedPromise){const ne=navigator.mediaCapabilities;typeof ne?.decodingInfo=="function"&&QD(K,P,C,I,e,O)?(K.supportedPromise=H_(K,P,ne,this.supportedCache),K.supportedPromise.then(Ee=>{if(!this.hls)return;K.supportedResult=Ee;const se=this.hls.levels,J=se.indexOf(K);Ee.error?this.warn(`MediaCapabilities decodingInfo error: "${Ee.error}" for level ${J} ${kt(Ee)}`):Ee.supported?Ee.decodingInfoResults.some(me=>me.smooth===!1||me.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${J} not smooth or powerEfficient: ${kt(Ee)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${J} ${kt(Ee)}`),J>-1&&se.length>1&&(this.log(`Removing unsupported level ${J}`),this.hls.removeLevel(J),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(Ee=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${Ee}`)})):K.supportedResult=$_}if((w&&K.codecSet!==w||C&&K.videoRange!==C||z&&I>K.frameRate||!z&&I>0&&I<K.frameRate||(q=K.supportedResult)!=null&&(q=q.decodingInfoResults)!=null&&q.some(ne=>ne.smooth===!1))&&(!L||H!==$)){X.push(H);continue}const ie=K.details,Y=(v?ie?.partTarget:ie?.averagetargetduration)||F;let U;z?U=u*e:U=a*e;const N=F&&n>=F*2&&s===0?K.averageBitrate:K.maxBitrate,W=this.getTimeToLoadFrag(Z,U,N*Y,ie===void 0);if(U>=N&&(H===d||K.loadError===0&&K.fragmentError===0)&&(W<=Z||!Ye(W)||A&&!this.bitrateTestDelay||W<c)){const ne=this.forcedAutoLevel;return H!==E&&(ne===-1||ne!==E)&&(X.length&&this.trace(`Skipped level(s) ${X.join(",")} of ${r} max with CODECS and VIDEO-RANGE:"${y[X[0]].codecs}" ${y[X[0]].videoRange}; not compatible with "${w}" ${C}`),this.info(`switch candidate:${p}->${H} adjustedbw(${Math.round(U)})-bitrate=${Math.round(U-N)} ttfb:${Z.toFixed(1)} avgDuration:${Y.toFixed(1)} maxFetchDuration:${c.toFixed(1)} fetchDuration:${W.toFixed(1)} firstSelection:${L} codecSet:${K.codecSet} videoRange:${K.videoRange} hls.loadLevel:${E}`)),L&&(this.firstSelection=H),H}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:r}=this.hls;return Math.min(Math.max(e,r),t)}}const z_={search:function(l,e){let t=0,r=l.length-1,n=null,s=null;for(;t<=r;){n=(t+r)/2|0,s=l[n];const a=e(s);if(a>0)t=n+1;else if(a<0)r=n-1;else return s}return null}};function hO(l,e,t){if(e===null||!Array.isArray(l)||!l.length||!Ye(e))return null;const r=l[0].programDateTime;if(e<(r||0))return null;const n=l[l.length-1].endProgramDateTime;if(e>=(n||0))return null;for(let s=0;s<l.length;++s){const a=l[s];if(pO(e,t,a))return a}return null}function Ns(l,e,t=0,r=0,n=.005){let s=null;if(l){s=e[1+l.sn-e[0].sn]||null;const u=l.endDTS-t;u>0&&u<15e-7&&(t+=15e-7),s&&l.level!==s.level&&s.end<=l.end&&(s=e[2+l.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(s=e[0]);if(s&&((!l||l.level===s.level)&&RS(t,r,s)===0||dO(s,l,Math.min(n,r))))return s;const a=z_.search(e,RS.bind(null,t,r));return a&&(a!==l||!s)?a:s}function dO(l,e,t){if(e&&e.start===0&&e.level<l.level&&(e.endPTS||0)>0){const r=e.tagList.reduce((n,s)=>(s[0]==="INF"&&(n+=parseFloat(s[1])),n),t);return l.start<=r}return!1}function RS(l=0,e=0,t){if(t.start<=l&&t.start+t.duration>l)return 0;const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-r<=l?1:t.start-r>l&&t.start?-1:0}function pO(l,e,t){const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-r>l}function q_(l,e,t){if(l&&l.startCC<=e&&l.endCC>=e){let r=l.fragments;const{fragmentHint:n}=l;n&&(r=r.concat(n));let s;return z_.search(r,a=>a.cc<e?1:a.cc>e?-1:(s=a,a.end<=t?1:a.start>t?-1:0)),s||null}return null}function Dc(l){switch(l.details){case Se.FRAG_LOAD_TIMEOUT:case Se.KEY_LOAD_TIMEOUT:case Se.LEVEL_LOAD_TIMEOUT:case Se.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Y_(l){return l.details.startsWith("key")}function W_(l){return Y_(l)&&!!l.frag&&!l.frag.decryptdata}function IS(l,e){const t=Dc(e);return l.default[`${t?"timeout":"error"}Retry`]}function km(l,e){const t=l.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*l.retryDelayMs,l.maxRetryDelayMs)}function LS(l){return _t(_t({},l),{errorRetry:null,timeoutRetry:null})}function Oc(l,e,t,r){if(!l)return!1;const n=r?.code,s=e<l.maxNumRetry&&(gO(n)||!!t);return l.shouldRetry?l.shouldRetry(l,e,t,r,s):s}function gO(l){return zg(l)||!!l&&(l<400||l>499)}function zg(l){return l===0&&navigator.onLine===!1}var yr={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},ti={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class mO extends vi{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(M.ERROR,this.onError,this),e.on(M.MANIFEST_LOADING,this.onManifestLoading,this),e.on(M.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(M.ERROR,this.onError,this),e.off(M.ERROR,this.onErrorOut,this),e.off(M.MANIFEST_LOADING,this.onManifestLoading,this),e.off(M.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return e?.type===Xe.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,r=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||r===-1?t.loadLevel:r}variantHasKey(e,t){if(e){var r;if((r=e.details)!=null&&r.hasKey(t))return!0;const n=e.audioGroups;if(n)return this.hls.allAudioTracks.filter(a=>n.indexOf(a.groupId)>=0).some(a=>{var u;return(u=a.details)==null?void 0:u.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var r;if(t.fatal)return;const n=this.hls,s=t.context;switch(t.details){case Se.FRAG_LOAD_ERROR:case Se.FRAG_LOAD_TIMEOUT:case Se.KEY_LOAD_ERROR:case Se.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case Se.FRAG_PARSING_ERROR:if((r=t.frag)!=null&&r.gap){t.errorAction=Na();return}case Se.FRAG_GAP:case Se.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=yr.SendAlternateToPenaltyBox;return}case Se.LEVEL_EMPTY_ERROR:case Se.LEVEL_PARSING_ERROR:{var a;const f=t.parent===Xe.MAIN?t.level:n.loadLevel;t.details===Se.LEVEL_EMPTY_ERROR&&((a=t.context)!=null&&(a=a.levelDetails)!=null&&a.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,f):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,f))}return;case Se.LEVEL_LOAD_ERROR:case Se.LEVEL_LOAD_TIMEOUT:typeof s?.level=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.level));return;case Se.AUDIO_TRACK_LOAD_ERROR:case Se.AUDIO_TRACK_LOAD_TIMEOUT:case Se.SUBTITLE_LOAD_ERROR:case Se.SUBTITLE_TRACK_LOAD_TIMEOUT:if(s){const f=n.loadLevelObj;if(f&&(s.type===dt.AUDIO_TRACK&&f.hasAudioGroup(s.groupId)||s.type===dt.SUBTITLE_TRACK&&f.hasSubtitleGroup(s.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,n.loadLevel),t.errorAction.action=yr.SendAlternateToPenaltyBox,t.errorAction.flags=ti.MoveAllAlternatesMatchingHost;return}}return;case Se.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:yr.SendAlternateToPenaltyBox,flags:ti.MoveAllAlternatesMatchingHDCP};return;case Se.KEY_SYSTEM_SESSION_UPDATE_FAILED:case Se.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case Se.KEY_SYSTEM_NO_SESSION:t.errorAction={action:yr.SendAlternateToPenaltyBox,flags:ti.MoveAllAlternatesMatchingKey};return;case Se.BUFFER_ADD_CODEC_ERROR:case Se.REMUX_ALLOC_ERROR:case Se.BUFFER_APPEND_ERROR:if(!t.errorAction){var u;t.errorAction=this.getLevelSwitchAction(t,(u=t.level)!=null?u:n.loadLevel)}return;case Se.INTERNAL_EXCEPTION:case Se.BUFFER_APPENDING_ERROR:case Se.BUFFER_FULL_ERROR:case Se.LEVEL_SWITCH_ERROR:case Se.BUFFER_STALLED_ERROR:case Se.BUFFER_SEEK_OVER_HOLE:case Se.BUFFER_NUDGE_ON_STALL:t.errorAction=Na();return}t.type===tt.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=Na())}getPlaylistRetryOrSwitchAction(e,t){const r=this.hls,n=IS(r.config.playlistLoadPolicy,e),s=this.playlistError++;if(Oc(n,s,Dc(e),e.response))return{action:yr.RetryRequest,flags:ti.None,retryConfig:n,retryCount:s};const u=this.getLevelSwitchAction(e,t);return n&&(u.retryConfig=n,u.retryCount=s),u}getFragRetryOrSwitchAction(e){const t=this.hls,r=this.getVariantLevelIndex(e.frag),n=t.levels[r],{fragLoadPolicy:s,keyLoadPolicy:a}=t.config,u=IS(Y_(e)?a:s,e),f=t.levels.reduce((d,p)=>d+p.fragmentError,0);if(n&&(e.details!==Se.FRAG_GAP&&n.fragmentError++,!W_(e)&&Oc(u,f,Dc(e),e.response)))return{action:yr.RetryRequest,flags:ti.None,retryConfig:u,retryCount:f};const c=this.getLevelSwitchAction(e,r);return u&&(c.retryConfig=u,c.retryCount=f),c}getLevelSwitchAction(e,t){const r=this.hls;t==null&&(t=r.loadLevel);const n=this.hls.levels[t];if(n){var s,a;const c=e.details;n.loadError++,c===Se.BUFFER_APPEND_ERROR&&n.fragmentError++;let d=-1;const{levels:p,loadLevel:m,minAutoLevel:v,maxAutoLevel:y}=r;!r.autoLevelEnabled&&!r.config.preserveManualLevelOnError&&(r.loadLevel=-1);const b=(s=e.frag)==null?void 0:s.type,x=(b===Xe.AUDIO&&c===Se.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(c===Se.BUFFER_ADD_CODEC_ERROR||c===Se.BUFFER_APPEND_ERROR))&&p.some(({audioCodec:C})=>n.audioCodec!==C),A=e.sourceBufferName==="video"&&(c===Se.BUFFER_ADD_CODEC_ERROR||c===Se.BUFFER_APPEND_ERROR)&&p.some(({codecSet:C,audioCodec:I})=>n.codecSet!==C&&n.audioCodec===I),{type:L,groupId:w}=(a=e.context)!=null?a:{};for(let C=p.length;C--;){const I=(C+m)%p.length;if(I!==m&&I>=v&&I<=y&&p[I].loadError===0){var u,f;const O=p[I];if(c===Se.FRAG_GAP&&b===Xe.MAIN&&e.frag){const B=p[I].details;if(B){const P=Ns(e.frag,B.fragments,e.frag.start);if(P!=null&&P.gap)continue}}else{if(L===dt.AUDIO_TRACK&&O.hasAudioGroup(w)||L===dt.SUBTITLE_TRACK&&O.hasSubtitleGroup(w))continue;if(b===Xe.AUDIO&&(u=n.audioGroups)!=null&&u.some(B=>O.hasAudioGroup(B))||b===Xe.SUBTITLE&&(f=n.subtitleGroups)!=null&&f.some(B=>O.hasSubtitleGroup(B))||x&&n.audioCodec===O.audioCodec||A&&n.codecSet===O.codecSet||!x&&n.codecSet!==O.codecSet)continue}d=I;break}}if(d>-1&&r.loadLevel!==d)return e.levelRetry=!0,this.playlistError=0,{action:yr.SendAlternateToPenaltyBox,flags:ti.None,nextAutoLevel:d}}return{action:yr.SendAlternateToPenaltyBox,flags:ti.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var r;switch((r=t.errorAction)==null?void 0:r.action){case yr.DoNothing:break;case yr.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==Se.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,r=e.errorAction;if(!r)return;const{flags:n}=r,s=r.nextAutoLevel;switch(n){case ti.None:this.switchLevel(e,s);break;case ti.MoveAllAlternatesMatchingHDCP:{const f=this.getVariantLevelIndex(e.frag),c=t.levels[f],d=c?.attrs["HDCP-LEVEL"];if(r.hdcpLevel=d,d==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(d){t.maxHdcpLevel=Vg[Vg.indexOf(d)-1],r.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case ti.MoveAllAlternatesMatchingKey:{const f=e.decryptdata;if(f){const c=this.hls.levels,d=c.length;for(let m=d;m--;)if(this.variantHasKey(c[m],f)){var a,u;this.log(`Banned key found in level ${m} (${c[m].bitrate}bps) or audio group "${(a=c[m].audioGroups)==null?void 0:a.join(",")}" (${(u=e.frag)==null?void 0:u.type} fragment) ${vr(f.keyId||[])}`),c[m].fragmentError++,c[m].loadError++,this.log(`Removing level ${m} with key error (${e.error})`),this.hls.removeLevel(m)}const p=e.frag;if(this.hls.levels.length<d)r.resolved=!0;else if(p&&p.type!==Xe.MAIN){const m=p.decryptdata;m&&!f.matches(m)&&(r.resolved=!0)}}break}}r.resolved||this.switchLevel(e,s)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===Se.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const r=Kg(e.mimeType),n=this.hls.levels;for(let s=n.length;s--;)n[s][`${e.sourceBufferName}Codec`]===r&&(this.log(`Removing level ${s} for ${e.details} ("${r}" not supported)`),this.hls.removeLevel(s))}}}function Na(l){const e={action:yr.DoNothing,flags:ti.None};return l&&(e.resolved=!0),e}var or={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class yO{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(M.MANIFEST_LOADING,this.onManifestLoading,this),e.on(M.BUFFER_APPENDED,this.onBufferAppended,this),e.on(M.FRAG_BUFFERED,this.onFragBuffered,this),e.on(M.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(M.MANIFEST_LOADING,this.onManifestLoading,this),e.off(M.BUFFER_APPENDED,this.onBufferAppended,this),e.off(M.FRAG_BUFFERED,this.onFragBuffered,this),e.off(M.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const r=this.activePartLists[t];if(r)for(let n=r.length;n--;){const s=r[n];if(!s)break;if(s.start<=e&&e<=s.end&&s.loaded)return s}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,r){const{fragments:n}=this,s=Object.keys(n);for(let a=s.length;a--;){const u=n[s[a]];if(u?.body.type===t&&(!r||u.buffered)){const f=u.body;if(f.start<=e&&e<=f.end)return f}}return null}detectEvictedFragments(e,t,r,n,s){this.timeRanges&&(this.timeRanges[e]=t);const a=n?.fragment.sn||-1;Object.keys(this.fragments).forEach(u=>{const f=this.fragments[u];if(!f||a>=f.body.sn)return;if(!f.buffered&&(!f.loaded||s)){f.body.type===r&&this.removeFragment(f.body);return}const c=f.range[e];if(c){if(c.time.length===0){this.removeFragment(f.body);return}c.time.some(d=>{const p=!this.isTimeBuffered(d.startPTS,d.endPTS,t);return p&&this.removeFragment(f.body),p})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const r=e.frag,n=wa(r),s=this.fragments[n];if(!s||s.buffered&&r.gap)return;const a=!r.relurl;Object.keys(t).forEach(u=>{const f=r.elementaryStreams[u];if(!f)return;const c=t[u],d=a||f.partial===!0;s.range[u]=this.getBufferedTimes(r,e.part,d,c)}),s.loaded=null,Object.keys(s.range).length?(this.bufferedEnd(s,r),Iu(s)||this.removeParts(r.sn-1,r.type)):this.removeFragment(s.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const r=this.activePartLists[t];r&&(this.activePartLists[t]=CS(r,n=>n.fragment.sn>=e))}fragBuffered(e,t){const r=wa(e);let n=this.fragments[r];!n&&t&&(n=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),n&&(n.loaded=null,this.bufferedEnd(n,e))}getBufferedTimes(e,t,r,n){const s={time:[],partial:r},a=e.start,u=e.end,f=e.minEndPTS||u,c=e.maxStartPTS||a;for(let d=0;d<n.length;d++){const p=n.start(d)-this.bufferPadding,m=n.end(d)+this.bufferPadding;if(c>=p&&f<=m){s.time.push({startPTS:Math.max(a,n.start(d)),endPTS:Math.min(u,n.end(d))});break}else if(a<m&&u>p){const v=Math.max(a,n.start(d)),y=Math.min(u,n.end(d));y>v&&(s.partial=!0,s.time.push({startPTS:v,endPTS:y}))}else if(u<=p)break}return s}getPartialFragment(e){let t=null,r,n,s,a=0;const{bufferPadding:u,fragments:f}=this;return Object.keys(f).forEach(c=>{const d=f[c];d&&Iu(d)&&(n=d.body.start-u,s=d.body.end+u,e>=n&&e<=s&&(r=Math.min(e-n,s-e),a<=r&&(t=d.body,a=r)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||Iu(t))}getState(e){const t=wa(e),r=this.fragments[t];return r?r.buffered?Iu(r)?or.PARTIAL:or.OK:or.APPENDING:or.NOT_LOADED}isTimeBuffered(e,t,r){let n,s;for(let a=0;a<r.length;a++){if(n=r.start(a)-this.bufferPadding,s=r.end(a)+this.bufferPadding,e>=n&&t<=s)return!0;if(t<=n)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const r=t.frag,n=t.part?null:t,s=wa(r);this.fragments[s]={body:r,appendedPTS:null,loaded:n,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:r,part:n,timeRanges:s,type:a}=t;if(r.sn==="initSegment")return;const u=r.type;if(n){let c=this.activePartLists[u];c||(this.activePartLists[u]=c=[]),c.push(n)}this.timeRanges=s;const f=s[a];this.detectEvictedFragments(a,f,u,n)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=wa(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,r=Object.keys(t);if(!e)return r.length>0;for(let n=r.length;n--;){const s=t[r[n]];if(s?.body.type===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,r,n,s){n&&!this.hasGaps||Object.keys(this.fragments).forEach(a=>{const u=this.fragments[a];if(!u)return;const f=u.body;f.type!==r||n&&!f.gap||f.start<t&&f.end>e&&(u.buffered||s)&&this.removeFragment(f)})}removeFragment(e){const t=wa(e);e.clearElementaryStreamInfo();const r=this.activePartLists[e.type];if(r){const n=e.sn;this.activePartLists[e.type]=CS(r,s=>s.fragment.sn!==n)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(r=>r.clearElementaryStreamInfo())}}function Iu(l){var e,t,r;return l.buffered&&!!(l.body.gap||(e=l.range.video)!=null&&e.partial||(t=l.range.audio)!=null&&t.partial||(r=l.range.audiovideo)!=null&&r.partial)}function wa(l){return`${l.type}_${l.level}_${l.sn}`}function CS(l,e){return l.filter(t=>{const r=e(t);return r||t.clearElementaryStreamInfo(),r})}var os={cbc:0,ctr:1};class vO{constructor(e,t,r){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=r}decrypt(e,t){switch(this.aesMode){case os.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case os.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function bO(l){const e=l.byteLength,t=e&&new DataView(l.buffer).getUint8(e-1);return t?l.slice(0,e-t):l}class EO{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),r=new Uint32Array(4);for(let n=0;n<4;n++)r[n]=t.getUint32(n*4);return r}initTable(){const e=this.sBox,t=this.invSBox,r=this.subMix,n=r[0],s=r[1],a=r[2],u=r[3],f=this.invSubMix,c=f[0],d=f[1],p=f[2],m=f[3],v=new Uint32Array(256);let y=0,b=0,E=0;for(E=0;E<256;E++)E<128?v[E]=E<<1:v[E]=E<<1^283;for(E=0;E<256;E++){let x=b^b<<1^b<<2^b<<3^b<<4;x=x>>>8^x&255^99,e[y]=x,t[x]=y;const T=v[y],A=v[T],L=v[A];let w=v[x]*257^x*16843008;n[y]=w<<24|w>>>8,s[y]=w<<16|w>>>16,a[y]=w<<8|w>>>24,u[y]=w,w=L*16843009^A*65537^T*257^y*16843008,c[x]=w<<24|w>>>8,d[x]=w<<16|w>>>16,p[x]=w<<8|w>>>24,m[x]=w,y?(y=T^v[v[v[L^T]]],b^=v[v[b]]):y=b=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let r=!0,n=0;for(;n<t.length&&r;)r=t[n]===this.key[n],n++;if(r)return;this.key=t;const s=this.keySize=t.length;if(s!==4&&s!==6&&s!==8)throw new Error("Invalid aes key size="+s);const a=this.ksRows=(s+6+1)*4;let u,f;const c=this.keySchedule=new Uint32Array(a),d=this.invKeySchedule=new Uint32Array(a),p=this.sBox,m=this.rcon,v=this.invSubMix,y=v[0],b=v[1],E=v[2],x=v[3];let T,A;for(u=0;u<a;u++){if(u<s){T=c[u]=t[u];continue}A=T,u%s===0?(A=A<<8|A>>>24,A=p[A>>>24]<<24|p[A>>>16&255]<<16|p[A>>>8&255]<<8|p[A&255],A^=m[u/s|0]<<24):s>6&&u%s===4&&(A=p[A>>>24]<<24|p[A>>>16&255]<<16|p[A>>>8&255]<<8|p[A&255]),c[u]=T=(c[u-s]^A)>>>0}for(f=0;f<a;f++)u=a-f,f&3?A=c[u]:A=c[u-4],f<4||u<=4?d[f]=A:d[f]=y[p[A>>>24]]^b[p[A>>>16&255]]^E[p[A>>>8&255]]^x[p[A&255]],d[f]=d[f]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,r){const n=this.keySize+6,s=this.invKeySchedule,a=this.invSBox,u=this.invSubMix,f=u[0],c=u[1],d=u[2],p=u[3],m=this.uint8ArrayToUint32Array_(r);let v=m[0],y=m[1],b=m[2],E=m[3];const x=new Int32Array(e),T=new Int32Array(x.length);let A,L,w,C,I,O,B,P,$,F,Z,X,q,H;const K=this.networkToHostOrderSwap;for(;t<x.length;){for($=K(x[t]),F=K(x[t+1]),Z=K(x[t+2]),X=K(x[t+3]),I=$^s[0],O=X^s[1],B=Z^s[2],P=F^s[3],q=4,H=1;H<n;H++)A=f[I>>>24]^c[O>>16&255]^d[B>>8&255]^p[P&255]^s[q],L=f[O>>>24]^c[B>>16&255]^d[P>>8&255]^p[I&255]^s[q+1],w=f[B>>>24]^c[P>>16&255]^d[I>>8&255]^p[O&255]^s[q+2],C=f[P>>>24]^c[I>>16&255]^d[O>>8&255]^p[B&255]^s[q+3],I=A,O=L,B=w,P=C,q=q+4;A=a[I>>>24]<<24^a[O>>16&255]<<16^a[B>>8&255]<<8^a[P&255]^s[q],L=a[O>>>24]<<24^a[B>>16&255]<<16^a[P>>8&255]<<8^a[I&255]^s[q+1],w=a[B>>>24]<<24^a[P>>16&255]<<16^a[I>>8&255]<<8^a[O&255]^s[q+2],C=a[P>>>24]<<24^a[I>>16&255]<<16^a[O>>8&255]<<8^a[B&255]^s[q+3],T[t]=K(A^v),T[t+1]=K(C^y),T[t+2]=K(w^b),T[t+3]=K(L^E),v=$,y=F,b=Z,E=X,t=t+4}return T.buffer}}class SO{constructor(e,t,r){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=r}expandKey(){const e=TO(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function TO(l){switch(l){case os.cbc:return"AES-CBC";case os.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${l}`)}}const xO=16;class Mm{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const r=self.crypto;r&&(this.subtle=r.subtle||r.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const r=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?bO(r):r}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,r,n){return this.useSoftware?new Promise((s,a)=>{const u=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(u,t,r,n);const f=this.flush();f?s(f.buffer):a(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,r,n)}softwareDecrypt(e,t,r,n){const{currentIV:s,currentResult:a,remainderData:u}=this;if(n!==os.cbc||t.byteLength!==16)return At.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),u&&(e=yi(u,e),this.remainderData=null);const f=this.getValidChunk(e);if(!f.length)return null;s&&(r=s);let c=this.softwareDecrypter;c||(c=this.softwareDecrypter=new EO),c.expandKey(t);const d=a;return this.currentResult=c.decrypt(f.buffer,0,r),this.currentIV=f.slice(-16).buffer,d||null}webCryptoDecrypt(e,t,r,n){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,r,n));this.key=t,this.fastAesKey=new SO(this.subtle,t,n)}return this.fastAesKey.expandKey().then(s=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new vO(this.subtle,new Uint8Array(r),n).decrypt(e.buffer,s)):Promise.reject(new Error("web crypto not initialized"))).catch(s=>(At.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${s.name}: ${s.message}`),this.onWebCryptoError(e,t,r,n)))}onWebCryptoError(e,t,r,n){const s=this.enableSoftwareAES;if(s){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r,n);const a=this.flush();if(a)return a.buffer}throw new Error("WebCrypto"+(s?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const r=e.length-e.length%xO;return r!==e.length&&(t=e.slice(0,r),this.remainderData=e.slice(r)),t}logOnce(e){this.logEnabled&&(At.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const DS=Math.pow(2,17);class _O{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const r=e.url;if(!r)return Promise.reject(new pn({type:tt.NETWORK_ERROR,details:Se.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${r?"part list":"url"}`),networkDetails:null}));this.abort();const n=this.config,s=n.fLoader,a=n.loader;return new Promise((u,f)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(y=>y[0]==="GAP")){f(kS(e));return}else e.gap=!1;const c=this.loader=s?new s(n):new a(n),d=OS(e);e.loader=c;const p=LS(n.fragLoadPolicy.default),m={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:DS};e.stats=c.stats;const v={onSuccess:(y,b,E,x)=>{this.resetLoader(e,c);let T=y.data;E.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(T.slice(0,16)),T=T.slice(16)),u({frag:e,part:null,payload:T,networkDetails:x})},onError:(y,b,E,x)=>{this.resetLoader(e,c),f(new pn({type:tt.NETWORK_ERROR,details:Se.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:_t({url:r,data:void 0},y),error:new Error(`HTTP Error ${y.code} ${y.text}`),networkDetails:E,stats:x}))},onAbort:(y,b,E)=>{this.resetLoader(e,c),f(new pn({type:tt.NETWORK_ERROR,details:Se.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:E,stats:y}))},onTimeout:(y,b,E)=>{this.resetLoader(e,c),f(new pn({type:tt.NETWORK_ERROR,details:Se.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${m.timeout}ms`),networkDetails:E,stats:y}))}};t&&(v.onProgress=(y,b,E,x)=>t({frag:e,part:null,payload:E,networkDetails:x})),c.load(d,m,v)})}loadPart(e,t,r){this.abort();const n=this.config,s=n.fLoader,a=n.loader;return new Promise((u,f)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){f(kS(e,t));return}const c=this.loader=s?new s(n):new a(n),d=OS(e,t);e.loader=c;const p=LS(n.fragLoadPolicy.default),m={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:DS};t.stats=c.stats,c.load(d,m,{onSuccess:(v,y,b,E)=>{this.resetLoader(e,c),this.updateStatsFromPart(e,t);const x={frag:e,part:t,payload:v.data,networkDetails:E};r(x),u(x)},onError:(v,y,b,E)=>{this.resetLoader(e,c),f(new pn({type:tt.NETWORK_ERROR,details:Se.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:_t({url:d.url,data:void 0},v),error:new Error(`HTTP Error ${v.code} ${v.text}`),networkDetails:b,stats:E}))},onAbort:(v,y,b)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,c),f(new pn({type:tt.NETWORK_ERROR,details:Se.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:b,stats:v}))},onTimeout:(v,y,b)=>{this.resetLoader(e,c),f(new pn({type:tt.NETWORK_ERROR,details:Se.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${m.timeout}ms`),networkDetails:b,stats:v}))}})})}updateStatsFromPart(e,t){const r=e.stats,n=t.stats,s=n.total;if(r.loaded+=n.loaded,s){const f=Math.round(e.duration/t.duration),c=Math.min(Math.round(r.loaded/s),f),p=(f-c)*Math.round(r.loaded/c);r.total=r.loaded+p}else r.total=Math.max(r.loaded,r.total);const a=r.loading,u=n.loading;a.start?a.first+=u.first-u.start:(a.start=u.start,a.first=u.first),a.end=u.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function OS(l,e=null){const t=e||l,r={frag:l,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},n=t.byteRangeStartOffset,s=t.byteRangeEndOffset;if(Ye(n)&&Ye(s)){var a;let u=n,f=s;if(l.sn==="initSegment"&&AO((a=l.decryptdata)==null?void 0:a.method)){const c=s-n;c%16&&(f=s+(16-c%16)),n!==0&&(r.resetIV=!0,u=n-16)}r.rangeStart=u,r.rangeEnd=f}return r}function kS(l,e){const t=new Error(`GAP ${l.gap?"tag":"attribute"} found`),r={type:tt.MEDIA_ERROR,details:Se.FRAG_GAP,fatal:!1,frag:l,error:t,networkDetails:null};return e&&(r.part=e),(e||l).stats.aborted=!0,new pn(r)}function AO(l){return l==="AES-128"||l==="AES-256"}class pn extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class Q_ extends vi{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Pm{constructor(e,t,r,n=0,s=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Lu(),this.buffering={audio:Lu(),video:Lu(),audiovideo:Lu()},this.level=e,this.sn=t,this.id=r,this.size=n,this.part=s,this.partial=a}}function Lu(){return{start:0,executeStart:0,executeEnd:0,end:0}}const MS={length:0,start:()=>0,end:()=>0};class ot{static isBuffered(e,t){if(e){const r=ot.getBuffered(e);for(let n=r.length;n--;)if(t>=r.start(n)&&t<=r.end(n))return!0}return!1}static bufferedRanges(e){if(e){const t=ot.getBuffered(e);return ot.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let r=0;r<e.length;r++)t.push({start:e.start(r),end:e.end(r)});return t}static bufferInfo(e,t,r){if(e){const n=ot.bufferedRanges(e);if(n.length)return ot.bufferedInfo(n,t,r)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,r){t=Math.max(0,t),e.length>1&&e.sort((d,p)=>d.start-p.start||p.end-d.end);let n=-1,s=[];if(r)for(let d=0;d<e.length;d++){t>=e[d].start&&t<=e[d].end&&(n=d);const p=s.length;if(p){const m=s[p-1].end;e[d].start-m<r?e[d].end>m&&(s[p-1].end=e[d].end):s.push(e[d])}else s.push(e[d])}else s=e;let a=0,u,f=t,c=t;for(let d=0;d<s.length;d++){const p=s[d].start,m=s[d].end;if(n===-1&&t>=p&&t<=m&&(n=d),t+r>=p&&t<m)f=p,c=m,a=c-t;else if(t+r<p){u=p;break}}return{len:a,start:f||0,end:c||0,nextStart:u,buffered:e,bufferedIndex:n}}static getBuffered(e){try{return e.buffered||MS}catch(t){return At.log("failed to get media.buffered",t),MS}}}const X_=/\{\$([a-zA-Z0-9-_]+)\}/g;function PS(l){return X_.test(l)}function qg(l,e){if(l.variableList!==null||l.hasVariableRefs){const t=l.variableList;return e.replace(X_,r=>{const n=r.substring(2,r.length-1),s=t?.[n];return s===void 0?(l.playlistParsingError||(l.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${n}"`)),r):s})}return e}function NS(l,e,t){let r=l.variableList;r||(l.variableList=r={});let n,s;if("QUERYPARAM"in e){n=e.QUERYPARAM;try{const a=new self.URL(t).searchParams;if(a.has(n))s=a.get(n);else throw new Error(`"${n}" does not match any query parameter in URI: "${t}"`)}catch(a){l.playlistParsingError||(l.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${a.message}`))}}else n=e.NAME,s=e.VALUE;n in r?l.playlistParsingError||(l.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${n}"`)):r[n]=s||""}function wO(l,e,t){const r=e.IMPORT;if(t&&r in t){let n=l.variableList;n||(l.variableList=n={}),n[r]=t[r]}else l.playlistParsingError||(l.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${r}"`))}const RO=/^(\d+)x(\d+)$/,US=/(.+?)=(".*?"|.*?)(?:,|$)/g;class $t{constructor(e,t){typeof e=="string"&&(e=$t.parseAttrList(e,t)),Lt(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const r=new Uint8Array(t.length/2);for(let n=0;n<t.length/2;n++)r[n]=parseInt(t.slice(n*2,n*2+2),16);return r}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const r=this[e];return r?parseFloat(r):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const r=this[e];return(r?r.split(/[ ,]+/):[]).reduce((n,s)=>(n[s.toLowerCase()]=!0,n),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=RO.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let r;const n={};for(US.lastIndex=0;(r=US.exec(e))!==null;){const a=r[1].trim();let u=r[2];const f=u.indexOf('"')===0&&u.lastIndexOf('"')===u.length-1;let c=!1;if(f)u=u.slice(1,-1);else switch(a){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":c=!0}if(t&&(f||c))u=qg(t,u);else if(!c&&!f)switch(a){case"CLOSED-CAPTIONS":if(u==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":At.warn(`${e}: attribute ${a} is missing quotes`)}n[a]=u}return n}}const IO="com.apple.hls.interstitial";function LO(l){return l!=="ID"&&l!=="CLASS"&&l!=="CUE"&&l!=="START-DATE"&&l!=="DURATION"&&l!=="END-DATE"&&l!=="END-ON-NEXT"}function CO(l){return l==="SCTE35-OUT"||l==="SCTE35-IN"||l==="SCTE35-CMD"}class Z_{constructor(e,t,r=0){var n;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=t?.tagAnchor||null,this.tagOrder=(n=t?.tagOrder)!=null?n:r,t){const s=t.attr;for(const a in s)if(Object.prototype.hasOwnProperty.call(e,a)&&e[a]!==s[a]){At.warn(`DATERANGE tag attribute: "${a}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=a;break}e=Lt(new $t({}),s,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const s=t?.endDate||new Date(this.attr["END-DATE"]);Ye(s.getTime())&&(this._endDate=s)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(At.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(Ye(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===IO}get isValid(){return!!this.id&&!this._badValueForSameId&&Ye(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const DO=10;class OO{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&r>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let r=t.decryptdata;return r||(t.setKeyFormat(e.keyFormat),r=t.decryptdata),!!r&&e.matches(r)})}get hasProgramDateTime(){return this.fragments.length?Ye(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||DO}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let r=e.length;r--;)if(e[r].index>t)return e[r].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function kc(l,e){return l.length===e.length?!l.some((t,r)=>t!==e[r]):!1}function BS(l,e){return!l&&!e?!0:!l||!e?!1:kc(l,e)}function Ua(l){return l==="AES-128"||l==="AES-256"||l==="AES-256-CTR"}function Nm(l){switch(l){case"AES-128":case"AES-256":return os.cbc;case"AES-256-CTR":return os.ctr;default:throw new Error(`invalid full segment method ${l}`)}}function Um(l){return Uint8Array.from(atob(l),e=>e.charCodeAt(0))}function Yg(l){return Uint8Array.from(unescape(encodeURIComponent(l)),e=>e.charCodeAt(0))}function kO(l){const e=Yg(l).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function J_(l){const e=function(r,n,s){const a=r[n];r[n]=r[s],r[s]=a};e(l,0,3),e(l,1,2),e(l,4,5),e(l,6,7)}function eA(l){const e=l.split(":");let t=null;if(e[0]==="data"&&e.length===2){const r=e[1].split(";"),n=r[r.length-1].split(",");if(n.length===2){const s=n[0]==="base64",a=n[1];s?(r.splice(-1,1),t=Um(a)):t=kO(a)}}return t}const Mc=typeof self<"u"?self:void 0;var Gt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},br={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function yc(l){switch(l){case br.FAIRPLAY:return Gt.FAIRPLAY;case br.PLAYREADY:return Gt.PLAYREADY;case br.WIDEVINE:return Gt.WIDEVINE;case br.CLEARKEY:return Gt.CLEARKEY}}function Sd(l){switch(l){case Gt.FAIRPLAY:return br.FAIRPLAY;case Gt.PLAYREADY:return br.PLAYREADY;case Gt.WIDEVINE:return br.WIDEVINE;case Gt.CLEARKEY:return br.CLEARKEY}}function Vo(l){const{drmSystems:e,widevineLicenseUrl:t}=l,r=e?[Gt.FAIRPLAY,Gt.WIDEVINE,Gt.PLAYREADY,Gt.CLEARKEY].filter(n=>!!e[n]):[];return!r[Gt.WIDEVINE]&&t&&r.push(Gt.WIDEVINE),r}const tA=(function(l){return Mc!=null&&(l=Mc.navigator)!=null&&l.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function MO(l,e,t,r){let n;switch(l){case Gt.FAIRPLAY:n=["cenc","sinf"];break;case Gt.WIDEVINE:case Gt.PLAYREADY:n=["cenc"];break;case Gt.CLEARKEY:n=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${l}`)}return PO(n,e,t,r)}function PO(l,e,t,r){return[{initDataTypes:l,persistentState:r.persistentState||"optional",distinctiveIdentifier:r.distinctiveIdentifier||"optional",sessionTypes:r.sessionTypes||[r.sessionType||"temporary"],audioCapabilities:e.map(s=>({contentType:`audio/mp4; codecs=${s}`,robustness:r.audioRobustness||"",encryptionScheme:r.audioEncryptionScheme||null})),videoCapabilities:t.map(s=>({contentType:`video/mp4; codecs=${s}`,robustness:r.videoRobustness||"",encryptionScheme:r.videoEncryptionScheme||null}))}]}function NO(l){var e;return!!l&&(l.sessionType==="persistent-license"||!!((e=l.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function rA(l){const e=new Uint16Array(l.buffer,l.byteOffset,l.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),r=t.substring(t.indexOf("<"),t.length),a=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("KID")[0];if(a){const u=a.childNodes[0]?a.childNodes[0].nodeValue:a.getAttribute("VALUE");if(u){const f=Um(u).subarray(0,16);return J_(f),f}}return null}let Ra={};class ss{static clearKeyUriToKeyIdMap(){Ra={}}static setKeyIdForUri(e,t){Ra[e]=t}static addKeyIdForUri(e){const t=Object.keys(Ra).length%Number.MAX_SAFE_INTEGER,r=new Uint8Array(16);return new DataView(r.buffer,12,4).setUint32(0,t),Ra[e]=r,r}constructor(e,t,r,n=[1],s=null,a){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=r,this.keyFormatVersions=n,this.iv=s,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!Ua(e),a!=null&&a.startsWith("0x")&&(this.keyId=new Uint8Array(C_(a)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&kc(e.keyFormatVersions,this.keyFormatVersions)&&BS(e.iv,this.iv)&&BS(e.keyId,this.keyId)}isSupported(){if(this.method){if(Ua(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case br.FAIRPLAY:case br.WIDEVINE:case br.PLAYREADY:case br.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(Ua(this.method)){let s=this.iv;return s||(typeof e!="number"&&(At.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),s=BO(e)),new ss(this.method,this.uri,"identity",this.keyFormatVersions,s)}if(this.keyId){const s=Ra[this.uri];if(s&&!kc(this.keyId,s)&&ss.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const r=eA(this.uri);if(r)switch(this.keyFormat){case br.WIDEVINE:if(this.pssh=r,!this.keyId){const s=$D(r.buffer);if(s.length){var n;const a=s[0];this.keyId=(n=a.kids)!=null&&n.length?a.kids[0]:null}}this.keyId||(this.keyId=FS(t));break;case br.PLAYREADY:{const s=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=jD(s,null,r),this.keyId=rA(r);break}default:{let s=r.subarray(0,16);if(s.length!==16){const a=new Uint8Array(16);a.set(s,16-s.length),s=a}this.keyId=s;break}}if(!this.keyId||this.keyId.byteLength!==16){let s;s=UO(t),s||(s=FS(t),s||(s=Ra[this.uri])),s&&(this.keyId=s,ss.setKeyIdForUri(this.uri,s))}return this}}function UO(l){const e=l?.[br.WIDEVINE];return e?e.keyId:null}function FS(l){const e=l?.[br.PLAYREADY];if(e){const t=eA(e.uri);if(t)return rA(t)}return null}function BO(l){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=l>>8*(15-t)&255;return e}const jS=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,$S=/#EXT-X-MEDIA:(.*)/g,FO=/^#EXT(?:INF|-X-TARGETDURATION):/m,Td=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),jO=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Bi{static findGroup(e,t){for(let r=0;r<e.length;r++){const n=e[r];if(n.id===t)return n}}static resolve(e,t){return Im.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return FO.test(e)}static parseMasterPlaylist(e,t){const r=PS(e),n={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:r},s=[];if(jS.lastIndex=0,!e.startsWith("#EXTM3U"))return n.playlistParsingError=new Error("no EXTM3U delimiter"),n;let a;for(;(a=jS.exec(e))!=null;)if(a[1]){var u;const c=new $t(a[1],n),d=qg(n,a[2]),p={attrs:c,bitrate:c.decimalInteger("BANDWIDTH")||c.decimalInteger("AVERAGE-BANDWIDTH"),name:c.NAME,url:Bi.resolve(d,t)},m=c.decimalResolution("RESOLUTION");m&&(p.width=m.width,p.height=m.height),KS(c.CODECS,p);const v=c["SUPPLEMENTAL-CODECS"];v&&(p.supplemental={},KS(v,p.supplemental)),(u=p.unknownCodecs)!=null&&u.length||s.push(p),n.levels.push(p)}else if(a[3]){const c=a[3],d=a[4];switch(c){case"SESSION-DATA":{const p=new $t(d,n),m=p["DATA-ID"];m&&(n.sessionData===null&&(n.sessionData={}),n.sessionData[m]=p);break}case"SESSION-KEY":{const p=GS(d,t,n);p.encrypted&&p.isSupported()?(n.sessionKeys===null&&(n.sessionKeys=[]),n.sessionKeys.push(p)):At.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${d}"`);break}case"DEFINE":{{const p=new $t(d,n);NS(n,p,t)}break}case"CONTENT-STEERING":{const p=new $t(d,n);n.contentSteering={uri:Bi.resolve(p["SERVER-URI"],t),pathwayId:p["PATHWAY-ID"]||"."};break}case"START":{n.startTimeOffset=HS(d);break}}}const f=s.length>0&&s.length<n.levels.length;return n.levels=f?s:n.levels,n.levels.length===0&&(n.playlistParsingError=new Error("no levels found in manifest")),n}static parseMasterPlaylistMedia(e,t,r){let n;const s={},a=r.levels,u={AUDIO:a.map(c=>({id:c.attrs.AUDIO,audioCodec:c.audioCodec})),SUBTITLES:a.map(c=>({id:c.attrs.SUBTITLES,textCodec:c.textCodec})),"CLOSED-CAPTIONS":[]};let f=0;for($S.lastIndex=0;(n=$S.exec(e))!==null;){const c=new $t(n[1],r),d=c.TYPE;if(d){const p=u[d],m=s[d]||[];s[d]=m;const v=c.LANGUAGE,y=c["ASSOC-LANGUAGE"],b=c.CHANNELS,E=c.CHARACTERISTICS,x=c["INSTREAM-ID"],T={attrs:c,bitrate:0,id:f++,groupId:c["GROUP-ID"]||"",name:c.NAME||v||"",type:d,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:v,url:c.URI?Bi.resolve(c.URI,t):""};if(y&&(T.assocLang=y),b&&(T.channels=b),E&&(T.characteristics=E),x&&(T.instreamId=x),p!=null&&p.length){const A=Bi.findGroup(p,T.groupId)||p[0];VS(T,A,"audioCodec"),VS(T,A,"textCodec")}m.push(T)}}return s}static parseLevelPlaylist(e,t,r,n,s,a){var u;const f={url:t},c=new OO(t),d=c.fragments,p=[];let m=null,v=0,y=0,b=0,E=0,x=0,T=null,A=new vd(n,f),L,w,C,I=-1,O=!1,B=null,P;if(Td.lastIndex=0,c.m3u8=e,c.hasVariableRefs=PS(e),((u=Td.exec(e))==null?void 0:u[0])!=="#EXTM3U")return c.playlistParsingError=new Error("Missing format identifier #EXTM3U"),c;for(;(L=Td.exec(e))!==null;){O&&(O=!1,A=new vd(n,f),A.playlistOffset=b,A.setStart(b),A.sn=v,A.cc=E,x&&(A.bitrate=x),A.level=r,m&&(A.initSegment=m,m.rawProgramDateTime&&(A.rawProgramDateTime=m.rawProgramDateTime,m.rawProgramDateTime=null),B&&(A.setByteRange(B),B=null)));const X=L[1];if(X){A.duration=parseFloat(X);const q=(" "+L[2]).slice(1);A.title=q||null,A.tagList.push(q?["INF",X,q]:["INF",X])}else if(L[3]){if(Ye(A.duration)){A.playlistOffset=b,A.setStart(b),C&&qS(A,C,c),A.sn=v,A.level=r,A.cc=E,d.push(A);const q=(" "+L[3]).slice(1);A.relurl=qg(c,q),Wg(A,T,p),T=A,b+=A.duration,v++,y=0,O=!0}}else{if(L=L[0].match(jO),!L){At.warn("No matches on slow regex match for level playlist!");continue}for(w=1;w<L.length&&L[w]===void 0;w++);const q=(" "+L[w]).slice(1),H=(" "+L[w+1]).slice(1),K=L[w+2]?(" "+L[w+2]).slice(1):null;switch(q){case"BYTERANGE":T?A.setByteRange(H,T):A.setByteRange(H);break;case"PROGRAM-DATE-TIME":A.rawProgramDateTime=H,A.tagList.push(["PROGRAM-DATE-TIME",H]),I===-1&&(I=d.length);break;case"PLAYLIST-TYPE":c.type&&cn(c,q,L),c.type=H.toUpperCase();break;case"MEDIA-SEQUENCE":c.startSN!==0?cn(c,q,L):d.length>0&&YS(c,q,L),v=c.startSN=parseInt(H);break;case"SKIP":{c.skippedSegments&&cn(c,q,L);const z=new $t(H,c),ie=z.decimalInteger("SKIPPED-SEGMENTS");if(Ye(ie)){c.skippedSegments+=ie;for(let U=ie;U--;)d.push(null);v+=ie}const Y=z.enumeratedString("RECENTLY-REMOVED-DATERANGES");Y&&(c.recentlyRemovedDateranges=(c.recentlyRemovedDateranges||[]).concat(Y.split("	")));break}case"TARGETDURATION":c.targetduration!==0&&cn(c,q,L),c.targetduration=Math.max(parseInt(H),1);break;case"VERSION":c.version!==null&&cn(c,q,L),c.version=parseInt(H);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":c.live||cn(c,q,L),c.live=!1;break;case"#":(H||K)&&A.tagList.push(K?[H,K]:[H]);break;case"DISCONTINUITY":E++,A.tagList.push(["DIS"]);break;case"GAP":A.gap=!0,A.tagList.push([q]);break;case"BITRATE":A.tagList.push([q,H]),x=parseInt(H)*1e3,Ye(x)?A.bitrate=x:x=0;break;case"DATERANGE":{const z=new $t(H,c),ie=new Z_(z,c.dateRanges[z.ID],c.dateRangeTagCount);c.dateRangeTagCount++,ie.isValid||c.skippedSegments?c.dateRanges[ie.id]=ie:At.warn(`Ignoring invalid DATERANGE tag: "${H}"`),A.tagList.push(["EXT-X-DATERANGE",H]);break}case"DEFINE":{{const z=new $t(H,c);"IMPORT"in z?wO(c,z,a):NS(c,z,t)}break}case"DISCONTINUITY-SEQUENCE":c.startCC!==0?cn(c,q,L):d.length>0&&YS(c,q,L),c.startCC=E=parseInt(H);break;case"KEY":{const z=GS(H,t,c);if(z.isSupported()){if(z.method==="NONE"){C=void 0;break}C||(C={});const ie=C[z.keyFormat];ie!=null&&ie.matches(z)||(ie&&(C=Lt({},C)),C[z.keyFormat]=z)}else At.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${H}"`);break}case"START":c.startTimeOffset=HS(H);break;case"MAP":{const z=new $t(H,c);if(A.duration){const ie=new vd(n,f);zS(ie,z,r,C),m=ie,A.initSegment=m,m.rawProgramDateTime&&!A.rawProgramDateTime&&(A.rawProgramDateTime=m.rawProgramDateTime)}else{const ie=A.byteRangeEndOffset;if(ie){const Y=A.byteRangeStartOffset;B=`${ie-Y}@${Y}`}else B=null;zS(A,z,r,C),m=A,O=!0}m.cc=E;break}case"SERVER-CONTROL":{P&&cn(c,q,L),P=new $t(H),c.canBlockReload=P.bool("CAN-BLOCK-RELOAD"),c.canSkipUntil=P.optionalFloat("CAN-SKIP-UNTIL",0),c.canSkipDateRanges=c.canSkipUntil>0&&P.bool("CAN-SKIP-DATERANGES"),c.partHoldBack=P.optionalFloat("PART-HOLD-BACK",0),c.holdBack=P.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{c.partTarget&&cn(c,q,L);const z=new $t(H);c.partTarget=z.decimalFloatingPoint("PART-TARGET");break}case"PART":{let z=c.partList;z||(z=c.partList=[]);const ie=y>0?z[z.length-1]:void 0,Y=y++,U=new $t(H,c),N=new wD(U,A,f,Y,ie);z.push(N),A.duration+=N.duration;break}case"PRELOAD-HINT":{const z=new $t(H,c);c.preloadHint=z;break}case"RENDITION-REPORT":{const z=new $t(H,c);c.renditionReports=c.renditionReports||[],c.renditionReports.push(z);break}default:At.warn(`line parsed but not handled: ${L}`);break}}}T&&!T.relurl?(d.pop(),b-=T.duration,c.partList&&(c.fragmentHint=T)):c.partList&&(Wg(A,T,p),A.cc=E,c.fragmentHint=A,C&&qS(A,C,c)),c.targetduration||(c.playlistParsingError=new Error("Missing Target Duration"));const $=d.length,F=d[0],Z=d[$-1];if(b+=c.skippedSegments*c.targetduration,b>0&&$&&Z){c.averagetargetduration=b/$;const X=Z.sn;c.endSN=X!=="initSegment"?X:0,c.live||(Z.endList=!0),I>0&&(GO(d,I),F&&p.unshift(F))}return c.fragmentHint&&(b+=c.fragmentHint.duration),c.totalduration=b,p.length&&c.dateRangeTagCount&&F&&iA(p,c),c.endCC=E,c}}function iA(l,e){let t=l.length;if(!t)if(e.hasProgramDateTime){const u=e.fragments[e.fragments.length-1];l.push(u),t++}else return;const r=l[t-1],n=e.live?1/0:e.totalduration,s=Object.keys(e.dateRanges);for(let u=s.length;u--;){const f=e.dateRanges[s[u]],c=f.startDate.getTime();f.tagAnchor=r.ref;for(let d=t;d--;){var a;if(((a=l[d])==null?void 0:a.sn)<e.startSN)break;const p=$O(e,c,l,d,n);if(p!==-1){f.tagAnchor=e.fragments[p].ref;break}}}}function $O(l,e,t,r,n){const s=t[r];if(s){const u=s.programDateTime;if(e>=u||r===0){var a;const f=(((a=t[r+1])==null?void 0:a.start)||n)-s.start;if(e<=u+f*1e3){const c=t[r].sn-l.startSN;if(c<0)return-1;const d=l.fragments;if(d.length>t.length){const m=(t[r+1]||d[d.length-1]).sn-l.startSN;for(let v=m;v>c;v--){const y=d[v].programDateTime;if(e>=y&&e<y+d[v].duration*1e3)return v}}return c}}}return-1}function GS(l,e,t){var r,n;const s=new $t(l,t),a=(r=s.METHOD)!=null?r:"",u=s.URI,f=s.hexadecimalInteger("IV"),c=s.KEYFORMATVERSIONS,d=(n=s.KEYFORMAT)!=null?n:"identity";u&&s.IV&&!f&&At.error(`Invalid IV: ${s.IV}`);const p=u?Bi.resolve(u,e):"",m=(c||"1").split("/").map(Number).filter(Number.isFinite);return new ss(a,p,d,m,f,s.KEYID)}function HS(l){const t=new $t(l).decimalFloatingPoint("TIME-OFFSET");return Ye(t)?t:null}function KS(l,e){let t=(l||"").split(/[ ,]+/).filter(r=>r);["video","audio","text"].forEach(r=>{const n=t.filter(s=>Dm(s,r));n.length&&(e[`${r}Codec`]=n.map(s=>s.split("/")[0]).join(","),t=t.filter(s=>n.indexOf(s)===-1))}),e.unknownCodecs=t}function VS(l,e,t){const r=e[t];r&&(l[t]=r)}function GO(l,e){let t=l[e];for(let r=e;r--;){const n=l[r];if(!n)return;n.programDateTime=t.programDateTime-n.duration*1e3,t=n}}function Wg(l,e,t){l.rawProgramDateTime?t.push(l):e!=null&&e.programDateTime&&(l.programDateTime=e.endProgramDateTime)}function zS(l,e,t,r){l.relurl=e.URI,e.BYTERANGE&&l.setByteRange(e.BYTERANGE),l.level=t,l.sn="initSegment",r&&(l.levelkeys=r),l.initSegment=null}function qS(l,e,t){l.levelkeys=e;const{encryptedFragments:r}=t;(!r.length||r[r.length-1].levelkeys!==e)&&Object.keys(e).some(n=>e[n].isCommonEncryption)&&r.push(l)}function cn(l,e,t){l.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function YS(l,e,t){l.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function xd(l,e){const t=e.startPTS;if(Ye(t)){let r=0,n;e.sn>l.sn?(r=t-l.start,n=l):(r=l.start-t,n=e),n.duration!==r&&n.setDuration(r)}else e.sn>l.sn?l.cc===e.cc&&l.minEndPTS?e.setStart(l.start+(l.minEndPTS-l.start)):e.setStart(l.start+l.duration):e.setStart(Math.max(l.start-e.duration,0))}function nA(l,e,t,r,n,s,a){r-t<=0&&(a.warn("Fragment should have a positive duration",e),r=t+e.duration,s=n+e.duration);let f=t,c=r;const d=e.startPTS,p=e.endPTS;if(Ye(d)){const x=Math.abs(d-t);l&&x>l.totalduration?a.warn(`media timestamps and playlist times differ by ${x}s for level ${e.level} ${l.url}`):Ye(e.deltaPTS)?e.deltaPTS=Math.max(x,e.deltaPTS):e.deltaPTS=x,f=Math.max(t,d),t=Math.min(t,d),n=e.startDTS!==void 0?Math.min(n,e.startDTS):n,c=Math.min(r,p),r=Math.max(r,p),s=e.endDTS!==void 0?Math.max(s,e.endDTS):s}const m=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(r-e.start),e.startPTS=t,e.maxStartPTS=f,e.startDTS=n,e.endPTS=r,e.minEndPTS=c,e.endDTS=s;const v=e.sn;if(!l||v<l.startSN||v>l.endSN)return 0;let y;const b=v-l.startSN,E=l.fragments;for(E[b]=e,y=b;y>0;y--)xd(E[y],E[y-1]);for(y=b;y<E.length-1;y++)xd(E[y],E[y+1]);return l.fragmentHint&&xd(E[E.length-1],l.fragmentHint),l.PTSKnown=l.alignedSliding=!0,m}function HO(l,e,t){if(l===e)return;let r=null;const n=l.fragments;for(let d=n.length-1;d>=0;d--){const p=n[d].initSegment;if(p){r=p;break}}l.fragmentHint&&delete l.fragmentHint.endPTS;let s;zO(l,e,(d,p,m,v)=>{if((!e.startCC||e.skippedSegments)&&p.cc!==d.cc){const y=d.cc-p.cc;for(let b=m;b<v.length;b++)v[b].cc+=y;e.endCC=v[v.length-1].cc}Ye(d.startPTS)&&Ye(d.endPTS)&&(p.setStart(p.startPTS=d.startPTS),p.startDTS=d.startDTS,p.maxStartPTS=d.maxStartPTS,p.endPTS=d.endPTS,p.endDTS=d.endDTS,p.minEndPTS=d.minEndPTS,p.setDuration(d.endPTS-d.startPTS),p.duration&&(s=p),e.PTSKnown=e.alignedSliding=!0),d.hasStreams&&(p.elementaryStreams=d.elementaryStreams),p.loader=d.loader,d.hasStats&&(p.stats=d.stats),d.initSegment&&(p.initSegment=d.initSegment,r=d.initSegment)});const a=e.fragments,u=e.fragmentHint?a.concat(e.fragmentHint):a;if(r&&u.forEach(d=>{var p;d&&(!d.initSegment||d.initSegment.relurl===((p=r)==null?void 0:p.relurl))&&(d.initSegment=r)}),e.skippedSegments){if(e.deltaUpdateFailed=a.some(d=>!d),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let d=e.skippedSegments;d--;)a.shift();e.startSN=a[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=KO(l.dateRanges,e,t));const d=l.fragments.filter(p=>p.rawProgramDateTime);if(l.hasProgramDateTime&&!e.hasProgramDateTime)for(let p=1;p<u.length;p++)u[p].programDateTime===null&&Wg(u[p],u[p-1],d);iA(d,e)}e.endCC=a[a.length-1].cc}if(!e.startCC){var f;const d=oA(l,e.startSN-1);e.startCC=(f=d?.cc)!=null?f:a[0].cc}VO(l.partList,e.partList,(d,p)=>{p.elementaryStreams=d.elementaryStreams,p.stats=d.stats}),s?nA(e,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS,t):sA(l,e),a.length&&(e.totalduration=e.edge-a[0].start),e.driftStartTime=l.driftStartTime,e.driftStart=l.driftStart;const c=e.advancedDateTime;if(e.advanced&&c){const d=e.edge;e.driftStart||(e.driftStartTime=c,e.driftStart=d),e.driftEndTime=c,e.driftEnd=d}else e.driftEndTime=l.driftEndTime,e.driftEnd=l.driftEnd,e.advancedDateTime=l.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=l.requestScheduled)}function KO(l,e,t){const{dateRanges:r,recentlyRemovedDateranges:n}=e,s=Lt({},l);n&&n.forEach(f=>{delete s[f]});const u=Object.keys(s).length;return u?(Object.keys(r).forEach(f=>{const c=s[f],d=new Z_(r[f].attr,c);d.isValid?(s[f]=d,c||(d.tagOrder+=u)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${kt(r[f].attr)}"`)}),s):r}function VO(l,e,t){if(l&&e){let r=0;for(let n=0,s=l.length;n<=s;n++){const a=l[n],u=e[n+r];a&&u&&a.index===u.index&&a.fragment.sn===u.fragment.sn?t(a,u):r--}}}function zO(l,e,t){const r=e.skippedSegments,n=Math.max(l.startSN,e.startSN)-e.startSN,s=(l.fragmentHint?1:0)+(r?e.endSN:Math.min(l.endSN,e.endSN))-e.startSN,a=e.startSN-l.startSN,u=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,f=l.fragmentHint?l.fragments.concat(l.fragmentHint):l.fragments;for(let c=n;c<=s;c++){const d=f[a+c];let p=u[c];if(r&&!p&&d&&(p=e.fragments[c]=d),d&&p){t(d,p,c,u);const m=d.relurl,v=p.relurl;if(m&&qO(m,v)){e.playlistParsingError=WS(`media sequence mismatch ${p.sn}:`,l,e,d,p);return}else if(d.cc!==p.cc){e.playlistParsingError=WS(`discontinuity sequence mismatch (${d.cc}!=${p.cc})`,l,e,d,p);return}}}}function WS(l,e,t,r,n){return new Error(`${l} ${n.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function sA(l,e,t=!0){const r=e.startSN+e.skippedSegments-l.startSN,n=l.fragments,s=r>=0;let a=0;if(s&&r<n.length)a=n[r].start;else if(s&&e.startSN===l.endSN+1)a=l.fragmentEnd;else if(s&&t)a=l.fragmentStart+r*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)a=l.fragmentStart;else return;Qg(e,a)}function Qg(l,e){if(e){const t=l.fragments;for(let r=l.skippedSegments;r<t.length;r++)t[r].addStart(e);l.fragmentHint&&l.fragmentHint.addStart(e)}}function aA(l,e=1/0){let t=1e3*l.targetduration;if(l.updated){const r=l.fragments;if(r.length&&t*4>e){const s=r[r.length-1].duration*1e3;s<t&&(t=s)}}else t/=2;return Math.round(t)}function oA(l,e,t){if(!l)return null;let r=l.fragments[e-l.startSN];return r||(r=l.fragmentHint,r&&r.sn===e)?r:e<l.startSN&&t&&t.sn===e?t:null}function QS(l,e,t){return l?lA(l.partList,e,t):null}function lA(l,e,t){if(l)for(let r=l.length;r--;){const n=l[r];if(n.index===t&&n.fragment.sn===e)return n}return null}function uA(l){l.forEach((e,t)=>{var r;(r=e.details)==null||r.fragments.forEach(n=>{n.level=t,n.initSegment&&(n.initSegment.level=t)})})}function qO(l,e){return l!==e&&e?XS(l)!==XS(e):!1}function XS(l){return l.replace(/\?[^?]*$/,"")}function Yo(l,e){for(let r=0,n=l.length;r<n;r++){var t;if(((t=l[r])==null?void 0:t.cc)===e)return l[r]}return null}function YO(l,e){return!!(l&&e.startCC<l.endCC&&e.endCC>l.startCC)}function ZS(l,e){const t=l.start+e;l.startPTS=t,l.setStart(t),l.endPTS=t+l.duration}function cA(l,e){const t=e.fragments;for(let r=0,n=t.length;r<n;r++)ZS(t[r],l);e.fragmentHint&&ZS(e.fragmentHint,l),e.alignedSliding=!0}function WO(l,e){l&&(fA(e,l),e.alignedSliding||Pc(e,l),!e.alignedSliding&&!e.skippedSegments&&sA(l,e,!1))}function fA(l,e){if(!YO(e,l))return;const t=Math.min(e.endCC,l.endCC),r=Yo(e.fragments,t),n=Yo(l.fragments,t);if(!r||!n)return;At.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const s=r.start-n.start;cA(s,l)}function Pc(l,e){if(!l.hasProgramDateTime||!e.hasProgramDateTime)return;const t=l.fragments,r=e.fragments;if(!t.length||!r.length)return;let n,s;const a=Math.min(e.endCC,l.endCC);e.startCC<a&&l.startCC<a&&(n=Yo(r,a),s=Yo(t,a)),(!n||!s)&&(n=r[Math.floor(r.length/2)],s=Yo(t,n.cc)||t[Math.floor(t.length/2)]);const u=n.programDateTime,f=s.programDateTime;if(!u||!f)return;const c=(f-u)/1e3-(s.start-n.start);cA(c,l)}function Lr(l,e,t){Hr(l,e,t),l.addEventListener(e,t)}function Hr(l,e,t){l.removeEventListener(e,t)}const QO={toString:function(l){let e="";const t=l.length;for(let r=0;r<t;r++)e+=`[${l.start(r).toFixed(3)}-${l.end(r).toFixed(3)}]`;return e}},$e={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Bm extends Q_{constructor(e,t,r,n,s){super(n,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=$e.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:a,fragCurrent:u,media:f,mediaBuffer:c,state:d}=this,p=f?f.currentTime:0,m=ot.bufferInfo(c||f,p,a.maxBufferHole),v=!m.len;if(this.log(`Media seeking to ${Ye(p)?p.toFixed(3):p}, state: ${d}, ${v?"out of":"in"} buffer`),this.state===$e.ENDED)this.resetLoadingState();else if(u){const y=a.maxFragLookUpTolerance,b=u.start-y,E=u.start+u.duration+y;if(v||E<m.start||b>m.end){const x=p>E;(p<b||x)&&(x&&u.loader&&(this.log(`Cancelling fragment load for seek (sn: ${u.sn})`),u.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(f){this.fragmentTracker.removeFragmentsInRange(p,1/0,this.playlistType,!0);const y=this.lastCurrentTime;if(p>y&&(this.lastCurrentTime=p),!this.loadingParts){const b=Math.max(m.end,p),E=this.shouldLoadParts(this.getLevelDetails(),b);E&&(this.log(`LL-Part loading ON after seeking to ${p.toFixed(2)} with buffer @${b.toFixed(2)}`),this.loadingParts=E)}}this.hls.hasEnoughToStart||(this.log(`Setting ${v?"startPosition":"nextLoadPosition"} to ${p} for seek without enough to start`),this.nextLoadPosition=p,v&&(this.startPosition=p)),v&&this.state===$e.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=s,this.hls=e,this.fragmentLoader=new _O(e.config),this.keyLoader=r,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Mm(e.config)}registerListeners(){const{hls:e}=this;e.on(M.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(M.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(M.MANIFEST_LOADING,this.onManifestLoading,this),e.on(M.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(M.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(M.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(M.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(M.MANIFEST_LOADING,this.onManifestLoading,this),e.off(M.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(M.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===$e.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=$e.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const r=e.end||0,n=this.config.timelineOffset||0;if(r<=n)return!1;const s=e.buffered;this.config.maxBufferHole&&s&&s.length>1&&(e=ot.bufferedInfo(s,e.start,0));const a=e.nextStart;if(a&&a>n&&a<t.edge||this.media.currentTime<e.start)return!1;const f=t.partList;if(f!=null&&f.length){const d=f[f.length-1];return ot.isBuffered(this.media,d.start+d.duration/2)}const c=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(c)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const r=this.media=this.mediaBuffer=t.media;Lr(r,"seeking",this.onMediaSeeking),Lr(r,"ended",this.onMediaEnded);const n=this.config;this.levels&&n.autoStartLoad&&this.state===$e.STOPPED&&this.startLoad(n.startPosition)}onMediaDetaching(e,t){const r=!!t.transferMedia,n=this.media;if(n!==null){if(n.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),Hr(n,"seeking",this.onMediaSeeking),Hr(n,"ended",this.onMediaEnded),this.keyLoader&&!r&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,r){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=$e.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,r){this.startFragRequested=!0,this._loadFragForPlayback(e,t,r)}_loadFragForPlayback(e,t,r){const n=s=>{const a=s.frag;if(this.fragContextChanged(a)){this.warn(`${a.type} sn: ${a.sn}${s.part?" part: "+s.part.index:""} of ${this.fragInfo(a,!1,s.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(a);return}a.stats.chunkCount++,this._handleFragmentLoadProgress(s)};this._doFragLoad(e,t,r,n).then(s=>{if(!s)return;const a=this.state,u=s.frag;if(this.fragContextChanged(u)){(a===$e.FRAG_LOADING||!this.fragCurrent&&a===$e.PARSING)&&(this.fragmentTracker.removeFragment(u),this.state=$e.IDLE);return}"payload"in s&&(this.log(`Loaded ${u.type} sn: ${u.sn} of ${this.playlistLabel()} ${u.level}`),this.hls.trigger(M.FRAG_LOADED,s)),this._handleFragmentLoadComplete(s)}).catch(s=>{this.state===$e.STOPPED||this.state===$e.ERROR||(this.warn(`Frag error: ${s?.message||s}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:r}=this;if(r.getState(e)===or.APPENDING){const s=e.type,a=this.getFwdBufferInfo(this.mediaBuffer,s),u=Math.max(e.duration,a?a.len:this.config.maxBufferLength),f=this.backtrackFragment;((f?e.sn-f.sn:0)===1||this.reduceMaxBufferLength(u,e.duration))&&r.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?r.removeAllFragments():r.hasParts(e.type)&&(r.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),r.getState(e)===or.PARTIAL&&r.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return t?.live&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,r=null){if(!(e-t))return;const n={startOffset:e,endOffset:t,type:r};this.hls.trigger(M.BUFFER_FLUSHING,n)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(r=>{const n=r?.frag;if(!n||this.fragContextChanged(n)||!this.levels)throw new Error("init load aborted");return r}).then(r=>{const{hls:n}=this,{frag:s,payload:a}=r,u=s.decryptdata;if(a&&a.byteLength>0&&u!=null&&u.key&&u.iv&&Ua(u.method)){const f=self.performance.now();return this.decrypter.decrypt(new Uint8Array(a),u.key.buffer,u.iv.buffer,Nm(u.method)).catch(c=>{throw n.trigger(M.ERROR,{type:tt.MEDIA_ERROR,details:Se.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:s}),c}).then(c=>{const d=self.performance.now();return n.trigger(M.FRAG_DECRYPTED,{frag:s,payload:c,stats:{tstart:f,tdecrypt:d}}),r.payload=c,this.completeInitSegmentLoad(r)})}return this.completeInitSegmentLoad(r)}).catch(r=>{this.state===$e.STOPPED||this.state===$e.ERROR||(this.warn(r),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const r=e.frag.stats;this.state!==$e.STOPPED&&(this.state=$e.IDLE),e.frag.data=new Uint8Array(e.payload),r.parsing.start=r.buffering.start=self.performance.now(),r.parsing.end=r.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var r,n;const s=e.tracks;if(s&&!t.encrypted&&((r=s.audio)!=null&&r.encrypted||(n=s.video)!=null&&n.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const a=this.media,u=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${a?"attached mediaKeys: "+a.mediaKeys:"detached"})`);return this.warn(u.message),!a||a.mediaKeys?!1:(this.hls.trigger(M.ERROR,{type:tt.KEY_SYSTEM_ERROR,details:Se.KEY_SYSTEM_NO_KEYS,fatal:!1,error:u,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const r=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${r?QO.toString(ot.getBuffered(r)):"(detached)"})`),Xt(e)){var n;if(e.type!==Xe.SUBTITLE){const a=e.elementaryStreams;if(!Object.keys(a).some(u=>!!a[u])){this.state=$e.IDLE;return}}const s=(n=this.levels)==null?void 0:n[e.level];s!=null&&s.fragmentError&&(this.log(`Resetting level fragment error count of ${s.fragmentError} on frag buffered`),s.fragmentError=0)}this.state=$e.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:r,part:n,partsLoaded:s}=e,a=!s||s.length===0||s.some(f=>!f),u=new Pm(r.level,r.sn,r.stats.chunkCount+1,0,n?n.index:-1,!a);t.flush(u)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,r=null,n){var s;this.fragCurrent=e;const a=t.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let u=null;if(e.encrypted&&!((s=e.decryptdata)!=null&&s.key)){if(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=$e.KEY_LOADING,this.fragCurrent=e,u=this.keyLoader.load(e).then(m=>{if(!this.fragContextChanged(m.frag))return this.hls.trigger(M.KEY_LOADED,m),this.state===$e.KEY_LOADING&&(this.state=$e.IDLE),m}),this.hls.trigger(M.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(u=this.keyLoader.loadClear(e,a.encryptedFragments,this.startFragRequested),u&&this.log("[eme] blocking frag load until media-keys acquired"));const f=this.fragPrevious;if(Xt(e)&&(!f||e.sn!==f.sn)){const m=this.shouldLoadParts(t.details,e.end);m!==this.loadingParts&&(this.log(`LL-Part loading ${m?"ON":"OFF"} loading sn ${f?.sn}->${e.sn}`),this.loadingParts=m)}if(r=Math.max(e.start,r||0),this.loadingParts&&Xt(e)){const m=a.partList;if(m&&n){r>a.fragmentEnd&&a.fragmentHint&&(e=a.fragmentHint);const v=this.getNextPart(m,e,r);if(v>-1){const y=m[v];e=this.fragCurrent=y.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${y.index} (${v}/${m.length-1}) of ${this.fragInfo(e,!1,y)}) cc: ${e.cc} [${a.startSN}-${a.endSN}], target: ${parseFloat(r.toFixed(3))}`),this.nextLoadPosition=y.start+y.duration,this.state=$e.FRAG_LOADING;let b;return u?b=u.then(E=>!E||this.fragContextChanged(E.frag)?null:this.doFragPartsLoad(e,y,t,n)).catch(E=>this.handleFragLoadError(E)):b=this.doFragPartsLoad(e,y,t,n).catch(E=>this.handleFragLoadError(E)),this.hls.trigger(M.FRAG_LOADING,{frag:e,part:y,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):b}else if(!e.url||this.loadedEndOfParts(m,r))return Promise.resolve(null)}}if(Xt(e)&&this.loadingParts){var c;this.log(`LL-Part loading OFF after next part miss @${r.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(c=a.partList)==null?void 0:c.filter(m=>m.loaded).map(m=>`[${m.start}-${m.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+a.startSN+"-"+a.endSN+"]"}, target: ${parseFloat(r.toFixed(3))}`),Ye(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=$e.FRAG_LOADING;const d=this.config.progressive&&e.type!==Xe.SUBTITLE;let p;return d&&u?p=u.then(m=>!m||this.fragContextChanged(m.frag)?null:this.fragmentLoader.load(e,n)).catch(m=>this.handleFragLoadError(m)):p=Promise.all([this.fragmentLoader.load(e,d?n:void 0),u]).then(([m])=>(!d&&n&&n(m),m)).catch(m=>this.handleFragLoadError(m)),this.hls.trigger(M.FRAG_LOADING,{frag:e,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):p}doFragPartsLoad(e,t,r,n){return new Promise((s,a)=>{var u;const f=[],c=(u=r.details)==null?void 0:u.partList,d=p=>{this.fragmentLoader.loadPart(e,p,n).then(m=>{f[p.index]=m;const v=m.part;this.hls.trigger(M.FRAG_LOADED,m);const y=QS(r.details,e.sn,p.index+1)||lA(c,e.sn,p.index+1);if(y)d(y);else return s({frag:e,part:v,partsLoaded:f})}).catch(a)};d(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===Se.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===tt.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(M.ERROR,t)}else this.hls.trigger(M.ERROR,{type:tt.OTHER_ERROR,details:Se.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==$e.PARSING){!this.fragCurrent&&this.state!==$e.STOPPED&&this.state!==$e.ERROR&&(this.state=$e.IDLE);return}const{frag:r,part:n,level:s}=t,a=self.performance.now();r.stats.parsing.end=a,n&&(n.stats.parsing.end=a);const u=this.getLevelDetails(),c=u&&r.sn>u.endSN||this.shouldLoadParts(u,r.end);c!==this.loadingParts&&(this.log(`LL-Part loading ${c?"ON":"OFF"} after parsing segment ending @${r.end.toFixed(2)}`),this.loadingParts=c),this.updateLevelTiming(r,n,s,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var r;const s=e.partList[0];if(s.fragment.type===Xe.SUBTITLE)return!1;const a=s.end+(((r=e.fragmentHint)==null?void 0:r.duration)||0);if(t>=a){var n;if((this.hls.hasEnoughToStart?((n=this.media)==null?void 0:n.currentTime)||this.lastCurrentTime:this.getLoadPosition())>s.start-s.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:r}=this,{level:n,sn:s,part:a}=e;if(!(t!=null&&t[n]))return this.warn(`Levels object was unset while buffering fragment ${s} of ${this.playlistLabel()} ${n}. The current chunk will not be buffered.`),null;const u=t[n],f=u.details,c=a>-1?QS(f,s,a):null,d=c?c.fragment:oA(f,s,r);return d?(r&&r!==d&&(d.stats=r.stats),{frag:d,part:c,level:u}):null}bufferFragmentData(e,t,r,n,s){if(this.state!==$e.PARSING)return;const{data1:a,data2:u}=e;let f=a;if(u&&(f=yi(a,u)),!f.length)return;const c=this.initPTS[t.cc],d=c?-c.baseTime/c.timescale:void 0,p={type:e.type,frag:t,part:r,chunkMeta:n,offset:d,parent:t.type,data:f};if(this.hls.trigger(M.BUFFER_APPENDING,p),e.dropped&&e.independent&&!r){if(s)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!ot.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const r=t.currentTime,n=ot.bufferInfo(t,r,0),s=e.duration,a=Math.min(this.config.maxFragLookUpTolerance*2,s*.25),u=Math.max(Math.min(e.start-a,n.end-a),r+a);e.start-u>a&&this.flushMainBuffer(u,e.start)}getFwdBufferInfo(e,t){var r;const n=this.getLoadPosition();if(!Ye(n))return null;const a=this.lastCurrentTime>n||(r=this.media)!=null&&r.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,n,t,a)}getFwdBufferInfoAtPos(e,t,r,n){const s=ot.bufferInfo(e,t,n);if(s.len===0&&s.nextStart!==void 0){const a=this.fragmentTracker.getBufferedFrag(t,r);if(a&&(s.nextStart<=a.end||a.gap)){const u=Math.max(Math.min(s.nextStart,a.end)-t,n);return ot.bufferInfo(e,t,u)}}return s}getMaxBufferLength(e){const{config:t}=this;let r;return e?r=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):r=t.maxBufferLength,Math.min(r,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const r=this.config,n=Math.max(Math.min(e-t,r.maxBufferLength),t),s=Math.max(e-t*3,r.maxMaxBufferLength/2,n);return s>=n?(r.maxMaxBufferLength=s,this.warn(`Reduce max buffer length to ${s}s`),!0):!1}getAppendedFrag(e,t=Xe.MAIN){const r=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return r&&"fragment"in r?r.fragment:r}getNextFragment(e,t){const r=t.fragments,n=r.length;if(!n)return null;const{config:s}=this,a=r[0].start,u=s.lowLatencyMode&&!!t.partList;let f=null;if(t.live){const p=s.initialLiveManifestSize;if(n<p)return this.warn(`Not enough fragments to start playback (have: ${n}, need: ${p})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<a){var c;u&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),f=this.getInitialLiveFragment(t);const m=this.hls.startPosition,v=this.hls.liveSyncPosition,y=f?(m!==-1&&m>=a?m:v)||f.start:e;this.log(`Setting startPosition to ${y} to match start frag at live edge. mainStart: ${m} liveSyncPosition: ${v} frag.start: ${(c=f)==null?void 0:c.start}`),this.startPosition=this.nextLoadPosition=y}}else e<=a&&(f=r[0]);if(!f){const p=this.loadingParts?t.partEnd:t.fragmentEnd;f=this.getFragmentAtPosition(e,p,t)}let d=this.filterReplacedPrimary(f,t);if(!d&&f){const p=f.sn-t.startSN;d=this.filterReplacedPrimary(r[p+1]||null,t)}return this.mapToInitFragWhenRequired(d)}isLoopLoading(e,t){const r=this.fragmentTracker.getState(e);return(r===or.OK||r===or.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,r,n,s){let a=null;if(e.gap&&(a=this.getNextFragment(this.nextLoadPosition,t),a&&!a.gap&&r.nextStart)){const u=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,r.nextStart,n,0);if(u!==null&&r.len+u.len>=s){const f=a.sn;return this.loopSn!==f&&(this.log(`buffer full after gaps in "${n}" playlist starting at sn: ${f}`),this.loopSn=f),null}}return this.loopSn=void 0,a}get primaryPrefetch(){if(JS(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(JS(this.config)&&e.type!==Xe.SUBTITLE){const r=this.hls.interstitialsManager,n=r?.bufferingItem;if(n){const a=n.event;if(a){if(a.appendInPlace||Math.abs(e.start-n.start)>1||n.start===0)return null}else if(e.end<=n.start&&t?.live===!1||e.start>n.end&&n.nextEvent&&(n.nextEvent.appendInPlace||e.start-n.end>1))return null}const s=r?.playerQueue;if(s)for(let a=s.length;a--;){const u=s[a].interstitial;if(u.appendInPlace&&e.start>=u.startTime&&e.end<=u.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,r){let n=-1,s=!1,a=!0;for(let u=0,f=e.length;u<f;u++){const c=e[u];if(a=a&&!c.independent,n>-1&&r<c.start)break;const d=c.loaded;d?n=-1:(s||(c.independent||a)&&c.fragment===t)&&(c.fragment!==t&&this.warn(`Need buffer at ${r} but next unloaded part starts at ${c.start}`),n=u),s=d}return n}loadedEndOfParts(e,t){let r;for(let n=e.length;n--;){if(r=e[n],!r.loaded)return!1;if(t>r.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,r=this.fragPrevious;let n=null;if(r){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${r.programDateTime}`),n=hO(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!n){const s=r.sn+1;if(s>=e.startSN&&s<=e.endSN){const a=t[s-e.startSN];r.cc===a.cc&&(n=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${n.sn}`))}n||(n=q_(e,r.cc,r.end),n&&this.log(`Live playlist, switching playlist, load frag with same CC: ${n.sn}`))}}else{const s=this.hls.liveSyncPosition;s!==null&&(n=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return n}getFragmentAtPosition(e,t,r){const{config:n}=this;let{fragPrevious:s}=this,{fragments:a,endSN:u}=r;const{fragmentHint:f}=r,{maxFragLookUpTolerance:c}=n,d=r.partList,p=!!(this.loadingParts&&d!=null&&d.length&&f);p&&!this.bitrateTest&&d[d.length-1].fragment.sn===f.sn&&(a=a.concat(f),u=f.sn);let m;if(e<t){var v;const b=e<this.lastCurrentTime||e>t-c||(v=this.media)!=null&&v.paused||!this.startFragRequested?0:c;m=Ns(s,a,e,b)}else m=a[a.length-1];if(m){const y=m.sn-r.startSN,b=this.fragmentTracker.getState(m);if((b===or.OK||b===or.PARTIAL&&m.gap)&&(s=m),s&&m.sn===s.sn&&(!p||d[0].fragment.sn>m.sn||!r.live)&&m.level===s.level){const x=a[y+1];m.sn<u&&this.fragmentTracker.getState(x)!==or.OK?m=x:m=null}}return m}alignPlaylists(e,t,r){const n=e.fragments.length;if(!n)return this.warn("No fragments in live playlist"),0;const s=e.fragmentStart,a=!t,u=e.alignedSliding&&Ye(s);if(a||!u&&!s){WO(r,e);const f=e.fragmentStart;return this.log(`Live playlist sliding: ${f.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${n}`),f}return s}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let r=this.startPosition;r<t&&(r=-1);const n=this.timelineOffset;if(r===-1){const s=this.startTimeOffset!==null,a=s?this.startTimeOffset:e.startTimeOffset;a!==null&&Ye(a)?(r=t+a,a<0&&(r+=e.edge),r=Math.min(Math.max(t,r),t+e.totalduration),this.log(`Setting startPosition to ${r} for start time offset ${a} found in ${s?"multivariant":"media"} playlist`),this.startPosition=r):e.live?(r=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${r}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=r=0),this.lastCurrentTime=r+n}this.nextLoadPosition=r+n}getLoadPosition(){var e;const{media:t}=this;let r=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?r=t.currentTime:this.nextLoadPosition>=0&&(r=this.nextLoadPosition),r}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&Xt(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==$e.FRAG_LOADING_WAITING_RETRY)&&(this.state=$e.IDLE)}onFragmentOrKeyLoadError(e,t){var r;if(t.chunkMeta&&!t.frag){const x=this.getCurrentContext(t.chunkMeta);x&&(t.frag=x.frag)}const n=t.frag;if(!n||n.type!==e||!this.levels)return;if(this.fragContextChanged(n)){var s;this.warn(`Frag load error must match current frag to retry ${n.url} > ${(s=this.fragCurrent)==null?void 0:s.url}`);return}const a=t.details===Se.FRAG_GAP;a&&this.fragmentTracker.fragBuffered(n,!0);const u=t.errorAction;if(!u){this.state=$e.ERROR;return}const{action:f,flags:c,retryCount:d=0,retryConfig:p}=u,m=!!p,v=m&&f===yr.RetryRequest,y=m&&!u.resolved&&c===ti.MoveAllAlternatesMatchingHost,b=(r=this.hls.latestLevelDetails)==null?void 0:r.live;if(!v&&y&&Xt(n)&&!n.endList&&b&&!W_(t))this.resetFragmentErrors(e),this.treatAsGap(n),u.resolved=!0;else if((v||y)&&d<p.maxNumRetry){var E;const x=zg((E=t.response)==null?void 0:E.code),T=km(p,d);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+T,this.state=$e.FRAG_LOADING_WAITING_RETRY,u.resolved=!0,x){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${n.sn} of ${e} ${n.level} errored with ${t.details}, retrying loading ${d+1}/${p.maxNumRetry} in ${T}ms`)}else if(p)if(this.resetFragmentErrors(e),d<p.maxNumRetry)!a&&f!==yr.RemoveAlternatePermanently&&(u.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${d})`);return}else f===yr.SendAlternateToPenaltyBox?this.state=$e.WAITING_LEVEL:this.state=$e.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,r=t===1/0;(!t||e>=t||r&&!zg(0))&&(r&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=$e.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===$e.PARSING||this.state===$e.PARSED){const t=e.frag,r=e.parent,n=this.getFwdBufferInfo(this.mediaBuffer,r),s=n&&n.len>.5;s&&this.reduceMaxBufferLength(n.len,t?.duration||10);const a=!s;return a&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${r} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),a}return!1}resetFragmentErrors(e){e===Xe.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==$e.STOPPED&&(this.state=$e.IDLE)}afterBufferFlushed(e,t,r){if(!e)return;const n=ot.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,n,r),this.state===$e.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==$e.STOPPED&&(this.state=$e.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,r,n){const s=r.details;if(!s){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((f,c)=>{const d=e.elementaryStreams[c];if(d){const p=d.endPTS-d.startPTS;if(p<=0)return this.warn(`Could not parse fragment ${e.sn} ${c} duration reliably (${p})`),f||!1;const m=n?0:nA(s,e,d.startPTS,d.endPTS,d.startDTS,d.endDTS,this);return this.hls.trigger(M.LEVEL_PTS_UPDATED,{details:s,level:r,drift:m,type:c,frag:e,start:d.startPTS,end:d.endPTS}),!0}return f},!1)){var u;const f=((u=this.transmuxer)==null?void 0:u.error)===null;if((r.fragmentError===0||f&&(r.fragmentError<2||e.endList))&&this.treatAsGap(e,r),f){const c=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(c.message),this.hls.trigger(M.ERROR,{type:tt.MEDIA_ERROR,details:Se.FRAG_PARSING_ERROR,fatal:!1,error:c,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${r.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=$e.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(M.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===Xe.MAIN?"level":"track"}fragInfo(e,t=!0,r){var n,s;return`${this.playlistLabel()} ${e.level} (${r?"part":"frag"}:[${((n=t&&!r?e.startPTS:(r||e).start)!=null?n:NaN).toFixed(3)}-${((s=t&&!r?e.endPTS:(r||e).end)!=null?s:NaN).toFixed(3)}]${r&&e.type==="main"?"INDEPENDENT="+(r.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function JS(l){return!!l.interstitialsController&&l.enableInterstitialPlayback!==!1}class hA{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let r;if(e.length)e.length===1?r=e[0]:r=XO(e,t);else return new Uint8Array(0);return this.reset(),r}reset(){this.chunks.length=0,this.dataLength=0}}function XO(l,e){const t=new Uint8Array(e);let r=0;for(let n=0;n<l.length;n++){const s=l[n];t.set(s,r),r+=s.length}return t}var _d={exports:{}},eT;function ZO(){return eT||(eT=1,(function(l){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function n(f,c,d){this.fn=f,this.context=c,this.once=d||!1}function s(f,c,d,p,m){if(typeof d!="function")throw new TypeError("The listener must be a function");var v=new n(d,p||f,m),y=t?t+c:c;return f._events[y]?f._events[y].fn?f._events[y]=[f._events[y],v]:f._events[y].push(v):(f._events[y]=v,f._eventsCount++),f}function a(f,c){--f._eventsCount===0?f._events=new r:delete f._events[c]}function u(){this._events=new r,this._eventsCount=0}u.prototype.eventNames=function(){var c=[],d,p;if(this._eventsCount===0)return c;for(p in d=this._events)e.call(d,p)&&c.push(t?p.slice(1):p);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(d)):c},u.prototype.listeners=function(c){var d=t?t+c:c,p=this._events[d];if(!p)return[];if(p.fn)return[p.fn];for(var m=0,v=p.length,y=new Array(v);m<v;m++)y[m]=p[m].fn;return y},u.prototype.listenerCount=function(c){var d=t?t+c:c,p=this._events[d];return p?p.fn?1:p.length:0},u.prototype.emit=function(c,d,p,m,v,y){var b=t?t+c:c;if(!this._events[b])return!1;var E=this._events[b],x=arguments.length,T,A;if(E.fn){switch(E.once&&this.removeListener(c,E.fn,void 0,!0),x){case 1:return E.fn.call(E.context),!0;case 2:return E.fn.call(E.context,d),!0;case 3:return E.fn.call(E.context,d,p),!0;case 4:return E.fn.call(E.context,d,p,m),!0;case 5:return E.fn.call(E.context,d,p,m,v),!0;case 6:return E.fn.call(E.context,d,p,m,v,y),!0}for(A=1,T=new Array(x-1);A<x;A++)T[A-1]=arguments[A];E.fn.apply(E.context,T)}else{var L=E.length,w;for(A=0;A<L;A++)switch(E[A].once&&this.removeListener(c,E[A].fn,void 0,!0),x){case 1:E[A].fn.call(E[A].context);break;case 2:E[A].fn.call(E[A].context,d);break;case 3:E[A].fn.call(E[A].context,d,p);break;case 4:E[A].fn.call(E[A].context,d,p,m);break;default:if(!T)for(w=1,T=new Array(x-1);w<x;w++)T[w-1]=arguments[w];E[A].fn.apply(E[A].context,T)}}return!0},u.prototype.on=function(c,d,p){return s(this,c,d,p,!1)},u.prototype.once=function(c,d,p){return s(this,c,d,p,!0)},u.prototype.removeListener=function(c,d,p,m){var v=t?t+c:c;if(!this._events[v])return this;if(!d)return a(this,v),this;var y=this._events[v];if(y.fn)y.fn===d&&(!m||y.once)&&(!p||y.context===p)&&a(this,v);else{for(var b=0,E=[],x=y.length;b<x;b++)(y[b].fn!==d||m&&!y[b].once||p&&y[b].context!==p)&&E.push(y[b]);E.length?this._events[v]=E.length===1?E[0]:E:a(this,v)}return this},u.prototype.removeAllListeners=function(c){var d;return c?(d=t?t+c:c,this._events[d]&&a(this,d)):(this._events=new r,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=t,u.EventEmitter=u,l.exports=u})(_d)),_d.exports}var JO=ZO(),Fm=_D(JO);const rl="1.6.15",$a={};function ek(){return typeof __HLS_WORKER_BUNDLE__=="function"}function tk(){const l=$a[rl];if(l)return l.clientCount++,l;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),n={worker:new self.Worker(t),objectURL:t,clientCount:1};return $a[rl]=n,n}function rk(l){const e=$a[l];if(e)return e.clientCount++,e;const t=new self.URL(l,self.location.href).href,n={worker:new self.Worker(t),scriptURL:t,clientCount:1};return $a[l]=n,n}function ik(l){const e=$a[l||rl];if(e&&e.clientCount--===1){const{worker:r,objectURL:n}=e;delete $a[l||rl],n&&self.URL.revokeObjectURL(n),r.terminate()}}function dA(l,e){return e+10<=l.length&&l[e]===51&&l[e+1]===68&&l[e+2]===73&&l[e+3]<255&&l[e+4]<255&&l[e+6]<128&&l[e+7]<128&&l[e+8]<128&&l[e+9]<128}function jm(l,e){return e+10<=l.length&&l[e]===73&&l[e+1]===68&&l[e+2]===51&&l[e+3]<255&&l[e+4]<255&&l[e+6]<128&&l[e+7]<128&&l[e+8]<128&&l[e+9]<128}function qc(l,e){let t=0;return t=(l[e]&127)<<21,t|=(l[e+1]&127)<<14,t|=(l[e+2]&127)<<7,t|=l[e+3]&127,t}function il(l,e){const t=e;let r=0;for(;jm(l,e);){r+=10;const n=qc(l,e+6);r+=n,dA(l,e+10)&&(r+=10),e+=r}if(r>0)return l.subarray(t,t+r)}function nk(l,e,t,r){const n=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],s=e[t+2],a=s>>2&15;if(a>12){const v=new Error(`invalid ADTS sampling index:${a}`);l.emit(M.ERROR,M.ERROR,{type:tt.MEDIA_ERROR,details:Se.FRAG_PARSING_ERROR,fatal:!0,error:v,reason:v.message});return}const u=(s>>6&3)+1,f=e[t+3]>>6&3|(s&1)<<2,c="mp4a.40."+u,d=n[a];let p=a;(u===5||u===29)&&(p-=3);const m=[u<<3|(p&14)>>1,(p&1)<<7|f<<3];return At.log(`manifest codec:${r}, parsed codec:${c}, channels:${f}, rate:${d} (ADTS object type:${u} sampling index:${a})`),{config:m,samplerate:d,channelCount:f,codec:c,parsedCodec:c,manifestCodec:r}}function pA(l,e){return l[e]===255&&(l[e+1]&246)===240}function gA(l,e){return l[e+1]&1?7:9}function $m(l,e){return(l[e+3]&3)<<11|l[e+4]<<3|(l[e+5]&224)>>>5}function sk(l,e){return e+5<l.length}function Nc(l,e){return e+1<l.length&&pA(l,e)}function ak(l,e){return sk(l,e)&&pA(l,e)&&$m(l,e)<=l.length-e}function ok(l,e){if(Nc(l,e)){const t=gA(l,e);if(e+t>=l.length)return!1;const r=$m(l,e);if(r<=t)return!1;const n=e+r;return n===l.length||Nc(l,n)}return!1}function mA(l,e,t,r,n){if(!l.samplerate){const s=nk(e,t,r,n);if(!s)return;Lt(l,s)}}function yA(l){return 1024*9e4/l}function lk(l,e){const t=gA(l,e);if(e+t<=l.length){const r=$m(l,e)-t;if(r>0)return{headerLength:t,frameLength:r}}}function vA(l,e,t,r,n){const s=yA(l.samplerate),a=r+n*s,u=lk(e,t);let f;if(u){const{frameLength:p,headerLength:m}=u,v=m+p,y=Math.max(0,t+v-e.length);y?(f=new Uint8Array(v-m),f.set(e.subarray(t+m,e.length),0)):f=e.subarray(t+m,t+v);const b={unit:f,pts:a};return y||l.samples.push(b),{sample:b,length:v,missing:y}}const c=e.length-t;return f=new Uint8Array(c),f.set(e.subarray(t,e.length),0),{sample:{unit:f,pts:a},length:c,missing:-1}}function uk(l,e){return jm(l,e)&&qc(l,e+6)+10<=l.length-e}function ck(l){return l instanceof ArrayBuffer?l:l.byteOffset==0&&l.byteLength==l.buffer.byteLength?l.buffer:new Uint8Array(l).buffer}function Ad(l,e=0,t=1/0){return fk(l,e,t,Uint8Array)}function fk(l,e,t,r){const n=hk(l);let s=1;"BYTES_PER_ELEMENT"in r&&(s=r.BYTES_PER_ELEMENT);const a=dk(l)?l.byteOffset:0,u=(a+l.byteLength)/s,f=(a+e)/s,c=Math.floor(Math.max(0,Math.min(f,u))),d=Math.floor(Math.min(c+Math.max(t,0),u));return new r(n,c,d-c)}function hk(l){return l instanceof ArrayBuffer?l:l.buffer}function dk(l){return l&&l.buffer instanceof ArrayBuffer&&l.byteLength!==void 0&&l.byteOffset!==void 0}function pk(l){const e={key:l.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(l.size<2)return;if(l.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const r=l.data.subarray(1).indexOf(0);if(r===-1)return;const n=si(Ad(l.data,1,r)),s=l.data[2+r],a=l.data.subarray(3+r).indexOf(0);if(a===-1)return;const u=si(Ad(l.data,3+r,a));let f;return n==="-->"?f=si(Ad(l.data,4+r+a)):f=ck(l.data.subarray(4+r+a)),e.mimeType=n,e.pictureType=s,e.description=u,e.data=f,e}function gk(l){if(l.size<2)return;const e=si(l.data,!0),t=new Uint8Array(l.data.subarray(e.length+1));return{key:l.type,info:e,data:t.buffer}}function mk(l){if(l.size<2)return;if(l.type==="TXXX"){let t=1;const r=si(l.data.subarray(t),!0);t+=r.length+1;const n=si(l.data.subarray(t));return{key:l.type,info:r,data:n}}const e=si(l.data.subarray(1));return{key:l.type,info:"",data:e}}function yk(l){if(l.type==="WXXX"){if(l.size<2)return;let t=1;const r=si(l.data.subarray(t),!0);t+=r.length+1;const n=si(l.data.subarray(t));return{key:l.type,info:r,data:n}}const e=si(l.data);return{key:l.type,info:"",data:e}}function vk(l){return l.type==="PRIV"?gk(l):l.type[0]==="W"?yk(l):l.type==="APIC"?pk(l):mk(l)}function bk(l){const e=String.fromCharCode(l[0],l[1],l[2],l[3]),t=qc(l,4),r=10;return{type:e,size:t,data:l.subarray(r,r+t)}}const Cu=10,Ek=10;function bA(l){let e=0;const t=[];for(;jm(l,e);){const r=qc(l,e+6);l[e+5]>>6&1&&(e+=Cu),e+=Cu;const n=e+r;for(;e+Ek<n;){const s=bk(l.subarray(e)),a=vk(s);a&&t.push(a),e+=s.size+Cu}dA(l,e)&&(e+=Cu)}return t}function EA(l){return l&&l.key==="PRIV"&&l.info==="com.apple.streaming.transportStreamTimestamp"}function Sk(l){if(l.data.byteLength===8){const e=new Uint8Array(l.data),t=e[3]&1;let r=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return r/=45,t&&(r+=4772185884e-2),Math.round(r)}}function Gm(l){const e=bA(l);for(let t=0;t<e.length;t++){const r=e[t];if(EA(r))return Sk(r)}}let ii=(function(l){return l.audioId3="org.id3",l.dateRange="com.apple.quicktime.HLS",l.emsg="https://aomedia.org/emsg/ID3",l.misbklv="urn:misb:KLV:bin:1910.1",l})({});function Mi(l="",e=9e4){return{type:l,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class Hm{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,r,n){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,r){}demux(e,t){this.cachedData&&(e=yi(this.cachedData,e),this.cachedData=null);let r=il(e,0),n=r?r.length:0,s;const a=this._audioTrack,u=this._id3Track,f=r?Gm(r):void 0,c=e.length;for((this.basePTS===null||this.frameIndex===0&&Ye(f))&&(this.basePTS=Tk(f,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),r&&r.length>0&&u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:ii.audioId3,duration:Number.POSITIVE_INFINITY});n<c;){if(this.canParse(e,n)){const d=this.appendFrame(a,e,n);d?(this.frameIndex++,this.lastPTS=d.sample.pts,n+=d.length,s=n):n=c}else uk(e,n)?(r=il(e,n),u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:ii.audioId3,duration:Number.POSITIVE_INFINITY}),n+=r.length,s=n):n++;if(n===c&&s!==c){const d=e.slice(s);this.cachedData?this.cachedData=yi(this.cachedData,d):this.cachedData=d}}return{audioTrack:a,videoTrack:Mi(),id3Track:u,textTrack:Mi()}}demuxSampleAes(e,t,r){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Mi(),id3Track:this._id3Track,textTrack:Mi()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const Tk=(l,e,t)=>{if(Ye(l))return l*90;const r=t?t.baseTime*9e4/t.timescale:0;return e*9e4+r};let Du=null;const xk=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],_k=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Ak=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],wk=[0,1,1,4];function SA(l,e,t,r,n){if(t+24>e.length)return;const s=TA(e,t);if(s&&t+s.frameLength<=e.length){const a=s.samplesPerFrame*9e4/s.sampleRate,u=r+n*a,f={unit:e.subarray(t,t+s.frameLength),pts:u,dts:u};return l.config=[],l.channelCount=s.channelCount,l.samplerate=s.sampleRate,l.samples.push(f),{sample:f,length:s.frameLength,missing:0}}}function TA(l,e){const t=l[e+1]>>3&3,r=l[e+1]>>1&3,n=l[e+2]>>4&15,s=l[e+2]>>2&3;if(t!==1&&n!==0&&n!==15&&s!==3){const a=l[e+2]>>1&1,u=l[e+3]>>6,f=t===3?3-r:r===3?3:4,c=xk[f*14+n-1]*1e3,p=_k[(t===3?0:t===2?1:2)*3+s],m=u===3?1:2,v=Ak[t][r],y=wk[r],b=v*8*y,E=Math.floor(v*c/p+a)*y;if(Du===null){const A=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Du=A?parseInt(A[1]):0}return!!Du&&Du<=87&&r===2&&c>=224e3&&u===0&&(l[e+3]=l[e+3]|128),{sampleRate:p,channelCount:m,frameLength:E,samplesPerFrame:b}}}function Km(l,e){return l[e]===255&&(l[e+1]&224)===224&&(l[e+1]&6)!==0}function xA(l,e){return e+1<l.length&&Km(l,e)}function Rk(l,e){return Km(l,e)&&4<=l.length-e}function _A(l,e){if(e+1<l.length&&Km(l,e)){const r=TA(l,e);let n=4;r!=null&&r.frameLength&&(n=r.frameLength);const s=e+n;return s===l.length||xA(l,s)}return!1}class Ik extends Hm{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,r,n){super.resetInitSegment(e,t,r,n),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const r=il(e,0);let n=r?.length||0;if(_A(e,n))return!1;for(let s=e.length;n<s;n++)if(ok(e,n))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return ak(e,t)}appendFrame(e,t,r){mA(e,this.observer,t,r,e.manifestCodec);const n=vA(e,t,r,this.basePTS,this.frameIndex);if(n&&n.missing===0)return n}}const AA=(l,e)=>{let t=0,r=5;e+=r;const n=new Uint32Array(1),s=new Uint32Array(1),a=new Uint8Array(1);for(;r>0;){a[0]=l[e];const u=Math.min(r,8),f=8-u;s[0]=4278190080>>>24+f<<f,n[0]=(a[0]&s[0])>>f,t=t?t<<u|n[0]:n[0],e+=1,r-=u}return t};class Lk extends Hm{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,r,n){super.resetInitSegment(e,t,r,n),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,r){const n=wA(e,t,r,this.basePTS,this.frameIndex);if(n!==-1)return{sample:e.samples[e.samples.length-1],length:n,missing:0}}static probe(e){if(!e)return!1;const t=il(e,0);if(!t)return!1;const r=t.length;return e[r]===11&&e[r+1]===119&&Gm(t)!==void 0&&AA(e,r)<16}}function wA(l,e,t,r,n){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const s=e[t+4]>>6;if(s>=3)return-1;const u=[48e3,44100,32e3][s],f=e[t+4]&63,d=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][f*3+s]*2;if(t+d>e.length)return-1;const p=e[t+6]>>5;let m=0;p===2?m+=2:(p&1&&p!==1&&(m+=2),p&4&&(m+=2));const v=(e[t+6]<<8|e[t+7])>>12-m&1,b=[2,1,2,3,3,4,4,5][p]+v,E=e[t+5]>>3,x=e[t+5]&7,T=new Uint8Array([s<<6|E<<1|x>>2,(x&3)<<6|p<<3|v<<2|f>>4,f<<4&224]),A=1536/u*9e4,L=r+n*A,w=e.subarray(t,t+d);return l.config=T,l.channelCount=b,l.samplerate=u,l.samples.push({unit:w,pts:L}),d}class Ck extends Hm{resetInitSegment(e,t,r,n){super.resetInitSegment(e,t,r,n),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=il(e,0);let r=t?.length||0;if(t&&e[r]===11&&e[r+1]===119&&Gm(t)!==void 0&&AA(e,r)<=16)return!1;for(let n=e.length;r<n;r++)if(_A(e,r))return At.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return Rk(e,t)}appendFrame(e,t,r){if(this.basePTS!==null)return SA(e,t,r,this.basePTS,this.frameIndex)}}const Dk=/\/emsg[-/]ID3/i;class Ok{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,r,n){const s=this.videoTrack=Mi("video",1),a=this.audioTrack=Mi("audio",1),u=this.txtTrack=Mi("text",1);if(this.id3Track=Mi("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const f=N_(e);if(f.video){const{id:c,timescale:d,codec:p,supplemental:m}=f.video;s.id=c,s.timescale=u.timescale=d,s.codec=p,s.supplemental=m}if(f.audio){const{id:c,timescale:d,codec:p}=f.audio;a.id=c,a.timescale=d,a.codec=p}u.id=k_.text,s.sampleDuration=0,s.duration=a.duration=n}resetContiguity(){this.remainderData=null}static probe(e){return LD(e)}demux(e,t){this.timeOffset=t;let r=e;const n=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=yi(this.remainderData,e));const u=ND(r);this.remainderData=u.remainder,n.samples=u.valid||new Uint8Array}else n.samples=r;const a=this.extractID3Track(n,t);return s.samples=vS(t,n),{videoTrack:n,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const n=this.extractID3Track(t,this.timeOffset);return r.samples=vS(e,t),{videoTrack:t,audioTrack:Mi(),id3Track:n,textTrack:Mi()}}extractID3Track(e,t){const r=this.id3Track;if(e.samples.length){const n=ht(e.samples,["emsg"]);n&&n.forEach(s=>{const a=BD(s);if(Dk.test(a.schemeIdUri)){const u=tT(a,t);let f=a.eventDuration===4294967295?Number.POSITIVE_INFINITY:a.eventDuration/a.timeScale;f<=.001&&(f=Number.POSITIVE_INFINITY);const c=a.payload;r.samples.push({data:c,len:c.byteLength,dts:u,pts:u,type:ii.emsg,duration:f})}else if(this.config.enableEmsgKLVMetadata&&a.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const u=tT(a,t);r.samples.push({data:a.payload,len:a.payload.byteLength,dts:u,pts:u,type:ii.misbklv,duration:Number.POSITIVE_INFINITY})}})}return r}demuxSampleAes(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function tT(l,e){return Ye(l.presentationTime)?l.presentationTime/l.timeScale:e+l.presentationTimeDelta/l.timeScale}class kk{constructor(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new Mm(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,os.cbc)}decryptAacSample(e,t,r){const n=e[t].unit;if(n.length<=16)return;const s=n.subarray(16,n.length-n.length%16),a=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(a).then(u=>{const f=new Uint8Array(u);n.set(f,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,r)}).catch(r)}decryptAacSamples(e,t,r){for(;;t++){if(t>=e.length){r();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,r),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,r=new Int8Array(t);let n=0;for(let s=32;s<e.length-16;s+=160,n+=16)r.set(e.subarray(s,s+16),n);return r}getAvcDecryptedUnit(e,t){const r=new Uint8Array(t);let n=0;for(let s=32;s<e.length-16;s+=160,n+=16)e.set(r.subarray(n,n+16),s);return e}decryptAvcSample(e,t,r,n,s){const a=F_(s.data),u=this.getAvcEncryptedData(a);this.decryptBuffer(u.buffer).then(f=>{s.data=this.getAvcDecryptedUnit(a,f),this.decrypter.isSync()||this.decryptAvcSamples(e,t,r+1,n)}).catch(n)}decryptAvcSamples(e,t,r,n){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length){n();return}const s=e[t].units;for(;!(r>=s.length);r++){const a=s[r];if(!(a.data.length<=48||a.type!==1&&a.type!==5)&&(this.decryptAvcSample(e,t,r,n,a),!this.decrypter.isSync()))return}}}}class RA{constructor(){this.VideoSample=null}createVideoSample(e,t,r){return{key:e,frame:!1,pts:t,dts:r,units:[],length:0}}getLastNalUnit(e){var t;let r=this.VideoSample,n;if((!r||r.units.length===0)&&(r=e[e.length-1]),(t=r)!=null&&t.units){const s=r.units;n=s[s.length-1]}return n}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const r=t.samples,n=r.length;if(n){const s=r[n-1];e.pts=s.pts,e.dts=s.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,r){const n=t.byteLength;let s=e.naluState||0;const a=s,u=[];let f=0,c,d,p,m=-1,v=0;for(s===-1&&(m=0,v=this.getNALuType(t,0),s=0,f=1);f<n;){if(c=t[f++],!s){s=c?0:1;continue}if(s===1){s=c?0:2;continue}if(!c)s=3;else if(c===1){if(d=f-s-1,m>=0){const y={data:t.subarray(m,d),type:v};u.push(y)}else{const y=this.getLastNalUnit(e.samples);y&&(a&&f<=4-a&&y.state&&(y.data=y.data.subarray(0,y.data.byteLength-a)),d>0&&(y.data=yi(y.data,t.subarray(0,d)),y.state=0))}f<n?(p=this.getNALuType(t,f),m=f,v=p,s=0):s=-1}else s=0}if(m>=0&&s>=0){const y={data:t.subarray(m,n),type:v,state:s};u.push(y)}if(u.length===0){const y=this.getLastNalUnit(e.samples);y&&(y.data=yi(y.data,t))}return e.naluState=s,u}}class Wo{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,r=e.byteLength-t,n=new Uint8Array(4),s=Math.min(4,t);if(s===0)throw new Error("no bytes available");n.set(e.subarray(r,r+s)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=s*8,this.bytesAvailable-=s}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const r=this.word>>>32-t;if(e>32&&At.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?r<<t|this.readBits(t):r}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class Mk extends RA{parsePES(e,t,r,n){const s=this.parseNALu(e,r.data,n);let a=this.VideoSample,u,f=!1;r.data=null,a&&s.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),s.forEach(c=>{var d,p;switch(c.type){case 1:{let b=!1;u=!0;const E=c.data;if(f&&E.length>4){const x=this.readSliceType(E);(x===2||x===4||x===7||x===9)&&(b=!0)}if(b){var m;(m=a)!=null&&m.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.frame=!0,a.key=b;break}case 5:u=!0,(d=a)!=null&&d.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.key=!0,a.frame=!0;break;case 6:{u=!0,Cm(c.data,1,r.pts,t.samples);break}case 7:{var v,y;u=!0,f=!0;const b=c.data,E=this.readSPS(b);if(!e.sps||e.width!==E.width||e.height!==E.height||((v=e.pixelRatio)==null?void 0:v[0])!==E.pixelRatio[0]||((y=e.pixelRatio)==null?void 0:y[1])!==E.pixelRatio[1]){e.width=E.width,e.height=E.height,e.pixelRatio=E.pixelRatio,e.sps=[b];const x=b.subarray(1,4);let T="avc1.";for(let A=0;A<3;A++){let L=x[A].toString(16);L.length<2&&(L="0"+L),T+=L}e.codec=T}break}case 8:u=!0,e.pps=[c.data];break;case 9:u=!0,e.audFound=!0,(p=a)!=null&&p.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;case 12:u=!0;break;default:u=!1;break}a&&u&&a.units.push(c)}),n&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new Wo(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let r=8,n=8,s;for(let a=0;a<e;a++)n!==0&&(s=t.readEG(),n=(r+s+256)%256),r=n===0?r:n}readSPS(e){const t=new Wo(e);let r=0,n=0,s=0,a=0,u,f,c;const d=t.readUByte.bind(t),p=t.readBits.bind(t),m=t.readUEG.bind(t),v=t.readBoolean.bind(t),y=t.skipBits.bind(t),b=t.skipEG.bind(t),E=t.skipUEG.bind(t),x=this.skipScalingList.bind(this);d();const T=d();if(p(5),y(3),d(),E(),T===100||T===110||T===122||T===244||T===44||T===83||T===86||T===118||T===128){const O=m();if(O===3&&y(1),E(),E(),y(1),v())for(f=O!==3?8:12,c=0;c<f;c++)v()&&(c<6?x(16,t):x(64,t))}E();const A=m();if(A===0)m();else if(A===1)for(y(1),b(),b(),u=m(),c=0;c<u;c++)b();E(),y(1);const L=m(),w=m(),C=p(1);C===0&&y(1),y(1),v()&&(r=m(),n=m(),s=m(),a=m());let I=[1,1];if(v()&&v())switch(d()){case 1:I=[1,1];break;case 2:I=[12,11];break;case 3:I=[10,11];break;case 4:I=[16,11];break;case 5:I=[40,33];break;case 6:I=[24,11];break;case 7:I=[20,11];break;case 8:I=[32,11];break;case 9:I=[80,33];break;case 10:I=[18,11];break;case 11:I=[15,11];break;case 12:I=[64,33];break;case 13:I=[160,99];break;case 14:I=[4,3];break;case 15:I=[3,2];break;case 16:I=[2,1];break;case 255:{I=[d()<<8|d(),d()<<8|d()];break}}return{width:Math.ceil((L+1)*16-r*2-n*2),height:(2-C)*(w+1)*16-(C?2:4)*(s+a),pixelRatio:I}}}class Pk extends RA{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,r,n){const s=this.parseNALu(e,r.data,n);let a=this.VideoSample,u,f=!1;r.data=null,a&&s.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),s.forEach(c=>{var d,p;switch(c.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:a||(a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),a.frame=!0,u=!0;break;case 16:case 17:case 18:case 21:if(u=!0,f){var m;(m=a)!=null&&m.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.key=!0,a.frame=!0;break;case 19:case 20:u=!0,(d=a)!=null&&d.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.key=!0,a.frame=!0;break;case 39:u=!0,Cm(c.data,2,r.pts,t.samples);break;case 32:u=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=Lt(e.params,this.readVPS(c.data)),this.initVPS=c.data),e.vps=[c.data];break;case 33:if(u=!0,f=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],c.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const v=this.readSPS(c.data);e.width=v.width,e.height=v.height,e.pixelRatio=v.pixelRatio,e.codec=v.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const y in v.params)e.params[y]=v.params[y]}this.pushParameterSet(e.sps,c.data,e.vps),a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.key=!0;break;case 34:if(u=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const v=this.readPPS(c.data);for(const y in v)e.params[y]=v[y]}this.pushParameterSet(e.pps,c.data,e.vps)}break;case 35:u=!0,e.audFound=!0,(p=a)!=null&&p.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;default:u=!1;break}a&&u&&a.units.push(c)}),n&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}pushParameterSet(e,t,r){(r&&r[0]===this.initVPS||!r&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let r=0;for(let n=0;n<e.byteLength;n++)n>=2&&e[n]===3&&e[n-1]===0&&e[n-2]===0||(t[r]=e[n],r++);return new Uint8Array(t.buffer,0,r)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new Wo(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const r=t.readBits(3),n=t.readBoolean();return{numTemporalLayers:r+1,temporalIdNested:n}}readSPS(e){const t=new Wo(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const r=t.readBits(3);t.readBoolean();const n=t.readBits(2),s=t.readBoolean(),a=t.readBits(5),u=t.readUByte(),f=t.readUByte(),c=t.readUByte(),d=t.readUByte(),p=t.readUByte(),m=t.readUByte(),v=t.readUByte(),y=t.readUByte(),b=t.readUByte(),E=t.readUByte(),x=t.readUByte(),T=[],A=[];for(let te=0;te<r;te++)T.push(t.readBoolean()),A.push(t.readBoolean());if(r>0)for(let te=r;te<8;te++)t.readBits(2);for(let te=0;te<r;te++)T[te]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),A[te]&&t.readUByte();t.readUEG();const L=t.readUEG();L==3&&t.skipBits(1);const w=t.readUEG(),C=t.readUEG(),I=t.readBoolean();let O=0,B=0,P=0,$=0;I&&(O+=t.readUEG(),B+=t.readUEG(),P+=t.readUEG(),$+=t.readUEG());const F=t.readUEG(),Z=t.readUEG(),X=t.readUEG(),q=t.readBoolean();for(let te=q?0:r;te<=r;te++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let ge=0;ge<4;ge++)for(let Ie=0;Ie<(ge===3?2:6);Ie++)if(!t.readBoolean())t.readUEG();else{const Ue=Math.min(64,1<<4+(ge<<1));ge>1&&t.readEG();for(let le=0;le<Ue;le++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const z=t.readUEG();let ie=0;for(let te=0;te<z;te++){let ge=!1;if(te!==0&&(ge=t.readBoolean()),ge){te===z&&t.readUEG(),t.readBoolean(),t.readUEG();let Ie=0;for(let Ce=0;Ce<=ie;Ce++){const Ue=t.readBoolean();let le=!1;Ue||(le=t.readBoolean()),(Ue||le)&&Ie++}ie=Ie}else{const Ie=t.readUEG(),Ce=t.readUEG();ie=Ie+Ce;for(let Ue=0;Ue<Ie;Ue++)t.readUEG(),t.readBoolean();for(let Ue=0;Ue<Ce;Ue++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const te=t.readUEG();for(let ge=0;ge<te;ge++){for(let Ie=0;Ie<X+4;Ie++)t.readBits(1);t.readBits(1)}}let U=0,N=1,W=1,ue=!0,ne=1,Ee=0;t.readBoolean(),t.readBoolean();let se=!1;if(t.readBoolean()){if(t.readBoolean()){const Ne=t.readUByte(),Ke=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],Ae=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];Ne>0&&Ne<16?(N=Ke[Ne-1],W=Ae[Ne-1]):Ne===255&&(N=t.readBits(16),W=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),se=t.readBoolean(),se&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(ne=t.readBits(32),Ee=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const Ae=t.readBoolean(),nt=t.readBoolean();let R=!1;(Ae||nt)&&(R=t.readBoolean(),R&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),R&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let D=0;D<=r;D++){ue=t.readBoolean();const j=ue||t.readBoolean();let ae=!1;j?t.readEG():ae=t.readBoolean();const ye=ae?1:t.readUEG()+1;if(Ae)for(let De=0;De<ye;De++)t.readUEG(),t.readUEG(),R&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(nt)for(let De=0;De<ye;De++)t.readUEG(),t.readUEG(),R&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),U=t.readUEG())}let me=w,ce=C;if(I){let te=1,ge=1;L===1?te=ge=2:L==2&&(te=2),me=w-te*B-te*O,ce=C-ge*$-ge*P}const he=n?["A","B","C"][n]:"",pe=u<<24|f<<16|c<<8|d;let Fe=0;for(let te=0;te<32;te++)Fe=(Fe|(pe>>te&1)<<31-te)>>>0;let Re=Fe.toString(16);return a===1&&Re==="2"&&(Re="6"),{codecString:`hvc1.${he}${a}.${Re}.${s?"H":"L"}${x}.B0`,params:{general_tier_flag:s,general_profile_idc:a,general_profile_space:n,general_profile_compatibility_flags:[u,f,c,d],general_constraint_indicator_flags:[p,m,v,y,b,E],general_level_idc:x,bit_depth:F+8,bit_depth_luma_minus8:F,bit_depth_chroma_minus8:Z,min_spatial_segmentation_idc:U,chroma_format_idc:L,frame_rate:{fixed:ue,fps:Ee/ne}},width:me,height:ce,pixelRatio:[N,W]}}readPPS(e){const t=new Wo(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const n=t.readBoolean(),s=t.readBoolean();let a=1;return s&&n?a=0:s?a=3:n&&(a=2),{parallelismType:a}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const cr=188;class is{constructor(e,t,r,n){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.logger=n,this.videoParser=null}static probe(e,t){const r=is.syncOffset(e);return r>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${r}`),r!==-1}static syncOffset(e){const t=e.length;let r=Math.min(cr*5,t-cr)+1,n=0;for(;n<r;){let s=!1,a=-1,u=0;for(let f=n;f<t;f+=cr)if(e[f]===71&&(t-f===cr||e[f+cr]===71)){if(u++,a===-1&&(a=f,a!==0&&(r=Math.min(a+cr*99,e.length-cr)+1)),s||(s=Xg(e,f)===0),s&&u>1&&(a===0&&u>2||f+cr>r))return a}else{if(u)return-1;break}n++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:k_[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,r,n){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=is.createTrack("video"),this._videoTrack.duration=n,this._audioTrack=is.createTrack("audio",n),this._id3Track=is.createTrack("id3"),this._txtTrack=is.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=r}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:r}=this;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,r=!1,n=!1){r||(this.sampleAes=null);let s;const a=this._videoTrack,u=this._audioTrack,f=this._id3Track,c=this._txtTrack;let d=a.pid,p=a.pesData,m=u.pid,v=f.pid,y=u.pesData,b=f.pesData,E=null,x=this.pmtParsed,T=this._pmtId,A=e.length;if(this.remainderData&&(e=yi(this.remainderData,e),A=e.length,this.remainderData=null),A<cr&&!n)return this.remainderData=e,{audioTrack:u,videoTrack:a,id3Track:f,textTrack:c};const L=Math.max(0,is.syncOffset(e));A-=(A-L)%cr,A<e.byteLength&&!n&&(this.remainderData=new Uint8Array(e.buffer,A,e.buffer.byteLength-A));let w=0;for(let I=L;I<A;I+=cr)if(e[I]===71){const O=!!(e[I+1]&64),B=Xg(e,I),P=(e[I+3]&48)>>4;let $;if(P>1){if($=I+5+e[I+4],$===I+cr)continue}else $=I+4;switch(B){case d:O&&(p&&(s=Ia(p,this.logger))&&(this.readyVideoParser(a.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(a,c,s,!1)),p={data:[],size:0}),p&&(p.data.push(e.subarray($,I+cr)),p.size+=I+cr-$);break;case m:if(O){if(y&&(s=Ia(y,this.logger)))switch(u.segmentCodec){case"aac":this.parseAACPES(u,s);break;case"mp3":this.parseMPEGPES(u,s);break;case"ac3":this.parseAC3PES(u,s);break}y={data:[],size:0}}y&&(y.data.push(e.subarray($,I+cr)),y.size+=I+cr-$);break;case v:O&&(b&&(s=Ia(b,this.logger))&&this.parseID3PES(f,s),b={data:[],size:0}),b&&(b.data.push(e.subarray($,I+cr)),b.size+=I+cr-$);break;case 0:O&&($+=e[$]+1),T=this._pmtId=Nk(e,$);break;case T:{O&&($+=e[$]+1);const F=Uk(e,$,this.typeSupported,r,this.observer,this.logger);d=F.videoPid,d>0&&(a.pid=d,a.segmentCodec=F.segmentVideoCodec),m=F.audioPid,m>0&&(u.pid=m,u.segmentCodec=F.segmentAudioCodec),v=F.id3Pid,v>0&&(f.pid=v),E!==null&&!x&&(this.logger.warn(`MPEG-TS PMT found at ${I} after unknown PID '${E}'. Backtracking to sync byte @${L} to parse all TS packets.`),E=null,I=L-188),x=this.pmtParsed=!0;break}case 17:case 8191:break;default:E=B;break}}else w++;w>0&&Zg(this.observer,new Error(`Found ${w} TS packet/s that do not start with 0x47`),void 0,this.logger),a.pesData=p,u.pesData=y,f.pesData=b;const C={audioTrack:u,videoTrack:a,id3Track:f,textTrack:c};return n&&this.extractRemainingSamples(C),C}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:r,id3Track:n,textTrack:s}=e,a=r.pesData,u=t.pesData,f=n.pesData;let c;if(a&&(c=Ia(a,this.logger))?(this.readyVideoParser(r.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(r,s,c,!0),r.pesData=null)):r.pesData=a,u&&(c=Ia(u,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,c);break;case"mp3":this.parseMPEGPES(t,c);break;case"ac3":this.parseAC3PES(t,c);break}t.pesData=null}else u!=null&&u.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=u;f&&(c=Ia(f,this.logger))?(this.parseID3PES(n,c),n.pesData=null):n.pesData=f}demuxSampleAes(e,t,r){const n=this.demux(e,r,!0,!this.config.progressive),s=this.sampleAes=new kk(this.observer,this.config,t);return this.decrypt(n,s)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new Mk:e==="hevc"&&(this.videoParser=new Pk))}decrypt(e,t){return new Promise(r=>{const{audioTrack:n,videoTrack:s}=e;n.samples&&n.segmentCodec==="aac"?t.decryptAacSamples(n.samples,0,()=>{s.samples?t.decryptAvcSamples(s.samples,0,0,()=>{r(e)}):r(e)}):s.samples&&t.decryptAvcSamples(s.samples,0,0,()=>{r(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let r=0;const n=this.aacOverFlow;let s=t.data;if(n){this.aacOverFlow=null;const p=n.missing,m=n.sample.unit.byteLength;if(p===-1)s=yi(n.sample.unit,s);else{const v=m-p;n.sample.unit.set(s.subarray(0,p),v),e.samples.push(n.sample),r=n.missing}}let a,u;for(a=r,u=s.length;a<u-1&&!Nc(s,a);a++);if(a!==r){let p;const m=a<u-1;if(m?p=`AAC PES did not start with ADTS header,offset:${a}`:p="No ADTS header found in AAC PES",Zg(this.observer,new Error(p),m,this.logger),!m)return}mA(e,this.observer,s,a,this.audioCodec);let f;if(t.pts!==void 0)f=t.pts;else if(n){const p=yA(e.samplerate);f=n.sample.pts+p}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let c=0,d;for(;a<u;)if(d=vA(e,s,a,f,c),a+=d.length,d.missing){this.aacOverFlow=d;break}else for(c++;a<u-1&&!Nc(s,a);a++);}parseMPEGPES(e,t){const r=t.data,n=r.length;let s=0,a=0;const u=t.pts;if(u===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;a<n;)if(xA(r,a)){const f=SA(e,r,a,u,s);if(f)a+=f.length,s++;else break}else a++}parseAC3PES(e,t){{const r=t.data,n=t.pts;if(n===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const s=r.length;let a=0,u=0,f;for(;u<s&&(f=wA(e,r,u,n,a++))>0;)u+=f}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const r=Lt({},t,{type:this._videoTrack?ii.emsg:ii.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(r)}}function Xg(l,e){return((l[e+1]&31)<<8)+l[e+2]}function Nk(l,e){return(l[e+10]&31)<<8|l[e+11]}function Uk(l,e,t,r,n,s){const a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},u=(l[e+1]&15)<<8|l[e+2],f=e+3+u-4,c=(l[e+10]&15)<<8|l[e+11];for(e+=12+c;e<f;){const d=Xg(l,e),p=(l[e+3]&15)<<8|l[e+4];switch(l[e]){case 207:if(!r){wd("ADTS AAC",s);break}case 15:a.audioPid===-1&&(a.audioPid=d);break;case 21:a.id3Pid===-1&&(a.id3Pid=d);break;case 219:if(!r){wd("H.264",s);break}case 27:a.videoPid===-1&&(a.videoPid=d);break;case 3:case 4:!t.mpeg&&!t.mp3?s.log("MPEG audio found, not supported in this browser"):a.audioPid===-1&&(a.audioPid=d,a.segmentAudioCodec="mp3");break;case 193:if(!r){wd("AC-3",s);break}case 129:t.ac3?a.audioPid===-1&&(a.audioPid=d,a.segmentAudioCodec="ac3"):s.log("AC-3 audio found, not supported in this browser");break;case 6:if(a.audioPid===-1&&p>0){let m=e+5,v=p;for(;v>2;){switch(l[m]){case 106:t.ac3!==!0?s.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=d,a.segmentAudioCodec="ac3");break}const b=l[m+1]+2;m+=b,v-=b}}break;case 194:case 135:return Zg(n,new Error("Unsupported EC-3 in M2TS found"),void 0,s),a;case 36:a.videoPid===-1&&(a.videoPid=d,a.segmentVideoCodec="hevc",s.log("HEVC in M2TS found"));break}e+=p+5}return a}function Zg(l,e,t,r){r.warn(`parsing error: ${e.message}`),l.emit(M.ERROR,M.ERROR,{type:tt.MEDIA_ERROR,details:Se.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function wd(l,e){e.log(`${l} with AES-128-CBC encryption found in unencrypted stream`)}function Ia(l,e){let t=0,r,n,s,a,u;const f=l.data;if(!l||l.size===0)return null;for(;f[0].length<19&&f.length>1;)f[0]=yi(f[0],f[1]),f.splice(1,1);if(r=f[0],(r[0]<<16)+(r[1]<<8)+r[2]===1){if(n=(r[4]<<8)+r[5],n&&n>l.size-6)return null;const d=r[7];d&192&&(a=(r[9]&14)*536870912+(r[10]&255)*4194304+(r[11]&254)*16384+(r[12]&255)*128+(r[13]&254)/2,d&64?(u=(r[14]&14)*536870912+(r[15]&255)*4194304+(r[16]&254)*16384+(r[17]&255)*128+(r[18]&254)/2,a-u>60*9e4&&(e.warn(`${Math.round((a-u)/9e4)}s delta between PTS and DTS, align them`),a=u)):u=a),s=r[8];let p=s+9;if(l.size<=p)return null;l.size-=p;const m=new Uint8Array(l.size);for(let v=0,y=f.length;v<y;v++){r=f[v];let b=r.byteLength;if(p)if(p>b){p-=b;continue}else r=r.subarray(p),b-=p,p=0;m.set(r,t),t+=b}return n&&(n-=s+3),{data:m,pts:a,dts:u,len:n}}return null}class Bk{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Xn=Math.pow(2,32)-1;class be{static init(){be.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in be.types)be.types.hasOwnProperty(e)&&(be.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);be.HDLR_TYPES={video:t,audio:r};const n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);be.STTS=be.STSC=be.STCO=s,be.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),be.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),be.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),be.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),u=new Uint8Array([97,118,99,49]),f=new Uint8Array([0,0,0,1]);be.FTYP=be.box(be.types.ftyp,a,f,a,u),be.DINF=be.box(be.types.dinf,be.box(be.types.dref,n))}static box(e,...t){let r=8,n=t.length;const s=n;for(;n--;)r+=t[n].byteLength;const a=new Uint8Array(r);for(a[0]=r>>24&255,a[1]=r>>16&255,a[2]=r>>8&255,a[3]=r&255,a.set(e,4),n=0,r=8;n<s;n++)a.set(t[n],r),r+=t[n].byteLength;return a}static hdlr(e){return be.box(be.types.hdlr,be.HDLR_TYPES[e])}static mdat(e){return be.box(be.types.mdat,e)}static mdhd(e,t){t*=e;const r=Math.floor(t/(Xn+1)),n=Math.floor(t%(Xn+1));return be.box(be.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,n>>24,n>>16&255,n>>8&255,n&255,85,196,0,0]))}static mdia(e){return be.box(be.types.mdia,be.mdhd(e.timescale||0,e.duration||0),be.hdlr(e.type),be.minf(e))}static mfhd(e){return be.box(be.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?be.box(be.types.minf,be.box(be.types.smhd,be.SMHD),be.DINF,be.stbl(e)):be.box(be.types.minf,be.box(be.types.vmhd,be.VMHD),be.DINF,be.stbl(e))}static moof(e,t,r){return be.box(be.types.moof,be.mfhd(e),be.traf(r,t))}static moov(e){let t=e.length;const r=[];for(;t--;)r[t]=be.trak(e[t]);return be.box.apply(null,[be.types.moov,be.mvhd(e[0].timescale||0,e[0].duration||0)].concat(r).concat(be.mvex(e)))}static mvex(e){let t=e.length;const r=[];for(;t--;)r[t]=be.trex(e[t]);return be.box.apply(null,[be.types.mvex,...r])}static mvhd(e,t){t*=e;const r=Math.floor(t/(Xn+1)),n=Math.floor(t%(Xn+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,n>>24,n>>16&255,n>>8&255,n&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return be.box(be.types.mvhd,s)}static sdtp(e){const t=e.samples||[],r=new Uint8Array(4+t.length);let n,s;for(n=0;n<t.length;n++)s=t[n].flags,r[n+4]=s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy;return be.box(be.types.sdtp,r)}static stbl(e){return be.box(be.types.stbl,be.stsd(e),be.box(be.types.stts,be.STTS),be.box(be.types.stsc,be.STSC),be.box(be.types.stsz,be.STSZ),be.box(be.types.stco,be.STCO))}static avc1(e){let t=[],r=[],n,s,a;for(n=0;n<e.sps.length;n++)s=e.sps[n],a=s.byteLength,t.push(a>>>8&255),t.push(a&255),t=t.concat(Array.prototype.slice.call(s));for(n=0;n<e.pps.length;n++)s=e.pps[n],a=s.byteLength,r.push(a>>>8&255),r.push(a&255),r=r.concat(Array.prototype.slice.call(s));const u=be.box(be.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(r))),f=e.width,c=e.height,d=e.pixelRatio[0],p=e.pixelRatio[1];return be.box(be.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,f>>8&255,f&255,c>>8&255,c&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u,be.box(be.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),be.box(be.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,d&255,p>>24,p>>16&255,p>>8&255,p&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return be.box(be.types.mp4a,be.audioStsd(e),be.box(be.types.esds,be.esds(e)))}static mp3(e){return be.box(be.types[".mp3"],be.audioStsd(e))}static ac3(e){return be.box(be.types["ac-3"],be.audioStsd(e),be.box(be.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return be.box(be.types.stsd,be.STSD,be.mp4a(e));if(t==="ac3"&&e.config)return be.box(be.types.stsd,be.STSD,be.ac3(e));if(t==="mp3"&&e.codec==="mp3")return be.box(be.types.stsd,be.STSD,be.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return be.box(be.types.stsd,be.STSD,be.avc1(e));if(t==="hevc"&&e.vps)return be.box(be.types.stsd,be.STSD,be.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,r=(e.duration||0)*(e.timescale||0),n=e.width||0,s=e.height||0,a=Math.floor(r/(Xn+1)),u=Math.floor(r%(Xn+1));return be.box(be.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,u>>24,u>>16&255,u>>8&255,u&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,n&255,0,0,s>>8&255,s&255,0,0]))}static traf(e,t){const r=be.sdtp(e),n=e.id,s=Math.floor(t/(Xn+1)),a=Math.floor(t%(Xn+1));return be.box(be.types.traf,be.box(be.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,n&255])),be.box(be.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,s&255,a>>24,a>>16&255,a>>8&255,a&255])),be.trun(e,r.length+16+20+8+16+8+8),r)}static trak(e){return e.duration=e.duration||4294967295,be.box(be.types.trak,be.tkhd(e),be.mdia(e))}static trex(e){const t=e.id;return be.box(be.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const r=e.samples||[],n=r.length,s=12+16*n,a=new Uint8Array(s);let u,f,c,d,p,m;for(t+=8+s,a.set([e.type==="video"?1:0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,n&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),u=0;u<n;u++)f=r[u],c=f.duration,d=f.size,p=f.flags,m=f.cts,a.set([c>>>24&255,c>>>16&255,c>>>8&255,c&255,d>>>24&255,d>>>16&255,d>>>8&255,d&255,p.isLeading<<2|p.dependsOn,p.isDependedOn<<6|p.hasRedundancy<<4|p.paddingValue<<1|p.isNonSync,p.degradPrio&61440,p.degradPrio&15,m>>>24&255,m>>>16&255,m>>>8&255,m&255],12+16*u);return be.box(be.types.trun,a)}static initSegment(e){be.types||be.init();const t=be.moov(e);return yi(be.FTYP,t)}static hvc1(e){const t=e.params,r=[e.vps,e.sps,e.pps],n=4,s=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),n-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),r.length]);let a=s.length;for(let y=0;y<r.length;y+=1){a+=3;for(let b=0;b<r[y].length;b+=1)a+=2+r[y][b].length}const u=new Uint8Array(a);u.set(s,0),a=s.length;const f=r.length-1;for(let y=0;y<r.length;y+=1){u.set(new Uint8Array([32+y|(y===f?128:0),0,r[y].length]),a),a+=3;for(let b=0;b<r[y].length;b+=1)u.set(new Uint8Array([r[y][b].length>>8,r[y][b].length&255]),a),a+=2,u.set(r[y][b],a),a+=r[y][b].length}const c=be.box(be.types.hvcC,u),d=e.width,p=e.height,m=e.pixelRatio[0],v=e.pixelRatio[1];return be.box(be.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,d>>8&255,d&255,p>>8&255,p&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,be.box(be.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),be.box(be.types.pasp,new Uint8Array([m>>24,m>>16&255,m>>8&255,m&255,v>>24,v>>16&255,v>>8&255,v&255])))}}be.types=void 0;be.HDLR_TYPES=void 0;be.STTS=void 0;be.STSC=void 0;be.STCO=void 0;be.STSZ=void 0;be.VMHD=void 0;be.SMHD=void 0;be.STSD=void 0;be.FTYP=void 0;be.DINF=void 0;const IA=9e4;function Vm(l,e,t=1,r=!1){const n=l*e*t;return r?Math.round(n):n}function Fk(l,e,t=1,r=!1){return Vm(l,e,1/t,r)}function jo(l,e=!1){return Vm(l,1e3,1/IA,e)}function jk(l,e=1){return Vm(l,IA,1/e)}function rT(l){const{baseTime:e,timescale:t,trackId:r}=l;return`${e/t} (${e}/${t}) trackId: ${r}`}const $k=10*1e3,Gk=1024,Hk=1152,Kk=1536;let La=null,Rd=null;function iT(l,e,t,r){return{duration:e,size:t,cts:r,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:l?2:1,isNonSync:l?0:1}}}class vc extends vi{constructor(e,t,r,n){if(super("mp4-remuxer",n),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,La===null){const a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);La=a?parseInt(a[1]):0}if(Rd===null){const s=navigator.userAgent.match(/Safari\/(\d+)/i);Rd=s?parseInt(s[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&rT(t)} > ${e&&rT(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const r=e[0].pts,n=e.reduce((s,a)=>{let u=a.pts,f=u-s;return f<-4294967296&&(t=!0,u=ri(u,r),f=u-s),f>0?s:u},r);return t&&this.debug("PTS rollover detected"),n}remux(e,t,r,n,s,a,u,f){let c,d,p,m,v,y,b=s,E=s;const x=e.pid>-1,T=t.pid>-1,A=t.samples.length,L=e.samples.length>0,w=u&&A>0||A>1;if((!x||L)&&(!T||w)||this.ISGenerated||u){if(this.ISGenerated){var I,O,B,P;const X=this.videoTrackConfig;(X&&(t.width!==X.width||t.height!==X.height||((I=t.pixelRatio)==null?void 0:I[0])!==((O=X.pixelRatio)==null?void 0:O[0])||((B=t.pixelRatio)==null?void 0:B[1])!==((P=X.pixelRatio)==null?void 0:P[1]))||!X&&w||this.nextAudioTs===null&&L)&&this.resetInitSegment()}this.ISGenerated||(p=this.generateIS(e,t,s,a));const $=this.isVideoContiguous;let F=-1,Z;if(w&&(F=Vk(t.samples),!$&&this.config.forceKeyFrameOnDiscontinuity))if(y=!0,F>0){this.warn(`Dropped ${F} out of ${A} video samples due to a missing keyframe`);const X=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(F),t.dropped+=F,E+=(t.samples[0].pts-X)/t.inputTimeScale,Z=E}else F===-1&&(this.warn(`No keyframe found out of ${A} video samples`),y=!1);if(this.ISGenerated){if(L&&w){const X=this.getVideoStartPts(t.samples),H=(ri(e.samples[0].pts,X)-X)/t.inputTimeScale;b+=Math.max(0,H),E+=Math.max(0,-H)}if(L){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),p=this.generateIS(e,t,s,a)),d=this.remuxAudio(e,b,this.isAudioContiguous,a,T||w||f===Xe.AUDIO?E:void 0),w){const X=d?d.endPTS-d.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),p=this.generateIS(e,t,s,a)),c=this.remuxVideo(t,E,$,X)}}else w&&(c=this.remuxVideo(t,E,$,0));c&&(c.firstKeyFrame=F,c.independent=F!==-1,c.firstKeyFramePTS=Z)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(v=LA(r,s,this._initPTS,this._initDTS)),n.samples.length&&(m=CA(n,s,this._initPTS))),{audio:d,video:c,initSegment:p,independent:y,text:m,id3:v}}computeInitPts(e,t,r,n){const s=Math.round(r*t);let a=ri(e,s);if(a<s+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(s-a)/t} ${n}`);a<s+t;)a+=8589934592;return a-s}generateIS(e,t,r,n){const s=e.samples,a=t.samples,u=this.typeSupported,f={},c=this._initPTS;let d=!c||n,p="audio/mp4",m,v,y,b=-1;if(d&&(m=v=1/0),e.config&&s.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":u.mpeg?(p="audio/mpeg",e.codec=""):u.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}f.audio={id:"audio",container:p,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&u.mpeg?new Uint8Array(0):be.initSegment([e]),metadata:{channelCount:e.channelCount}},d&&(b=e.id,y=e.inputTimeScale,!c||y!==c.timescale?m=v=this.computeInitPts(s[0].pts,y,r,"audio"):d=!1)}if(t.sps&&t.pps&&a.length){if(t.timescale=t.inputTimeScale,f.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:be.initSegment([t]),metadata:{width:t.width,height:t.height}},d)if(b=t.id,y=t.inputTimeScale,!c||y!==c.timescale){const E=this.getVideoStartPts(a),x=ri(a[0].dts,E),T=this.computeInitPts(x,y,r,"video"),A=this.computeInitPts(E,y,r,"video");v=Math.min(v,T),m=Math.min(m,A)}else d=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(f).length)return this.ISGenerated=!0,d?(c&&this.warn(`Timestamps at playlist time: ${n?"":"~"}${r} ${m/y} != initPTS: ${c.baseTime/c.timescale} (${c.baseTime}/${c.timescale}) trackId: ${c.trackId}`),this.log(`Found initPTS at playlist time: ${r} offset: ${m/y} (${m}/${y}) trackId: ${b}`),this._initPTS={baseTime:m,timescale:y,trackId:b},this._initDTS={baseTime:v,timescale:y,trackId:b}):m=y=void 0,{tracks:f,initPTS:m,timescale:y,trackId:b}}remuxVideo(e,t,r,n){const s=e.inputTimeScale,a=e.samples,u=[],f=a.length,c=this._initPTS,d=c.baseTime*s/c.timescale;let p=this.nextVideoTs,m=8,v=this.videoSampleDuration,y,b,E=Number.POSITIVE_INFINITY,x=Number.NEGATIVE_INFINITY,T=!1;if(!r||p===null){const U=d+t*s,N=a[0].pts-ri(a[0].dts,a[0].pts);La&&p!==null&&Math.abs(U-N-(p+d))<15e3?r=!0:p=U-N-d}const A=p+d;for(let U=0;U<f;U++){const N=a[U];N.pts=ri(N.pts,A),N.dts=ri(N.dts,A),N.dts<a[U>0?U-1:U].dts&&(T=!0)}T&&a.sort(function(U,N){const W=U.dts-N.dts,ue=U.pts-N.pts;return W||ue}),y=a[0].dts,b=a[a.length-1].dts;const L=b-y,w=L?Math.round(L/(f-1)):v||e.inputTimeScale/30;if(r){const U=y-A,N=U>w,W=U<-1;if((N||W)&&(N?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${jo(U,!0)} ms (${U}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${jo(-U,!0)} ms (${U}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!W||A>=a[0].pts||La)){y=A;const ue=a[0].pts-U;if(N)a[0].dts=y,a[0].pts=ue;else{let ne=!0;for(let Ee=0;Ee<a.length&&!(a[Ee].dts>ue&&ne);Ee++){const se=a[Ee].pts;if(a[Ee].dts-=U,a[Ee].pts-=U,Ee<a.length-1){const J=a[Ee+1].pts,me=a[Ee].pts,ce=J<=me,he=J<=se;ne=ce==he}}}this.log(`Video: Initial PTS/DTS adjusted: ${jo(ue,!0)}/${jo(y,!0)}, delta: ${jo(U,!0)} ms`)}}y=Math.max(0,y);let C=0,I=0,O=y;for(let U=0;U<f;U++){const N=a[U],W=N.units,ue=W.length;let ne=0;for(let Ee=0;Ee<ue;Ee++)ne+=W[Ee].data.length;I+=ne,C+=ue,N.length=ne,N.dts<O?(N.dts=O,O+=w/4|0||1):O=N.dts,E=Math.min(N.pts,E),x=Math.max(N.pts,x)}b=a[f-1].dts;const B=I+4*C+8;let P;try{P=new Uint8Array(B)}catch(U){this.observer.emit(M.ERROR,M.ERROR,{type:tt.MUX_ERROR,details:Se.REMUX_ALLOC_ERROR,fatal:!1,error:U,bytes:B,reason:`fail allocating video mdat ${B}`});return}const $=new DataView(P.buffer);$.setUint32(0,B),P.set(be.types.mdat,4);let F=!1,Z=Number.POSITIVE_INFINITY,X=Number.POSITIVE_INFINITY,q=Number.NEGATIVE_INFINITY,H=Number.NEGATIVE_INFINITY;for(let U=0;U<f;U++){const N=a[U],W=N.units;let ue=0;for(let se=0,J=W.length;se<J;se++){const me=W[se],ce=me.data,he=me.data.byteLength;$.setUint32(m,he),m+=4,P.set(ce,m),m+=he,ue+=4+he}let ne;if(U<f-1)v=a[U+1].dts-N.dts,ne=a[U+1].pts-N.pts;else{const se=this.config,J=U>0?N.dts-a[U-1].dts:w;if(ne=U>0?N.pts-a[U-1].pts:w,se.stretchShortVideoTrack&&this.nextAudioTs!==null){const me=Math.floor(se.maxBufferHole*s),ce=(n?E+n*s:this.nextAudioTs+d)-N.pts;ce>me?(v=ce-J,v<0?v=J:F=!0,this.log(`It is approximately ${ce/90} ms to the next segment; using duration ${v/90} ms for the last video frame.`)):v=J}else v=J}const Ee=Math.round(N.pts-N.dts);Z=Math.min(Z,v),q=Math.max(q,v),X=Math.min(X,ne),H=Math.max(H,ne),u.push(iT(N.key,v,ue,Ee))}if(u.length){if(La){if(La<70){const U=u[0].flags;U.dependsOn=2,U.isNonSync=0}}else if(Rd&&H-X<q-Z&&w/q<.025&&u[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let U=y;for(let N=0,W=u.length;N<W;N++){const ue=U+u[N].duration,ne=U+u[N].cts;if(N<W-1){const Ee=ue+u[N+1].cts;u[N].duration=Ee-ne}else u[N].duration=N?u[N-1].duration:w;u[N].cts=0,U=ue}}}v=F||!v?w:v;const K=b+v;this.nextVideoTs=p=K-d,this.videoSampleDuration=v,this.isVideoContiguous=!0;const Y={data1:be.moof(e.sequenceNumber++,y,Lt(e,{samples:u})),data2:P,startPTS:(E-d)/s,endPTS:(x+v-d)/s,startDTS:(y-d)/s,endDTS:p/s,type:"video",hasAudio:!1,hasVideo:!0,nb:u.length,dropped:e.dropped};return e.samples=[],e.dropped=0,Y}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return Hk;case"ac3":return Kk;default:return Gk}}remuxAudio(e,t,r,n,s){const a=e.inputTimeScale,u=e.samplerate?e.samplerate:a,f=a/u,c=this.getSamplesPerFrame(e),d=c*f,p=this._initPTS,m=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,v=[],y=s!==void 0;let b=e.samples,E=m?0:8,x=this.nextAudioTs||-1;const T=p.baseTime*a/p.timescale,A=T+t*a;if(this.isAudioContiguous=r=r||b.length&&x>0&&(n&&Math.abs(A-(x+T))<9e3||Math.abs(ri(b[0].pts,A)-(x+T))<20*d),b.forEach(function(H){H.pts=ri(H.pts,A)}),!r||x<0){const H=b.length;if(b=b.filter(K=>K.pts>=0),H!==b.length&&this.warn(`Removed ${b.length-H} of ${H} samples (initPTS ${T} / ${a})`),!b.length)return;s===0?x=0:n&&!y?x=Math.max(0,A-T):x=b[0].pts-T}if(e.segmentCodec==="aac"){const H=this.config.maxAudioFramesDrift;for(let K=0,z=x+T;K<b.length;K++){const ie=b[K],Y=ie.pts,U=Y-z,N=Math.abs(1e3*U/a);if(U<=-H*d&&y)K===0&&(this.warn(`Audio frame @ ${(Y/a).toFixed(3)}s overlaps marker by ${Math.round(1e3*U/a)} ms.`),this.nextAudioTs=x=Y-T,z=Y);else if(U>=H*d&&N<$k&&y){let W=Math.round(U/d);for(z=Y-W*d;z<0&&W&&d;)W--,z+=d;K===0&&(this.nextAudioTs=x=z-T),this.warn(`Injecting ${W} audio frames @ ${((z-T)/a).toFixed(3)}s due to ${Math.round(1e3*U/a)} ms gap.`);for(let ue=0;ue<W;ue++){let ne=Bk.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);ne||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),ne=ie.unit.subarray()),b.splice(K,0,{unit:ne,pts:z}),z+=d,K++}}ie.pts=z,z+=d}}let L=null,w=null,C,I=0,O=b.length;for(;O--;)I+=b[O].unit.byteLength;for(let H=0,K=b.length;H<K;H++){const z=b[H],ie=z.unit;let Y=z.pts;if(w!==null){const N=v[H-1];N.duration=Math.round((Y-w)/f)}else if(r&&e.segmentCodec==="aac"&&(Y=x+T),L=Y,I>0){I+=E;try{C=new Uint8Array(I)}catch(N){this.observer.emit(M.ERROR,M.ERROR,{type:tt.MUX_ERROR,details:Se.REMUX_ALLOC_ERROR,fatal:!1,error:N,bytes:I,reason:`fail allocating audio mdat ${I}`});return}m||(new DataView(C.buffer).setUint32(0,I),C.set(be.types.mdat,4))}else return;C.set(ie,E);const U=ie.byteLength;E+=U,v.push(iT(!0,c,U,0)),w=Y}const B=v.length;if(!B)return;const P=v[v.length-1];x=w-T,this.nextAudioTs=x+f*P.duration;const $=m?new Uint8Array(0):be.moof(e.sequenceNumber++,L/f,Lt({},e,{samples:v}));e.samples=[];const F=(L-T)/a,Z=this.nextAudioTs/a,q={data1:$,data2:C,startPTS:F,endPTS:Z,startDTS:F,endDTS:Z,type:"audio",hasAudio:!0,hasVideo:!1,nb:B};return this.isAudioContiguous=!0,q}}function ri(l,e){let t;if(e===null)return l;for(e<l?t=-8589934592:t=8589934592;Math.abs(l-e)>4294967296;)l+=t;return l}function Vk(l){for(let e=0;e<l.length;e++)if(l[e].key)return e;return-1}function LA(l,e,t,r){const n=l.samples.length;if(!n)return;const s=l.inputTimeScale;for(let u=0;u<n;u++){const f=l.samples[u];f.pts=ri(f.pts-t.baseTime*s/t.timescale,e*s)/s,f.dts=ri(f.dts-r.baseTime*s/r.timescale,e*s)/s}const a=l.samples;return l.samples=[],{samples:a}}function CA(l,e,t){const r=l.samples.length;if(!r)return;const n=l.inputTimeScale;for(let a=0;a<r;a++){const u=l.samples[a];u.pts=ri(u.pts-t.baseTime*n/t.timescale,e*n)/n}l.samples.sort((a,u)=>a.pts-u.pts);const s=l.samples;return l.samples=[],{samples:s}}class zk extends vi{constructor(e,t,r,n){super("passthrough-remuxer",n),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,r,n){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(e,n),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:r,videoCodec:n}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:s,video:a}=this.initData=N_(e);if(t)kD(e,t);else{const f=s||a;f!=null&&f.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${f.codec}")!`)}s&&(r=nT(s,Ot.AUDIO,this)),a&&(n=nT(a,Ot.VIDEO,this));const u={};s&&a?u.audiovideo={container:"video/mp4",codec:r+","+n,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:s?u.audio={container:"audio/mp4",codec:r,encrypted:s.encrypted,initSegment:e,id:"audio"}:a?u.video={container:"video/mp4",codec:n,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=u}remux(e,t,r,n,s,a){var u,f;let{initPTS:c,lastEndTime:d}=this;const p={audio:void 0,video:void 0,text:n,id3:r,initSegment:void 0};Ye(d)||(d=this.lastEndTime=s||0);const m=t.samples;if(!m.length)return p;const v={initPTS:void 0,timescale:void 0,trackId:void 0};let y=this.initData;if((u=y)!=null&&u.length||(this.generateInitSegment(m),y=this.initData),!((f=y)!=null&&f.length))return this.warn("Failed to generate initSegment."),p;this.emitInitSegment&&(v.tracks=this.initTracks,this.emitInitSegment=!1);const b=PD(m,y,this),E=y.audio?b[y.audio.id]:null,x=y.video?b[y.video.id]:null,T=Ou(x,1/0),A=Ou(E,1/0),L=Ou(x,0,!0),w=Ou(E,0,!0);let C=s,I=0;const O=E&&(!x||!c&&A<T||c&&c.trackId===y.audio.id),B=O?E:x;if(B){const z=B.timescale,ie=B.start-s*z,Y=O?y.audio.id:y.video.id;C=B.start/z,I=O?w-A:L-T,(a||!c)&&(qk(c,C,s,I)||z!==c.timescale)&&(c&&this.warn(`Timestamps at playlist time: ${a?"":"~"}${s} ${ie/z} != initPTS: ${c.baseTime/c.timescale} (${c.baseTime}/${c.timescale}) trackId: ${c.trackId}`),this.log(`Found initPTS at playlist time: ${s} offset: ${C-s} (${ie}/${z}) trackId: ${Y}`),c=null,v.initPTS=ie,v.timescale=z,v.trackId=Y)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${s}`);c?(v.initPTS=c.baseTime,v.timescale=c.timescale,v.trackId=c.trackId):((!v.timescale||v.trackId===void 0||v.initPTS===void 0)&&(this.warn("Could not set initPTS"),v.initPTS=C,v.timescale=1,v.trackId=-1),this.initPTS=c={baseTime:v.initPTS,timescale:v.timescale,trackId:v.trackId});const P=C-c.baseTime/c.timescale,$=P+I;I>0?this.lastEndTime=$:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const F=!!y.audio,Z=!!y.video;let X="";F&&(X+="audio"),Z&&(X+="video");const q=(y.audio?y.audio.encrypted:!1)||(y.video?y.video.encrypted:!1),H={data1:m,startPTS:P,startDTS:P,endPTS:$,endDTS:$,type:X,hasAudio:F,hasVideo:Z,nb:1,dropped:0,encrypted:q};p.audio=F&&!Z?H:void 0,p.video=Z?H:void 0;const K=x?.sampleCount;if(K){const z=x.keyFrameIndex,ie=z!==-1;H.nb=K,H.dropped=z===0||this.isVideoContiguous?0:ie?z:K,H.independent=ie,H.firstKeyFrame=z,ie&&x.keyFrameStart&&(H.firstKeyFramePTS=(x.keyFrameStart-c.baseTime)/c.timescale),this.isVideoContiguous||(p.independent=ie),this.isVideoContiguous||(this.isVideoContiguous=ie),H.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${z}/${K} dropped: ${H.dropped} start: ${H.firstKeyFramePTS||"NA"}`)}return p.initSegment=v,p.id3=LA(r,s,c,c),n.samples.length&&(p.text=CA(n,s,c)),p}}function Ou(l,e,t=!1){return l?.start!==void 0?(l.start+(t?l.duration:0))/l.timescale:e}function qk(l,e,t,r){if(l===null)return!0;const n=Math.max(r,1),s=e-l.baseTime/l.timescale;return Math.abs(s-t)>n}function nT(l,e,t){const r=l.codec;return r&&r.length>4?r:e===Ot.AUDIO?r==="ec-3"||r==="ac-3"||r==="alac"?r:r==="fLaC"||r==="Opus"?Ic(r,!1):(t.warn(`Unhandled audio codec "${r}" in mp4 MAP`),r||"mp4a"):(t.warn(`Unhandled video codec "${r}" in mp4 MAP`),r||"avc1")}let gn;try{gn=self.performance.now.bind(self.performance)}catch{gn=Date.now}const bc=[{demux:Ok,remux:zk},{demux:is,remux:vc},{demux:Ik,remux:vc},{demux:Ck,remux:vc}];bc.splice(2,0,{demux:Lk,remux:vc});class sT{constructor(e,t,r,n,s,a){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=r,this.id=s,this.logger=a}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,r,n){const s=r.transmuxing;s.executeStart=gn();let a=new Uint8Array(e);const{currentTransmuxState:u,transmuxConfig:f}=this;n&&(this.currentTransmuxState=n);const{contiguous:c,discontinuity:d,trackSwitch:p,accurateTimeOffset:m,timeOffset:v,initSegmentChange:y}=n||u,{audioCodec:b,videoCodec:E,defaultInitPts:x,duration:T,initSegmentData:A}=f,L=Yk(a,t);if(L&&Ua(L.method)){const O=this.getDecrypter(),B=Nm(L.method);if(O.isSync()){let P=O.softwareDecrypt(a,L.key.buffer,L.iv.buffer,B);if(r.part>-1){const F=O.flush();P=F&&F.buffer}if(!P)return s.executeEnd=gn(),Id(r);a=new Uint8Array(P)}else return this.asyncResult=!0,this.decryptionPromise=O.webCryptoDecrypt(a,L.key.buffer,L.iv.buffer,B).then(P=>{const $=this.push(P,null,r);return this.decryptionPromise=null,$}),this.decryptionPromise}const w=this.needsProbing(d,p);if(w){const O=this.configureTransmuxer(a);if(O)return this.logger.warn(`[transmuxer] ${O.message}`),this.observer.emit(M.ERROR,M.ERROR,{type:tt.MEDIA_ERROR,details:Se.FRAG_PARSING_ERROR,fatal:!1,error:O,reason:O.message}),s.executeEnd=gn(),Id(r)}(d||p||y||w)&&this.resetInitSegment(A,b,E,T,t),(d||y||w)&&this.resetInitialTimestamp(x),c||this.resetContiguity();const C=this.transmux(a,L,v,m,r);this.asyncResult=nl(C);const I=this.currentTransmuxState;return I.contiguous=!0,I.discontinuity=!1,I.trackSwitch=!1,s.executeEnd=gn(),C}flush(e){const t=e.transmuxing;t.executeStart=gn();const{decrypter:r,currentTransmuxState:n,decryptionPromise:s}=this;if(s)return this.asyncResult=!0,s.then(()=>this.flush(e));const a=[],{timeOffset:u}=n;if(r){const p=r.flush();p&&a.push(this.push(p.buffer,null,e))}const{demuxer:f,remuxer:c}=this;if(!f||!c){t.executeEnd=gn();const p=[Id(e)];return this.asyncResult?Promise.resolve(p):p}const d=f.flush(u);return nl(d)?(this.asyncResult=!0,d.then(p=>(this.flushRemux(a,p,e),a))):(this.flushRemux(a,d,e),this.asyncResult?Promise.resolve(a):a)}flushRemux(e,t,r){const{audioTrack:n,videoTrack:s,id3Track:a,textTrack:u}=t,{accurateTimeOffset:f,timeOffset:c}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${r.sn}${r.part>-1?" part: "+r.part:""} of ${this.id===Xe.MAIN?"level":"track"} ${r.level}`);const d=this.remuxer.remux(n,s,a,u,c,f,!0,this.id);e.push({remuxResult:d,chunkMeta:r}),r.transmuxing.executeEnd=gn()}resetInitialTimestamp(e){const{demuxer:t,remuxer:r}=this;!t||!r||(t.resetTimeStamp(e),r.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,r,n,s){const{demuxer:a,remuxer:u}=this;!a||!u||(a.resetInitSegment(e,t,r,n),u.resetInitSegment(e,t,r,s))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,r,n,s){let a;return t&&t.method==="SAMPLE-AES"?a=this.transmuxSampleAes(e,t,r,n,s):a=this.transmuxUnencrypted(e,r,n,s),a}transmuxUnencrypted(e,t,r,n){const{audioTrack:s,videoTrack:a,id3Track:u,textTrack:f}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(s,a,u,f,t,r,!1,this.id),chunkMeta:n}}transmuxSampleAes(e,t,r,n,s){return this.demuxer.demuxSampleAes(e,t,r).then(a=>({remuxResult:this.remuxer.remux(a.audioTrack,a.videoTrack,a.id3Track,a.textTrack,r,n,!1,this.id),chunkMeta:s}))}configureTransmuxer(e){const{config:t,observer:r,typeSupported:n}=this;let s;for(let p=0,m=bc.length;p<m;p++){var a;if((a=bc[p].demux)!=null&&a.probe(e,this.logger)){s=bc[p];break}}if(!s)return new Error("Failed to find demuxer by probing fragment data");const u=this.demuxer,f=this.remuxer,c=s.remux,d=s.demux;(!f||!(f instanceof c))&&(this.remuxer=new c(r,t,n,this.logger)),(!u||!(u instanceof d))&&(this.demuxer=new d(r,t,n,this.logger),this.probe=d.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Mm(this.config)),e}}function Yk(l,e){let t=null;return l.byteLength>0&&e?.key!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const Id=l=>({remuxResult:{},chunkMeta:l});function nl(l){return"then"in l&&l.then instanceof Function}class Wk{constructor(e,t,r,n,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=r,this.duration=n,this.defaultInitPts=s||null}}class Qk{constructor(e,t,r,n,s,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=r,this.trackSwitch=n,this.timeOffset=s,this.initSegmentChange=a}}let aT=0;class DA{constructor(e,t,r,n){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=aT++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=f=>{const c=f.data,d=this.hls;if(!(!d||!(c!=null&&c.event)||c.instanceNo!==this.instanceNo))switch(c.event){case"init":{var p;const m=(p=this.workerContext)==null?void 0:p.objectURL;m&&self.URL.revokeObjectURL(m);break}case"transmuxComplete":{this.handleTransmuxComplete(c.data);break}case"flush":{this.onFlush(c.data);break}case"workerLog":{d.logger[c.data.logType]&&d.logger[c.data.logType](c.data.message);break}default:{c.data=c.data||{},c.data.frag=this.frag,c.data.part=this.part,c.data.id=this.id,d.trigger(c.event,c.data);break}}},this.onWorkerError=f=>{if(!this.hls)return;const c=new Error(`${f.message}  (${f.filename}:${f.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(M.ERROR,{type:tt.OTHER_ERROR,details:Se.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:c})};const s=e.config;this.hls=e,this.id=t,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=r,this.onFlush=n;const a=(f,c)=>{c=c||{},c.frag=this.frag||void 0,f===M.ERROR&&(c=c,c.parent=this.id,c.part=this.part,this.error=c.error),this.hls.trigger(f,c)};this.observer=new Fm,this.observer.on(M.FRAG_DECRYPTED,a),this.observer.on(M.ERROR,a);const u=SS(s.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const f=this.hls.logger;if(s.workerPath||ek()){try{s.workerPath?(f.log(`loading Web Worker ${s.workerPath} for "${t}"`),this.workerContext=rk(s.workerPath)):(f.log(`injecting Web Worker for "${t}"`),this.workerContext=tk());const{worker:d}=this.workerContext;d.addEventListener("message",this.onWorkerMessage),d.addEventListener("error",this.onWorkerError),d.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:u,id:t,config:kt(s)})}catch(d){f.warn(`Error setting up "${t}" Web Worker, fallback to inline`,d),this.terminateWorker(),this.error=null,this.transmuxer=new sT(this.observer,u,s,"",t,e.logger)}return}}this.transmuxer=new sT(this.observer,u,s,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=aT++;const t=this.hls.config,r=SS(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:r,id:this.id,config:kt(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),ik(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,r,n,s,a,u,f,c,d){var p,m;c.transmuxing.start=self.performance.now();const{instanceNo:v,transmuxer:y}=this,b=a?a.start:s.start,E=s.decryptdata,x=this.frag,T=!(x&&s.cc===x.cc),A=!(x&&c.level===x.level),L=x?c.sn-x.sn:-1,w=this.part?c.part-this.part.index:-1,C=L===0&&c.id>1&&c.id===x?.stats.chunkCount,I=!A&&(L===1||L===0&&(w===1||C&&w<=0)),O=self.performance.now();(A||L||s.stats.parsing.start===0)&&(s.stats.parsing.start=O),a&&(w||!I)&&(a.stats.parsing.start=O);const B=!(x&&((p=s.initSegment)==null?void 0:p.url)===((m=x.initSegment)==null?void 0:m.url)),P=new Qk(T,I,f,A,b,B);if(!I||T||B){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${s.type} sn: ${c.sn}${c.part>-1?" part: "+c.part:""} ${this.id===Xe.MAIN?"level":"track"}: ${c.level} id: ${c.id}
        discontinuity: ${T}
        trackSwitch: ${A}
        contiguous: ${I}
        accurateTimeOffset: ${f}
        timeOffset: ${b}
        initSegmentChange: ${B}`);const $=new Wk(r,n,t,u,d);this.configureTransmuxer($)}if(this.frag=s,this.part=a,this.workerContext)this.workerContext.worker.postMessage({instanceNo:v,cmd:"demux",data:e,decryptdata:E,chunkMeta:c,state:P},e instanceof ArrayBuffer?[e]:[]);else if(y){const $=y.push(e,E,c,P);nl($)?$.then(F=>{this.handleTransmuxComplete(F)}).catch(F=>{this.transmuxerError(F,c,"transmuxer-interface push error")}):this.handleTransmuxComplete($)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:r}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(r){const n=r.flush(e);nl(n)?n.then(s=>{this.handleFlushResult(s,e)}).catch(s=>{this.transmuxerError(s,e,"transmuxer-interface flush error")}):this.handleFlushResult(n,e)}}transmuxerError(e,t,r){this.hls&&(this.error=e,this.hls.trigger(M.ERROR,{type:tt.MEDIA_ERROR,details:Se.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:r}))}handleFlushResult(e,t){e.forEach(r=>{this.handleTransmuxComplete(r)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:r}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):r&&r.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const oT=100;class Xk extends Bm{constructor(e,t,r){super(e,t,r,"audio-stream-controller",Xe.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(M.LEVEL_LOADED,this.onLevelLoaded,this),e.on(M.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(M.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(M.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(M.BUFFER_RESET,this.onBufferReset,this),e.on(M.BUFFER_CREATED,this.onBufferCreated,this),e.on(M.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(M.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(M.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(M.FRAG_LOADING,this.onFragLoading,this),e.on(M.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(M.LEVEL_LOADED,this.onLevelLoaded,this),e.off(M.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(M.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(M.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(M.BUFFER_RESET,this.onBufferReset,this),e.off(M.BUFFER_CREATED,this.onBufferCreated,this),e.off(M.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(M.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(M.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(M.FRAG_LOADING,this.onFragLoading,this),e.off(M.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:r,initPTS:n,timescale:s,trackId:a}){if(r===Xe.MAIN){const u=t.cc,f=this.fragCurrent;if(this.initPTS[u]={baseTime:n,timescale:s,trackId:a},this.log(`InitPTS for cc: ${u} found from main: ${n/s} (${n}/${s}) trackId: ${a}`),this.mainAnchor=t,this.state===$e.WAITING_INIT_PTS){const c=this.waitingData;(!c&&!this.loadingParts||c&&c.frag.cc!==u)&&this.syncWithAnchor(t,c?.frag)}else!this.hls.hasEnoughToStart&&f&&f.cc!==u?(f.abortRequests(),this.syncWithAnchor(t,f)):this.state===$e.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var r;const n=((r=this.mainFragLoading)==null?void 0:r.frag)||null;if(t&&n?.cc===t.cc)return;const s=(n||e).cc,a=this.getLevelDetails(),u=this.getLoadPosition(),f=q_(a,s,u);f&&(this.log(`Syncing with main frag at ${f.start} cc ${f.cc}`),this.startFragRequested=!1,this.nextLoadPosition=f.start,this.resetLoadingState(),this.state===$e.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=$e.STOPPED;return}const r=this.lastCurrentTime;this.stopLoad(),this.setInterval(oT),r>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${r.toFixed(3)}`),e=r,this.state=$e.IDLE):this.state=$e.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case $e.IDLE:this.doTickIdle();break;case $e.WAITING_TRACK:{const{levels:e,trackId:t}=this,r=e?.[t],n=r?.details;if(n&&!this.waitForLive(r)){if(this.waitForCdnTuneIn(n))break;this.state=$e.WAITING_INIT_PTS}break}case $e.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case $e.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:r,cache:n,complete:s}=e,a=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=$e.FRAG_LOADING;const u=n.flush().buffer,f={frag:t,part:r,payload:u,networkDetails:null};this._handleFragmentLoadProgress(f),s&&super._handleFragmentLoadComplete(f)}else a&&a.cc!==e.frag.cc&&this.syncWithAnchor(a,e.frag)}else this.state=$e.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:r,media:n,trackId:s}=this,a=t.config;if(!this.buffering||!n&&!this.primaryPrefetch&&(this.startFragRequested||!a.startFragPrefetch)||!(r!=null&&r[s]))return;const u=r[s],f=u.details;if(!f||this.waitForLive(u)||this.waitForCdnTuneIn(f)){this.state=$e.WAITING_TRACK,this.startFragRequested=!1;return}const c=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&c&&(this.bufferFlushed=!1,this.afterBufferFlushed(c,Ot.AUDIO,Xe.AUDIO));const d=this.getFwdBufferInfo(c,Xe.AUDIO);if(d===null)return;if(!this.switchingTrack&&this._streamEnded(d,f)){t.trigger(M.BUFFER_EOS,{type:"audio"}),this.state=$e.ENDED;return}const p=d.len,m=t.maxBufferLength,v=f.fragments,y=v[0].start,b=this.getLoadPosition(),E=this.flushing?b:d.end;if(this.switchingTrack&&n){const A=b;f.PTSKnown&&A<y&&(d.end>y||d.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),n.currentTime=y+.05)}if(p>=m&&!this.switchingTrack&&E<v[v.length-1].start)return;let x=this.getNextFragment(E,f);if(x&&this.isLoopLoading(x,E)&&(x=this.getNextFragmentLoopLoading(x,f,d,Xe.MAIN,m)),!x){this.bufferFlushed=!0;return}let T=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&T&&Xt(x)&&!x.endList&&(!f.live||!this.loadingParts&&E<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(T)===or.OK&&(this.mainFragLoading=T=null),T&&Xt(T))){if(x.start>T.end){const L=this.fragmentTracker.getFragAtPos(E,Xe.MAIN);L&&L.end>T.end&&(T=L,this.mainFragLoading={frag:L,targetBufferTime:null})}if(x.start>T.end)return}this.loadFragment(x,u,E)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(r=>new tl(r))}onAudioTrackSwitching(e,t){const r=!!t.url;this.trackId=t.id;const{fragCurrent:n}=this;n&&(n.abortRequests(),this.removeUnbufferedFrags(n.start)),this.resetLoadingState(),r?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==$e.STOPPED&&(this.setInterval(oT),this.state=$e.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const r=this.cachedTrackLoadedData;r&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(M.AUDIO_TRACK_LOADED,r))}onAudioTrackLoaded(e,t){var r;const{levels:n}=this,{details:s,id:a,groupId:u,track:f}=t;if(!n){this.warn(`Audio tracks reset while loading track ${a} "${f.name}" of "${u}"`);return}const c=this.mainDetails;if(!c||s.endCC>c.endCC||c.expired){this.cachedTrackLoadedData=t,this.state!==$e.STOPPED&&(this.state=$e.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${a} "${f.name}" of "${u}" loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`);const d=n[a];let p=0;if(s.live||(r=d.details)!=null&&r.live){if(this.checkLiveUpdate(s),s.deltaUpdateFailed)return;if(d.details){var m;p=this.alignPlaylists(s,d.details,(m=this.levelLastLoaded)==null?void 0:m.details)}s.alignedSliding||(fA(s,c),s.alignedSliding||Pc(s,c),p=s.fragmentStart)}d.details=s,this.levelLastLoaded=d,this.startFragRequested||this.setStartPosition(c,p),this.hls.trigger(M.AUDIO_TRACK_UPDATED,{details:s,id:a,groupId:t.groupId}),this.state===$e.WAITING_TRACK&&!this.waitForCdnTuneIn(s)&&(this.state=$e.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const r=e.frag,{part:n,payload:s}=e,{config:a,trackId:u,levels:f}=this;if(!f){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const c=f[u];if(!c){this.warn("Audio track is undefined on fragment load progress");return}const d=c.details;if(!d){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(r.start);return}const p=a.defaultAudioCodec||c.audioCodec||"mp4a.40.2";let m=this.transmuxer;m||(m=this.transmuxer=new DA(this.hls,Xe.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const v=this.initPTS[r.cc],y=(t=r.initSegment)==null?void 0:t.data;if(v!==void 0){const E=n?n.index:-1,x=E!==-1,T=new Pm(r.level,r.sn,r.stats.chunkCount,s.byteLength,E,x);m.push(s,y,p,"",r,n,d.totalduration,!1,T,v)}else{this.log(`Unknown video PTS for cc ${r.cc}, waiting for video PTS before demuxing audio frag ${r.sn} of [${d.startSN} ,${d.endSN}],track ${u}`);const{cache:b}=this.waitingData=this.waitingData||{frag:r,part:n,cache:new hA,complete:!1};b.push(new Uint8Array(s)),this.state!==$e.STOPPED&&(this.state=$e.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===Xe.MAIN&&Xt(t.frag)&&(this.mainFragLoading=t,this.state===$e.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:r,part:n}=t;if(r.type!==Xe.AUDIO){!this.audioOnly&&r.type===Xe.MAIN&&!r.elementaryStreams.video&&!r.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${n?" p: "+n.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(Xt(r)){this.fragPrevious=r;const s=this.switchingTrack;s&&(this.bufferedTrack=s,this.switchingTrack=null,this.hls.trigger(M.AUDIO_TRACK_SWITCHED,_t({},s)))}this.fragBufferedComplete(r,n),this.media&&this.tick()}onError(e,t){var r;if(t.fatal){this.state=$e.ERROR;return}switch(t.details){case Se.FRAG_GAP:case Se.FRAG_PARSING_ERROR:case Se.FRAG_DECRYPT_ERROR:case Se.FRAG_LOAD_ERROR:case Se.FRAG_LOAD_TIMEOUT:case Se.KEY_LOAD_ERROR:case Se.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Xe.AUDIO,t);break;case Se.AUDIO_TRACK_LOAD_ERROR:case Se.AUDIO_TRACK_LOAD_TIMEOUT:case Se.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===$e.WAITING_TRACK&&((r=t.context)==null?void 0:r.type)===dt.AUDIO_TRACK&&(this.state=$e.IDLE);break;case Se.BUFFER_ADD_CODEC_ERROR:case Se.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case Se.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case Se.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==Ot.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==Ot.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===$e.ENDED&&(this.state=$e.IDLE);const r=this.mediaBuffer||this.media;r&&(this.afterBufferFlushed(r,t,Xe.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const r="audio",{hls:n}=this,{remuxResult:s,chunkMeta:a}=e,u=this.getCurrentContext(a);if(!u){this.resetWhenMissingContext(a);return}const{frag:f,part:c,level:d}=u,{details:p}=d,{audio:m,text:v,id3:y,initSegment:b}=s;if(this.fragContextChanged(f)||!p){this.fragmentTracker.removeFragment(f);return}if(this.state=$e.PARSING,this.switchingTrack&&m&&this.completeAudioSwitch(this.switchingTrack),b!=null&&b.tracks){const E=f.initSegment||f;if(this.unhandledEncryptionError(b,f))return;this._bufferInitSegment(d,b.tracks,E,a),n.trigger(M.FRAG_PARSING_INIT_SEGMENT,{frag:E,id:r,tracks:b.tracks})}if(m){const{startPTS:E,endPTS:x,startDTS:T,endDTS:A}=m;c&&(c.elementaryStreams[Ot.AUDIO]={startPTS:E,endPTS:x,startDTS:T,endDTS:A}),f.setElementaryStreamInfo(Ot.AUDIO,E,x,T,A),this.bufferFragmentData(m,f,c,a)}if(y!=null&&(t=y.samples)!=null&&t.length){const E=Lt({id:r,frag:f,details:p},y);n.trigger(M.FRAG_PARSING_METADATA,E)}if(v){const E=Lt({id:r,frag:f,details:p},v);n.trigger(M.FRAG_PARSING_USERDATA,E)}}_bufferInitSegment(e,t,r,n){if(this.state!==$e.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const s=t.audio;s.id=Xe.AUDIO;const a=e.audioCodec;this.log(`Init audio buffer, container:${s.container}, codecs[level/parsed]=[${a}/${s.codec}]`),a&&a.split(",").length===1&&(s.levelCodec=a),this.hls.trigger(M.BUFFER_CODECS,t);const u=s.initSegment;if(u!=null&&u.byteLength){const f={type:"audio",frag:r,part:null,chunkMeta:n,parent:r.type,data:u};this.hls.trigger(M.BUFFER_APPENDING,f)}this.tickImmediate()}loadFragment(e,t,r){const n=this.fragmentTracker.getState(e);if(this.switchingTrack||n===or.NOT_LOADED||n===or.PARTIAL){var s;if(!Xt(e))this._loadInitSegment(e,t);else if((s=t.details)!=null&&s.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=$e.WAITING_INIT_PTS;const a=this.mainDetails;a&&a.fragmentStart!==t.details.fragmentStart&&Pc(t.details,a)}else super.loadFragment(e,t,r)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:r,assocLang:n,characteristics:s,audioCodec:a,channels:u}=this.bufferedTrack;Ps({name:t,lang:r,assocLang:n,characteristics:s,audioCodec:a,channels:u},e,Cs)||(Cc(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(M.AUDIO_TRACK_SWITCHED,_t({},e))}}class zm extends vi{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,r){const n=t?.renditionReports;if(n){let s=-1;for(let a=0;a<n.length;a++){const u=n[a];let f;try{f=new self.URL(u.URI,t.url).href}catch(c){this.warn(`Could not construct new URL for Rendition Report: ${c}`),f=u.URI||""}if(f===e){s=a;break}else f===e.substring(0,f.length)&&(s=a)}if(s!==-1){const a=n[s],u=parseInt(a["LAST-MSN"])||t.lastPartSn;let f=parseInt(a["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const d=Math.min(t.age-t.partTarget,t.targetduration);f>=0&&d>t.partTarget&&(f+=1)}const c=r&&TS(r);return new xS(u,f>=0?f:void 0,c)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(r){this.warn(`Could not construct new URL with HLS Delivery Directives: ${r}`)}return e}playlistLoaded(e,t,r){const{details:n,stats:s}=t,a=self.performance.now(),u=s.loading.first?Math.max(0,a-s.loading.first):0;n.advancedDateTime=Date.now()-u;const f=this.hls.config.timelineOffset;if(f!==n.appliedTimelineOffset){const d=Math.max(f||0,0);n.appliedTimelineOffset=d,n.fragments.forEach(p=>{p.setStart(p.playlistOffset+d)})}if(n.live||r!=null&&r.live){const d="levelInfo"in t?t.levelInfo:t.track;if(n.reloaded(r),r&&n.fragments.length>0){HO(r,n,this);const T=n.playlistParsingError;if(T){this.warn(T);const A=this.hls;if(!A.config.ignorePlaylistParsingErrors){var c;const{networkDetails:L}=t;A.trigger(M.ERROR,{type:tt.NETWORK_ERROR,details:Se.LEVEL_PARSING_ERROR,fatal:!1,url:n.url,error:T,reason:T.message,level:t.level||void 0,parent:(c=n.fragments[0])==null?void 0:c.type,networkDetails:L,stats:s});return}n.playlistParsingError=null}}n.requestScheduled===-1&&(n.requestScheduled=s.loading.start);const p=this.hls.mainForwardBufferInfo,m=p?p.end-p.len:0,v=(n.edge-m)*1e3,y=aA(n,v);if(n.requestScheduled+y<a?n.requestScheduled=a:n.requestScheduled+=y,this.log(`live playlist ${e} ${n.advanced?"REFRESHED "+n.lastPartSn+"-"+n.lastPartIndex:n.updated?"UPDATED":"MISSED"}`),!this.canLoad||!n.live)return;let b,E,x;if(n.canBlockReload&&n.endSN&&n.advanced){const T=this.hls.config.lowLatencyMode,A=n.lastPartSn,L=n.endSN,w=n.lastPartIndex,C=w!==-1,I=A===L;C?I?(E=L+1,x=T?0:w):(E=A,x=T?w+1:n.maxPartIndex):E=L+1;const O=n.age,B=O+n.ageHeader;let P=Math.min(B-n.partTarget,n.targetduration*1.5);if(P>0){if(B>n.targetduration*3)this.log(`Playlist last advanced ${O.toFixed(2)}s ago. Omitting segment and part directives.`),E=void 0,x=void 0;else if(r!=null&&r.tuneInGoal&&B-n.partTarget>r.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${r.tuneInGoal} to: ${P} with playlist age: ${n.age}`),P=0;else{const $=Math.floor(P/n.targetduration);if(E+=$,x!==void 0){const F=Math.round(P%n.targetduration/n.partTarget);x+=F}this.log(`CDN Tune-in age: ${n.ageHeader}s last advanced ${O.toFixed(2)}s goal: ${P} skip sn ${$} to part ${x}`)}n.tuneInGoal=P}if(b=this.getDeliveryDirectives(n,t.deliveryDirectives,E,x),T||!I){n.requestScheduled=a,this.loadingPlaylist(d,b);return}}else(n.canBlockReload||n.canSkipUntil)&&(b=this.getDeliveryDirectives(n,t.deliveryDirectives,E,x));b&&E!==void 0&&n.canBlockReload&&(n.requestScheduled=s.loading.first+Math.max(y-u*2,y/2)),this.scheduleLoading(d,b,n)}else this.clearTimer()}scheduleLoading(e,t,r){const n=r||e.details;if(!n){this.loadingPlaylist(e,t);return}const s=self.performance.now(),a=n.requestScheduled;if(s>=a){this.loadingPlaylist(e,t);return}const u=a-s;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(u)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),u)}getDeliveryDirectives(e,t,r,n){let s=TS(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,n=t.part,s=mc.No),new xS(r,n,s)}checkRetry(e){const t=e.details,r=Dc(e),n=e.errorAction,{action:s,retryCount:a=0,retryConfig:u}=n||{},f=!!n&&!!u&&(s===yr.RetryRequest||!n.resolved&&s===yr.SendAlternateToPenaltyBox);if(f){var c;if(a>=u.maxNumRetry)return!1;if(r&&(c=e.context)!=null&&c.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${u.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const d=km(u,a);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),d),this.warn(`Retrying playlist loading ${a+1}/${u.maxNumRetry} after "${t}" in ${d}ms`)}e.levelRetry=!0,n.resolved=!0}return f}}function OA(l,e){if(l.length!==e.length)return!1;for(let t=0;t<l.length;t++)if(!sl(l[t].attrs,e[t].attrs))return!1;return!0}function sl(l,e,t){const r=l["STABLE-RENDITION-ID"];return r&&!t?r===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(n=>l[n]!==e[n])}function Jg(l,e){return e.label.toLowerCase()===l.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(l.lang||"").toLowerCase())}class Zk extends zm{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(M.MANIFEST_LOADING,this.onManifestLoading,this),e.on(M.MANIFEST_PARSED,this.onManifestParsed,this),e.on(M.LEVEL_LOADING,this.onLevelLoading,this),e.on(M.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(M.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(M.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(M.MANIFEST_LOADING,this.onManifestLoading,this),e.off(M.MANIFEST_PARSED,this.onManifestParsed,this),e.off(M.LEVEL_LOADING,this.onLevelLoading,this),e.off(M.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(M.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(M.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:r,groupId:n,details:s}=t,a=this.tracksInGroup[r];if(!a||a.groupId!==n){this.warn(`Audio track with id:${r} and group:${n} not found in active group ${a?.groupId}`);return}const u=a.details;a.details=t.details,this.log(`Audio track ${r} "${a.name}" lang:${a.lang} group:${n} loaded [${s.startSN}-${s.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,u)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.audioGroups||null,n=this.groupIds;let s=this.currentTrack;if(!r||n?.length!==r?.length||r!=null&&r.some(u=>n?.indexOf(u)===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const u=this.tracks.filter(m=>!r||r.indexOf(m.groupId)!==-1);if(u.length)this.selectDefaultTrack&&!u.some(m=>m.default)&&(this.selectDefaultTrack=!1),u.forEach((m,v)=>{m.id=v});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=u;const f=this.hls.config.audioPreference;if(!s&&f){const m=Ui(f,u,Cs);if(m>-1)s=u[m];else{const v=Ui(f,this.tracks);s=this.tracks[v]}}let c=this.findTrackId(s);c===-1&&s&&(c=this.findTrackId(null));const d={audioTracks:u};this.log(`Updating audio tracks, ${u.length} track(s) found in group(s): ${r?.join(",")}`),this.hls.trigger(M.AUDIO_TRACKS_UPDATED,d);const p=this.trackId;if(c!==-1&&p===-1)this.setAudioTrack(c);else if(u.length&&p===-1){var a;const m=new Error(`No audio track selected for current audio group-ID(s): ${(a=this.groupIds)==null?void 0:a.join(",")} track count: ${u.length}`);this.warn(m.message),this.hls.trigger(M.ERROR,{type:tt.MEDIA_ERROR,details:Se.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:m})}}}onError(e,t){t.fatal||!t.context||t.context.type===dt.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const r=this.allAudioTracks;if(this.selectDefaultTrack=!1,r.length){const n=this.currentTrack;if(n&&Ps(e,n,Cs))return n;const s=Ui(e,this.tracksInGroup,Cs);if(s>-1){const a=this.tracksInGroup[s];return this.setAudioTrack(s),a}else if(n){let a=t.loadLevel;a===-1&&(a=t.firstAutoLevel);const u=cO(e,t.levels,r,a,Cs);if(u===-1)return null;t.nextLoadLevel=u}if(e.channels||e.audioCodec){const a=Ui(e,r);if(a>-1)return r[a]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const r=this.currentTrack,n=t[e],s=n.details&&!n.details.live;if(e===this.trackId&&n===r&&s||(this.log(`Switching to audio-track ${e} "${n.name}" lang:${n.lang} group:${n.groupId} channels:${n.channels}`),this.trackId=e,this.currentTrack=n,this.hls.trigger(M.AUDIO_TRACK_SWITCHING,_t({},n)),s))return;const a=this.switchParams(n.url,r?.details,n.details);this.loadPlaylist(a)}findTrackId(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const n=t[r];if(!(this.selectDefaultTrack&&!n.default)&&(!e||Ps(e,n,Cs)))return r}if(e){const{name:r,lang:n,assocLang:s,characteristics:a,audioCodec:u,channels:f}=e;for(let c=0;c<t.length;c++){const d=t[c];if(Ps({name:r,lang:n,assocLang:s,characteristics:a,audioCodec:u,channels:f},d,Cs))return c}for(let c=0;c<t.length;c++){const d=t[c];if(sl(e.attrs,d.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return c}for(let c=0;c<t.length;c++){const d=t[c];if(sl(e.attrs,d.attrs,["LANGUAGE"]))return c}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&Cc(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=e.id,n=e.groupId,s=this.getUrlWithDirectives(e.url,t),a=e.details,u=a?.age;this.log(`Loading audio-track ${r} "${e.name}" lang:${e.lang} group:${n}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${u&&a.live?" age "+u.toFixed(1)+(a.type&&" "+a.type||""):""} ${s}`),this.hls.trigger(M.AUDIO_TRACK_LOADING,{url:s,id:r,groupId:n,deliveryDirectives:t||null,track:e})}}class Jk{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,r){if(this.queues===null||this.tracks===null)return;const n=this.queues[t];n.push(e),n.length===1&&!r&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const r={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(r,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const r={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(r)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const r=(t=e[0])==null?void 0:t.label;(r==="async-blocker"||r==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const n=t[0];try{n.execute()}catch(s){var r;if(n.onError(s),this.queues===null||this.tracks===null)return;const a=(r=this.tracks[e])==null?void 0:r.buffer;a!=null&&a.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,r;return(t=this.queues)!=null&&t[e]||(r=this.tracks)!=null&&r[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const r=(t=this.tracks)==null?void 0:t[e],n=r?.buffer;return n?`SourceBuffer${n.updating?" updating":""}${r.ended?" ended":""}${r.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(r=>r.label).join(", "))||""}}const lT=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,kA="HlsJsTrackRemovedError";class eM extends Error{constructor(e){super(e),this.name=kA}}class tM extends vi{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=r=>{var n;this.hls&&((n=this.mediaSource)==null?void 0:n.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=r=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=r=>{const{media:n,mediaSource:s}=this;r&&this.log("Media source opened"),!(!n||!s)&&(s.removeEventListener("sourceopen",this._onMediaSourceOpen),n.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(M.MEDIA_ATTACHED,{media:n,mediaSource:s}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:r,_objectUrl:n}=this;r!==n&&this.error(`Media element src was set while attaching MediaSource (${n} > ${r})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=xD(as(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(M.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(M.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(M.MANIFEST_LOADING,this.onManifestLoading,this),e.on(M.MANIFEST_PARSED,this.onManifestParsed,this),e.on(M.BUFFER_RESET,this.onBufferReset,this),e.on(M.BUFFER_APPENDING,this.onBufferAppending,this),e.on(M.BUFFER_CODECS,this.onBufferCodecs,this),e.on(M.BUFFER_EOS,this.onBufferEos,this),e.on(M.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(M.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(M.FRAG_PARSED,this.onFragParsed,this),e.on(M.FRAG_CHANGED,this.onFragChanged,this),e.on(M.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(M.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(M.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(M.MANIFEST_LOADING,this.onManifestLoading,this),e.off(M.MANIFEST_PARSED,this.onManifestParsed,this),e.off(M.BUFFER_RESET,this.onBufferReset,this),e.off(M.BUFFER_APPENDING,this.onBufferAppending,this),e.off(M.BUFFER_CODECS,this.onBufferCodecs,this),e.off(M.BUFFER_EOS,this.onBufferEos,this),e.off(M.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(M.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(M.FRAG_PARSED,this.onFragParsed,this),e.off(M.FRAG_CHANGED,this.onFragChanged,this),e.off(M.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const r={};if(this.operationQueue){const s=this.isUpdating();s||this.operationQueue.removeBlockers();const a=this.isQueued();(s||a)&&this.warn(`Transfering MediaSource with${a?" operations in queue":""}${s?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const n=this.transferData;return!this.sourceBufferCount&&n&&n.mediaSource===t?Lt(r,n.tracks):this.sourceBuffers.forEach(s=>{const[a]=s;a&&(r[a]=Lt({},this.tracks[a]),this.removeBuffer(a)),s[0]=s[1]=null}),{media:e,mediaSource:t,tracks:r}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var r;let n=2;(t.audio&&!t.video||!t.altAudio)&&(n=1),this.bufferCodecEventsTotal=n,this.log(`${n} bufferCodec event(s) expected.`),(r=this.transferData)!=null&&r.mediaSource&&this.sourceBufferCount&&n&&this.bufferCreated()}onMediaAttaching(e,t){const r=this.media=t.media;this.transferData=this.overrides=void 0;const n=as(this.appendSource);if(n){const s=!!t.mediaSource;(s||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const a=this.mediaSource=t.mediaSource||new n;if(this.assignMediaSource(a),s)this._objectUrl=r.src,this.attachTransferred();else{const u=this._objectUrl=self.URL.createObjectURL(a);if(this.appendSource)try{r.removeAttribute("src");const f=self.ManagedMediaSource;r.disableRemotePlayback=r.disableRemotePlayback||f&&a instanceof f,uT(r),rM(r,u),r.load()}catch{r.src=u}else r.src=u}r.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,r;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(r=e.constructor)==null?void 0:r.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const r=this.tracks,n=t.tracks,s=n?Object.keys(n):null,a=s?s.length:0,u=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(n&&s&&a){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${kt(r,(f,c)=>f==="initSegment"?void 0:c)};
transfer tracks: ${kt(n,(f,c)=>f==="initSegment"?void 0:c)}}`),!L_(n,r)){t.mediaSource=null,t.tracks=void 0;const f=e.currentTime,c=this.details,d=Math.max(f,c?.fragments[0].start||0);if(d-f>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${f} -> ${d}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(n)}"->"${Object.keys(r)}") start time: ${d} currentTime: ${f}`),this.onMediaDetaching(M.MEDIA_DETACHING,{}),this.onMediaAttaching(M.MEDIA_ATTACHING,t),e.currentTime=d;return}this.transferData=void 0,s.forEach(f=>{const c=f,d=n[c];if(d){const p=d.buffer;if(p){const m=this.fragmentTracker,v=d.id;if(m.hasFragments(v)||m.hasParts(v)){const E=ot.getBuffered(p);m.detectEvictedFragments(c,E,v,null,!0)}const y=Ld(c),b=[c,p];this.sourceBuffers[y]=b,p.updating&&this.operationQueue&&this.operationQueue.prependBlocker(c),this.trackSourceBuffer(c,d)}}}),u(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),u()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const r=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:n,mediaSource:s,_objectUrl:a}=this;if(s){if(this.log(`media source ${r?"transferring":"detaching"}`),r)this.sourceBuffers.forEach(([u])=>{u&&this.removeBuffer(u)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const u=s.readyState==="open";try{const f=s.sourceBuffers;for(let c=f.length;c--;)u&&f[c].abort(),s.removeSourceBuffer(f[c]);u&&s.endOfStream()}catch(f){this.warn(`onMediaDetaching: ${f.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}s.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("sourceended",this._onMediaSourceEnded),s.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(s.removeEventListener("startstreaming",this._onStartStreaming),s.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}n&&(n.removeEventListener("emptied",this._onMediaEmptied),r||(a&&self.URL.revokeObjectURL(a),this.mediaSrc===a?(n.removeAttribute("src"),this.appendSource&&uT(n),n.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(M.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const r=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),r)try{var n;(n=this.mediaSource)!=null&&n.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(r)}catch(s){this.warn(`onBufferReset ${e}`,s)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Ld(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new Jk(this.tracks)}onBufferCodecs(e,t){var r;const n=this.tracks,s=Object.keys(t);this.log(`BUFFER_CODECS: "${s}" (current SB count ${this.sourceBufferCount})`);const a="audiovideo"in t&&(n.audio||n.video)||n.audiovideo&&("audio"in t||"video"in t),u=!a&&this.sourceBufferCount&&this.media&&s.some(f=>!n[f]);if(a||u){this.warn(`Unsupported transition between "${Object.keys(n)}" and "${s}" SourceBuffers`);return}s.forEach(f=>{var c,d;const p=t[f],{id:m,codec:v,levelCodec:y,container:b,metadata:E,supplemental:x}=p;let T=n[f];const A=(c=this.transferData)==null||(c=c.tracks)==null?void 0:c[f],L=A!=null&&A.buffer?A:T,w=L?.pendingCodec||L?.codec,C=L?.levelCodec;T||(T=n[f]={buffer:void 0,listeners:[],codec:v,supplemental:x,container:b,levelCodec:y,metadata:E,id:m});const I=gc(w,C),O=I?.replace(lT,"$1");let B=gc(v,y);const P=(d=B)==null?void 0:d.replace(lT,"$1");B&&I&&O!==P&&(f.slice(0,5)==="audio"&&(B=Ic(B,this.appendSource)),this.log(`switching codec ${w} to ${B}`),B!==(T.pendingCodec||T.codec)&&(T.pendingCodec=B),T.container=b,this.appendChangeType(f,b,B))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((r=t.audio)==null?void 0:r.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const r=this.tracks[t];return e[t]={id:r.id,container:r.container,codec:r.codec,levelCodec:r.levelCodec},e},{})}appendChangeType(e,t,r){const n=`${t};codecs=${r}`,s={label:`change-type=${n}`,execute:()=>{const a=this.tracks[e];if(a){const u=a.buffer;u!=null&&u.changeType&&(this.log(`changing ${e} sourceBuffer type to ${n}`),u.changeType(n),a.codec=r,a.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn(`Failed to change ${e} SourceBuffer type`,a)}};this.append(s,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const r=e.start,n=r+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(r,Xe.MAIN))==null?void 0:t.gap)===!0)return;const a={label:"block-audio",execute:()=>{var u;const f=this.tracks.video;(this.lastVideoAppendEnd>n||f!=null&&f.buffer&&ot.isBuffered(f.buffer,n)||((u=this.fragmentTracker.getAppendedFrag(n,Xe.MAIN))==null?void 0:u.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:u=>{this.warn("Error executing block-audio operation",u)}};this.blockedAudioAppend={op:a,frag:e},this.append(a,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:r}=this,{data:n,type:s,parent:a,frag:u,part:f,chunkMeta:c,offset:d}=t,p=c.buffering[s],{sn:m,cc:v}=u,y=self.performance.now();p.start=y;const b=u.stats.buffering,E=f?f.stats.buffering:null;b.start===0&&(b.start=y),E&&E.start===0&&(E.start=y);const x=r.audio;let T=!1;s==="audio"&&x?.container==="audio/mpeg"&&(T=!this.lastMpegAudioChunk||c.id===1||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);const A=r.video,L=A?.buffer;if(L&&m!=="initSegment"){const I=f||u,O=this.blockedAudioAppend;if(s==="audio"&&a!=="main"&&!this.blockedAudioAppend&&!(A.ending||A.ended)){const P=I.start+I.duration*.05,$=L.buffered,F=this.currentOp("video");!$.length&&!F?this.blockAudio(I):!F&&!ot.isBuffered(L,P)&&this.lastVideoAppendEnd<P&&this.blockAudio(I)}else if(s==="video"){const B=I.end;if(O){const P=O.frag.start;(B>P||B<this.lastVideoAppendEnd||ot.isBuffered(L,P))&&this.unblockAudio()}this.lastVideoAppendEnd=B}}const w=(f||u).start,C={label:`append-${s}`,execute:()=>{var I;p.executeStart=self.performance.now();const O=(I=this.tracks[s])==null?void 0:I.buffer;O&&(T?this.updateTimestampOffset(O,w,.1,s,m,v):d!==void 0&&Ye(d)&&this.updateTimestampOffset(O,d,1e-6,s,m,v)),this.appendExecutor(n,s)},onStart:()=>{},onComplete:()=>{const I=self.performance.now();p.executeEnd=p.end=I,b.first===0&&(b.first=I),E&&E.first===0&&(E.first=I);const O={};this.sourceBuffers.forEach(([B,P])=>{B&&(O[B]=ot.getBuffered(P))}),this.appendErrors[s]=0,s==="audio"||s==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(M.BUFFER_APPENDED,{type:s,frag:u,part:f,chunkMeta:c,parent:u.type,timeRanges:O})},onError:I=>{var O;const B={type:tt.MEDIA_ERROR,parent:u.type,details:Se.BUFFER_APPEND_ERROR,sourceBufferName:s,frag:u,part:f,chunkMeta:c,error:I,err:I,fatal:!1},P=(O=this.media)==null?void 0:O.error;if(I.code===DOMException.QUOTA_EXCEEDED_ERR||I.name=="QuotaExceededError"||"quota"in I)B.details=Se.BUFFER_FULL_ERROR;else if(I.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!P)B.errorAction=Na(!0);else if(I.name===kA&&this.sourceBufferCount===0)B.errorAction=Na(!0);else{const $=++this.appendErrors[s];this.warn(`Failed ${$}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${s}" sourceBuffer (${P||"no media error"})`),($>=this.hls.config.appendErrorMaxRetry||P)&&(B.fatal=!0)}this.hls.trigger(M.ERROR,B)}};this.log(`queuing "${s}" append sn: ${m}${f?" p: "+f.index:""} of ${u.type===Xe.MAIN?"level":"track"} ${u.level} cc: ${v}`),this.append(C,s,this.isPending(this.tracks[s]))}getFlushOp(e,t,r){return this.log(`queuing "${e}" remove ${t}-${r}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,r)},onStart:()=>{},onComplete:()=>{this.hls.trigger(M.BUFFER_FLUSHED,{type:e})},onError:n=>{this.warn(`Failed to remove ${t}-${r} from "${e}" SourceBuffer`,n)}}}onBufferFlushing(e,t){const{type:r,startOffset:n,endOffset:s}=t;r?this.append(this.getFlushOp(r,n,s),r):this.sourceBuffers.forEach(([a])=>{a&&this.append(this.getFlushOp(a,n,s),a)})}onFragParsed(e,t){const{frag:r,part:n}=t,s=[],a=n?n.elementaryStreams:r.elementaryStreams;a[Ot.AUDIOVIDEO]?s.push("audiovideo"):(a[Ot.AUDIO]&&s.push("audio"),a[Ot.VIDEO]&&s.push("video"));const u=()=>{const f=self.performance.now();r.stats.buffering.end=f,n&&(n.stats.buffering.end=f);const c=n?n.stats:r.stats;this.hls.trigger(M.FRAG_BUFFERED,{frag:r,part:n,stats:c,id:r.type})};s.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${r.type} level: ${r.level} sn: ${r.sn}`),this.blockBuffers(u,s).catch(f=>{this.warn(`Fragment buffered callback ${f}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var r;this.sourceBuffers.forEach(([a])=>{if(a){const u=this.tracks[a];(!t.type||t.type===a)&&(u.ending=!0,u.ended||(u.ended=!0,this.log(`${a} buffer reached EOS`)))}});const n=((r=this.overrides)==null?void 0:r.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([a])=>{var u;return a&&!((u=this.tracks[a])!=null&&u.ended)})?n?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:a}=this;if(!a||a.readyState!=="open"){a&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${a.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),a.endOfStream(),this.hls.trigger(M.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(M.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===Se.BUFFER_APPEND_ERROR&&t.frag){var r;const n=(r=t.errorAction)==null?void 0:r.nextAutoLevel;Ye(n)&&n!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:r}=this;if(!r||t===null||!this.sourceBufferCount)return;const n=e.config,s=r.currentTime,a=t.levelTargetDuration,u=t.live&&n.liveBackBufferLength!==null?n.liveBackBufferLength:n.backBufferLength;if(Ye(u)&&u>=0){const c=Math.max(u,a),d=Math.floor(s/a)*a-c;this.flushBackBuffer(s,a,d)}const f=n.frontBufferFlushThreshold;if(Ye(f)&&f>0){const c=Math.max(n.maxBufferLength,f),d=Math.max(c,a),p=Math.floor(s/a)*a+d;this.flushFrontBuffer(s,a,p)}}flushBackBuffer(e,t,r){this.sourceBuffers.forEach(([n,s])=>{if(s){const u=ot.getBuffered(s);if(u.length>0&&r>u.start(0)){var a;this.hls.trigger(M.BACK_BUFFER_REACHED,{bufferEnd:r});const f=this.tracks[n];if((a=this.details)!=null&&a.live)this.hls.trigger(M.LIVE_BACK_BUFFER_REACHED,{bufferEnd:r});else if(f!=null&&f.ended){this.log(`Cannot flush ${n} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(M.BUFFER_FLUSHING,{startOffset:0,endOffset:r,type:n})}}})}flushFrontBuffer(e,t,r){this.sourceBuffers.forEach(([n,s])=>{if(s){const a=ot.getBuffered(s),u=a.length;if(u<2)return;const f=a.start(u-1),c=a.end(u-1);if(r>f||e>=f&&e<=c)return;this.hls.trigger(M.BUFFER_FLUSHING,{startOffset:f,endOffset:1/0,type:n})}})}getDurationAndRange(){var e;const{details:t,mediaSource:r}=this;if(!t||!this.media||r?.readyState!=="open")return null;const n=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&r.setLiveSeekableRange){const c=Math.max(0,t.fragmentStart),d=Math.max(c,n);return{duration:1/0,start:c,end:d}}return{duration:1/0}}const s=(e=this.overrides)==null?void 0:e.duration;if(s)return Ye(s)?{duration:s}:null;const a=this.media.duration,u=Ye(r.duration)?r.duration:0;return n>u&&n>a||!Ye(a)?{duration:n}:null}updateMediaSource({duration:e,start:t,end:r}){const n=this.mediaSource;!this.media||!n||n.readyState!=="open"||(n.duration!==e&&(Ye(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),n.duration=e),t!==void 0&&r!==void 0&&(this.log(`MediaSource duration is set to ${n.duration}. Setting seekable range to ${t}-${r}.`),n.setLiveSeekableRange(t,r)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:r}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${kt(r)}`),this.tracksReady){var n;const s=(n=this.transferData)==null?void 0:n.tracks;s&&Object.keys(s).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,r])=>{if(t){const n=this.tracks[t];e[t]={buffer:r,container:n.container,codec:n.codec,supplemental:n.supplemental,levelCodec:n.levelCodec,id:n.id,metadata:n.metadata}}}),this.hls.trigger(M.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(M.ERROR,{type:tt.MEDIA_ERROR,details:Se.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:r}=this;if(!r)throw new Error("createSourceBuffers called when mediaSource was null");for(const s in e){const a=s,u=e[a];if(this.isPending(u)){const f=this.getTrackCodec(u,a),c=`${u.container};codecs=${f}`;u.codec=f,this.log(`creating sourceBuffer(${c})${this.currentOp(a)?" Queued":""} ${kt(u)}`);try{const d=r.addSourceBuffer(c),p=Ld(a),m=[a,d];t[p]=m,u.buffer=d}catch(d){var n;this.error(`error while trying to add sourceBuffer: ${d.message}`),this.shiftAndExecuteNext(a),(n=this.operationQueue)==null||n.removeBlockers(),delete this.tracks[a],this.hls.trigger(M.ERROR,{type:tt.MEDIA_ERROR,details:Se.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:d,sourceBufferName:a,mimeType:c,parent:u.id});return}this.trackSourceBuffer(a,u)}}this.bufferCreated()}getTrackCodec(e,t){const r=e.supplemental;let n=e.codec;r&&(t==="video"||t==="audiovideo")&&Jo(r,"video")&&(n=VD(n,r));const s=gc(n,e.levelCodec);return s?t.slice(0,5)==="audio"?Ic(s,this.appendSource):s:""}trackSourceBuffer(e,t){const r=t.buffer;if(!r)return;const n=this.getTrackCodec(t,e);this.tracks[e]={buffer:r,codec:n,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(s,a)=>{const u=a.removedRanges;u!=null&&u.length&&this.hls.trigger(M.BUFFER_FLUSHED,{type:s})})}get mediaSrc(){var e,t;const r=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return r?.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const r=this.currentOp(e);r&&(r.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var r;const n=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(r=this.mediaSource)==null?void 0:r.readyState}`);this.error(`${n}`,t),this.hls.trigger(M.ERROR,{type:tt.MEDIA_ERROR,details:Se.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:n,fatal:!1});const s=this.currentOp(e);s&&s.onError(n)}updateTimestampOffset(e,t,r,n,s,a){const u=t-e.timestampOffset;Math.abs(u)>=r&&(this.log(`Updating ${n} SourceBuffer timestampOffset to ${t} (sn: ${s} cc: ${a})`),e.timestampOffset=t)}removeExecutor(e,t,r){const{media:n,mediaSource:s}=this,a=this.tracks[e],u=a?.buffer;if(!n||!s||!u){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const f=Ye(n.duration)?n.duration:1/0,c=Ye(s.duration)?s.duration:1/0,d=Math.max(0,t),p=Math.min(r,f,c);p>d&&(!a.ending||a.ended)?(a.ended=!1,this.log(`Removing [${d},${p}] from the ${e} SourceBuffer`),u.remove(d,p)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const r=this.tracks[t],n=r?.buffer;if(!n)throw new eM(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);r.ending=!1,r.ended=!1,n.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:r}=this,n=t.map(a=>this.appendBlocker(a));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(n).then(a=>{r===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var r;const n=(r=this.tracks[t])==null?void 0:r.buffer;!n||n.updating||this.shiftAndExecuteNext(t)})}append(e,t,r){this.operationQueue&&this.operationQueue.append(e,t,r)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,r){const n=this.tracks[e];if(!n)return;const s=n.buffer;if(!s)return;const a=r.bind(this,e);n.listeners.push({event:t,listener:a}),s.addEventListener(t,a)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const r=t.buffer;r&&(t.listeners.forEach(n=>{r.removeEventListener(n.event,n.listener)}),t.listeners.length=0)}}function uT(l){const e=l.querySelectorAll("source");[].slice.call(e).forEach(t=>{l.removeChild(t)})}function rM(l,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,l.appendChild(t)}function Ld(l){return l==="audio"?1:0}class qm{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(M.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(M.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(M.MANIFEST_PARSED,this.onManifestParsed,this),e.on(M.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(M.BUFFER_CODECS,this.onBufferCodecs,this),e.on(M.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(M.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(M.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(M.MANIFEST_PARSED,this.onManifestParsed,this),e.off(M.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(M.BUFFER_CODECS,this.onBufferCodecs,this),e.off(M.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&Ye(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,r=this.getMaxLevel(e.length-1);r!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${r}: ${e[r].height}p@${e[r].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=r,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const r=t.filter((n,s)=>this.isLevelAllowed(n)&&s<=e);return this.clientRect=null,qm.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,!t.width&&!t.height&&(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(r=>e.bitrate===r.bitrate&&e.width===r.width&&e.height===r.height)}static getMaxLevelByMediaSize(e,t,r){if(!(e!=null&&e.length))return-1;const n=(u,f)=>f?u.width!==f.width||u.height!==f.height:!0;let s=e.length-1;const a=Math.max(t,r);for(let u=0;u<e.length;u+=1){const f=e[u];if((f.width>=a||f.height>=a)&&n(f,e[u+1])){s=u;break}}return s}}const iM={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Gr=iM,nM={HLS:"h"},sM=nM;class Fi{constructor(e,t){Array.isArray(e)&&(e=e.map(r=>r instanceof Fi?r:new Fi(r))),this.value=e,this.params=t}}const aM="Dict";function oM(l){return Array.isArray(l)?JSON.stringify(l):l instanceof Map?"Map{}":l instanceof Set?"Set{}":typeof l=="object"?JSON.stringify(l):String(l)}function lM(l,e,t,r){return new Error(`failed to ${l} "${oM(e)}" as ${t}`,{cause:r})}function ji(l,e,t){return lM("serialize",l,e,t)}class MA{constructor(e){this.description=e}}const cT="Bare Item",uM="Boolean";function cM(l){if(typeof l!="boolean")throw ji(l,uM);return l?"?1":"?0"}function fM(l){return btoa(String.fromCharCode(...l))}const hM="Byte Sequence";function dM(l){if(ArrayBuffer.isView(l)===!1)throw ji(l,hM);return`:${fM(l)}:`}const pM="Integer";function gM(l){return l<-999999999999999||999999999999999<l}function PA(l){if(gM(l))throw ji(l,pM);return l.toString()}function mM(l){return`@${PA(l.getTime()/1e3)}`}function NA(l,e){if(l<0)return-NA(-l,e);const t=Math.pow(10,e);if(Math.abs(l*t%1-.5)<Number.EPSILON){const n=Math.floor(l*t);return(n%2===0?n:n+1)/t}else return Math.round(l*t)/t}const yM="Decimal";function vM(l){const e=NA(l,3);if(Math.floor(Math.abs(e)).toString().length>12)throw ji(l,yM);const t=e.toString();return t.includes(".")?t:`${t}.0`}const bM="String",EM=/[\x00-\x1f\x7f]+/;function SM(l){if(EM.test(l))throw ji(l,bM);return`"${l.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function TM(l){return l.description||l.toString().slice(7,-1)}const xM="Token";function fT(l){const e=TM(l);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw ji(e,xM);return e}function em(l){switch(typeof l){case"number":if(!Ye(l))throw ji(l,cT);return Number.isInteger(l)?PA(l):vM(l);case"string":return SM(l);case"symbol":return fT(l);case"boolean":return cM(l);case"object":if(l instanceof Date)return mM(l);if(l instanceof Uint8Array)return dM(l);if(l instanceof MA)return fT(l);default:throw ji(l,cT)}}const _M="Key";function tm(l){if(/^[a-z*][a-z0-9\-_.*]*$/.test(l)===!1)throw ji(l,_M);return l}function Ym(l){return l==null?"":Object.entries(l).map(([e,t])=>t===!0?`;${tm(e)}`:`;${tm(e)}=${em(t)}`).join("")}function UA(l){return l instanceof Fi?`${em(l.value)}${Ym(l.params)}`:em(l)}function AM(l){return`(${l.value.map(UA).join(" ")})${Ym(l.params)}`}function wM(l,e={whitespace:!0}){if(typeof l!="object"||l==null)throw ji(l,aM);const t=l instanceof Map?l.entries():Object.entries(l),r=e?.whitespace?" ":"";return Array.from(t).map(([n,s])=>{s instanceof Fi||(s=new Fi(s));let a=tm(n);return s.value===!0?a+=Ym(s.params):(a+="=",Array.isArray(s.value)?a+=AM(s):a+=UA(s)),a}).join(`,${r}`)}function BA(l,e){return wM(l,e)}const Di="CMCD-Object",qt="CMCD-Request",Is="CMCD-Session",Zn="CMCD-Status",RM={br:Di,ab:Di,d:Di,ot:Di,tb:Di,tpb:Di,lb:Di,tab:Di,lab:Di,url:Di,pb:qt,bl:qt,tbl:qt,dl:qt,ltc:qt,mtp:qt,nor:qt,nrr:qt,rc:qt,sn:qt,sta:qt,su:qt,ttfb:qt,ttfbb:qt,ttlb:qt,cmsdd:qt,cmsds:qt,smrt:qt,df:qt,cs:qt,ts:qt,cid:Is,pr:Is,sf:Is,sid:Is,st:Is,v:Is,msd:Is,bs:Zn,bsd:Zn,cdn:Zn,rtp:Zn,bg:Zn,pt:Zn,ec:Zn,e:Zn},IM={REQUEST:qt};function LM(l){return Object.keys(l).reduce((e,t)=>{var r;return(r=l[t])===null||r===void 0||r.forEach(n=>e[n]=t),e},{})}function CM(l,e){const t={};if(!l)return t;const r=Object.keys(l),n=e?LM(e):{};return r.reduce((s,a)=>{var u;const f=RM[a]||n[a]||IM.REQUEST,c=(u=s[f])!==null&&u!==void 0?u:s[f]={};return c[a]=l[a],s},t)}function DM(l){return["ot","sf","st","e","sta"].includes(l)}function OM(l){return typeof l=="number"?Ye(l):l!=null&&l!==""&&l!==!1}const FA="event";function kM(l,e){const t=new URL(l),r=new URL(e);if(t.origin!==r.origin)return l;const n=t.pathname.split("/").slice(1),s=r.pathname.split("/").slice(1,-1);for(;n[0]===s[0];)n.shift(),s.shift();for(;s.length;)s.shift(),n.unshift("..");return n.join("/")+t.search+t.hash}const Ec=l=>Math.round(l),rm=(l,e)=>Array.isArray(l)?l.map(t=>rm(t,e)):l instanceof Fi&&typeof l.value=="string"?new Fi(rm(l.value,e),l.params):(e.baseUrl&&(l=kM(l,e.baseUrl)),e.version===1?encodeURIComponent(l):l),ku=l=>Ec(l/100)*100,MM=(l,e)=>{let t=l;return e.version>=2&&(l instanceof Fi&&typeof l.value=="string"?t=new Fi([l]):typeof l=="string"&&(t=[l])),rm(t,e)},PM={br:Ec,d:Ec,bl:ku,dl:ku,mtp:ku,nor:MM,rtp:ku,tb:Ec},jA="request",$A="response",Wm=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],NM=["e"],UM=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Yc(l){return UM.test(l)}function BM(l){return Wm.includes(l)||NM.includes(l)||Yc(l)}const GA=["d","dl","nor","ot","rtp","su"];function FM(l){return Wm.includes(l)||GA.includes(l)||Yc(l)}const jM=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function $M(l){return Wm.includes(l)||GA.includes(l)||jM.includes(l)||Yc(l)}const GM=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function HM(l){return GM.includes(l)||Yc(l)}const KM={[$A]:$M,[FA]:BM,[jA]:FM};function HA(l,e={}){const t={};if(l==null||typeof l!="object")return t;const r=e.version||l.v||1,n=e.reportingMode||jA,s=r===1?HM:KM[n];let a=Object.keys(l).filter(s);const u=e.filter;typeof u=="function"&&(a=a.filter(u));const f=n===$A||n===FA;f&&!a.includes("ts")&&a.push("ts"),r>1&&!a.includes("v")&&a.push("v");const c=Lt({},PM,e.formatters),d={version:r,reportingMode:n,baseUrl:e.baseUrl};return a.sort().forEach(p=>{let m=l[p];const v=c[p];if(typeof v=="function"&&(m=v(m,d)),p==="v"){if(r===1)return;m=r}p=="pr"&&m===1||(f&&p==="ts"&&!Ye(m)&&(m=Date.now()),OM(m)&&(DM(p)&&typeof m=="string"&&(m=new MA(m)),t[p]=m))}),t}function VM(l,e={}){const t={};if(!l)return t;const r=HA(l,e),n=CM(r,e?.customHeaderMap);return Object.entries(n).reduce((s,[a,u])=>{const f=BA(u,{whitespace:!1});return f&&(s[a]=f),s},t)}function zM(l,e,t){return Lt(l,VM(e,t))}const qM="CMCD";function YM(l,e={}){return l?BA(HA(l,e),{whitespace:!1}):""}function WM(l,e={}){if(!l)return"";const t=YM(l,e);return encodeURIComponent(t)}function QM(l,e={}){if(!l)return"";const t=WM(l,e);return`${qM}=${t}`}const hT=/CMCD=[^&#]+/;function XM(l,e,t){const r=QM(e,t);if(!r)return l;if(hT.test(l))return l.replace(hT,r);const n=l.includes("?")?"&":"?";return`${l}${n}${r}`}class ZM{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=n=>{try{this.apply(n,{ot:Gr.MANIFEST,su:!this.initialized})}catch(s){this.hls.logger.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=n=>{try{const{frag:s,part:a}=n,u=this.hls.levels[s.level],f=this.getObjectType(s),c={d:(a||s).duration*1e3,ot:f};(f===Gr.VIDEO||f===Gr.AUDIO||f==Gr.MUXED)&&(c.br=u.bitrate/1e3,c.tb=this.getTopBandwidth(f)/1e3,c.bl=this.getBufferLength(f));const d=a?this.getNextPart(a):this.getNextFrag(s);d!=null&&d.url&&d.url!==s.url&&(c.nor=d.url),this.apply(n,c)}catch(s){this.hls.logger.warn("Could not generate segment CMCD data.",s)}},this.hls=e;const t=this.config=e.config,{cmcd:r}=t;r!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=r.sessionId||e.sessionId,this.cid=r.contentId,this.useHeaders=r.useHeaders===!0,this.includeKeys=r.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(M.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(M.MEDIA_DETACHED,this.onMediaDetached,this),e.on(M.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(M.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(M.MEDIA_DETACHED,this.onMediaDetached,this),e.off(M.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var r,n;this.audioBuffer=(r=t.tracks.audio)==null?void 0:r.buffer,this.videoBuffer=(n=t.tracks.video)==null?void 0:n.buffer}createData(){var e;return{v:1,sf:sM.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){Lt(t,this.createData());const r=t.ot===Gr.INIT||t.ot===Gr.VIDEO||t.ot===Gr.MUXED;this.starved&&r&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:n}=this;n&&(t=Object.keys(t).reduce((a,u)=>(n.includes(u)&&(a[u]=t[u]),a),{}));const s={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),zM(e.headers,t,s)):e.url=XM(e.url,t,s)}getNextFrag(e){var t;const r=(t=this.hls.levels[e.level])==null?void 0:t.details;if(r){const n=e.sn-r.startSN;return r.fragments[n+1]}}getNextPart(e){var t;const{index:r,fragment:n}=e,s=(t=this.hls.levels[n.level])==null||(t=t.details)==null?void 0:t.partList;if(s){const{sn:a}=n;for(let u=s.length-1;u>=0;u--){const f=s[u];if(f.index===r&&f.fragment.sn===a)return s[u+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Gr.TIMED_TEXT;if(e.sn==="initSegment")return Gr.INIT;if(t==="audio")return Gr.AUDIO;if(t==="main")return this.hls.audioTracks.length?Gr.VIDEO:Gr.MUXED}getTopBandwidth(e){let t=0,r;const n=this.hls;if(e===Gr.AUDIO)r=n.audioTracks;else{const s=n.maxAutoLevel,a=s>-1?s+1:n.levels.length;r=n.levels.slice(0,a)}return r.forEach(s=>{s.bitrate>t&&(t=s.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,r=e===Gr.AUDIO?this.audioBuffer:this.videoBuffer;return!r||!t?NaN:ot.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,r=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new r(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,a,u){t(s),this.loader.load(s,a,u)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,r=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new r(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,a,u){t(s),this.loader.load(s,a,u)}}}}const JM=3e5;class eP extends vi{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(M.MANIFEST_LOADING,this.onManifestLoading,this),e.on(M.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(M.MANIFEST_PARSED,this.onManifestParsed,this),e.on(M.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(M.MANIFEST_LOADING,this.onManifestLoading,this),e.off(M.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(M.MANIFEST_PARSED,this.onManifestParsed,this),e.off(M.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(r=>r!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:r}=t;r!==null&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:r}=t;if(r?.action===yr.SendAlternateToPenaltyBox&&r.flags===ti.MoveAllAlternatesMatchingHost){const n=this.levels;let s=this._pathwayPriority,a=this.pathwayId;if(t.context){const{groupId:u,pathwayId:f,type:c}=t.context;u&&n?a=this.getPathwayForGroupId(u,c,a):f&&(a=f)}a in this.penalizedPathways||(this.penalizedPathways[a]=performance.now()),!s&&n&&(s=this.pathways()),s&&s.length>1&&(this.updatePathwayPriority(s),r.resolved=this.pathwayId!==a),t.details===Se.BUFFER_APPEND_ERROR&&!t.fatal?r.resolved=!0:r.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${a} levels: ${n&&n.length} priorities: ${kt(s)} penalized: ${kt(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const r=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${r}"`),t=this.getLevelsForPathway(r),this.pathwayId=r}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const r=this.penalizedPathways,n=performance.now();Object.keys(r).forEach(s=>{n-r[s]>JM&&delete r[s]});for(let s=0;s<e.length;s++){const a=e[s];if(a in r)continue;if(a===this.pathwayId)return;const u=this.hls.nextLoadLevel,f=this.hls.levels[u];if(t=this.getLevelsForPathway(a),t.length>0){this.log(`Setting Pathway to "${a}"`),this.pathwayId=a,uA(t),this.hls.trigger(M.LEVELS_UPDATED,{levels:t});const c=this.hls.levels[u];f&&c&&this.levels&&(c.attrs["STABLE-VARIANT-ID"]!==f.attrs["STABLE-VARIANT-ID"]&&c.bitrate!==f.bitrate&&this.log(`Unstable Pathways change from bitrate ${f.bitrate} to ${c.bitrate}`),this.hls.nextLoadLevel=u);break}}}getPathwayForGroupId(e,t,r){const n=this.getLevelsForPathway(r).concat(this.levels||[]);for(let s=0;s<n.length;s++)if(t===dt.AUDIO_TRACK&&n[s].hasAudioGroup(e)||t===dt.SUBTITLE_TRACK&&n[s].hasSubtitleGroup(e))return n[s].pathwayId;return r}clonePathways(e){const t=this.levels;if(!t)return;const r={},n={};e.forEach(s=>{const{ID:a,"BASE-ID":u,"URI-REPLACEMENT":f}=s;if(t.some(d=>d.pathwayId===a))return;const c=this.getLevelsForPathway(u).map(d=>{const p=new $t(d.attrs);p["PATHWAY-ID"]=a;const m=p.AUDIO&&`${p.AUDIO}_clone_${a}`,v=p.SUBTITLES&&`${p.SUBTITLES}_clone_${a}`;m&&(r[p.AUDIO]=m,p.AUDIO=m),v&&(n[p.SUBTITLES]=v,p.SUBTITLES=v);const y=KA(d.uri,p["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",f),b=new tl({attrs:p,audioCodec:d.audioCodec,bitrate:d.bitrate,height:d.height,name:d.name,url:y,videoCodec:d.videoCodec,width:d.width});if(d.audioGroups)for(let E=1;E<d.audioGroups.length;E++)b.addGroupId("audio",`${d.audioGroups[E]}_clone_${a}`);if(d.subtitleGroups)for(let E=1;E<d.subtitleGroups.length;E++)b.addGroupId("text",`${d.subtitleGroups[E]}_clone_${a}`);return b});t.push(...c),dT(this.audioTracks,r,f,a),dT(this.subtitleTracks,n,f,a)})}loadSteeringManifest(e){const t=this.hls.config,r=t.loader;this.loader&&this.loader.destroy(),this.loader=new r(t);let n;try{n=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(n.protocol!=="data:"){const d=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;n.searchParams.set("_HLS_pathway",this.pathwayId),n.searchParams.set("_HLS_throughput",""+d)}const s={responseType:"json",url:n.href},a=t.steeringManifestLoadPolicy.default,u=a.errorRetry||a.timeoutRetry||{},f={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:u.maxNumRetry||0,retryDelay:u.retryDelayMs||0,maxRetryDelay:u.maxRetryDelayMs||0},c={onSuccess:(d,p,m,v)=>{this.log(`Loaded steering manifest: "${n}"`);const y=d.data;if(y?.VERSION!==1){this.log(`Steering VERSION ${y.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=y.TTL;const{"RELOAD-URI":b,"PATHWAY-CLONES":E,"PATHWAY-PRIORITY":x}=y;if(b)try{this.uri=new self.URL(b,n).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${b}`);return}this.scheduleRefresh(this.uri||m.url),E&&this.clonePathways(E);const T={steeringManifest:y,url:n.toString()};this.hls.trigger(M.STEERING_MANIFEST_LOADED,T),x&&this.updatePathwayPriority(x)},onError:(d,p,m,v)=>{if(this.log(`Error loading steering manifest: ${d.code} ${d.text} (${p.url})`),this.stopLoad(),d.code===410){this.enabled=!1,this.log(`Steering manifest ${p.url} no longer available`);return}let y=this.timeToLoad*1e3;if(d.code===429){const b=this.loader;if(typeof b?.getResponseHeader=="function"){const E=b.getResponseHeader("Retry-After");E&&(y=parseFloat(E)*1e3)}this.log(`Steering manifest ${p.url} rate limited`);return}this.scheduleRefresh(this.uri||p.url,y)},onTimeout:(d,p,m)=>{this.log(`Timeout loading steering manifest (${p.url})`),this.scheduleRefresh(this.uri||p.url)}};this.log(`Requesting steering manifest: ${n}`),this.loader.load(s,f,c)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var r;const n=(r=this.hls)==null?void 0:r.media;if(n&&!n.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function dT(l,e,t,r){l&&Object.keys(e).forEach(n=>{const s=l.filter(a=>a.groupId===n).map(a=>{const u=Lt({},a);return u.details=void 0,u.attrs=new $t(u.attrs),u.url=u.attrs.URI=KA(a.url,a.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),u.groupId=u.attrs["GROUP-ID"]=e[n],u.attrs["PATHWAY-ID"]=r,u});l.push(...s)})}function KA(l,e,t,r){const{HOST:n,PARAMS:s,[t]:a}=r;let u;e&&(u=a?.[e],u&&(l=u));const f=new self.URL(l);return n&&!u&&(f.host=n),s&&Object.keys(s).sort().forEach(c=>{c&&f.searchParams.set(c,s[c])}),f.href}class Ba extends vi{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=Ba.CDMCleanupPromise?[Ba.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:r,initData:n}=t,s=`"${t.type}" event: init data type: "${r}"`;if(this.debug(s),n!==null){if(!this.keyFormatPromise){let a=Object.keys(this.keySystemAccessPromises);a.length||(a=Vo(this.config));const u=a.map(Sd).filter(f=>!!f);this.keyFormatPromise=this.getKeyFormatPromise(u)}this.keyFormatPromise.then(a=>{const u=yc(a);if(r!=="sinf"||u!==Gt.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${r}" for selected key-system ${u}`);return}let f;try{const v=ar(new Uint8Array(n)),y=Um(JSON.parse(v).sinf),b=B_(y);if(!b)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");f=new Uint8Array(b.subarray(8,24))}catch(v){this.warn(`${s} Failed to parse sinf: ${v}`);return}const c=vr(f),{keyIdToKeySessionPromise:d,mediaKeySessions:p}=this;let m=d[c];for(let v=0;v<p.length;v++){const y=p[v],b=y.decryptdata;if(!b.keyId)continue;const E=vr(b.keyId);if(kc(f,b.keyId)||b.uri.replace(/-/g,"").indexOf(c)!==-1){if(m=d[E],!m)continue;if(b.pssh)break;delete d[E],b.pssh=new Uint8Array(n),b.keyId=f,m=d[c]=m.then(()=>this.generateRequestWithPreferredKeySession(y,r,n,"encrypted-event-key-match")),m.catch(x=>this.handleError(x));break}}m||this.handleError(new Error(`Key ID ${c} not encountered in playlist. Key-system sessions ${p.length}.`))}).catch(a=>this.handleError(a))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(M.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(M.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(M.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(M.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(M.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(M.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(M.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(M.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(M.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(M.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:r}=this.config,n=t?.[e];if(n)return n.licenseUrl;if(e===Gt.WIDEVINE&&r)return r}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,r=t?.[e];if(r)return r.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,r=(a,u,f)=>!!a&&f.indexOf(a)===u,n=t.map(a=>a.audioCodec).filter(r),s=t.map(a=>a.videoCodec).filter(r);return n.length+s.length===0&&s.push("avc1.42e01e"),new Promise((a,u)=>{const f=c=>{const d=c.shift();this.getMediaKeysPromise(d,n,s).then(p=>a({keySystem:d,mediaKeys:p})).catch(p=>{c.length?f(c):p instanceof ei?u(p):u(new ei({type:tt.KEY_SYSTEM_ERROR,details:Se.KEY_SYSTEM_NO_ACCESS,error:p,fatal:!0},p.message))})};f(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:r}=this.config;if(typeof r!="function"){let n=`Configured requestMediaKeySystemAccess is not a function ${r}`;return tA===null&&self.location.protocol==="http:"&&(n=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(n))}return r(e,t)}getMediaKeysPromise(e,t,r){var n;const s=MO(e,t,r,this.config.drmSystemOptions||{});let a=this.keySystemAccessPromises[e],u=(n=a)==null?void 0:n.keySystemAccess;if(!u){this.log(`Requesting encrypted media "${e}" key-system access with config: ${kt(s)}`),u=this.requestMediaKeySystemAccess(e,s);const f=a=this.keySystemAccessPromises[e]={keySystemAccess:u};return u.catch(c=>{this.log(`Failed to obtain access to key-system "${e}": ${c}`)}),u.then(c=>{this.log(`Access for key-system "${c.keySystem}" obtained`);const d=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const p=f.mediaKeys=c.createMediaKeys().then(m=>(this.log(`Media-keys created for "${e}"`),f.hasMediaKeys=!0,d.then(v=>v?this.setMediaKeysServerCertificate(m,e,v):m)));return p.catch(m=>{this.error(`Failed to create media-keys for "${e}"}: ${m}`)}),p})}return u.then(()=>a.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:r}){this.log(`Creating key-system session "${t}" keyId: ${vr(e.keyId||[])} keyUri: ${e.uri}`);const n=r.createSession(),s={decryptdata:e,keySystem:t,mediaKeys:r,mediaKeysSession:n,keyStatus:"status-pending"};return this.mediaKeySessions.push(s),s}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const r=this.createMediaKeySessionContext(e),n=Mu(t),s="cenc";this.keyIdToKeySessionPromise[n]=this.generateRequestWithPreferredKeySession(r,s,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const r=e.mediaKeysSession;return this.log(`Updating key-session "${r.sessionId}" for keyId ${vr(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),r.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>Sd(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:r})=>this.attemptSetMediaKeys(t,r))}selectKeySystem(e){return new Promise((t,r)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:n})=>{const s=Sd(n);s?t(s):r(new Error(`Unable to find format for key-system "${n}"`))}).catch(r)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=Vo(this.config),r=e.map(yc).filter(n=>!!n&&t.indexOf(n)!==-1);return this.selectKeySystem(r)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let r=0;r<t.length;r++){const n=tP(e,t[r]);if(n)return n}}loadKey(e){const t=e.keyInfo.decryptdata,r=Mu(t),n=this.bannedKeyIds[r];if(n||this.getKeyStatus(t)==="internal-error"){const u=pT(n||"internal-error",t);return this.handleError(u,e.frag),Promise.reject(u)}const s=`(keyId: ${r} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${s}`);const a=this.keyIdToKeySessionPromise[r];if(!a){const u=this.getKeySystemForKeyPromise(t).then(({keySystem:f,mediaKeys:c})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${s}`),this.attemptSetMediaKeys(f,c).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:f,mediaKeys:c,decryptdata:t}))))).then(f=>{const c="cenc",d=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(f,c,d,"playlist-key")});return u.catch(f=>this.handleError(f,e.frag)),this.keyIdToKeySessionPromise[r]=u,u}return a.catch(u=>{if(u instanceof ei){const f=_t({},u.data);this.getKeyStatus(t)==="internal-error"&&(f.decryptdata=t);const c=new ei(f,u.message);this.handleError(c,e.frag)}}),a}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof ei){t&&(e.data.frag=t);const r=e.data.decryptdata;this.error(`${e.message}${r?` (${vr(r.keyId||[])})`:""}`),this.hls.trigger(M.ERROR,e.data)}else this.error(e.message),this.hls.trigger(M.ERROR,{type:tt.KEY_SYSTEM_ERROR,details:Se.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=Mu(e),r=this.keyIdToKeySessionPromise[t];if(!r){const n=yc(e.keyFormat),s=n?[n]:Vo(this.config);return this.attemptKeySystemAccess(s)}return r}getKeySystemSelectionPromise(e){if(e.length||(e=Vo(this.config)),e.length===0)throw new ei({type:tt.KEY_SYSTEM_ERROR,details:Se.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${kt({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const r=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const n=Promise.all(r).then(()=>this.media?this.media.setMediaKeys(t):new Promise((s,a)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return a(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(s).catch(a)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(n),n.then(()=>{this.log(`Media-keys set for "${e}"`),r.push(n),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(s=>r.indexOf(s)===-1)})}generateRequestWithPreferredKeySession(e,t,r,n){var s;const a=(s=this.config.drmSystems)==null||(s=s[e.keySystem])==null?void 0:s.generateRequest;if(a)try{const y=a.call(this.hls,t,r,e);if(!y)throw new Error("Invalid response from configured generateRequest filter");t=y.initDataType,r=y.initData?y.initData:null,e.decryptdata.pssh=r?new Uint8Array(r):null}catch(y){if(this.warn(y.message),this.hls&&this.hls.config.debug)throw y}if(r===null)return this.log(`Skipping key-session request for "${n}" (no initData)`),Promise.resolve(e);const u=Mu(e.decryptdata),f=e.decryptdata.uri;this.log(`Generating key-session request for "${n}" keyId: ${u} URI: ${f} (init data type: ${t} length: ${r.byteLength})`);const c=new Fm,d=e._onmessage=y=>{const b=e.mediaKeysSession;if(!b){c.emit("error",new Error("invalid state"));return}const{messageType:E,message:x}=y;this.log(`"${E}" message event for session "${b.sessionId}" message size: ${x.byteLength}`),E==="license-request"||E==="license-renewal"?this.renewLicense(e,x).catch(T=>{c.eventNames().length?c.emit("error",T):this.handleError(T)}):E==="license-release"?e.keySystem===Gt.FAIRPLAY&&this.updateKeySession(e,Yg("acknowledged")).then(()=>this.removeSession(e)).catch(T=>this.handleError(T)):this.warn(`unhandled media key message type "${E}"`)},p=(y,b)=>{b.keyStatus=y;let E;y.startsWith("usable")?c.emit("resolved"):y==="internal-error"||y==="output-restricted"||y==="output-downscaled"?E=pT(y,b.decryptdata):y==="expired"?E=new Error(`key expired (keyId: ${u})`):y==="released"?E=new Error("key released"):y==="status-pending"||this.warn(`unhandled key status change "${y}" (keyId: ${u})`),E&&(c.eventNames().length?c.emit("error",E):this.handleError(E))},m=e._onkeystatuseschange=y=>{if(!e.mediaKeysSession){c.emit("error",new Error("invalid state"));return}const E=this.getKeyStatuses(e);if(!Object.keys(E).some(L=>E[L]!=="status-pending"))return;if(E[u]==="expired"){this.log(`Expired key ${kt(E)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let T=E[u];if(T)p(T,e);else{var A;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(A=e.keyStatusTimeouts)[u]||(A[u]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const w=this.getKeyStatus(e.decryptdata);if(w&&w!=="status-pending")return this.log(`No status for keyId ${u} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${w} from other session.`),p(w,e);this.log(`key status for ${u} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),T="internal-error",p(T,e)},1e3)),this.log(`No status for keyId ${u} (${kt(E)}).`)}};Lr(e.mediaKeysSession,"message",d),Lr(e.mediaKeysSession,"keystatuseschange",m);const v=new Promise((y,b)=>{c.on("error",b),c.on("resolved",y)});return e.mediaKeysSession.generateRequest(t,r).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${u} URI: ${f}`)}).catch(y=>{throw new ei({type:tt.KEY_SYSTEM_ERROR,details:Se.KEY_SYSTEM_NO_SESSION,error:y,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${y}`)}).then(()=>v).catch(y=>(c.removeAllListeners(),this.removeSession(e).then(()=>{throw y}))).then(()=>(c.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((r,n)=>{if(typeof n=="string"&&typeof r=="object"){const u=n;n=r,r=u}const s="buffer"in n?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n);if(e.keySystem===Gt.PLAYREADY&&s.length===16){const u=vr(s);t[u]=r,J_(s)}const a=vr(s);r==="internal-error"&&(this.bannedKeyIds[a]=r),this.log(`key status change "${r}" for keyStatuses keyId: ${a} key-session "${e.mediaKeysSession.sessionId}"`),t[a]=r}),t}fetchServerCertificate(e){const t=this.config,r=t.loader,n=new r(t),s=this.getServerCertificateUrl(e);return s?(this.log(`Fetching server certificate for "${e}"`),new Promise((a,u)=>{const f={responseType:"arraybuffer",url:s},c=t.certLoadPolicy.default,d={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(m,v,y,b)=>{a(m.data)},onError:(m,v,y,b)=>{u(new ei({type:tt.KEY_SYSTEM_ERROR,details:Se.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:y,response:_t({url:f.url,data:void 0},m)},`"${e}" certificate request failed (${s}). Status: ${m.code} (${m.text})`))},onTimeout:(m,v,y)=>{u(new ei({type:tt.KEY_SYSTEM_ERROR,details:Se.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:y,response:{url:f.url,data:void 0}},`"${e}" certificate request timed out (${s})`))},onAbort:(m,v,y)=>{u(new Error("aborted"))}};n.load(f,d,p)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,r){return new Promise((n,s)=>{e.setServerCertificate(r).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${r.byteLength}) on "${t}"`),n(e)}).catch(a=>{s(new ei({type:tt.KEY_SYSTEM_ERROR,details:Se.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(r=>this.updateKeySession(e,new Uint8Array(r)).catch(n=>{throw new ei({type:tt.KEY_SYSTEM_ERROR,details:Se.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:n,fatal:!1},n.message)}))}unpackPlayReadyKeyMessage(e,t){const r=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!r.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const n=new DOMParser().parseFromString(r,"application/xml"),s=n.querySelectorAll("HttpHeader");if(s.length>0){let d;for(let p=0,m=s.length;p<m;p++){var a,u;d=s[p];const v=(a=d.querySelector("name"))==null?void 0:a.textContent,y=(u=d.querySelector("value"))==null?void 0:u.textContent;v&&y&&e.setRequestHeader(v,y)}}const f=n.querySelector("Challenge"),c=f?.textContent;if(!c)throw new Error("Cannot find <Challenge> in key message");return Yg(atob(c))}setupLicenseXHR(e,t,r,n){const s=this.config.licenseXhrSetup;return s?Promise.resolve().then(()=>{if(!r.decryptdata)throw new Error("Key removed");return s.call(this.hls,e,t,r,n)}).catch(a=>{if(!r.decryptdata)throw a;return e.open("POST",t,!0),s.call(this.hls,e,t,r,n)}).then(a=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:a||n})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:n}))}requestLicense(e,t){const r=this.config.keyLoadPolicy.default;return new Promise((n,s)=>{const a=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${a}`);const u=new XMLHttpRequest;u.responseType="arraybuffer",u.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return s(new Error("invalid state"));if(u.readyState===4)if(u.status===200){this._requestLicenseFailureCount=0;let f=u.response;this.log(`License received ${f instanceof ArrayBuffer?f.byteLength:f}`);const c=this.config.licenseResponseCallback;if(c)try{f=c.call(this.hls,u,a,e)}catch(d){this.error(d)}n(f)}else{const f=r.errorRetry,c=f?f.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>c||u.status>=400&&u.status<500)s(new ei({type:tt.KEY_SYSTEM_ERROR,details:Se.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:u,response:{url:a,data:void 0,code:u.status,text:u.statusText}},`License Request XHR failed (${a}). Status: ${u.status} (${u.statusText})`));else{const d=c-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${d} attempts left`),this.requestLicense(e,t).then(n,s)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=u,this.setupLicenseXHR(u,a,e,t).then(({xhr:f,licenseChallenge:c})=>{e.keySystem==Gt.PLAYREADY&&(c=this.unpackPlayReadyKeyMessage(f,c)),f.send(c)}).catch(s)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const r=t.media;this.media=r,Lr(r,"encrypted",this.onMediaEncrypted),Lr(r,"waitingforkey",this.onWaitingForKey);const n=this.mediaResolved;n?n():this.mediaKeys=r.mediaKeys}onMediaDetached(){const e=this.media;e&&(Hr(e,"encrypted",this.onMediaEncrypted),Hr(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const r=this.media,n=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,ss.clearKeyUriToKeyIdMap();const s=n.length;Ba.CDMCleanupPromise=Promise.all(n.map(a=>this.removeSession(a)).concat((r==null||(e=r.setMediaKeys(null))==null?void 0:e.catch(a=>{this.log(`Could not clear media keys: ${a}`),this.hls&&this.hls.trigger(M.ERROR,{type:tt.OTHER_ERROR,details:Se.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${a}`)})}))||Promise.resolve())).catch(a=>{this.log(`Could not close sessions and clear media keys: ${a}`),this.hls&&this.hls.trigger(M.ERROR,{type:tt.OTHER_ERROR,details:Se.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${a}`)})}).then(()=>{s&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const r=t.reduce((n,s)=>(n.indexOf(s.keyFormat)===-1&&n.push(s.keyFormat),n),[]);this.log(`Selecting key-system from session-keys ${r.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(r)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:r,decryptdata:n}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${vr(n?.keyId||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),r&&r.readyState!==XMLHttpRequest.DONE&&r.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const s=this.mediaKeySessions.indexOf(e);s>-1&&this.mediaKeySessions.splice(s,1);const{keyStatusTimeouts:a}=e;a&&Object.keys(a).forEach(c=>self.clearTimeout(a[c]));const{drmSystemOptions:u}=this.config;return(NO(u)?new Promise((c,d)=>{self.setTimeout(()=>d(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(c).catch(d)}):Promise.resolve()).catch(c=>{this.log(`Could not remove session: ${c}`),this.hls&&this.hls.trigger(M.ERROR,{type:tt.OTHER_ERROR,details:Se.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${c}`)})}).then(()=>t.close()).catch(c=>{this.log(`Could not close session: ${c}`),this.hls&&this.hls.trigger(M.ERROR,{type:tt.OTHER_ERROR,details:Se.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${c}`)})})}return Promise.resolve()}}Ba.CDMCleanupPromise=void 0;function Mu(l){if(!l)throw new Error("Could not read keyId of undefined decryptdata");if(l.keyId===null)throw new Error("keyId is null");return vr(l.keyId)}function tP(l,e){if(l.keyId&&e.mediaKeysSession.keyStatuses.has(l.keyId))return e.mediaKeysSession.keyStatuses.get(l.keyId);if(l.matches(e.decryptdata))return e.keyStatus}class ei extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function pT(l,e){const t=l==="output-restricted",r=t?Se.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:Se.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new ei({type:tt.KEY_SYSTEM_ERROR,details:r,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${l}"`)}class rP{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(M.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(M.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(M.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(M.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const r=this.hls.config;if(r.capLevelOnFPSDrop){const n=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=n,n&&typeof n.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,r){const n=performance.now();if(t){if(this.lastTime){const s=n-this.lastTime,a=r-this.lastDroppedFrames,u=t-this.lastDecodedFrames,f=1e3*a/s,c=this.hls;if(c.trigger(M.FPS_DROP,{currentDropped:a,currentDecoded:u,totalDroppedFrames:r}),f>0&&a>c.config.fpsDroppedMonitoringThreshold*u){let d=c.currentLevel;c.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+d),d>0&&(c.autoLevelCapping===-1||c.autoLevelCapping>=d)&&(d=d-1,c.trigger(M.FPS_DROP_LEVEL_CAPPING,{level:d,droppedLevel:c.currentLevel}),c.autoLevelCapping=d,this.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=r,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function VA(l,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=l,e.dispatchEvent(t)}function zA(l,e){const t=l.mode;if(t==="disabled"&&(l.mode="hidden"),l.cues&&!l.cues.getCueById(e.id))try{if(l.addCue(e),!l.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(r){At.debug(`[texttrack-utils]: ${r}`);try{const n=new self.TextTrackCue(e.startTime,e.endTime,e.text);n.id=e.id,l.addCue(n)}catch(n){At.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${n}`)}}t==="disabled"&&(l.mode=t)}function Ma(l,e){const t=l.mode;if(t==="disabled"&&(l.mode="hidden"),l.cues)for(let r=l.cues.length;r--;)e&&l.cues[r].removeEventListener("enter",e),l.removeCue(l.cues[r]);t==="disabled"&&(l.mode=t)}function im(l,e,t,r){const n=l.mode;if(n==="disabled"&&(l.mode="hidden"),l.cues&&l.cues.length>0){const s=nP(l.cues,e,t);for(let a=0;a<s.length;a++)(!r||r(s[a]))&&l.removeCue(s[a])}n==="disabled"&&(l.mode=n)}function iP(l,e){if(e<=l[0].startTime)return 0;const t=l.length-1;if(e>l[t].endTime)return-1;let r=0,n=t,s;for(;r<=n;)if(s=Math.floor((n+r)/2),e<l[s].startTime)n=s-1;else if(e>l[s].startTime&&r<t)r=s+1;else return s;return l[r].startTime-e<e-l[n].startTime?r:n}function nP(l,e,t){const r=[],n=iP(l,e);if(n>-1)for(let s=n,a=l.length;s<a;s++){const u=l[s];if(u.startTime>=e&&u.endTime<=t)r.push(u);else if(u.startTime>t)return r}return r}function Sc(l){const e=[];for(let t=0;t<l.length;t++){const r=l[t];(r.kind==="subtitles"||r.kind==="captions")&&r.label&&e.push(l[t])}return e}class sP extends zm{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const r=Sc(this.media.textTracks);for(let s=0;s<r.length;s++)if(r[s].mode==="hidden")t=r[s];else if(r[s].mode==="showing"){t=r[s];break}const n=this.findTrackForTextTrack(t);this.subtitleTrack!==n&&this.setSubtitleTrack(n)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(M.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(M.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(M.MANIFEST_LOADING,this.onManifestLoading,this),e.on(M.MANIFEST_PARSED,this.onManifestParsed,this),e.on(M.LEVEL_LOADING,this.onLevelLoading,this),e.on(M.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(M.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(M.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(M.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(M.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(M.MANIFEST_LOADING,this.onManifestLoading,this),e.off(M.MANIFEST_PARSED,this.onManifestParsed,this),e.off(M.LEVEL_LOADING,this.onLevelLoading,this),e.off(M.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(M.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(M.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const r=this.media;if(!r)return;const n=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||r.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,n)return;Sc(r.textTracks).forEach(a=>{Ma(a)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:r,groupId:n,details:s}=t,a=this.tracksInGroup[r];if(!a||a.groupId!==n){this.warn(`Subtitle track with id:${r} and group:${n} not found in active group ${a?.groupId}`);return}const u=a.details;a.details=t.details,this.log(`Subtitle track ${r} "${a.name}" lang:${a.lang} group:${n} loaded [${s.startSN}-${s.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,u)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.subtitleGroups||null,n=this.groupIds;let s=this.currentTrack;if(!r||n?.length!==r?.length||r!=null&&r.some(a=>n?.indexOf(a)===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(d=>!r||r.indexOf(d.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(d=>d.default)&&(this.selectDefaultTrack=!1),a.forEach((d,p)=>{d.id=p});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const u=this.hls.config.subtitlePreference;if(!s&&u){this.selectDefaultTrack=!1;const d=Ui(u,a);if(d>-1)s=a[d];else{const p=Ui(u,this.tracks);s=this.tracks[p]}}let f=this.findTrackId(s);f===-1&&s&&(f=this.findTrackId(null));const c={subtitleTracks:a};this.log(`Updating subtitle tracks, ${a.length} track(s) found in "${r?.join(",")}" group-id`),this.hls.trigger(M.SUBTITLE_TRACKS_UPDATED,c),f!==-1&&this.trackId===-1&&this.setSubtitleTrack(f)}}findTrackId(e){const t=this.tracksInGroup,r=this.selectDefaultTrack;for(let n=0;n<t.length;n++){const s=t[n];if(!(r&&!s.default||!r&&!e)&&(!e||Ps(s,e)))return n}if(e){for(let n=0;n<t.length;n++){const s=t[n];if(sl(e.attrs,s.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return n}for(let n=0;n<t.length;n++){const s=t[n];if(sl(e.attrs,s.attrs,["LANGUAGE"]))return n}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const n=t[r];if(Jg(n,e))return r}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===dt.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const r=this.currentTrack;if(r&&Ps(e,r))return r;const n=Ui(e,this.tracksInGroup);if(n>-1){const s=this.tracksInGroup[n];return this.setSubtitleTrack(n),s}else{if(r)return null;{const s=Ui(e,t);if(s>-1)return t[s]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=e.id,n=e.groupId,s=this.getUrlWithDirectives(e.url,t),a=e.details,u=a?.age;this.log(`Loading subtitle ${r} "${e.name}" lang:${e.lang} group:${n}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${u&&a.live?" age "+u.toFixed(1)+(a.type&&" "+a.type||""):""} ${s}`),this.hls.trigger(M.SUBTITLE_TRACK_LOADING,{url:s,id:r,groupId:n,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=Sc(e.textTracks),r=this.currentTrack;let n;if(r&&(n=t.filter(s=>Jg(r,s))[0],n||this.warn(`Unable to find subtitle TextTrack with name "${r.name}" and language "${r.lang}"`)),[].slice.call(t).forEach(s=>{s.mode!=="disabled"&&s!==n&&(s.mode="disabled")}),n){const s=this.subtitleDisplay?"showing":"hidden";n.mode!==s&&(n.mode=s)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!Ye(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const r=this.currentTrack,n=t[e]||null;if(this.trackId=e,this.currentTrack=n,this.toggleTrackModes(),!n){this.hls.trigger(M.SUBTITLE_TRACK_SWITCH,{id:e});return}const s=!!n.details&&!n.details.live;if(e===this.trackId&&n===r&&s)return;this.log(`Switching to subtitle-track ${e}`+(n?` "${n.name}" lang:${n.lang} group:${n.groupId}`:""));const{id:a,groupId:u="",name:f,type:c,url:d}=n;this.hls.trigger(M.SUBTITLE_TRACK_SWITCH,{id:a,groupId:u,name:f,type:c,url:d});const p=this.switchParams(n.url,r?.details,n.details);this.loadPlaylist(p)}}function aP(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const s=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(n=="x"?s:s&3|8).toString(16)})}}}function Qo(l){let e=5381,t=l.length;for(;t;)e=e*33^l.charCodeAt(--t);return(e>>>0).toString()}const Fa=.025;let Uc=(function(l){return l[l.Point=0]="Point",l[l.Range=1]="Range",l})({});function oP(l,e,t){return`${l.identifier}-${t+1}-${Qo(e)}`}class lP{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const r=this.playoutLimit;return e<=0||isNaN(r)?!1:r===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>r}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Cd(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,r=Cd(t,e);return t-r<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=Ye(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Cd(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<Fa))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Uc.Range:Uc.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return uP(this)}}function Cd(l,e){return l-e.start<e.duration/2&&!(Math.abs(l-(e.start+e.duration))<Fa)?e.start:e.start+e.duration}function qA(l,e,t){const r=new self.URL(l,t);return r.protocol!=="data:"&&r.searchParams.set("_HLS_primary_id",e),r}function Dd(l,e){for(;(t=l.assetList[++e])!=null&&t.error;)var t;return e}function uP(l){return`["${l.identifier}" ${l.cue.pre?"<pre>":l.cue.post?"<post>":""}${l.timelineStart.toFixed(2)}-${l.resumeTime.toFixed(2)}]`}function ka(l){const e=l.timelineStart,t=l.duration||0;return`["${l.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class cP{constructor(e,t,r,n){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(M.PLAYOUT_LIMIT_REACHED,{})};const s=this.hls=new e(t);this.interstitial=r,this.assetItem=n;const a=()=>{this.hasDetails=!0};s.once(M.LEVEL_LOADED,a),s.once(M.AUDIO_TRACK_LOADED,a),s.once(M.SUBTITLE_TRACK_LOADED,a),s.on(M.MEDIA_ATTACHING,(u,{media:f})=>{this.removeMediaListeners(),this.mediaAttached=f,this.interstitial.playoutLimit&&(f.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&s.on(M.BUFFER_APPENDED,()=>{const d=this.bufferedEnd;this.reachedPlayout(d)&&(this._bufferedEosTime=d,s.trigger(M.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=qA(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const r=Math.min(this._bufferedEosTime||1/0,this.duration),n=this.timelineOffset,s=ot.bufferInfo(e,n,0);return this.getAssetTime(s.end)>=r-.02}reachedPlayout(e){const r=this.interstitial.playoutLimit;return this.startOffset+e>=r}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=ot.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const r=t-this.startOffset;if(r>0&&r<e)return r}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const r=e-t;if(Math.abs(r)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,r=this.duration;return Math.min(Math.max(0,e-t),r)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=r=>delete r.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,r){var n;(n=this.hls)==null||n.on(e,t)}once(e,t,r){var n;(n=this.hls)==null||n.once(e,t)}off(e,t,r){var n;(n=this.hls)==null||n.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${ka(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const gT=.033;class fP extends vi{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((r,n)=>e<=n.startOffset&&t>n.startOffset?(delete n.error,r+1):r,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let r=-1;e.nextEvent?r=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(r=this.findEventIndex(e.previousEvent.identifier)+1);const n=this.items;if(n)for(n[r]||(t===void 0&&(t=e.start),r=this.findItemIndexAtTime(t));r>=0&&(s=n[r])!=null&&s.event;){var s;r--}return r}findItemIndexAtTime(e,t){const r=this.items;if(r)for(let n=0;n<r.length;n++){let s=r[n];if(t&&t!=="primary"&&(s=s[t]),e===s.start||e>s.start&&e<s.end)return n}return-1}findJumpRestrictedIndex(e,t){const r=this.items;if(r)for(let n=e;n<=t&&r[n];n++){const s=r[n].event;if(s!=null&&s.restrictions.jump&&!s.appendInPlace)return n}return-1}findEventIndex(e){const t=this.items;if(t)for(let n=t.length;n--;){var r;if(((r=t[n].event)==null?void 0:r.identifier)===e)return n}return-1}findAssetIndex(e,t){const r=e.assetList,n=r.length;if(n>1)for(let s=0;s<n;s++){const a=r[s];if(!a.error){const u=a.timelineStart;if(t===u||t>u&&(t<u+(a.duration||0)||s===n-1))return s}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const r=t.assetList,n=r[r.length-1];if(n)return n.identifier}return null}parseInterstitialDateRanges(e,t){const r=e.main.details,{dateRanges:n}=r,s=this.events,a=this.parseDateRanges(n,{url:r.url},t),u=Object.keys(n),f=s?s.filter(c=>!u.includes(c.identifier)):[];a.length&&a.sort((c,d)=>{const p=c.cue.pre,m=c.cue.post,v=d.cue.pre,y=d.cue.post;if(p&&!v)return-1;if(v&&!p||m&&!y)return 1;if(y&&!m)return-1;if(!p&&!v&&!m&&!y){const b=c.startTime,E=d.startTime;if(b!==E)return b-E}return c.dateRange.tagOrder-d.dateRange.tagOrder}),this.events=a,f.forEach(c=>{this.removeEvent(c)}),this.updateSchedule(e,f)}updateSchedule(e,t=[],r=!1){const n=this.events||[];if(n.length||t.length||this.length<2){const s=this.items,a=this.parseSchedule(n,e);(r||t.length||s?.length!==a.length||a.some((f,c)=>Math.abs(f.playout.start-s[c].playout.start)>.005||Math.abs(f.playout.end-s[c].playout.end)>.005))&&(this.items=a,this.onScheduleUpdate(t,s))}}parseDateRanges(e,t,r){const n=[],s=Object.keys(e);for(let a=0;a<s.length;a++){const u=s[a],f=e[u];if(f.isInterstitial){let c=this.eventMap[u];c?c.setDateRange(f):(c=new lP(f,t),this.eventMap[u]=c,r===!1&&(c.appendInPlace=r)),n.push(c)}}return n}parseSchedule(e,t){const r=[],n=t.main.details,s=n.live?1/0:n.edge;let a=0;if(e=e.filter(f=>!f.error&&!(f.cue.once&&f.hasPlayed)),e.length){this.resolveOffsets(e,t);let f=0,c=0;if(e.forEach((d,p)=>{const m=d.cue.pre,v=d.cue.post,y=e[p-1]||null,b=d.appendInPlace,E=v?s:d.startOffset,x=d.duration,T=d.timelineOccupancy===Uc.Range?x:0,A=d.resumptionOffset,L=y?.startTime===E,w=E+d.cumulativeDuration;let C=b?w+x:E+A;if(m||!v&&E<=0){const O=c;c+=T,d.timelineStart=w;const B=a;a+=x,r.push({event:d,start:w,end:C,playout:{start:B,end:a},integrated:{start:O,end:c}})}else if(E<=s){if(!L){const P=E-f;if(P>gT){const $=f,F=c;c+=P;const Z=a;a+=P;const X={previousEvent:e[p-1]||null,nextEvent:d,start:$,end:$+P,playout:{start:Z,end:a},integrated:{start:F,end:c}};r.push(X)}else P>0&&y&&(y.cumulativeDuration+=P,r[r.length-1].end=E)}v&&(C=w),d.timelineStart=w;const O=c;c+=T;const B=a;a+=x,r.push({event:d,start:w,end:C,playout:{start:B,end:a},integrated:{start:O,end:c}})}else return;const I=d.resumeTime;v||I>s?f=s:f=I}),f<s){var u;const d=f,p=c,m=s-f;c+=m;const v=a;a+=m,r.push({previousEvent:((u=r[r.length-1])==null?void 0:u.event)||null,nextEvent:null,start:f,end:d+m,playout:{start:v,end:a},integrated:{start:p,end:c}})}this.setDurations(s,a,c)}else r.push({previousEvent:null,nextEvent:null,start:0,end:s,playout:{start:0,end:s},integrated:{start:0,end:s}}),this.setDurations(s,s,s);return r}setDurations(e,t,r){this.durations={primary:e,playout:t,integrated:r}}resolveOffsets(e,t){const r=t.main.details,n=r.live?1/0:r.edge;let s=0,a=-1;e.forEach((u,f)=>{const c=u.cue.pre,d=u.cue.post,p=c?0:d?n:u.startTime;this.updateAssetDurations(u),a===p?u.cumulativeDuration=s:(s=0,a=p),!d&&u.snapOptions.in&&(u.resumeAnchor=Ns(null,r.fragments,u.startOffset+u.resumptionOffset,0,0)||void 0),u.appendInPlace&&!u.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(u,t)||(u.appendInPlace=!1)),!u.appendInPlace&&f+1<e.length&&e[f+1].startTime-e[f].resumeTime<gT&&(e[f+1].appendInPlace=!1,e[f+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${u}`));const v=Ye(u.resumeOffset)?u.resumeOffset:u.duration;s+=v})}primaryCanResumeInPlaceAt(e,t){const r=e.resumeTime,n=e.startTime+e.resumptionOffset;return Math.abs(r-n)>Fa?(this.log(`"${e.identifier}" resumption ${r} not aligned with estimated timeline end ${n}`),!1):!Object.keys(t).some(a=>{const u=t[a].details,f=u.edge;if(r>=f)return this.log(`"${e.identifier}" resumption ${r} past ${a} playlist end ${f}`),!1;const c=Ns(null,u.fragments,r);if(!c)return this.log(`"${e.identifier}" resumption ${r} does not align with any fragments in ${a} playlist (${u.fragStart}-${u.fragmentEnd})`),!0;const d=a==="audio"?.175:0;return Math.abs(c.start-r)<Fa+d||Math.abs(c.end-r)<Fa+d?!1:(this.log(`"${e.identifier}" resumption ${r} not aligned with ${a} fragment bounds (${c.start}-${c.end} sn: ${c.sn} cc: ${c.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let r=0,n=!1,s=!1;for(let a=0;a<e.assetList.length;a++){const u=e.assetList[a],f=t+r;u.startOffset=r,u.timelineStart=f,n||(n=u.duration===null),s||(s=!!u.error);const c=u.error?0:u.duration||0;r+=c}n&&!s?e.duration=Math.max(r,e.duration):e.duration=r}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function Ti(l){return`[${l.event?'"'+l.event.identifier+'"':"primary"}: ${l.start.toFixed(2)}-${l.end.toFixed(2)}]`}class hP{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const r=e.assetListUrl;let n;try{n=qA(r,this.hls.sessionId,e.baseUrl)}catch(m){const v=this.assignAssetListError(e,Se.ASSET_LIST_LOAD_ERROR,m,r);this.hls.trigger(M.ERROR,v);return}t&&n.protocol!=="data:"&&n.searchParams.set("_HLS_start_offset",""+t);const s=this.hls.config,a=s.loader,u=new a(s),f={responseType:"json",url:n.href},c=s.interstitialAssetListLoadPolicy.default,d={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(m,v,y,b)=>{const E=m.data,x=E?.ASSETS;if(!Array.isArray(x)){const T=this.assignAssetListError(e,Se.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),y.url,v,b);this.hls.trigger(M.ERROR,T);return}e.assetListResponse=E,this.hls.trigger(M.ASSET_LIST_LOADED,{event:e,assetListResponse:E,networkDetails:b})},onError:(m,v,y,b)=>{const E=this.assignAssetListError(e,Se.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${m.code} ${m.text} (${v.url})`),v.url,b,y);this.hls.trigger(M.ERROR,E)},onTimeout:(m,v,y)=>{const b=this.assignAssetListError(e,Se.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${v.url})`),v.url,m,y);this.hls.trigger(M.ERROR,b)}};return u.load(f,d,p),this.hls.trigger(M.ASSET_LIST_LOADING,{event:e}),u}assignAssetListError(e,t,r,n,s,a){return e.error=r,{type:tt.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:n,error:r,networkDetails:a,stats:s}}}function mT(l){var e;l==null||(e=l.play())==null||e.catch(()=>{})}function Pu(l,e){return`[${l}] Advancing timeline position to ${e}`}class dP extends vi{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const r=this.currentTime;if(r===void 0||this.playbackDisabled||!this.schedule)return;const n=r-this.timelinePos;if(Math.abs(n)<1/7056e5)return;const a=n<=-.01;this.timelinePos=r,this.bufferedPos=r;const u=this.playingItem;if(!u){this.checkBuffer();return}if(a&&this.schedule.resetErrorsInRange(r,r-n)&&this.updateSchedule(!0),this.checkBuffer(),a&&r<u.start||r>=u.end){var f;const v=this.findItemIndex(u);let y=this.schedule.findItemIndexAtTime(r);if(y===-1&&(y=v+(a?-1:1),this.log(`seeked ${a?"back ":""}to position not covered by schedule ${r} (resolving from ${v} to ${y})`)),!this.isInterstitial(u)&&(f=this.media)!=null&&f.paused&&(this.shouldPlay=!1),!a&&y>v){const b=this.schedule.findJumpRestrictedIndex(v+1,y);if(b>v){this.setSchedulePosition(b);return}}this.setSchedulePosition(y);return}const c=this.playingAsset;if(!c){if(this.playingLastItem&&this.isInterstitial(u)){const v=u.event.assetList[0];v&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(r,v))}return}const d=c.timelineStart,p=c.duration||0;if(a&&r<d||r>=d+p){var m;(m=u.event)!=null&&m.appendInPlace&&(this.clearAssetPlayers(u.event,u),this.flushFrontBuffer(r)),this.setScheduleToAssetAtTime(r,c)}},this.onTimeupdate=()=>{const r=this.currentTime;if(r===void 0||this.playbackDisabled)return;if(r>this.timelinePos)this.timelinePos=r,r>this.bufferedPos&&this.checkBuffer();else return;const n=this.playingItem;if(!n||this.playingLastItem)return;if(r>=n.end){this.timelinePos=n.end;const u=this.findItemIndex(n);this.setSchedulePosition(u+1)}const s=this.playingAsset;if(!s)return;const a=s.timelineStart+(s.duration||0);r>=a&&this.setScheduleToAssetAtTime(r,s)},this.onScheduleUpdate=(r,n)=>{const s=this.schedule;if(!s)return;const a=this.playingItem,u=s.events||[],f=s.items||[],c=s.durations,d=r.map(b=>b.identifier),p=!!(u.length||d.length);(p||n)&&this.log(`INTERSTITIALS_UPDATED (${u.length}): ${u}
Schedule: ${f.map(b=>Ti(b))} pos: ${this.timelinePos}`),d.length&&this.log(`Removed events ${d}`);let m=null,v=null;a&&(m=this.updateItem(a,this.timelinePos),this.itemsMatch(a,m)?this.playingItem=m:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const y=this.bufferingItem;if(y&&(v=this.updateItem(y,this.bufferedPos),this.itemsMatch(y,v)?this.bufferingItem=v:y.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(y.event,null))),r.forEach(b=>{b.assetList.forEach(E=>{this.clearAssetPlayer(E.identifier,null)})}),this.playerQueue.forEach(b=>{if(b.interstitial.appendInPlace){const E=b.assetItem.timelineStart,x=b.timelineOffset-E;if(x)try{b.timelineOffset=E}catch(T){Math.abs(x)>Fa&&this.warn(`${T} ("${b.assetId}" ${b.timelineOffset}->${E})`)}}}),p||n){if(this.hls.trigger(M.INTERSTITIALS_UPDATED,{events:u.slice(0),schedule:f.slice(0),durations:c,removedIds:d}),this.isInterstitial(a)&&d.includes(a.event.identifier)){this.warn(`Interstitial "${a.event.identifier}" removed while playing`),this.primaryFallback(a.event);return}a&&this.trimInPlace(m,a),y&&v!==m&&this.trimInPlace(v,y),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new hP(e),this.schedule=new fP(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(M.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(M.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(M.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(M.MANIFEST_LOADING,this.onManifestLoading,this),e.on(M.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(M.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(M.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(M.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(M.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(M.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(M.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(M.BUFFER_APPENDED,this.onBufferAppended,this),e.on(M.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(M.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(M.MEDIA_ENDED,this.onMediaEnded,this),e.on(M.ERROR,this.onError,this),e.on(M.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(M.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(M.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(M.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(M.MANIFEST_LOADING,this.onManifestLoading,this),e.off(M.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(M.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(M.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(M.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(M.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(M.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(M.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(M.BUFFER_CODECS,this.onBufferCodecs,this),e.off(M.BUFFER_APPENDED,this.onBufferAppended,this),e.off(M.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(M.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(M.MEDIA_ENDED,this.onMediaEnded,this),e.off(M.ERROR,this.onError,this),e.off(M.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){Hr(e,"play",this.onPlay),Hr(e,"pause",this.onPause),Hr(e,"seeking",this.onSeeking),Hr(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const r=this.media=t.media;Lr(r,"seeking",this.onSeeking),Lr(r,"timeupdate",this.onTimeupdate),Lr(r,"play",this.onPlay),Lr(r,"pause",this.onPause)}onMediaAttached(e,t){const r=this.effectivePlayingItem,n=this.detachedData;if(this.detachedData=null,r===null)this.checkStart();else if(!n){this.clearScheduleState();const s=this.findItemIndex(r);this.setSchedulePosition(s)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const r=!!t.transferMedia,n=this.media;if(this.media=null,!r&&(n&&this.removeMediaListeners(n),this.detachedData)){const s=this.getBufferingPlayer();s&&(this.log(`Removing schedule state for detachedData and ${s}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,s.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,r=p=>p&&e.getAssetPlayer(p.identifier),n=(p,m,v,y,b)=>{if(p){let E=p[m].start;const x=p.event;if(x){if(m==="playout"||x.timelineOccupancy!==Uc.Point){const T=r(v);T?.interstitial===x&&(E+=T.assetItem.startOffset+T[b])}}else{const T=y==="bufferedPos"?a():e[y];E+=T-p.start}return E}return 0},s=(p,m)=>{var v;if(p!==0&&m!=="primary"&&(v=e.schedule)!=null&&v.length){var y;const b=e.schedule.findItemIndexAtTime(p),E=(y=e.schedule.items)==null?void 0:y[b];if(E){const x=E[m].start-E.start;return p+x}}return p},a=()=>{const p=e.bufferedPos;return p===Number.MAX_VALUE?u("primary"):Math.max(p,0)},u=p=>{var m,v;return(m=e.primaryDetails)!=null&&m.live?e.primaryDetails.edge:((v=e.schedule)==null?void 0:v.durations[p])||0},f=(p,m)=>{var v,y;const b=e.effectivePlayingItem;if(b!=null&&(v=b.event)!=null&&v.restrictions.skip||!e.schedule)return;e.log(`seek to ${p} "${m}"`);const E=e.effectivePlayingItem,x=e.schedule.findItemIndexAtTime(p,m),T=(y=e.schedule.items)==null?void 0:y[x],A=e.getBufferingPlayer(),L=A?.interstitial,w=L?.appendInPlace,C=E&&e.itemsMatch(E,T);if(E&&(w||C)){const I=r(e.playingAsset),O=I?.media||e.primaryMedia;if(O){const B=m==="primary"?O.currentTime:n(E,m,e.playingAsset,"timelinePos","currentTime"),P=p-B,$=(w?B:O.currentTime)+P;if($>=0&&(!I||w||$<=I.duration)){O.currentTime=$;return}}}if(T){let I=p;if(m!=="primary"){const B=T[m].start,P=p-B;I=T.start+P}const O=!e.isInterstitial(T);if((!e.isInterstitial(E)||E.event.appendInPlace)&&(O||T.event.appendInPlace)){const B=e.media||(w?A?.media:null);B&&(B.currentTime=I)}else if(E){const B=e.findItemIndex(E);if(x>B){const $=e.schedule.findJumpRestrictedIndex(B+1,x);if($>B){e.setSchedulePosition($);return}}let P=0;if(O)e.timelinePos=I,e.checkBuffer();else{const $=T.event.assetList,F=p-(T[m]||T).start;for(let Z=$.length;Z--;){const X=$[Z];if(X.duration&&F>=X.startOffset&&F<X.startOffset+X.duration){P=Z;break}}}e.setSchedulePosition(x,P)}}},c=()=>{const p=e.effectivePlayingItem;if(e.isInterstitial(p))return p;const m=t();return e.isInterstitial(m)?m:null},d={get bufferedEnd(){const p=t(),m=e.bufferingItem;if(m&&m===p){var v;return n(m,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-m.playout.start||((v=e.bufferingAsset)==null?void 0:v.startOffset)||0}return 0},get currentTime(){const p=c(),m=e.effectivePlayingItem;return m&&m===p?n(m,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-m.playout.start:0},set currentTime(p){const m=c(),v=e.effectivePlayingItem;v&&v===m&&f(p+v.playout.start,"playout")},get duration(){const p=c();return p?p.playout.end-p.playout.start:0},get assetPlayers(){var p;const m=(p=c())==null?void 0:p.event.assetList;return m?m.map(v=>e.getAssetPlayer(v.identifier)):[]},get playingIndex(){var p;const m=(p=c())==null?void 0:p.event;return m&&e.effectivePlayingAsset?m.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return c()}};return this.manager={get events(){var p;return((p=e.schedule)==null||(p=p.events)==null?void 0:p.slice(0))||[]},get schedule(){var p;return((p=e.schedule)==null||(p=p.items)==null?void 0:p.slice(0))||[]},get interstitialPlayer(){return c()?d:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const p=t();return e.findItemIndex(p)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const p=e.effectivePlayingItem;return e.findItemIndex(p)},primary:{get bufferedEnd(){return a()},get currentTime(){const p=e.timelinePos;return p>0?p:0},set currentTime(p){f(p,"primary")},get duration(){return u("primary")},get seekableStart(){var p;return((p=e.primaryDetails)==null?void 0:p.fragmentStart)||0}},integrated:{get bufferedEnd(){return n(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return n(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(p){f(p,"integrated")},get duration(){return u("integrated")},get seekableStart(){var p;return s(((p=e.primaryDetails)==null?void 0:p.fragmentStart)||0,"integrated")}},skip:()=>{const p=e.effectivePlayingItem,m=p?.event;if(m&&!m.restrictions.skip){const v=e.findItemIndex(p);if(m.appendInPlace){const y=p.playout.start+p.event.duration;f(y+.001,"playout")}else e.advanceAfterAssetEnded(m,v,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,r=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!r?!1:this.findItemIndex(t)===r.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const r=this.waitingItem||this.playingItem;if(this.isInterstitial(r)&&!r.event.appendInPlace)return;let n=this.media;!n&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(n=this.primaryMedia);const s=(t=n)==null?void 0:t.currentTime;if(!(s===void 0||!Ye(s)))return s}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const r=this.getAssetPlayer(e);r&&this.transferMediaFromPlayer(r,t)}transferMediaFromPlayer(e,t){const r=e.interstitial.appendInPlace,n=e.media;if(r&&n===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&n){this.detachedData={media:n};return}const s=e.transferMedia();this.log(`transfer MediaSource from ${e} ${kt(s)}`),this.detachedData=s}else t&&n&&(this.shouldPlay||(this.shouldPlay=!n.paused))}transferMediaTo(e,t){var r,n;if(e.media===t)return;let s=null;const a=this.hls,u=e!==a,f=u&&e.interstitial.appendInPlace,c=(r=this.detachedData)==null?void 0:r.mediaSource;let d;if(a.media)f&&(s=a.transferMedia(),this.detachedData=s),d="Primary";else if(c){const y=this.getBufferingPlayer();y?(s=y.transferMedia(),d=`${y}`):d="detached MediaSource"}else d="detached media";if(!s){if(c)s=this.detachedData,this.log(`using detachedData: MediaSource ${kt(s)}`);else if(!this.detachedData||a.media===t){const y=this.playerQueue;y.length>1&&y.forEach(b=>{if(u&&b.interstitial.appendInPlace!==f){const E=b.interstitial;this.clearInterstitial(b.interstitial,null),E.appendInPlace=!1,E.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${E}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const p=s&&"mediaSource"in s&&((n=s.mediaSource)==null?void 0:n.readyState)!=="closed",m=p&&s?s:t;this.log(`${p?"transfering MediaSource":"attaching media"} to ${u?e:"Primary"} from ${d} (media.currentTime: ${t.currentTime})`);const v=this.schedule;if(m===s&&v){const y=u&&e.assetId===v.assetIdAtEnd;m.overrides={duration:v.duration,endOfStream:!u||y,cueRemoval:!u}}e.attachMedia(m)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e?.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const r=this.timelinePos,n=this.effectivePlayingItem;if(r===-1){const s=this.hls.startPosition;if(this.log(Pu("checkStart",s)),this.timelinePos=s,t.length&&t[0].cue.pre){const a=e.findEventIndex(t[0].identifier);this.setSchedulePosition(a)}else if(s>=0||!this.primaryLive){const a=this.timelinePos=s>0?s:0,u=e.findItemIndexAtTime(a);this.setSchedulePosition(u)}}else if(n&&!this.playingItem){const s=e.findItemIndex(n);this.setSchedulePosition(s)}}advanceAssetBuffering(e,t){const r=e.event,n=r.findAssetIndex(t),s=Dd(r,n);if(!r.isAssetPastPlayoutLimit(s))this.bufferedToEvent(e,s);else if(this.schedule){var a;const u=(a=this.schedule.items)==null?void 0:a[this.findItemIndex(e)+1];u&&this.bufferedToItem(u)}}advanceAfterAssetEnded(e,t,r){const n=Dd(e,r);if(e.isAssetPastPlayoutLimit(n)){if(this.schedule){const s=this.schedule.items;if(s){const a=t+1,u=s.length;if(a>=u){this.setSchedulePosition(-1);return}const f=e.resumeTime;this.timelinePos<f&&(this.log(Pu("advanceAfterAssetEnded",f)),this.timelinePos=f,e.appendInPlace&&this.advanceInPlace(f),this.checkBuffer(this.bufferedPos<f)),this.setSchedulePosition(a)}}}else{if(e.appendInPlace){const s=e.assetList[n];s&&this.advanceInPlace(s.timelineStart)}this.setSchedulePosition(t,n)}}setScheduleToAssetAtTime(e,t){const r=this.schedule;if(!r)return;const n=t.parentIdentifier,s=r.getEvent(n);if(s){const a=r.findEventIndex(n),u=r.findAssetIndex(s,e);this.advanceAfterAssetEnded(s,a,u-1)}}setSchedulePosition(e,t){var r;const n=(r=this.schedule)==null?void 0:r.items;if(!n||this.playbackDisabled)return;const s=e>=0?n[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${s&&Ti(s)}) pos: ${this.timelinePos}`);const a=this.waitingItem||this.playingItem,u=this.playingLastItem;if(this.isInterstitial(a)){const d=a.event,p=this.playingAsset,m=p?.identifier,v=m?this.getAssetPlayer(m):null;if(v&&m&&(!this.eventItemsMatch(a,s)||t!==void 0&&m!==d.assetList[t].identifier)){var f;const y=d.findAssetIndex(p);if(this.log(`INTERSTITIAL_ASSET_ENDED ${y+1}/${d.assetList.length} ${ka(p)}`),this.endedAsset=p,this.playingAsset=null,this.hls.trigger(M.INTERSTITIAL_ASSET_ENDED,{asset:p,assetListIndex:y,event:d,schedule:n.slice(0),scheduleIndex:e,player:v}),a!==this.playingItem){this.itemsMatch(a,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(d,this.findItemIndex(this.playingItem),y);return}this.retreiveMediaSource(m,s),v.media&&!((f=this.detachedData)!=null&&f.mediaSource)&&v.detachMedia()}if(!this.eventItemsMatch(a,s)&&(this.endedItem=a,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${d} ${Ti(a)}`),d.hasPlayed=!0,this.hls.trigger(M.INTERSTITIAL_ENDED,{event:d,schedule:n.slice(0),scheduleIndex:e}),d.cue.once)){var c;this.updateSchedule();const y=(c=this.schedule)==null?void 0:c.items;if(s&&y){const b=this.findItemIndex(s);this.advanceSchedule(b,y,t,a,u)}return}}this.advanceSchedule(e,n,t,a,u)}advanceSchedule(e,t,r,n,s){const a=this.schedule;if(!a)return;const u=t[e]||null,f=this.primaryMedia,c=this.playerQueue;if(c.length&&c.forEach(d=>{const p=d.interstitial,m=a.findEventIndex(p.identifier);(m<e||m>e+1)&&this.clearInterstitial(p,u)}),this.isInterstitial(u)){this.timelinePos=Math.min(Math.max(this.timelinePos,u.start),u.end);const d=u.event;if(r===void 0){r=a.findAssetIndex(d,this.timelinePos);const y=Dd(d,r-1);if(d.isAssetPastPlayoutLimit(y)||d.appendInPlace&&this.timelinePos===u.end){this.advanceAfterAssetEnded(d,e,r);return}r=y}const p=this.waitingItem;this.assetsBuffered(u,f)||this.setBufferingItem(u);let m=this.preloadAssets(d,r);if(this.eventItemsMatch(u,p||n)||(this.waitingItem=u,this.log(`INTERSTITIAL_STARTED ${Ti(u)} ${d.appendInPlace?"append in place":""}`),this.hls.trigger(M.INTERSTITIAL_STARTED,{event:d,schedule:t.slice(0),scheduleIndex:e})),!d.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${d}`);return}if(d.assetListLoader&&(d.assetListLoader.destroy(),d.assetListLoader=void 0),!f){this.log(`Waiting for attachMedia to start Interstitial ${d}`);return}this.waitingItem=this.endedItem=null,this.playingItem=u;const v=d.assetList[r];if(!v){this.advanceAfterAssetEnded(d,e,r||0);return}if(m||(m=this.getAssetPlayer(v.identifier)),m===null||m.destroyed){const y=d.assetList.length;this.warn(`asset ${r+1}/${y} player destroyed ${d}`),m=this.createAssetPlayer(d,v,r),m.loadSource()}if(!this.eventItemsMatch(u,this.bufferingItem)&&d.appendInPlace&&this.isAssetBuffered(v))return;this.startAssetPlayer(m,r,t,e,f),this.shouldPlay&&mT(m.media)}else u?(this.resumePrimary(u,e,n),this.shouldPlay&&mT(this.hls.media)):s&&this.isInterstitial(n)&&(this.endedItem=null,this.playingItem=n,n.event.appendInPlace||this.attachPrimary(a.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,r){var n,s;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${Ti(e)}`),!((n=this.detachedData)!=null&&n.mediaSource)){let u=this.timelinePos;(u<e.start||u>=e.end)&&(u=this.getPrimaryResumption(e,t),this.log(Pu("resumePrimary",u)),this.timelinePos=u),this.attachPrimary(u,e)}if(!r)return;const a=(s=this.schedule)==null?void 0:s.items;a&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${Ti(e)}`),this.hls.trigger(M.INTERSTITIALS_PRIMARY_RESUMED,{schedule:a.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const r=e.start;if(this.primaryLive){const n=this.primaryDetails;if(t===0)return this.hls.startPosition;if(n&&(r<n.fragmentStart||r>n.edge))return this.hls.liveSyncPosition||-1}return r}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:ot.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,r){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const n=this.primaryMedia;if(!n)return;const s=this.hls;s.media?this.checkBuffer():(this.transferMediaTo(s,n),r&&this.startLoadingPrimaryAt(e,r)),r||(this.log(Pu("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,r))}startLoadingPrimaryAt(e,t){var r;const n=this.hls;!n.loadingEnabled||!n.media||Math.abs((((r=n.mainForwardBufferInfo)==null?void 0:r.start)||n.media.currentTime)-e)>.5?n.startLoad(e,t):n.bufferingEnabled||n.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(M.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(M.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const r=this.hls.levels[t.level];if(!r.details)return;const n=_t(_t({},this.mediaSelection||this.altSelection),{},{main:r});this.mediaSelection=n,this.schedule.parseInterstitialDateRanges(n,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const r=this.hls.audioTracks[t.id],n=this.mediaSelection;if(!n){this.altSelection=_t(_t({},this.altSelection),{},{audio:r});return}const s=_t(_t({},n),{},{audio:r});this.mediaSelection=s}onSubtitleTrackUpdated(e,t){const r=this.hls.subtitleTracks[t.id],n=this.mediaSelection;if(!n){this.altSelection=_t(_t({},this.altSelection),{},{subtitles:r});return}const s=_t(_t({},n),{},{subtitles:r});this.mediaSelection=s}onAudioTrackSwitching(e,t){const r=AS(t);this.playerQueue.forEach(({hls:n})=>n&&(n.setAudioOption(t)||n.setAudioOption(r)))}onSubtitleTrackSwitch(e,t){const r=AS(t);this.playerQueue.forEach(({hls:n})=>n&&(n.setSubtitleOption(t)||t.id!==-1&&n.setSubtitleOption(r)))}onBufferCodecs(e,t){const r=t.tracks;r&&(this.requiredTracks=r)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const r=this.playingItem;if(r&&!this.itemsMatch(r,this.bufferingItem)&&!this.isInterstitial(r)){const n=this.timelinePos;this.bufferedPos=n,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let n=0;n<t.length;n++){const s=t[n];if(s.cue.post){var r;const a=this.schedule.findEventIndex(s.identifier),u=(r=this.schedule.items)==null?void 0:r[a];this.isInterstitial(u)&&this.eventItemsMatch(u,this.bufferingItem)&&this.bufferedToItem(u,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const r=this.findItemIndex(t);this.setSchedulePosition(r+1)}else this.shouldPlay=!1}updateItem(e,t){var r;const n=(r=this.schedule)==null?void 0:r.items;if(e&&n){const s=this.findItemIndex(e,t);return n[s]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((s,a)=>{e.event.isAssetPastPlayoutLimit(a)&&this.clearAssetPlayer(s.identifier,null)});const r=e.end+.25,n=ot.bufferInfo(this.primaryMedia,r,0);(n.end>r||(n.nextStart||0)>r)&&(this.log(`trim buffered interstitial ${Ti(e)} (was ${Ti(t)})`),this.attachPrimary(r,null,!0),this.flushFrontBuffer(r))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var r;return!!t&&(e===t||e.event.identifier===((r=t.event)==null?void 0:r.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const r=this.mediaSelection;r&&((t=this.schedule)==null||t.updateSchedule(r,[],e))}checkBuffer(e){var t;const r=(t=this.schedule)==null?void 0:t.items;if(!r)return;const n=ot.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=n.len<1),this.updateBufferedPos(n.end,r,e)}updateBufferedPos(e,t,r){const n=this.schedule,s=this.bufferingItem;if(this.bufferedPos>e||!n)return;if(t.length===1&&this.itemsMatch(t[0],s)){this.bufferedPos=e;return}const a=this.playingItem,u=this.findItemIndex(a);let f=n.findItemIndexAtTime(e);if(this.bufferedPos<e){var c;const d=this.findItemIndex(s),p=Math.min(d+1,t.length-1),m=t[p];if((f===-1&&s&&e>=s.end||(c=m.event)!=null&&c.appendInPlace&&e+.01>=m.start)&&(f=p),this.isInterstitial(s)){const v=s.event;if(p-u>1&&v.appendInPlace===!1||v.assetList.length===0&&v.assetListLoader)return}if(this.bufferedPos=e,f>d&&f>u)this.bufferedToItem(m);else{const v=this.primaryDetails;this.primaryLive&&v&&e>v.edge-v.targetduration&&m.start<v.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(m)&&this.preloadAssets(m.event,0)}}else r&&a&&!this.itemsMatch(a,s)&&(f===u?this.bufferedToItem(a):f===u+1&&this.bufferedToItem(t[f]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(n=>{const s=this.getAssetPlayer(n.identifier);return!(s!=null&&s.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,r=this.schedule;if(!this.itemsMatch(e,t)&&r){const{items:n,events:s}=r;if(!n||!s)return t;const a=this.isInterstitial(e),u=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const f=u?u.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${Ti(e)}`+(t?` (${f.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(a){const c=r.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((d,p)=>{const m=this.getAssetPlayer(d.identifier);m&&(p===c&&m.loadSource(),m.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(c=>c.pauseBuffering());this.hls.trigger(M.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:s.slice(0),schedule:n.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const r=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(r!==null){this.bufferingAsset=null;const n=this.detachedData;n?n.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),r=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(r)}bufferedToEvent(e,t){const r=e.event,n=r.assetList.length===0&&!r.assetListLoader,s=r.cue.once;if(n||!s){const a=this.preloadAssets(r,t);if(a!=null&&a.interstitial.appendInPlace){const u=this.primaryMedia;u&&this.bufferAssetPlayer(a,u)}}}preloadAssets(e,t){const r=e.assetUrl,n=e.assetList.length,s=n===0&&!e.assetListLoader,a=e.cue.once;if(s){const f=e.timelineStart;if(e.appendInPlace){var u;const m=this.playingItem;!this.isInterstitial(m)&&(m==null||(u=m.nextEvent)==null?void 0:u.identifier)===e.identifier&&this.flushFrontBuffer(f+.25)}let c,d=0;if(!this.playingItem&&this.primaryLive&&(d=this.hls.startPosition,d===-1&&(d=this.hls.liveSyncPosition||0)),d&&!(e.cue.pre||e.cue.post)){const m=d-f;m>0&&(c=Math.round(m*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${r?1:n} ${e}${c?` live-start: ${d} start-offset: ${c}`:""}`),r)return this.createAsset(e,0,0,f,e.duration,r);const p=this.assetListLoader.loadAssetList(e,c);p&&(e.assetListLoader=p)}else if(!a&&n){for(let c=t;c<n;c++){const d=e.assetList[c],p=this.getAssetPlayerQueueIndex(d.identifier);(p===-1||this.playerQueue[p].destroyed)&&!d.error&&this.createAssetPlayer(e,d,c)}const f=e.assetList[t];if(f){const c=this.getAssetPlayer(f.identifier);return c&&c.loadSource(),c}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(n=>{this.hls.trigger(M.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:n})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let r=0;r<t.length;r++)if(e===t[r].assetId)return r;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let r=0;r<e.length;r++)if(e[r].media===t)return e[r]}return null}createAsset(e,t,r,n,s,a){const u={parentIdentifier:e.identifier,identifier:oP(e,a,t),duration:s,startOffset:r,timelineStart:n,uri:a};return this.createAssetPlayer(e,u,t)}createAssetPlayer(e,t,r){const n=this.hls,s=n.userConfig;let a=s.videoPreference;const u=n.loadLevelObj||n.levels[n.currentLevel];(a||u)&&(a=Lt({},a),u.videoCodec&&(a.videoCodec=u.videoCodec),u.videoRange&&(a.allowedVideoRanges=[u.videoRange]));const f=n.audioTracks[n.audioTrack],c=n.subtitleTracks[n.subtitleTrack];let d=0;if(this.primaryLive||e.appendInPlace){const L=this.timelinePos-t.timelineStart;if(L>1){const w=t.duration;w&&L<w&&(d=L)}}const p=t.identifier,m=_t(_t({},s),{},{maxMaxBufferLength:Math.min(180,n.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:n.sessionId,assetPlayerId:p,abrEwmaDefaultEstimate:n.bandwidthEstimate,interstitialsController:void 0,startPosition:d,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:a,audioPreference:f||s.audioPreference,subtitlePreference:c||s.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(m.timelineOffset=t.timelineStart));const v=m.cmcd;v!=null&&v.sessionId&&v.contentId&&(m.cmcd=Lt({},v,{contentId:Qo(t.uri)})),this.getAssetPlayer(p)&&this.warn(`Duplicate date range identifier ${e} and asset ${p}`);const y=new cP(this.HlsPlayerClass,m,e,t);this.playerQueue.push(y),e.assetList[r]=t;let b=!0;const E=L=>{if(L.live){var w;const O=new Error(`Interstitials MUST be VOD assets ${e}`),B={fatal:!0,type:tt.OTHER_ERROR,details:Se.INTERSTITIAL_ASSET_ITEM_ERROR,error:O},P=((w=this.schedule)==null?void 0:w.findEventIndex(e.identifier))||-1;this.handleAssetItemError(B,e,P,r,O.message);return}const C=L.edge-L.fragmentStart,I=t.duration;(b||I===null||C>I)&&(b=!1,this.log(`Interstitial asset "${p}" duration change ${I} > ${C}`),t.duration=C,this.updateSchedule())};y.on(M.LEVEL_UPDATED,(L,{details:w})=>E(w)),y.on(M.LEVEL_PTS_UPDATED,(L,{details:w})=>E(w)),y.on(M.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const x=(L,w)=>{const C=this.getAssetPlayer(p);if(C&&w.tracks){C.off(M.BUFFER_CODECS,x),C.tracks=w.tracks;const I=this.primaryMedia;this.bufferingAsset===C.assetItem&&I&&!C.media&&this.bufferAssetPlayer(C,I)}};y.on(M.BUFFER_CODECS,x);const T=()=>{var L;const w=this.getAssetPlayer(p);if(this.log(`buffered to end of asset ${w}`),!w||!this.schedule)return;const C=this.schedule.findEventIndex(e.identifier),I=(L=this.schedule.items)==null?void 0:L[C];this.isInterstitial(I)&&this.advanceAssetBuffering(I,t)};y.on(M.BUFFERED_TO_END,T);const A=L=>()=>{if(!this.getAssetPlayer(p)||!this.schedule)return;this.shouldPlay=!0;const C=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,C,L)};return y.once(M.MEDIA_ENDED,A(r)),y.once(M.PLAYOUT_LIMIT_REACHED,A(1/0)),y.on(M.ERROR,(L,w)=>{if(!this.schedule)return;const C=this.getAssetPlayer(p);if(w.details===Se.BUFFER_STALLED_ERROR){if(C!=null&&C.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(w,e,this.schedule.findEventIndex(e.identifier),r,`Asset player error ${w.error} ${e}`)}),y.on(M.DESTROYING,()=>{if(!this.getAssetPlayer(p)||!this.schedule)return;const w=new Error(`Asset player destroyed unexpectedly ${p}`),C={fatal:!0,type:tt.OTHER_ERROR,details:Se.INTERSTITIAL_ASSET_ITEM_ERROR,error:w};this.handleAssetItemError(C,e,this.schedule.findEventIndex(e.identifier),r,w.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${ka(t)}`),this.hls.trigger(M.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:r,event:e,player:y}),y}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(r=>{this.clearAssetPlayer(r.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const r=this.playerQueue[t];this.transferMediaFromPlayer(r,null),r.resetDetails()}}clearAssetPlayer(e,t){const r=this.getAssetPlayerQueueIndex(e);if(r!==-1){const n=this.playerQueue[r];this.log(`clear ${n} toSegment: ${t&&Ti(t)}`),this.transferMediaFromPlayer(n,t),this.playerQueue.splice(r,1),n.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,r,n,s){const{interstitial:a,assetItem:u,assetId:f}=e,c=a.assetList.length,d=this.playingAsset;this.endedAsset=null,this.playingAsset=u,(!d||d.identifier!==f)&&(d&&(this.clearAssetPlayer(d.identifier,r[n]),delete d.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${c} ${ka(u)}`),this.hls.trigger(M.INTERSTITIAL_ASSET_STARTED,{asset:u,assetListIndex:t,event:a,schedule:r.slice(0),scheduleIndex:n,player:e})),this.bufferAssetPlayer(e,s)}bufferAssetPlayer(e,t){var r,n;if(!this.schedule)return;const{interstitial:s,assetItem:a}=e,u=this.schedule.findEventIndex(s.identifier),f=(r=this.schedule.items)==null?void 0:r[u];if(!f)return;e.loadSource(),this.setBufferingItem(f),this.bufferingAsset=a;const c=this.getBufferingPlayer();if(c===e)return;const d=s.appendInPlace;if(d&&c?.interstitial.appendInPlace===!1)return;const p=c?.tracks||((n=this.detachedData)==null?void 0:n.tracks)||this.requiredTracks;if(d&&a!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(p&&!L_(p,e.tracks)){const m=new Error(`Asset ${ka(a)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(p)}')`),v={fatal:!0,type:tt.OTHER_ERROR,details:Se.INTERSTITIAL_ASSET_ITEM_ERROR,error:m},y=s.findAssetIndex(a);this.handleAssetItemError(v,s,u,y,m.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,r=this.primaryMedia;if(!t||!r)return;const n=r.currentTime,s=t.findAssetIndex(e,n),a=e.assetList[s];if(a){const u=this.getAssetPlayer(a.identifier);if(u){const f=u.currentTime||n-a.timelineStart,c=u.duration-f;if(this.warn(`Stalled at ${f} of ${f+c} in ${u} ${e} (media.currentTime: ${n})`),f&&(c/r.playbackRate<.5||u.bufferedInPlaceToEnd(r))&&u.hls){const d=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,d,s)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,r,n,s){if(e.details===Se.BUFFER_STALLED_ERROR)return;const a=t.assetList[n]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${a&&ka(a)} ${e.error}`),!this.schedule)return;const u=a?.identifier||"",f=this.getAssetPlayerQueueIndex(u),c=this.playerQueue[f]||null,d=this.schedule.items,p=Lt({},e,{fatal:!1,errorAction:Na(!0),asset:a,assetListIndex:n,event:t,schedule:d,scheduleIndex:r,player:c});if(this.hls.trigger(M.INTERSTITIAL_ASSET_ERROR,p),!e.fatal)return;const m=this.playingAsset,v=this.bufferingAsset,y=new Error(s);if(a&&(this.clearAssetPlayer(u,null),a.error=y),!t.assetList.some(b=>!b.error))t.error=y;else for(let b=n;b<t.assetList.length;b++)this.resetAssetPlayer(t.assetList[b].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):m&&m.identifier===u?this.advanceAfterAssetEnded(t,r,n):v&&v.identifier===u&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,v)}primaryFallback(e){const t=e.timelineStart,r=this.effectivePlayingItem;let n=this.timelinePos;if(r){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${n} playing: ${Ti(r)} error: ${e.error}`),n===-1&&(n=this.hls.startPosition);const a=this.updateItem(r,n);this.itemsMatch(r,a)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(n===-1){this.checkStart();return}if(!this.schedule)return;const s=this.schedule.findItemIndexAtTime(n);this.setSchedulePosition(s)}onAssetListLoaded(e,t){var r,n;const s=t.event,a=s.identifier,u=t.assetListResponse.ASSETS;if(!((r=this.schedule)!=null&&r.hasEvent(a)))return;const f=s.timelineStart,c=s.duration;let d=0;u.forEach((b,E)=>{const x=parseFloat(b.DURATION);this.createAsset(s,E,d,f+d,x,b.URI),d+=x}),s.duration=d,this.log(`Loaded asset-list with duration: ${d} (was: ${c}) ${s}`);const p=this.waitingItem,m=p?.event.identifier===a;this.updateSchedule();const v=(n=this.bufferingItem)==null?void 0:n.event;if(m){var y;const b=this.schedule.findEventIndex(a),E=(y=this.schedule.items)==null?void 0:y[b];if(E){if(!this.playingItem&&this.timelinePos>E.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==b){s.error=new Error(`Interstitial ${u.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${s}`),this.log(s.error.message),this.updateSchedule(!0),this.primaryFallback(s);return}this.setBufferingItem(E)}this.setSchedulePosition(b)}else if(v?.identifier===a){const b=s.assetList[0];if(b){const E=this.getAssetPlayer(b.identifier);if(v.appendInPlace){const x=this.primaryMedia;E&&x&&this.bufferAssetPlayer(E,x)}else E&&E.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case Se.ASSET_LIST_PARSING_ERROR:case Se.ASSET_LIST_LOAD_ERROR:case Se.ASSET_LIST_LOAD_TIMEOUT:{const r=t.interstitial;r&&(this.updateSchedule(!0),this.primaryFallback(r));break}case Se.BUFFER_STALLED_ERROR:{const r=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(r)&&r.event.appendInPlace){this.handleInPlaceStall(r.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const yT=500;class pP extends Bm{constructor(e,t,r){super(e,t,r,"subtitle-stream-controller",Xe.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(M.LEVEL_LOADED,this.onLevelLoaded,this),e.on(M.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(M.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(M.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(M.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(M.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(M.LEVEL_LOADED,this.onLevelLoaded,this),e.off(M.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(M.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(M.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(M.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(M.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=$e.IDLE,this.setInterval(yT),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:r,success:n}=t;if(this.fragContextChanged(r)||(Xt(r)&&(this.fragPrevious=r),this.state=$e.IDLE),!n)return;const s=this.tracksBuffered[this.currentTrackId];if(!s)return;let a;const u=r.start;for(let c=0;c<s.length;c++)if(u>=s[c].start&&u<=s[c].end){a=s[c];break}const f=r.start+r.duration;a?a.end=f:(a={start:u,end:f},s.push(a)),this.fragmentTracker.fragBuffered(r),this.fragBufferedComplete(r,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:r,endOffset:n}=t;if(r===0&&n!==Number.POSITIVE_INFINITY){const s=n-1;if(s<=0)return;t.endOffsetSubtitles=Math.max(0,s),this.tracksBuffered.forEach(a=>{for(let u=0;u<a.length;){if(a[u].end<=s){a.shift();continue}else if(a[u].start<s)a[u].start=s;else break;u++}}),this.fragmentTracker.removeFragmentsInRange(r,s,Xe.SUBTITLE)}}onError(e,t){const r=t.frag;r?.type===Xe.SUBTITLE&&(t.details===Se.FRAG_GAP&&this.fragmentTracker.fragBuffered(r,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==$e.STOPPED&&(this.state=$e.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&OA(this.levels,t)){this.levels=t.map(r=>new tl(r));return}this.tracksBuffered=[],this.levels=t.map(r=>{const n=new tl(r);return this.tracksBuffered[n.id]=[],n}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Xe.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var r;if(this.currentTrackId=t.id,!((r=this.levels)!=null&&r.length)||this.currentTrackId===-1){this.clearInterval();return}const n=this.levels[this.currentTrackId];n!=null&&n.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,n&&this.state!==$e.STOPPED&&this.setInterval(yT)}onSubtitleTrackLoaded(e,t){var r;const{currentTrackId:n,levels:s}=this,{details:a,id:u}=t;if(!s){this.warn(`Subtitle tracks were reset while loading level ${u}`);return}const f=s[u];if(u>=s.length||!f)return;this.log(`Subtitle track ${u} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let c=0;if(a.live||(r=f.details)!=null&&r.live){if(a.deltaUpdateFailed)return;const p=this.mainDetails;if(!p){this.startFragRequested=!1;return}const m=p.fragments[0];if(!f.details)a.hasProgramDateTime&&p.hasProgramDateTime?(Pc(a,p),c=a.fragmentStart):m&&(c=m.start,Qg(a,c));else{var d;c=this.alignPlaylists(a,f.details,(d=this.levelLastLoaded)==null?void 0:d.details),c===0&&m&&(c=m.start,Qg(a,c))}p&&!this.startFragRequested&&this.setStartPosition(p,c)}f.details=a,this.levelLastLoaded=f,u===n&&(this.hls.trigger(M.SUBTITLE_TRACK_UPDATED,{details:a,id:u,groupId:t.groupId}),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===$e.IDLE&&(Ns(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),f.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:r}=e,n=t.decryptdata,s=this.hls;if(!this.fragContextChanged(t)&&r&&r.byteLength>0&&n!=null&&n.key&&n.iv&&Ua(n.method)){const a=performance.now();this.decrypter.decrypt(new Uint8Array(r),n.key.buffer,n.iv.buffer,Nm(n.method)).catch(u=>{throw s.trigger(M.ERROR,{type:tt.MEDIA_ERROR,details:Se.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:t}),u}).then(u=>{const f=performance.now();s.trigger(M.FRAG_DECRYPTED,{frag:t,payload:u,stats:{tstart:a,tdecrypt:f}})}).catch(u=>{this.warn(`${u.name}: ${u.message}`),this.state=$e.IDLE})}}doTick(){if(!this.media){this.state=$e.IDLE;return}if(this.state===$e.IDLE){const{currentTrackId:e,levels:t}=this,r=t?.[e];if(!r||!t.length||!r.details||this.waitForLive(r))return;const{config:n}=this,s=this.getLoadPosition(),a=ot.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],s,n.maxBufferHole),{end:u,len:f}=a,c=r.details,d=this.hls.maxBufferLength+c.levelTargetDuration;if(f>d)return;const p=c.fragments,m=p.length,v=c.edge;let y=null;const b=this.fragPrevious;if(u<v){const T=n.maxFragLookUpTolerance,A=u>v-T?0:T;y=Ns(b,p,Math.max(p[0].start,u),A),!y&&b&&b.start<p[0].start&&(y=p[0])}else y=p[m-1];if(y=this.filterReplacedPrimary(y,r.details),!y)return;const E=y.sn-c.startSN,x=p[E-1];if(x&&x.cc===y.cc&&this.fragmentTracker.getState(x)===or.NOT_LOADED&&(y=x),this.fragmentTracker.getState(y)===or.NOT_LOADED){const T=this.mapToInitFragWhenRequired(y);T&&this.loadFragment(T,r,u)}}}loadFragment(e,t,r){Xt(e)?super.loadFragment(e,t,r):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new gP(this.tracksBuffered[this.currentTrackId]||[])}}class gP{constructor(e){this.buffered=void 0;const t=(r,n,s)=>{if(n=n>>>0,n>s-1)throw new DOMException(`Failed to execute '${r}' on 'TimeRanges': The index provided (${n}) is greater than the maximum bound (${s})`);return e[n][r]};this.buffered={get length(){return e.length},end(r){return t("end",r,e.length)},start(r){return t("start",r,e.length)}}}}const mP={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},YA=l=>String.fromCharCode(mP[l]||l),xi=15,fn=100,yP={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},vP={17:2,18:4,21:6,22:8,23:10,19:13,20:15},bP={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},EP={25:2,26:4,29:6,30:8,31:10,27:13,28:15},SP=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class TP{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const r=typeof t=="function"?t():t;At.log(`${this.time} [${e}] ${r}`)}}}const Ls=function(e){const t=[];for(let r=0;r<e.length;r++)t.push(e[r].toString(16));return t};class WA{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let r=0;r<t.length;r++){const n=t[r];e.hasOwnProperty(n)&&(this[n]=e[n])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class xP{constructor(){this.uchar=" ",this.penState=new WA}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class _P{constructor(e){this.chars=[],this.pos=0,this.currPenState=new WA,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<fn;t++)this.chars.push(new xP);this.logger=e}equals(e){for(let t=0;t<fn;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<fn;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<fn;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>fn&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=fn)}moveCursor(e){const t=this.pos+e;if(e>1)for(let r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=YA(e);if(this.pos>=fn){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<fn;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let r=0;r<fn;r++){const n=this.chars[r].uchar;n!==" "&&(t=!1),e.push(n)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Od{constructor(e){this.rows=[],this.currRow=xi-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<xi;t++)this.rows.push(new _P(e));this.logger=e}reset(){for(let e=0;e<xi;e++)this.rows[e].clear();this.currRow=xi-1}equals(e){let t=!0;for(let r=0;r<xi;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t}copy(e){for(let t=0;t<xi;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<xi;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+kt(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let u=0;u<xi;u++)this.rows[u].clear();const s=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){const u=a.rows[s].cueStartTime,f=this.logger.time;if(u!==null&&f!==null&&u<f)for(let c=0;c<this.nrRollUpRows;c++)this.rows[t-this.nrRollUpRows+c+1].copy(a.rows[s+c])}}this.currRow=t;const r=this.rows[this.currRow];if(e.indent!==null){const s=e.indent,a=Math.max(s-1,0);r.setCursor(e.indent),e.color=r.chars[a].penState.foreground}const n={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(n)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+kt(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let r="",n=-1;for(let s=0;s<xi;s++){const a=this.rows[s].getTextString();a&&(n=s+1,e?t.push("Row "+n+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(e?r="["+t.join(" | ")+"]":r=t.join(`
`)),r}getTextAndFormat(){return this.rows}}class vT{constructor(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Od(r),this.nonDisplayedMemory=new Od(r),this.lastOutputScreen=new Od(r),this.currRollUpRow=this.displayedMemory.rows[xi-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[xi-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let r=0;r<e.length;r++)this.writeScreen.insertChar(e[r]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const r=Math.floor(e/2)-16,n=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=n[r]}this.logger.log(2,"MIDROW: "+kt(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class bT{constructor(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=wP(),this.logger=void 0;const n=this.logger=new TP;this.channels=[null,new vT(e,t,n),new vT(e+1,r,n)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let r=0;r<t.length;r+=2){const n=t[r]&127,s=t[r+1]&127;let a=!1,u=null;if(n===0&&s===0)continue;this.logger.log(3,()=>"["+Ls([t[r],t[r+1]])+"] -> ("+Ls([n,s])+")");const f=this.cmdHistory;if(n>=16&&n<=31){if(AP(n,s,f)){Nu(null,null,f),this.logger.log(3,()=>"Repeated command ("+Ls([n,s])+") is dropped");continue}Nu(n,s,this.cmdHistory),a=this.parseCmd(n,s),a||(a=this.parseMidrow(n,s)),a||(a=this.parsePAC(n,s)),a||(a=this.parseBackgroundAttributes(n,s))}else Nu(null,null,f);if(!a&&(u=this.parseChars(n,s),u)){const d=this.currentChannel;d&&d>0?this.channels[d].insertChars(u):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!a&&!u&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Ls([n,s])+" orig: "+Ls([t[r],t[r+1]]))}}parseCmd(e,t){const r=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,n=(e===23||e===31)&&t>=33&&t<=35;if(!(r||n))return!1;const s=e===20||e===21||e===23?1:2,a=this.channels[s];return e===20||e===21||e===28||e===29?t===32?a.ccRCL():t===33?a.ccBS():t===34?a.ccAOF():t===35?a.ccAON():t===36?a.ccDER():t===37?a.ccRU(2):t===38?a.ccRU(3):t===39?a.ccRU(4):t===40?a.ccFON():t===41?a.ccRDC():t===42?a.ccTR():t===43?a.ccRTD():t===44?a.ccEDM():t===45?a.ccCR():t===46?a.ccENM():t===47&&a.ccEOC():a.ccTO(t-32),this.currentChannel=s,!0}parseMidrow(e,t){let r=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?r=1:r=2,r!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const n=this.channels[r];return n?(n.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Ls([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let r;const n=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,s=(e===16||e===24)&&t>=64&&t<=95;if(!(n||s))return!1;const a=e<=23?1:2;t>=64&&t<=95?r=a===1?yP[e]:bP[e]:r=a===1?vP[e]:EP[e];const u=this.channels[a];return u?(u.setPAC(this.interpretPAC(r,t)),this.currentChannel=a,!0):!1}interpretPAC(e,t){let r;const n={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?r=t-96:r=t-64,n.underline=(r&1)===1,r<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(n.italics=!0,n.color="white"):n.indent=Math.floor((r-16)/2)*4,n}parseChars(e,t){let r,n=null,s=null;if(e>=25?(r=2,s=e-8):(r=1,s=e),s>=17&&s<=19){let a;s===17?a=t+80:s===18?a=t+112:a=t+144,this.logger.log(2,()=>"Special char '"+YA(a)+"' in channel "+r),n=[a]}else e>=32&&e<=127&&(n=t===0?[e]:[e,t]);return n&&this.logger.log(3,()=>"Char codes =  "+Ls(n).join(",")),n}parseBackgroundAttributes(e,t){const r=(e===16||e===24)&&t>=32&&t<=47,n=(e===23||e===31)&&t>=45&&t<=47;if(!(r||n))return!1;let s;const a={};e===16||e===24?(s=Math.floor((t-32)/2),a.background=SP[s],t%2===1&&(a.background=a.background+"_semi")):t===45?a.background="transparent":(a.foreground="black",t===47&&(a.underline=!0));const u=e<=23?1:2;return this.channels[u].setBkgData(a),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Nu(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const r=this.channels[t];r&&r.cueSplitAtTime(e)}}}function Nu(l,e,t){t.a=l,t.b=e}function AP(l,e,t){return t.a===l&&t.b===e}function wP(){return{a:null,b:null}}var Qm=(function(){if(Mc!=null&&Mc.VTTCue)return self.VTTCue;const l=["","lr","rl"],e=["start","middle","end","left","right"];function t(u,f){if(typeof f!="string"||!Array.isArray(u))return!1;const c=f.toLowerCase();return~u.indexOf(c)?c:!1}function r(u){return t(l,u)}function n(u){return t(e,u)}function s(u,...f){let c=1;for(;c<arguments.length;c++){const d=arguments[c];for(const p in d)u[p]=d[p]}return u}function a(u,f,c){const d=this,p={enumerable:!0};d.hasBeenReset=!1;let m="",v=!1,y=u,b=f,E=c,x=null,T="",A=!0,L="auto",w="start",C=50,I="middle",O=50,B="middle";Object.defineProperty(d,"id",s({},p,{get:function(){return m},set:function(P){m=""+P}})),Object.defineProperty(d,"pauseOnExit",s({},p,{get:function(){return v},set:function(P){v=!!P}})),Object.defineProperty(d,"startTime",s({},p,{get:function(){return y},set:function(P){if(typeof P!="number")throw new TypeError("Start time must be set to a number.");y=P,this.hasBeenReset=!0}})),Object.defineProperty(d,"endTime",s({},p,{get:function(){return b},set:function(P){if(typeof P!="number")throw new TypeError("End time must be set to a number.");b=P,this.hasBeenReset=!0}})),Object.defineProperty(d,"text",s({},p,{get:function(){return E},set:function(P){E=""+P,this.hasBeenReset=!0}})),Object.defineProperty(d,"region",s({},p,{get:function(){return x},set:function(P){x=P,this.hasBeenReset=!0}})),Object.defineProperty(d,"vertical",s({},p,{get:function(){return T},set:function(P){const $=r(P);if($===!1)throw new SyntaxError("An invalid or illegal string was specified.");T=$,this.hasBeenReset=!0}})),Object.defineProperty(d,"snapToLines",s({},p,{get:function(){return A},set:function(P){A=!!P,this.hasBeenReset=!0}})),Object.defineProperty(d,"line",s({},p,{get:function(){return L},set:function(P){if(typeof P!="number"&&P!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");L=P,this.hasBeenReset=!0}})),Object.defineProperty(d,"lineAlign",s({},p,{get:function(){return w},set:function(P){const $=n(P);if(!$)throw new SyntaxError("An invalid or illegal string was specified.");w=$,this.hasBeenReset=!0}})),Object.defineProperty(d,"position",s({},p,{get:function(){return C},set:function(P){if(P<0||P>100)throw new Error("Position must be between 0 and 100.");C=P,this.hasBeenReset=!0}})),Object.defineProperty(d,"positionAlign",s({},p,{get:function(){return I},set:function(P){const $=n(P);if(!$)throw new SyntaxError("An invalid or illegal string was specified.");I=$,this.hasBeenReset=!0}})),Object.defineProperty(d,"size",s({},p,{get:function(){return O},set:function(P){if(P<0||P>100)throw new Error("Size must be between 0 and 100.");O=P,this.hasBeenReset=!0}})),Object.defineProperty(d,"align",s({},p,{get:function(){return B},set:function(P){const $=n(P);if(!$)throw new SyntaxError("An invalid or illegal string was specified.");B=$,this.hasBeenReset=!0}})),d.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a})();class RP{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function QA(l){function e(r,n,s,a){return(r|0)*3600+(n|0)*60+(s|0)+parseFloat(a||0)}const t=l.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}let IP=class{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,r){for(let n=0;n<r.length;++n)if(t===r[n]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1}};function XA(l,e,t,r){const n=r?l.split(r):[l];for(const s in n){if(typeof n[s]!="string")continue;const a=n[s].split(t);if(a.length!==2)continue;const u=a[0],f=a[1];e(u,f)}}const nm=new Qm(0,0,""),Uu=nm.align==="middle"?"middle":"center";function LP(l,e,t){const r=l;function n(){const u=QA(l);if(u===null)throw new Error("Malformed timestamp: "+r);return l=l.replace(/^[^\sa-zA-Z-]+/,""),u}function s(u,f){const c=new IP;XA(u,function(m,v){let y;switch(m){case"region":for(let b=t.length-1;b>=0;b--)if(t[b].id===v){c.set(m,t[b].region);break}break;case"vertical":c.alt(m,v,["rl","lr"]);break;case"line":y=v.split(","),c.integer(m,y[0]),c.percent(m,y[0])&&c.set("snapToLines",!1),c.alt(m,y[0],["auto"]),y.length===2&&c.alt("lineAlign",y[1],["start",Uu,"end"]);break;case"position":y=v.split(","),c.percent(m,y[0]),y.length===2&&c.alt("positionAlign",y[1],["start",Uu,"end","line-left","line-right","auto"]);break;case"size":c.percent(m,v);break;case"align":c.alt(m,v,["start",Uu,"end","left","right"]);break}},/:/,/\s/),f.region=c.get("region",null),f.vertical=c.get("vertical","");let d=c.get("line","auto");d==="auto"&&nm.line===-1&&(d=-1),f.line=d,f.lineAlign=c.get("lineAlign","start"),f.snapToLines=c.get("snapToLines",!0),f.size=c.get("size",100),f.align=c.get("align",Uu);let p=c.get("position","auto");p==="auto"&&nm.position===50&&(p=f.align==="start"||f.align==="left"?0:f.align==="end"||f.align==="right"?100:50),f.position=p}function a(){l=l.replace(/^\s+/,"")}if(a(),e.startTime=n(),a(),l.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+r);l=l.slice(3),a(),e.endTime=n(),a(),s(l,e)}function ZA(l){return l.replace(/<br(?: \/)?>/gi,`
`)}class CP{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new RP,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function r(){let s=t.buffer,a=0;for(s=ZA(s);a<s.length&&s[a]!=="\r"&&s[a]!==`
`;)++a;const u=s.slice(0,a);return s[a]==="\r"&&++a,s[a]===`
`&&++a,t.buffer=s.slice(a),u}function n(s){XA(s,function(a,u){},/:/)}try{let s="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;s=r();const u=s.match(/^()?WEBVTT([ \t].*)?$/);if(!(u!=null&&u[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let a=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:s=r(),t.state){case"HEADER":/:/.test(s)?n(s):s||(t.state="ID");continue;case"NOTE":s||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){t.state="NOTE";break}if(!s)continue;if(t.cue=new Qm(0,0,""),t.state="CUE",s.indexOf("-->")===-1){t.cue.id=s;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{LP(s,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const u=s.indexOf("-->")!==-1;if(!s||u&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=s}continue;case"BADCUE":s||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const DP=/\r\n|\n\r|\n|\r/g,kd=function(e,t,r=0){return e.slice(r,r+t.length)===t},OP=function(e){let t=parseInt(e.slice(-3));const r=parseInt(e.slice(-6,-4)),n=parseInt(e.slice(-9,-7)),s=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!Ye(t)||!Ye(r)||!Ye(n)||!Ye(s))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*r,t+=60*1e3*n,t+=3600*1e3*s,t};function Xm(l,e,t){return Qo(l.toString())+Qo(e.toString())+Qo(t)}const kP=function(e,t,r){let n=e[t],s=e[n.prevCC];if(!s||!s.new&&n.new){e.ccOffset=e.presentationOffset=n.start,n.new=!1;return}for(;(a=s)!=null&&a.new;){var a;e.ccOffset+=n.start-s.start,n.new=!1,n=s,s=e[n.prevCC]}e.presentationOffset=r};function MP(l,e,t,r,n,s,a){const u=new CP,f=si(new Uint8Array(l)).trim().replace(DP,`
`).split(`
`),c=[],d=e?jk(e.baseTime,e.timescale):0;let p="00:00.000",m=0,v=0,y,b=!0;u.oncue=function(E){const x=t[r];let T=t.ccOffset;const A=(m-d)/9e4;if(x!=null&&x.new&&(v!==void 0?T=t.ccOffset=x.start:kP(t,r,A)),A){if(!e){y=new Error("Missing initPTS for VTT MPEGTS");return}T=A-t.presentationOffset}const L=E.endTime-E.startTime,w=ri((E.startTime+T-v)*9e4,n*9e4)/9e4;E.startTime=Math.max(w,0),E.endTime=Math.max(w+L,0);const C=E.text.trim();E.text=decodeURIComponent(encodeURIComponent(C)),E.id||(E.id=Xm(E.startTime,E.endTime,C)),E.endTime>0&&c.push(E)},u.onparsingerror=function(E){y=E},u.onflush=function(){if(y){a(y);return}s(c)},f.forEach(E=>{if(b)if(kd(E,"X-TIMESTAMP-MAP=")){b=!1,E.slice(16).split(",").forEach(x=>{kd(x,"LOCAL:")?p=x.slice(6):kd(x,"MPEGTS:")&&(m=parseInt(x.slice(7)))});try{v=OP(p)/1e3}catch(x){y=x}return}else E===""&&(b=!1);u.parse(E+`
`)}),u.flush()}const Md="stpp.ttml.im1t",JA=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,e1=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,PP={left:"start",center:"center",right:"end",start:"start",end:"end"};function ET(l,e,t,r){const n=ht(new Uint8Array(l),["mdat"]);if(n.length===0){r(new Error("Could not parse IMSC1 mdat"));return}const s=n.map(u=>si(u)),a=Fk(e.baseTime,1,e.timescale);try{s.forEach(u=>t(NP(u,a)))}catch(u){r(u)}}function NP(l,e){const n=new DOMParser().parseFromString(l,"text/xml").getElementsByTagName("tt")[0];if(!n)throw new Error("Invalid ttml");const s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(s).reduce((p,m)=>(p[m]=n.getAttribute(`ttp:${m}`)||s[m],p),{}),u=n.getAttribute("xml:space")!=="preserve",f=ST(Pd(n,"styling","style")),c=ST(Pd(n,"layout","region")),d=Pd(n,"body","[begin]");return[].map.call(d,p=>{const m=t1(p,u);if(!m||!p.hasAttribute("begin"))return null;const v=Ud(p.getAttribute("begin"),a),y=Ud(p.getAttribute("dur"),a);let b=Ud(p.getAttribute("end"),a);if(v===null)throw TT(p);if(b===null){if(y===null)throw TT(p);b=v+y}const E=new Qm(v-e,b-e,m);E.id=Xm(E.startTime,E.endTime,E.text);const x=c[p.getAttribute("region")],T=f[p.getAttribute("style")],A=UP(x,T,f),{textAlign:L}=A;if(L){const w=PP[L];w&&(E.lineAlign=w),E.align=L}return Lt(E,A),E}).filter(p=>p!==null)}function Pd(l,e,t){const r=l.getElementsByTagName(e)[0];return r?[].slice.call(r.querySelectorAll(t)):[]}function ST(l){return l.reduce((e,t)=>{const r=t.getAttribute("xml:id");return r&&(e[r]=t),e},{})}function t1(l,e){return[].slice.call(l.childNodes).reduce((t,r,n)=>{var s;return r.nodeName==="br"&&n?t+`
`:(s=r.childNodes)!=null&&s.length?t1(r,e):e?t+r.textContent.trim().replace(/\s+/g," "):t+r.textContent},"")}function UP(l,e,t){const r="http://www.w3.org/ns/ttml#styling";let n=null;const s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=l!=null&&l.hasAttribute("style")?l.getAttribute("style"):null;return a&&t.hasOwnProperty(a)&&(n=t[a]),s.reduce((u,f)=>{const c=Nd(e,r,f)||Nd(l,r,f)||Nd(n,r,f);return c&&(u[f]=c),u},{})}function Nd(l,e,t){return l&&l.hasAttributeNS(e,t)?l.getAttributeNS(e,t):null}function TT(l){return new Error(`Could not parse ttml timestamp ${l}`)}function Ud(l,e){if(!l)return null;let t=QA(l);return t===null&&(JA.test(l)?t=BP(l,e):e1.test(l)&&(t=FP(l,e))),t}function BP(l,e){const t=JA.exec(l),r=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+r/e.frameRate}function FP(l,e){const t=e1.exec(l),r=Number(t[1]);switch(t[2]){case"h":return r*3600;case"m":return r*60;case"ms":return r*1e3;case"f":return r/e.frameRate;case"t":return r/e.tickRate}return r}class Bu{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,r){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class jP{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=_T(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(M.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(M.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(M.MANIFEST_LOADING,this.onManifestLoading,this),e.on(M.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(M.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(M.FRAG_LOADING,this.onFragLoading,this),e.on(M.FRAG_LOADED,this.onFragLoaded,this),e.on(M.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(M.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(M.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(M.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(M.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(M.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(M.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(M.MANIFEST_LOADING,this.onManifestLoading,this),e.off(M.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(M.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(M.FRAG_LOADING,this.onFragLoading,this),e.off(M.FRAG_LOADED,this.onFragLoaded,this),e.off(M.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(M.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(M.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(M.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(M.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Bu(this,"textTrack1"),t=new Bu(this,"textTrack2"),r=new Bu(this,"textTrack3"),n=new Bu(this,"textTrack4");this.cea608Parser1=new bT(1,e,t),this.cea608Parser2=new bT(3,r,n)}addCues(e,t,r,n,s){let a=!1;for(let u=s.length;u--;){const f=s[u],c=$P(f[0],f[1],t,r);if(c>=0&&(f[0]=Math.min(f[0],t),f[1]=Math.max(f[1],r),a=!0,c/(r-t)>.5))return}if(a||s.push([t,r]),this.config.renderTextTracksNatively){const u=this.captionsTracks[e];this.Cues.newCue(u,t,r,n)}else{const u=this.Cues.newCue(null,t,r,n);this.hls.trigger(M.CUES_PARSED,{type:"captions",cues:u,track:e})}}onInitPtsFound(e,{frag:t,id:r,initPTS:n,timescale:s,trackId:a}){const{unparsedVttFrags:u}=this;r===Xe.MAIN&&(this.initPTS[t.cc]={baseTime:n,timescale:s,trackId:a}),u.length&&(this.unparsedVttFrags=[],u.forEach(f=>{this.initPTS[f.frag.cc]?this.onFragLoaded(M.FRAG_LOADED,f):this.hls.trigger(M.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:f.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:r}=this;if(r)for(let n=0;n<r.textTracks.length;n++){const s=r.textTracks[n];if(xT(s,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return s}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:r,media:n}=this,{label:s,languageCode:a}=t[e],u=this.getExistingTrack(s,a);if(u)r[e]=u,Ma(r[e]),VA(r[e],n);else{const f=this.createTextTrack("captions",s,a);f&&(f[e]=!0,r[e]=f)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const r=t.label,n={_id:e,label:r,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=n,this.hls.trigger(M.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]})}createTextTrack(e,t,r){const n=this.media;if(n)return n.addTextTrack(e,t,r)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const r=!!t.transferMedia;if(this.media=null,r)return;const{captionsTracks:n}=this;Object.keys(n).forEach(s=>{Ma(n[s]),delete n[s]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=_T(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let r=0;r<t.length;r++)Ma(t[r])}onSubtitleTracksUpdated(e,t){const r=t.subtitleTracks||[],n=r.some(s=>s.textCodec===Md);if(this.config.enableWebVTT||n&&this.config.enableIMSC1){if(OA(this.tracks,r)){this.tracks=r;return}if(this.textTracks=[],this.tracks=r,this.config.renderTextTracksNatively){const a=this.media,u=a?Sc(a.textTracks):null;if(this.tracks.forEach((f,c)=>{let d;if(u){let p=null;for(let m=0;m<u.length;m++)if(u[m]&&xT(u[m],f)){p=u[m],u[m]=null;break}p&&(d=p)}if(d)Ma(d);else{const p=r1(f);d=this.createTextTrack(p,f.name,f.lang),d&&(d.mode="disabled")}d&&this.textTracks.push(d)}),u!=null&&u.length){const f=u.filter(c=>c!==null).map(c=>c.label);f.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${f.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const a=this.tracks.map(u=>({label:u.name,kind:u.type.toLowerCase(),default:u.default,subtitleTrack:u}));this.hls.trigger(M.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(r=>{const n=/(?:CC|SERVICE)([1-4])/.exec(r.instreamId);if(!n)return;const s=`textTrack${n[1]}`,a=this.captionsProperties[s];a&&(a.label=r.name,r.lang&&(a.languageCode=r.lang),a.media=r)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t?.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===Xe.MAIN){var r,n;const{cea608Parser1:s,cea608Parser2:a,lastSn:u}=this,{cc:f,sn:c}=t.frag,d=(r=(n=t.part)==null?void 0:n.index)!=null?r:-1;s&&a&&(c!==u+1||c===u&&d!==this.lastPartIndex+1||f!==this.lastCc)&&(s.reset(),a.reset()),this.lastCc=f,this.lastSn=c,this.lastPartIndex=d}}onFragLoaded(e,t){const{frag:r,payload:n}=t;if(r.type===Xe.SUBTITLE)if(n.byteLength){const s=r.decryptdata,a="stats"in t;if(s==null||!s.encrypted||a){const u=this.tracks[r.level],f=this.vttCCs;f[r.cc]||(f[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),u&&u.textCodec===Md?this._parseIMSC1(r,n):this._parseVTTs(t)}}else this.hls.trigger(M.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const r=this.hls;ET(t,this.initPTS[e.cc],n=>{this._appendCues(n,e.level),r.trigger(M.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},n=>{r.logger.log(`Failed to parse IMSC1: ${n}`),r.trigger(M.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:n})})}_parseVTTs(e){var t;const{frag:r,payload:n}=e,{initPTS:s,unparsedVttFrags:a}=this,u=s.length-1;if(!s[r.cc]&&u===-1){a.push(e);return}const f=this.hls,c=(t=r.initSegment)!=null&&t.data?yi(r.initSegment.data,new Uint8Array(n)).buffer:n;MP(c,this.initPTS[r.cc],this.vttCCs,r.cc,r.start,d=>{this._appendCues(d,r.level),f.trigger(M.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},d=>{const p=d.message==="Missing initPTS for VTT MPEGTS";p?a.push(e):this._fallbackToIMSC1(r,n),f.logger.log(`Failed to parse VTT cue: ${d}`),!(p&&u>r.cc)&&f.trigger(M.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:d})})}_fallbackToIMSC1(e,t){const r=this.tracks[e.level];r.textCodec||ET(t,this.initPTS[e.cc],()=>{r.textCodec=Md,this._parseIMSC1(e,t)},()=>{r.textCodec="wvtt"})}_appendCues(e,t){const r=this.hls;if(this.config.renderTextTracksNatively){const n=this.textTracks[t];if(!n||n.mode==="disabled")return;e.forEach(s=>zA(n,s))}else{const n=this.tracks[t];if(!n)return;const s=n.default?"default":"subtitles"+t;r.trigger(M.CUES_PARSED,{type:"subtitles",cues:e,track:s})}}onFragDecrypted(e,t){const{frag:r}=t;r.type===Xe.SUBTITLE&&this.onFragLoaded(M.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:r,samples:n}=t;if(!(r.type===Xe.MAIN&&this.closedCaptionsForLevel(r)==="NONE"))for(let s=0;s<n.length;s++){const a=n[s].bytes;if(a){this.cea608Parser1||this.initCea608Parsers();const u=this.extractCea608Data(a);this.cea608Parser1.addData(n[s].pts,u[0]),this.cea608Parser2.addData(n[s].pts,u[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:r,endOffsetSubtitles:n,type:s}){const{media:a}=this;if(!(!a||a.currentTime<r)){if(!s||s==="video"){const{captionsTracks:u}=this;Object.keys(u).forEach(f=>im(u[f],t,r))}if(this.config.renderTextTracksNatively&&t===0&&n!==void 0){const{textTracks:u}=this;Object.keys(u).forEach(f=>im(u[f],t,n))}}}extractCea608Data(e){const t=[[],[]],r=e[0]&31;let n=2;for(let s=0;s<r;s++){const a=e[n++],u=127&e[n++],f=127&e[n++];if(u===0&&f===0)continue;if((4&a)!==0){const d=3&a;(d===0||d===1)&&(t[d].push(u),t[d].push(f))}}return t}}function r1(l){return l.characteristics&&/transcribes-spoken-dialog/gi.test(l.characteristics)&&/describes-music-and-sound/gi.test(l.characteristics)?"captions":"subtitles"}function xT(l,e){return!!l&&l.kind===r1(e)&&Jg(e,l)}function $P(l,e,t,r){return Math.min(e,r)-Math.max(l,t)}function _T(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const GP=/\s/,HP={newCue(l,e,t,r){const n=[];let s,a,u,f,c;const d=self.VTTCue||self.TextTrackCue;for(let m=0;m<r.rows.length;m++)if(s=r.rows[m],u=!0,f=0,c="",!s.isEmpty()){var p;for(let b=0;b<s.chars.length;b++)GP.test(s.chars[b].uchar)&&u?f++:(c+=s.chars[b].uchar,u=!1);s.cueStartTime=e,e===t&&(t+=1e-4),f>=16?f--:f++;const v=ZA(c.trim()),y=Xm(e,t,v);l!=null&&(p=l.cues)!=null&&p.getCueById(y)||(a=new d(e,t,v),a.id=y,a.line=m+1,a.align="left",a.position=10+Math.min(80,Math.floor(f*8/32)*10),n.push(a))}return l&&n.length&&(n.sort((m,v)=>m.line==="auto"||v.line==="auto"?0:m.line>8&&v.line>8?v.line-m.line:m.line-v.line),n.forEach(m=>zA(l,m))),n}};function KP(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const VP=/(\d+)-(\d+)\/(\d+)/;class AT{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||WP,this.controller=new self.AbortController,this.stats=new Lm}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,r){const n=this.stats;if(n.loading.start)throw new Error("Loader can only be used once.");n.loading.start=self.performance.now();const s=zP(e,this.controller.signal),a=e.responseType==="arraybuffer",u=a?"byteLength":"length",{maxTimeToFirstByteMs:f,maxLoadTimeMs:c}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),t.timeout=f&&Ye(f)?f:c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(n,e,this.response))},t.timeout),(nl(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(p=>{var m;this.response=this.loader=p;const v=Math.max(self.performance.now(),n.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(n,e,this.response))},c-(v-n.loading.start)),!p.ok){const{status:b,statusText:E}=p;throw new QP(E||"fetch, bad network response",b,p)}n.loading.first=v,n.total=YP(p.headers)||n.total;const y=(m=this.callbacks)==null?void 0:m.onProgress;return y&&Ye(t.highWaterMark)?this.loadProgressively(p,n,e,t.highWaterMark,y):a?p.arrayBuffer():e.responseType==="json"?p.json():p.text()}).then(p=>{var m,v;const y=this.response;if(!y)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),n.loading.end=Math.max(self.performance.now(),n.loading.first);const b=p[u];b&&(n.loaded=n.total=b);const E={url:y.url,data:p,code:y.status},x=(m=this.callbacks)==null?void 0:m.onProgress;x&&!Ye(t.highWaterMark)&&x(n,e,p,y),(v=this.callbacks)==null||v.onSuccess(E,n,e,y)}).catch(p=>{var m;if(self.clearTimeout(this.requestTimeout),n.aborted)return;const v=p&&p.code||0,y=p?p.message:null;(m=this.callbacks)==null||m.onError({code:v,text:y},e,p?p.details:null,n)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,r,n=0,s){const a=new hA,u=e.body.getReader(),f=()=>u.read().then(c=>{if(c.done)return a.dataLength&&s(t,r,a.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const d=c.value,p=d.length;return t.loaded+=p,p<n||a.dataLength?(a.push(d),a.dataLength>=n&&s(t,r,a.flush().buffer,e)):s(t,r,d.buffer,e),f()}).catch(()=>Promise.reject());return f()}}function zP(l,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Lt({},l.headers))};return l.rangeEnd&&t.headers.set("Range","bytes="+l.rangeStart+"-"+String(l.rangeEnd-1)),t}function qP(l){const e=VP.exec(l);if(e)return parseInt(e[2])-parseInt(e[1])+1}function YP(l){const e=l.get("Content-Range");if(e){const r=qP(e);if(Ye(r))return r}const t=l.get("Content-Length");if(t)return parseInt(t)}function WP(l,e){return new self.Request(l.url,e)}class QP extends Error{constructor(e,t,r){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=r}}const XP=/^age:\s*[\d.]+\s*$/im;class i1{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Lm,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const r=this.loader=new self.XMLHttpRequest,n=this.stats;n.loading.first=0,n.loaded=0,n.aborted=!1;const s=this.xhrSetup;s?Promise.resolve().then(()=>{if(!(this.loader!==r||this.stats.aborted))return s(r,t.url)}).catch(a=>{if(!(this.loader!==r||this.stats.aborted))return r.open("GET",t.url,!0),s(r,t.url)}).then(()=>{this.loader!==r||this.stats.aborted||this.openAndSendXhr(r,t,e)}).catch(a=>{var u;(u=this.callbacks)==null||u.onError({code:r.status,text:a.message},t,r,n)}):this.openAndSendXhr(r,t,e)}openAndSendXhr(e,t,r){e.readyState||e.open("GET",t.url,!0);const n=t.headers,{maxTimeToFirstByteMs:s,maxLoadTimeMs:a}=r.loadPolicy;if(n)for(const u in n)e.setRequestHeader(u,n[u]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=s&&Ye(s)?s:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:r}=this;if(!e||!t)return;const n=t.readyState,s=this.config;if(!r.aborted&&n>=2&&(r.loading.first===0&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),n===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const c=t.status,d=t.responseType==="text"?t.responseText:null;if(c>=200&&c<300){const y=d??t.response;if(y!=null){var a,u;r.loading.end=Math.max(self.performance.now(),r.loading.first);const b=t.responseType==="arraybuffer"?y.byteLength:y.length;r.loaded=r.total=b,r.bwEstimate=r.total*8e3/(r.loading.end-r.loading.first);const E=(a=this.callbacks)==null?void 0:a.onProgress;E&&E(r,e,y,t);const x={url:t.responseURL,data:y,code:c};(u=this.callbacks)==null||u.onSuccess(x,r,e,t);return}}const p=s.loadPolicy.errorRetry,m=r.retry,v={url:e.url,data:void 0,code:c};if(Oc(p,m,!1,v))this.retry(p);else{var f;At.error(`${c} while loading ${e.url}`),(f=this.callbacks)==null||f.onError({code:c,text:t.statusText},e,t,r)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(Oc(e,t,!0))this.retry(e);else{var r;At.warn(`timeout while loading ${(r=this.context)==null?void 0:r.url}`);const n=this.callbacks;n&&(this.abortInternal(),n.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:r}=this;this.retryDelay=km(e,r.retry),r.retry++,At.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t?.url}, retrying ${r.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&XP.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const ZP={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},JP=_t(_t({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:i1,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:fO,bufferController:tM,capLevelController:qm,errorController:mO,fpsController:rP,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:tA,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:ZP},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},eN()),{},{subtitleStreamController:pP,subtitleTrackController:sP,timelineController:jP,audioStreamController:Xk,audioTrackController:Zk,emeController:Ba,cmcdController:ZM,contentSteeringController:eP,interstitialsController:dP});function eN(){return{cueHandler:HP,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function tN(l,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const r=sm(l),n=["manifest","level","frag"],s=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return n.forEach(a=>{const u=`${a==="level"?"playlist":a}LoadPolicy`,f=e[u]===void 0,c=[];s.forEach(d=>{const p=`${a}Loading${d}`,m=e[p];if(m!==void 0&&f){c.push(p);const v=r[u].default;switch(e[u]={default:v},d){case"TimeOut":v.maxLoadTimeMs=m,v.maxTimeToFirstByteMs=m;break;case"MaxRetry":v.errorRetry.maxNumRetry=m,v.timeoutRetry.maxNumRetry=m;break;case"RetryDelay":v.errorRetry.retryDelayMs=m,v.timeoutRetry.retryDelayMs=m;break;case"MaxRetryTimeout":v.errorRetry.maxRetryDelayMs=m,v.timeoutRetry.maxRetryDelayMs=m;break}}}),c.length&&t.warn(`hls.js config: "${c.join('", "')}" setting(s) are deprecated, use "${u}": ${kt(e[u])}`)}),_t(_t({},r),e)}function sm(l){return l&&typeof l=="object"?Array.isArray(l)?l.map(sm):Object.keys(l).reduce((e,t)=>(e[t]=sm(l[t]),e),{}):l}function rN(l,e){const t=l.loader;t!==AT&&t!==i1?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),l.progressive=!1):KP()&&(l.loader=AT,l.progressive=!0,l.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const Tc=2,iN=.1,nN=.05,sN=100;class aN extends Q_{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var r;(r=this.media)!=null&&r.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var r;this.ended=((r=this.media)==null?void 0:r.currentTime)||1,this.hls.trigger(M.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(M.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(M.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(M.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(M.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(M.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(M.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(sN),this.mediaSource=t.mediaSource;const r=this.media=t.media;Lr(r,"playing",this.onMediaPlaying),Lr(r,"waiting",this.onMediaWaiting),Lr(r,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:r}=this;r&&(Hr(r,"playing",this.onMediaPlaying),Hr(r,"waiting",this.onMediaWaiting),Hr(r,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var r,n;const s=(r=this.hls)==null?void 0:r.config;if(!s)return;const a=this.media;if(!a)return;const{seeking:u}=a,f=this.seeking&&!u,c=!this.seeking&&u,d=a.paused&&!u||a.ended||a.playbackRate===0;if(this.seeking=u,e!==t){t&&(this.ended=0),this.moved=!0,u||(this.nudgeRetry=0,s.nudgeOnVideoHole&&!d&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(c||f){f&&this.stallResolved(e);return}if(d){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&a.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(M.MEDIA_ENDED,{stalled:!1}));return}if(!ot.getBuffered(a).length){this.nudgeRetry=0;return}const p=ot.bufferInfo(a,e,0),m=p.nextStart||0,v=this.fragmentTracker;if(u&&v&&this.hls){const C=wT(this.hls.inFlightFragments,e),I=p.len>Tc,O=!m||C||m-e>Tc&&!v.getPartialFragment(e);if(I||O)return;this.moved=!1}const y=(n=this.hls)==null?void 0:n.latestLevelDetails;if(!this.moved&&this.stalled!==null&&v){if(!(p.len>0)&&!m)return;const I=Math.max(m,p.start||0)-e,B=!!(y!=null&&y.live)?y.targetduration*2:Tc,P=Fu(e,v);if(I>0&&(I<=B||P)){a.paused||this._trySkipBufferHole(P);return}}const b=s.detectStallWithCurrentTimeMs,E=self.performance.now(),x=this.waiting;let T=this.stalled;if(T===null)if(x>0&&E-x<b)T=this.stalled=x;else{this.stalled=E;return}const A=E-T;if(!u&&(A>=b||x)&&this.hls){var L;if(((L=this.mediaSource)==null?void 0:L.readyState)==="ended"&&!(y!=null&&y.live)&&Math.abs(e-(y?.edge||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(M.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(p),!this.media||!this.hls)return}const w=ot.bufferInfo(a,e,s.maxBufferHole);this._tryFixBufferStall(w,A,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const r=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(r)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(M.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var r;const n=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(r=this.buffered.audio)!=null&&r.length&&n&&n.length>1&&e>n.end(0)){const s=ot.bufferedInfo(ot.timeRangesToArray(this.buffered.audio),e,0);if(s.len>1&&t>=s.start){const a=ot.timeRangesToArray(n),u=ot.bufferedInfo(a,t,0).bufferedIndex;if(u>-1&&u<a.length-1){const f=ot.bufferedInfo(a,e,0).bufferedIndex,c=a[u].end,d=a[u+1].start;if((f===-1||f>u)&&d-c<1&&e-c<2){const p=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${c} -> ${d} buffered index: ${f}`);this.warn(p.message),this.media.currentTime+=1e-6;let m=Fu(e,this.fragmentTracker);m&&"fragment"in m?m=m.fragment:m||(m=void 0);const v=ot.bufferInfo(this.media,e,0);this.hls.trigger(M.ERROR,{type:tt.MEDIA_ERROR,details:Se.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:p,reason:p.message,frag:m,buffer:v.len,bufferInfo:v})}}}}}_tryFixBufferStall(e,t,r){var n,s;const{fragmentTracker:a,media:u}=this,f=(n=this.hls)==null?void 0:n.config;if(!u||!a||!f)return;const c=(s=this.hls)==null?void 0:s.latestLevelDetails,d=Fu(r,a);if((d||c!=null&&c.live&&r<c.fragmentStart)&&(this._trySkipBufferHole(d)||!this.media))return;const p=e.buffered,m=this.adjacentTraversal(e,r);(p&&p.length>1&&e.len>f.maxBufferHole||e.nextStart&&(e.nextStart-r<f.maxBufferHole||m))&&(t>f.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const r=this.fragmentTracker,n=e.nextStart;if(r&&n){const s=r.getFragAtPos(t,Xe.MAIN),a=r.getFragAtPos(n,Xe.MAIN);if(s&&a)return a.sn-s.sn<2}return!1}_reportStall(e){const{hls:t,media:r,stallReported:n,stalled:s}=this;if(!n&&s!==null&&r&&t){this.stallReported=!0;const a=new Error(`Playback stalling at @${r.currentTime} due to low buffer (${kt(e)})`);this.warn(a.message),t.trigger(M.ERROR,{type:tt.MEDIA_ERROR,details:Se.BUFFER_STALLED_ERROR,fatal:!1,error:a,buffer:e.len,bufferInfo:e,stalled:{start:s}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:r,media:n}=this,s=(t=this.hls)==null?void 0:t.config;if(!n||!r||!s)return 0;const a=n.currentTime,u=ot.bufferInfo(n,a,0),f=a<u.start?u.start:u.nextStart;if(f&&this.hls){const d=u.len<=s.maxBufferHole,p=u.len>0&&u.len<1&&n.readyState<3,m=f-a;if(m>0&&(d||p)){if(m>s.maxBufferHole){let y=!1;if(a===0){const b=r.getAppendedFrag(0,Xe.MAIN);b&&f<b.end&&(y=!0)}if(!y&&e){var c;if(!((c=this.hls.loadLevelObj)!=null&&c.details)||wT(this.hls.inFlightFragments,f))return 0;let E=!1,x=e.end;for(;x<f;){const T=Fu(x,r);if(T)x+=T.duration;else{E=!0;break}}if(E)return 0}}const v=Math.max(f+nN,a+iN);if(this.warn(`skipping hole, adjusting currentTime from ${a} to ${v}`),this.moved=!0,n.currentTime=v,!(e!=null&&e.gap)){const y=new Error(`fragment loaded with buffer holes, seeking from ${a} to ${v}`),b={type:tt.MEDIA_ERROR,details:Se.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:y,reason:y.message,buffer:u.len,bufferInfo:u};e&&("fragment"in e?b.part=e:b.frag=e),this.hls.trigger(M.ERROR,b)}return v}}return 0}_tryNudgeBuffer(e){const{hls:t,media:r,nudgeRetry:n}=this,s=t?.config;if(!r||!s)return 0;const a=r.currentTime;if(this.nudgeRetry++,n<s.nudgeMaxRetry){const u=a+(n+1)*s.nudgeOffset,f=new Error(`Nudging 'currentTime' from ${a} to ${u}`);this.warn(f.message),r.currentTime=u,t.trigger(M.ERROR,{type:tt.MEDIA_ERROR,details:Se.BUFFER_NUDGE_ON_STALL,error:f,fatal:!1,buffer:e.len,bufferInfo:e})}else{const u=new Error(`Playhead still not moving while enough data buffered @${a} after ${s.nudgeMaxRetry} nudges`);this.error(u.message),t.trigger(M.ERROR,{type:tt.MEDIA_ERROR,details:Se.BUFFER_STALLED_ERROR,error:u,fatal:!0,buffer:e.len,bufferInfo:e})}}}function wT(l,e){const t=RT(l.main);if(t&&t.start<=e)return t;const r=RT(l.audio);return r&&r.start<=e?r:null}function RT(l){if(!l)return null;switch(l.state){case $e.IDLE:case $e.STOPPED:case $e.ENDED:case $e.ERROR:return null}return l.frag}function Fu(l,e){return e.getAppendedFrag(l,Xe.MAIN)||e.getPartialFragment(l)}const oN=.25;function am(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function Bd(l,e,t,r,n){let s=new l(e,t,"");try{s.value=r,n&&(s.type=n)}catch{s=new l(e,t,kt(n?_t({type:n},r):r))}return s}const ju=(()=>{const l=am();try{l&&new l(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class lN{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(M.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(M.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(M.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(M.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(M.MANIFEST_LOADING,this.onManifestLoading,this),e.on(M.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(M.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(M.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(M.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(M.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(M.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(M.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(M.MANIFEST_LOADING,this.onManifestLoading,this),e.off(M.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(M.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(M.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(M.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var r;this.media=t.media,((r=t.overrides)==null?void 0:r.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&Ma(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const r=e[t];if(r.kind==="metadata"&&r.label==="id3")return VA(r,this.media),r}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:r,enableID3MetadataCues:n}=this.hls.config;if(!r&&!n)return;const{samples:s}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=am();if(a)for(let u=0;u<s.length;u++){const f=s[u].type;if(f===ii.emsg&&!r||!n)continue;const c=bA(s[u].data),d=s[u].pts;let p=d+s[u].duration;p>ju&&(p=ju),p-d<=0&&(p=d+oN);for(let v=0;v<c.length;v++){const y=c[v];if(!EA(y)){this.updateId3CueEnds(d,f);const b=Bd(a,d,p,y,f);b&&this.id3Track.addCue(b)}}}}updateId3CueEnds(e,t){var r;const n=(r=this.id3Track)==null?void 0:r.cues;if(n)for(let s=n.length;s--;){const a=n[s];a.type===t&&a.startTime<e&&a.endTime===ju&&(a.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:r,type:n}){const{id3Track:s,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:u,enableID3MetadataCues:f}}=a;if(s&&(u||f)){let c;n==="audio"?c=d=>d.type===ii.audioId3&&f:n==="video"?c=d=>d.type===ii.emsg&&u:c=d=>d.type===ii.audioId3&&f||d.type===ii.emsg&&u,im(s,t,r,c)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:r,timelineOffset:n,enableDateRangeMetadataCues:s,interstitialsController:a}=this.hls.config;if(!s)return;const u=am();if(r&&n&&!a){const{fragmentStart:b,fragmentEnd:E}=e;let x=this.assetCue;x?(x.startTime=b,x.endTime=E):u&&(x=this.assetCue=Bd(u,b,E,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),x&&(x.id=r,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(x),x.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:f}=this,{dateRanges:c}=e,d=Object.keys(c);let p=this.dateRangeCuesAppended;if(f&&t){var m;if((m=f.cues)!=null&&m.length){const b=Object.keys(p).filter(E=>!d.includes(E));for(let E=b.length;E--;){var v;const x=b[E],T=(v=p[x])==null?void 0:v.cues;delete p[x],T&&Object.keys(T).forEach(A=>{const L=T[A];if(L){L.removeEventListener("enter",this.onEventCueEnter);try{f.removeCue(L)}catch{}}})}}else p=this.dateRangeCuesAppended={}}const y=e.fragments[e.fragments.length-1];if(!(d.length===0||!Ye(y?.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let b=0;b<d.length;b++){const E=d[b],x=c[E],T=x.startTime,A=p[E],L=A?.cues||{};let w=A?.durationKnown||!1,C=ju;const{duration:I,endDate:O}=x;if(O&&I!==null)C=T+I,w=!0;else if(x.endOnNext&&!w){const P=d.reduce(($,F)=>{if(F!==x.id){const Z=c[F];if(Z.class===x.class&&Z.startDate>x.startDate&&(!$||x.startDate<$.startDate))return Z}return $},null);P&&(C=P.startTime,w=!0)}const B=Object.keys(x.attr);for(let P=0;P<B.length;P++){const $=B[P];if(!LO($))continue;const F=L[$];if(F)w&&!(A!=null&&A.durationKnown)?F.endTime=C:Math.abs(F.startTime-T)>.01&&(F.startTime=T,F.endTime=C);else if(u){let Z=x.attr[$];CO($)&&(Z=C_(Z));const q=Bd(u,T,C,{key:$,data:Z},ii.dateRange);q&&(q.id=E,this.id3Track.addCue(q),L[$]=q,a&&($==="X-ASSET-LIST"||$==="X-ASSET-URL")&&q.addEventListener("enter",this.onEventCueEnter))}}p[E]={cues:L,dateRange:x,durationKnown:w}}}}}class uN{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,r=this.levelDetails;if(!t||!r)return;this.currentTime=t.currentTime;const n=this.computeLatency();if(n===null)return;this._latency=n;const{lowLatencyMode:s,maxLiveSyncPlaybackRate:a}=this.config;if(!s||a===1||!r.live)return;const u=this.targetLatency;if(u===null)return;const f=n-u,c=Math.min(this.maxLatency,u+r.targetduration);if(f<c&&f>.05&&this.forwardBufferLength>1){const p=Math.min(2,Math.max(1,a)),m=Math.round(2/(1+Math.exp(-.75*f-this.edgeStalled))*20)/20,v=Math.min(p,Math.max(1,m));this.changeMediaPlaybackRate(t,v)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:r,targetduration:n}=e,{liveSyncDuration:s,liveSyncDurationCount:a,lowLatencyMode:u}=this.config,f=this.hls.userConfig;let c=u&&r||t;(this._targetLatencyUpdated||f.liveSyncDuration||f.liveSyncDurationCount||c===0)&&(c=s!==void 0?s:a*n);const d=n;return c+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,d)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const r=this.levelDetails;if(r===null)return null;const n=r.edge,s=e-t-this.edgeStalled,a=n-r.totalduration,u=n-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(a,s),u)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(M.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(M.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(M.MANIFEST_LOADING,this.onManifestLoading,this),e.on(M.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(M.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(M.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(M.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(M.MANIFEST_LOADING,this.onManifestLoading,this),e.off(M.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(M.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var r;t.details===Se.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(r=this.levelDetails)!=null&&r.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var r,n;e.playbackRate!==t&&((r=this.hls)==null||r.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(n=this.targetLatency)==null?void 0:n.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class cN extends zm{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(M.MANIFEST_LOADING,this.onManifestLoading,this),e.on(M.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(M.LEVEL_LOADED,this.onLevelLoaded,this),e.on(M.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(M.FRAG_BUFFERED,this.onFragBuffered,this),e.on(M.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(M.MANIFEST_LOADING,this.onManifestLoading,this),e.off(M.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(M.LEVEL_LOADED,this.onLevelLoaded,this),e.off(M.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(M.FRAG_BUFFERED,this.onFragBuffered,this),e.off(M.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const r=this.hls.config.preferManagedMediaSource,n=[],s={},a={};let u=!1,f=!1,c=!1;t.levels.forEach(d=>{const p=d.attrs;let{audioCodec:m,videoCodec:v}=d;m&&(d.audioCodec=m=Ic(m,r)||void 0),v&&(v=d.videoCodec=zD(v));const{width:y,height:b,unknownCodecs:E}=d,x=E?.length||0;if(u||(u=!!(y&&b)),f||(f=!!v),c||(c=!!m),x||m&&!this.isAudioSupported(m)||v&&!this.isVideoSupported(v)){this.log(`Some or all CODECS not supported "${p.CODECS}"`);return}const{CODECS:T,"FRAME-RATE":A,"HDCP-LEVEL":L,"PATHWAY-ID":w,RESOLUTION:C,"VIDEO-RANGE":I}=p,B=`${`${w||"."}-`}${d.bitrate}-${C}-${A}-${T}-${I}-${L}`;if(s[B])if(s[B].uri!==d.url&&!d.attrs["PATHWAY-ID"]){const P=a[B]+=1;d.attrs["PATHWAY-ID"]=new Array(P+1).join(".");const $=this.createLevel(d);s[B]=$,n.push($)}else s[B].addGroupId("audio",p.AUDIO),s[B].addGroupId("text",p.SUBTITLES);else{const P=this.createLevel(d);s[B]=P,a[B]=1,n.push(P)}}),this.filterAndSortMediaOptions(n,t,u,f,c)}createLevel(e){const t=new tl(e),r=e.supplemental;if(r!=null&&r.videoCodec&&!this.isVideoSupported(r.videoCodec)){const n=new Error(`SUPPLEMENTAL-CODECS not supported "${r.videoCodec}"`);this.log(n.message),t.supportedResult=G_(n,[])}return t}isAudioSupported(e){return Jo(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Jo(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,r,n,s){var a;let u=[],f=[],c=e;const d=((a=t.stats)==null?void 0:a.parsing)||{};if((r||n)&&s&&(c=c.filter(({videoCodec:T,videoRange:A,width:L,height:w})=>(!!T||!!(L&&w))&&rO(A))),c.length===0){Promise.resolve().then(()=>{if(this.hls){let T="no level with compatible codecs found in manifest",A=T;t.levels.length&&(A=`one or more CODECS in variant not supported: ${kt(t.levels.map(w=>w.attrs.CODECS).filter((w,C,I)=>I.indexOf(w)===C))}`,this.warn(A),T+=` (${A})`);const L=new Error(T);this.hls.trigger(M.ERROR,{type:tt.MEDIA_ERROR,details:Se.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:L,reason:A})}}),d.end=performance.now();return}t.audioTracks&&(u=t.audioTracks.filter(T=>!T.audioCodec||this.isAudioSupported(T.audioCodec)),IT(u)),t.subtitles&&(f=t.subtitles,IT(f));const p=c.slice(0);c.sort((T,A)=>{if(T.attrs["HDCP-LEVEL"]!==A.attrs["HDCP-LEVEL"])return(T.attrs["HDCP-LEVEL"]||"")>(A.attrs["HDCP-LEVEL"]||"")?1:-1;if(r&&T.height!==A.height)return T.height-A.height;if(T.frameRate!==A.frameRate)return T.frameRate-A.frameRate;if(T.videoRange!==A.videoRange)return Lc.indexOf(T.videoRange)-Lc.indexOf(A.videoRange);if(T.videoCodec!==A.videoCodec){const L=bS(T.videoCodec),w=bS(A.videoCodec);if(L!==w)return w-L}if(T.uri===A.uri&&T.codecSet!==A.codecSet){const L=Rc(T.codecSet),w=Rc(A.codecSet);if(L!==w)return w-L}return T.averageBitrate!==A.averageBitrate?T.averageBitrate-A.averageBitrate:0});let m=p[0];if(this.steering&&(c=this.steering.filterParsedLevels(c),c.length!==p.length)){for(let T=0;T<p.length;T++)if(p[T].pathwayId===c[0].pathwayId){m=p[T];break}}this._levels=c;for(let T=0;T<c.length;T++)if(c[T]===m){var v;this._firstLevel=T;const A=m.bitrate,L=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${c.length} level(s) found, first bitrate: ${A}`),((v=this.hls.userConfig)==null?void 0:v.abrEwmaDefaultEstimate)===void 0){const w=Math.min(A,this.hls.config.abrEwmaDefaultEstimateMax);w>L&&L===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=w)}break}const y=s&&!n,b=this.hls.config,E=!!(b.audioStreamController&&b.audioTrackController),x={levels:c,audioTracks:u,subtitleTracks:f,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:s,video:n,altAudio:E&&!y&&u.some(T=>!!T.url)};d.end=performance.now(),this.hls.trigger(M.MANIFEST_PARSED,x)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const d=new Error("invalid level idx"),p=e<0;if(this.hls.trigger(M.ERROR,{type:tt.OTHER_ERROR,details:Se.LEVEL_SWITCH_ERROR,level:e,fatal:p,error:d,reason:d.message}),p)return;e=Math.min(e,t.length-1)}const r=this.currentLevelIndex,n=this.currentLevel,s=n?n.attrs["PATHWAY-ID"]:void 0,a=t[e],u=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,r===e&&n&&s===u)return;this.log(`Switching to level ${e} (${a.height?a.height+"p ":""}${a.videoRange?a.videoRange+" ":""}${a.codecSet?a.codecSet+" ":""}@${a.bitrate})${u?" with Pathway "+u:""} from level ${r}${s?" with Pathway "+s:""}`);const f={level:e,attrs:a.attrs,details:a.details,bitrate:a.bitrate,averageBitrate:a.averageBitrate,maxBitrate:a.maxBitrate,realBitrate:a.realBitrate,width:a.width,height:a.height,codecSet:a.codecSet,audioCodec:a.audioCodec,videoCodec:a.videoCodec,audioGroups:a.audioGroups,subtitleGroups:a.subtitleGroups,loaded:a.loaded,loadError:a.loadError,fragmentError:a.fragmentError,name:a.name,id:a.id,uri:a.uri,url:a.url,urlId:0,audioGroupIds:a.audioGroupIds,textGroupIds:a.textGroupIds};this.hls.trigger(M.LEVEL_SWITCHING,f);const c=a.details;if(!c||c.live){const d=this.switchParams(a.uri,n?.details,c);this.loadPlaylist(d)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),r=e.filter(n=>t.indexOf(n)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=r}}onError(e,t){t.fatal||!t.context||t.context.type===dt.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===Xe.MAIN){const r=t.elementaryStreams;if(!Object.keys(r).some(s=>!!r[s]))return;const n=this._levels[t.level];n!=null&&n.loadError&&(this.log(`Resetting level error count of ${n.loadError} on frag buffered`),n.loadError=0)}}onLevelLoaded(e,t){var r;const{level:n,details:s}=t,a=t.levelInfo;if(!a){var u;this.warn(`Invalid level index ${n}`),(u=t.deliveryDirectives)!=null&&u.skip&&(s.deltaUpdateFailed=!0);return}if(a===this.currentLevel||t.withoutMultiVariant){a.fragmentError===0&&(a.loadError=0);let f=a.details;f===t.details&&f.advanced&&(f=void 0),this.playlistLoaded(n,t,f)}else(r=t.deliveryDirectives)!=null&&r.skip&&(s.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=this.getUrlWithDirectives(e.uri,t),n=this.currentLevelIndex,s=e.attrs["PATHWAY-ID"],a=e.details,u=a?.age;this.log(`Loading level index ${n}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${s?" Pathway "+s:""}${u&&a.live?" age "+u.toFixed(1)+(a.type&&" "+a.type||""):""} ${r}`),this.hls.trigger(M.LEVEL_LOADING,{url:r,level:n,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const r=this._levels.filter((s,a)=>a!==e?!0:(this.steering&&this.steering.removeLevel(s),s===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,s.details&&s.details.fragments.forEach(u=>u.level=-1)),!1));uA(r),this._levels=r,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const n=r.length-1;this._firstLevel=Math.min(this._firstLevel,n),this._startLevel&&(this._startLevel=Math.min(this._startLevel,n)),this.hls.trigger(M.LEVELS_UPDATED,{levels:r})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:r}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(M.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:r}))}}function IT(l){const e={};l.forEach(t=>{const r=t.groupId||"";t.id=e[r]=e[r]||0,e[r]++})}function n1(){return self.SourceBuffer||self.WebKitSourceBuffer}function s1(){if(!as())return!1;const e=n1();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function fN(){if(!s1())return!1;const l=as();return typeof l?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>l.isTypeSupported(el(e,"video")))||["mp4a.40.2","fLaC"].some(e=>l.isTypeSupported(el(e,"audio"))))}function hN(){var l;const e=n1();return typeof(e==null||(l=e.prototype)==null?void 0:l.changeType)=="function"}const dN=100;class pN extends Bm{constructor(e,t,r){super(e,t,r,"stream-controller",Xe.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const n=this.media,s=n?n.currentTime:null;if(s===null||!Ye(s)||(this.log(`Media seeked to ${s.toFixed(3)}`),!this.getBufferedFrag(s)))return;const a=this.getFwdBufferInfoAtPos(n,s,Xe.MAIN,0);if(a===null||a.len===0){this.warn(`Main forward buffer length at ${s} on "seeked" event ${a?a.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(M.MANIFEST_PARSED,this.onManifestParsed,this),e.on(M.LEVEL_LOADING,this.onLevelLoading,this),e.on(M.LEVEL_LOADED,this.onLevelLoaded,this),e.on(M.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(M.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(M.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(M.BUFFER_CREATED,this.onBufferCreated,this),e.on(M.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(M.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(M.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(M.MANIFEST_PARSED,this.onManifestParsed,this),e.off(M.LEVEL_LOADED,this.onLevelLoaded,this),e.off(M.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(M.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(M.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(M.BUFFER_CREATED,this.onBufferCreated,this),e.off(M.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(M.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(M.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:r,hls:n}=this;if(this.stopLoad(),this.setInterval(dN),this.level=-1,!this.startFragRequested){let s=n.startLevel;s===-1&&(n.config.testBandwidth&&this.levels.length>1?(s=0,this.bitrateTest=!0):s=n.firstAutoLevel),n.nextLoadLevel=s,this.level=n.loadLevel,this._hasEnoughToStart=!!t}r>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${r.toFixed(3)}`),e=r),this.state=$e.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=$e.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case $e.WAITING_LEVEL:{const{levels:e,level:t}=this,r=e?.[t],n=r?.details;if(n&&(!n.live||this.levelLastLoaded===r&&!this.waitForLive(r))){if(this.waitForCdnTuneIn(n))break;this.state=$e.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=$e.IDLE;break}break}case $e.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===$e.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:r,media:n}=this;if(t===null||!n&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const s=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(r!=null&&r[s]))return;const a=r[s],u=this.getMainFwdBufferInfo();if(u===null)return;const f=this.getLevelDetails();if(f&&this._streamEnded(u,f)){const b={};this.altAudio===2&&(b.type="video"),this.hls.trigger(M.BUFFER_EOS,b),this.state=$e.ENDED;return}if(!this.buffering)return;e.loadLevel!==s&&e.manualLevel===-1&&this.log(`Adapting to level ${s} from level ${this.level}`),this.level=e.nextLoadLevel=s;const c=a.details;if(!c||this.state===$e.WAITING_LEVEL||this.waitForLive(a)){this.level=s,this.state=$e.WAITING_LEVEL,this.startFragRequested=!1;return}const d=u.len,p=this.getMaxBufferLength(a.maxBitrate);if(d>=p)return;this.backtrackFragment&&this.backtrackFragment.start>u.end&&(this.backtrackFragment=null);const m=this.backtrackFragment?this.backtrackFragment.start:u.end;let v=this.getNextFragment(m,c);if(this.couldBacktrack&&!this.fragPrevious&&v&&Xt(v)&&this.fragmentTracker.getState(v)!==or.OK){var y;const E=((y=this.backtrackFragment)!=null?y:v).sn-c.startSN,x=c.fragments[E-1];x&&v.cc===x.cc&&(v=x,this.fragmentTracker.removeFragment(x))}else this.backtrackFragment&&u.len&&(this.backtrackFragment=null);if(v&&this.isLoopLoading(v,m)){if(!v.gap){const E=this.audioOnly&&!this.altAudio?Ot.AUDIO:Ot.VIDEO,x=(E===Ot.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;x&&this.afterBufferFlushed(x,E,Xe.MAIN)}v=this.getNextFragmentLoopLoading(v,c,u,Xe.MAIN,p)}v&&(v.initSegment&&!v.initSegment.data&&!this.bitrateTest&&(v=v.initSegment),this.loadFragment(v,a,m))}loadFragment(e,t,r){const n=this.fragmentTracker.getState(e);n===or.NOT_LOADED||n===or.PARTIAL?Xt(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,r):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,Xe.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let r;const n=this.getAppendedFrag(t.currentTime);n&&n.start>1&&this.flushMainBuffer(0,n.start-1);const s=this.getLevelDetails();if(s!=null&&s.live){const u=this.getMainFwdBufferInfo();if(!u||u.len<s.targetduration*2)return}if(!t.paused&&e){const u=this.hls.nextLoadLevel,f=e[u],c=this.fragLastKbps;c&&this.fragCurrent?r=this.fragCurrent.duration*f.maxBitrate/(1e3*c)+1:r=0}else r=0;const a=this.getBufferedFrag(t.currentTime+r);if(a){const u=this.followingBufferedFrag(a);if(u){this.abortCurrentFrag();const f=u.maxStartPTS?u.maxStartPTS:u.start,c=u.duration,d=Math.max(a.end,f+Math.min(Math.max(c-this.config.maxFragLookUpTolerance,c*(this.couldBacktrack?.5:.125)),c*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(d,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case $e.KEY_LOADING:case $e.FRAG_LOADING:case $e.FRAG_LOADING_WAITING_RETRY:case $e.PARSING:case $e.PARSED:this.state=$e.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const r=t.media;Lr(r,"playing",this.onMediaPlaying),Lr(r,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:r}=this;r&&(Hr(r,"playing",this.onMediaPlaying),Hr(r,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(M.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let r=!1,n=!1;for(let s=0;s<t.levels.length;s++){const a=t.levels[s].audioCodec;a&&(r=r||a.indexOf("mp4a.40.2")!==-1,n=n||a.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=r&&n&&!hN(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:r}=this;if(!r||this.state!==$e.IDLE)return;const n=t.levelInfo;(!n.details||n.details.live&&(this.levelLastLoaded!==n||n.details.expired)||this.waitForCdnTuneIn(n.details))&&(this.state=$e.WAITING_LEVEL)}onLevelLoaded(e,t){var r;const{levels:n,startFragRequested:s}=this,a=t.level,u=t.details,f=u.totalduration;if(!n){this.warn(`Levels were reset while loading level ${a}`);return}this.log(`Level ${a} loaded [${u.startSN},${u.endSN}]${u.lastPartSn?`[part-${u.lastPartSn}-${u.lastPartIndex}]`:""}, cc [${u.startCC}, ${u.endCC}] duration:${f}`);const c=t.levelInfo,d=this.fragCurrent;d&&(this.state===$e.FRAG_LOADING||this.state===$e.FRAG_LOADING_WAITING_RETRY)&&d.level!==t.level&&d.loader&&this.abortCurrentFrag();let p=0;if(u.live||(r=c.details)!=null&&r.live){var m;if(this.checkLiveUpdate(u),u.deltaUpdateFailed)return;p=this.alignPlaylists(u,c.details,(m=this.levelLastLoaded)==null?void 0:m.details)}if(c.details=u,this.levelLastLoaded=c,s||this.setStartPosition(u,p),this.hls.trigger(M.LEVEL_UPDATED,{details:u,level:a}),this.state===$e.WAITING_LEVEL){if(this.waitForCdnTuneIn(u))return;this.state=$e.IDLE}s&&u.live&&this.synchronizeToLiveEdge(u),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:r}=this;if(!r)return;const n=this.hls.liveSyncPosition,s=this.getLoadPosition(),a=e.fragmentStart,u=e.edge,f=s>=a-t.maxFragLookUpTolerance&&s<=u;if(n!==null&&r.duration>n&&(s<n||!f)){const d=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!f&&r.readyState<4||s<u-d)&&(this._hasEnoughToStart||(this.nextLoadPosition=n),r.readyState))if(this.warn(`Playback: ${s.toFixed(3)} is located too far from the end of live sliding playlist: ${u}, reset currentTime to : ${n.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var c;const p=ot.bufferInfo(r,n,0);if(!((c=p.buffered)!=null&&c.length)){r.currentTime=n;return}if(p.start<=s){r.currentTime=n;return}const{nextStart:v}=ot.bufferedInfo(p.buffered,s,0);v&&(r.currentTime=v)}else r.currentTime=n}}_handleFragmentLoadProgress(e){var t;const r=e.frag,{part:n,payload:s}=e,{levels:a}=this;if(!a){this.warn(`Levels were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const u=a[r.level];if(!u){this.warn(`Level ${r.level} not found on progress`);return}const f=u.details;if(!f){this.warn(`Dropping fragment ${r.sn} of level ${r.level} after level details were reset`),this.fragmentTracker.removeFragment(r);return}const c=u.videoCodec,d=f.PTSKnown||!f.live,p=(t=r.initSegment)==null?void 0:t.data,m=this._getAudioCodec(u),v=this.transmuxer=this.transmuxer||new DA(this.hls,Xe.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),y=n?n.index:-1,b=y!==-1,E=new Pm(r.level,r.sn,r.stats.chunkCount,s.byteLength,y,b),x=this.initPTS[r.cc];v.push(s,p,m,c,r,n,f.totalduration,d,E,x)}onAudioTrackSwitching(e,t){const r=this.hls,n=this.altAudio!==0;if(Cc(t.url,r))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests(),this.fragmentTracker.removeFragment(a)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(n){this.altAudio=0,this.fragmentTracker.removeAllFragments(),r.once(M.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(M.AUDIO_TRACK_SWITCHED,t)}),r.trigger(M.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}r.trigger(M.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const r=Cc(t.url,this.hls);if(r){const n=this.videoBuffer;n&&this.mediaBuffer!==n&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=n)}this.altAudio=r?2:0,this.tick()}onBufferCreated(e,t){const r=t.tracks;let n,s,a=!1;for(const u in r){const f=r[u];if(f.id==="main"){if(s=u,n=f,u==="video"){const c=r[u];c&&(this.videoBuffer=c.buffer)}}else a=!0}a&&n?(this.log(`Alternate track found, use ${s}.buffered to schedule main fragment loading`),this.mediaBuffer=n.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:r,part:n}=t,s=r.type===Xe.MAIN;if(s){if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${n?" p: "+n.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}`),this.state===$e.PARSED&&(this.state=$e.IDLE);return}const u=n?n.stats:r.stats;this.fragLastKbps=Math.round(8*u.total/(u.buffering.end-u.loading.first)),Xt(r)&&(this.fragPrevious=r),this.fragBufferedComplete(r,n)}const a=this.media;a&&(!this._hasEnoughToStart&&ot.getBuffered(a).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),s&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var r;if(t.fatal){this.state=$e.ERROR;return}switch(t.details){case Se.FRAG_GAP:case Se.FRAG_PARSING_ERROR:case Se.FRAG_DECRYPT_ERROR:case Se.FRAG_LOAD_ERROR:case Se.FRAG_LOAD_TIMEOUT:case Se.KEY_LOAD_ERROR:case Se.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Xe.MAIN,t);break;case Se.LEVEL_LOAD_ERROR:case Se.LEVEL_LOAD_TIMEOUT:case Se.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===$e.WAITING_LEVEL&&((r=t.context)==null?void 0:r.type)===dt.LEVEL&&(this.state=$e.IDLE);break;case Se.BUFFER_ADD_CODEC_ERROR:case Se.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case Se.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case Se.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=$e.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==Ot.AUDIO||!this.altAudio){const r=(t===Ot.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;r&&(this.afterBufferFlushed(r,t,Xe.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let r=this.startPosition;if(r>=0&&t<r){if(e.seeking){this.log(`could not seek to ${r}, already seeking at ${t}`);return}const n=this.timelineOffset;n&&r&&(r+=n);const s=this.getLevelDetails(),a=ot.getBuffered(e),u=a.length?a.start(0):0,f=u-r,c=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||f>0&&(f<c||this.loadingParts&&f<2*(s?.partTarget||0)))&&(this.log(`adjusting start position by ${f} to match buffer start`),r+=f,this.startPosition=r),t<r&&(this.log(`seek to target start position ${r} from current time ${t} buffer start ${u}`),e.currentTime=r)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(r=>{const{hls:n}=this,s=r?.frag;if(!s||this.fragContextChanged(s))return;t.fragmentError=0,this.state=$e.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const a=s.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),n.trigger(M.FRAG_LOADED,r),s.bitrateTest=!1}).catch(r=>{this.state===$e.STOPPED||this.state===$e.ERROR||(this.warn(r),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:r}=this,{remuxResult:n,chunkMeta:s}=e,a=this.getCurrentContext(s);if(!a){this.resetWhenMissingContext(s);return}const{frag:u,part:f,level:c}=a,{video:d,text:p,id3:m,initSegment:v}=n,{details:y}=c,b=this.altAudio?void 0:n.audio;if(this.fragContextChanged(u)){this.fragmentTracker.removeFragment(u);return}if(this.state=$e.PARSING,v){const E=v.tracks;if(E){const L=u.initSegment||u;if(this.unhandledEncryptionError(v,u))return;this._bufferInitSegment(c,E,L,s),r.trigger(M.FRAG_PARSING_INIT_SEGMENT,{frag:L,id:t,tracks:E})}const x=v.initPTS,T=v.timescale,A=this.initPTS[u.cc];if(Ye(x)&&(!A||A.baseTime!==x||A.timescale!==T)){const L=v.trackId;this.initPTS[u.cc]={baseTime:x,timescale:T,trackId:L},r.trigger(M.INIT_PTS_FOUND,{frag:u,id:t,initPTS:x,timescale:T,trackId:L})}}if(d&&y){b&&d.type==="audiovideo"&&this.logMuxedErr(u);const E=y.fragments[u.sn-1-y.startSN],x=u.sn===y.startSN,T=!E||u.cc>E.cc;if(n.independent!==!1){const{startPTS:A,endPTS:L,startDTS:w,endDTS:C}=d;if(f)f.elementaryStreams[d.type]={startPTS:A,endPTS:L,startDTS:w,endDTS:C};else if(d.firstKeyFrame&&d.independent&&s.id===1&&!T&&(this.couldBacktrack=!0),d.dropped&&d.independent){const I=this.getMainFwdBufferInfo(),O=(I?I.end:this.getLoadPosition())+this.config.maxBufferHole,B=d.firstKeyFramePTS?d.firstKeyFramePTS:A;if(!x&&O<B-this.config.maxBufferHole&&!T){this.backtrack(u);return}else T&&(u.gap=!0);u.setElementaryStreamInfo(d.type,u.start,L,u.start,C,!0)}else x&&A-(y.appliedTimelineOffset||0)>Tc&&(u.gap=!0);u.setElementaryStreamInfo(d.type,A,L,w,C),this.backtrackFragment&&(this.backtrackFragment=u),this.bufferFragmentData(d,u,f,s,x||T)}else if(x||T)u.gap=!0;else{this.backtrack(u);return}}if(b){const{startPTS:E,endPTS:x,startDTS:T,endDTS:A}=b;f&&(f.elementaryStreams[Ot.AUDIO]={startPTS:E,endPTS:x,startDTS:T,endDTS:A}),u.setElementaryStreamInfo(Ot.AUDIO,E,x,T,A),this.bufferFragmentData(b,u,f,s)}if(y&&m!=null&&m.samples.length){const E={id:t,frag:u,details:y,samples:m.samples};r.trigger(M.FRAG_PARSING_METADATA,E)}if(y&&p){const E={id:t,frag:u,details:y,samples:p.samples};r.trigger(M.FRAG_PARSING_USERDATA,E)}}logMuxedErr(e){this.warn(`${Xt(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,r,n){if(this.state!==$e.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(r));const{audio:s,video:a,audiovideo:u}=t;if(s){const c=e.audioCodec;let d=gc(s.codec,c);d==="mp4a"&&(d="mp4a.40.5");const p=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){d&&(d.indexOf("mp4a.40.5")!==-1?d="mp4a.40.2":d="mp4a.40.5");const m=s.metadata;m&&"channelCount"in m&&(m.channelCount||1)!==1&&p.indexOf("firefox")===-1&&(d="mp4a.40.5")}d&&d.indexOf("mp4a.40.5")!==-1&&p.indexOf("android")!==-1&&s.container!=="audio/mpeg"&&(d="mp4a.40.2",this.log(`Android: force audio codec to ${d}`)),c&&c!==d&&this.log(`Swapping manifest audio codec "${c}" for "${d}"`),s.levelCodec=d,s.id=Xe.MAIN,this.log(`Init audio buffer, container:${s.container}, codecs[selected/level/parsed]=[${d||""}/${c||""}/${s.codec}]`),delete t.audiovideo}if(a){a.levelCodec=e.videoCodec,a.id=Xe.MAIN;const c=a.codec;if(c?.length===4)switch(c){case"hvc1":case"hev1":a.codec="hvc1.1.6.L120.90";break;case"av01":a.codec="av01.0.04M.08";break;case"avc1":a.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${c}]${a.codec!==c?" parsed-corrected="+a.codec:""}${a.supplemental?" supplemental="+a.supplemental:""}`),delete t.audiovideo}u&&(this.log(`Init audiovideo buffer, container:${u.container}, codecs[level/parsed]=[${e.codecs}/${u.codec}]`),delete t.video,delete t.audio);const f=Object.keys(t);if(f.length){if(this.hls.trigger(M.BUFFER_CODECS,t),!this.hls)return;f.forEach(c=>{const p=t[c].initSegment;p!=null&&p.byteLength&&this.hls.trigger(M.BUFFER_APPENDING,{type:c,data:p,frag:r,part:null,chunkMeta:n,parent:r.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,Xe.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,r=e?.[t];return r?this.getMaxBufferLength(r.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=$e.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const r=e.currentTime;if(ot.isBuffered(e,r)?t=this.getAppendedFrag(r):ot.isBuffered(e,r+.1)&&(t=this.getAppendedFrag(r+.1)),t){this.backtrackFragment=null;const n=this.fragPlaying,s=t.level;(!n||t.sn!==n.sn||n.level!==s)&&(this.fragPlaying=t,this.hls.trigger(M.FRAG_CHANGED,{frag:t}),(!n||n.level!==s)&&this.hls.trigger(M.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return Ye(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(Ye(t)){const r=this.getLevelDetails(),n=this.currentFrag||(r?Ns(null,r.fragments,t):null);if(n){const s=n.programDateTime;if(s!==null){const a=s+(t-n.start)*1e3;return new Date(a)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class gN extends vi{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const r in this.keyIdToKeyInfo){const n=this.keyIdToKeyInfo[r].loader;if(n){var t;if(e&&e!==((t=n.context)==null?void 0:t.frag.type))return;n.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=Se.KEY_LOAD_ERROR,r,n,s){return new pn({type:tt.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:s,error:r,networkDetails:n})}loadClear(e,t,r){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let n=0,s=t.length;n<s;n++){const a=t[n];if(e.cc<=a.cc&&(!Xt(e)||!Xt(a)||e.sn<a.sn)||!r&&n==s-1)return this.emeController.selectKeySystemFormat(a).then(u=>{if(!this.emeController)return;a.setKeyFormat(u);const f=yc(u);if(f)return this.emeController.getKeySystemAccess([f])})}if(this.config.requireKeySystemAccessOnStart){const n=Vo(this.config);if(n.length)return this.emeController.getKeySystemAccess(n)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var r,n;t&&e.setKeyFormat(t);const s=e.decryptdata;if(!s){const c=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,Se.KEY_LOAD_ERROR,c))}const a=s.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,Se.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${a}"`)));const u=Fd(s);let f=this.keyIdToKeyInfo[u];if((r=f)!=null&&r.decryptdata.key)return s.key=f.decryptdata.key,Promise.resolve({frag:e,keyInfo:f});if(this.emeController&&(n=f)!=null&&n.keyLoadPromise)switch(this.emeController.getKeyStatus(f.decryptdata)){case"usable":case"usable-in-future":return f.keyLoadPromise.then(d=>{const{keyInfo:p}=d;return s.key=p.decryptdata.key,{frag:e,keyInfo:p}})}switch(this.log(`${this.keyIdToKeyInfo[u]?"Rel":"L"}oading${s.keyId?" keyId: "+vr(s.keyId):""} URI: ${s.uri} from ${e.type} ${e.level}`),f=this.keyIdToKeyInfo[u]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return s.keyFormat==="identity"?this.loadKeyHTTP(f,e):this.loadKeyEME(f,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(f,e);default:return Promise.reject(this.createKeyLoadError(e,Se.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${s.method}"`)))}}loadKeyEME(e,t){const r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var n;if(!e.decryptdata.keyId&&(n=t.initSegment)!=null&&n.data){const a=MD(t.initSegment.data);if(a.length){let u=a[0];u.some(f=>f!==0)?(this.log(`Using keyId found in init segment ${vr(u)}`),ss.setKeyIdForUri(e.decryptdata.uri,u)):(u=ss.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${vr(u)}`)),e.decryptdata.keyId=u}}if(!e.decryptdata.keyId&&!Xt(t))return Promise.resolve(r);const s=this.emeController.loadKey(r);return(e.keyLoadPromise=s.then(a=>(e.mediaKeySessionContext=a,r))).catch(a=>{throw e.keyLoadPromise=null,"data"in a&&(a.data.frag=t),a})}return Promise.resolve(r)}loadKeyHTTP(e,t){const r=this.config,n=r.loader,s=new n(r);return t.keyLoader=e.loader=s,e.keyLoadPromise=new Promise((a,u)=>{const f={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},c=r.keyLoadPolicy.default,d={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(m,v,y,b)=>{const{frag:E,keyInfo:x}=y,T=Fd(x.decryptdata);if(!E.decryptdata||x!==this.keyIdToKeyInfo[T])return u(this.createKeyLoadError(E,Se.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),b));x.decryptdata.key=E.decryptdata.key=new Uint8Array(m.data),E.keyLoader=null,x.loader=null,a({frag:E,keyInfo:x})},onError:(m,v,y,b)=>{this.resetLoader(v),u(this.createKeyLoadError(t,Se.KEY_LOAD_ERROR,new Error(`HTTP Error ${m.code} loading key ${m.text}`),y,_t({url:f.url,data:void 0},m)))},onTimeout:(m,v,y)=>{this.resetLoader(v),u(this.createKeyLoadError(t,Se.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),y))},onAbort:(m,v,y)=>{this.resetLoader(v),u(this.createKeyLoadError(t,Se.INTERNAL_ABORTED,new Error("key loading aborted"),y))}};s.load(f,d,p)})}resetLoader(e){const{frag:t,keyInfo:r,url:n}=e,s=r.loader;t.keyLoader===s&&(t.keyLoader=null,r.loader=null);const a=Fd(r.decryptdata)||n;delete this.keyIdToKeyInfo[a],s&&s.destroy()}}function Fd(l){if(l.keyFormat!==br.FAIRPLAY){const e=l.keyId;if(e)return vr(e)}return l.uri}function LT(l){const{type:e}=l;switch(e){case dt.AUDIO_TRACK:return Xe.AUDIO;case dt.SUBTITLE_TRACK:return Xe.SUBTITLE;default:return Xe.MAIN}}function jd(l,e){let t=l.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class mN{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(M.MANIFEST_LOADING,this.onManifestLoading,this),e.on(M.LEVEL_LOADING,this.onLevelLoading,this),e.on(M.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(M.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(M.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(M.MANIFEST_LOADING,this.onManifestLoading,this),e.off(M.LEVEL_LOADING,this.onLevelLoading,this),e.off(M.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(M.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(M.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,r=t.pLoader,n=t.loader,s=r||n,a=new s(t);return this.loaders[e.type]=a,a}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:r}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:dt.MANIFEST,url:r,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:r,level:n,pathwayId:s,url:a,deliveryDirectives:u,levelInfo:f}=t;this.load({id:r,level:n,pathwayId:s,responseType:"text",type:dt.LEVEL,url:a,deliveryDirectives:u,levelOrTrack:f})}onAudioTrackLoading(e,t){const{id:r,groupId:n,url:s,deliveryDirectives:a,track:u}=t;this.load({id:r,groupId:n,level:null,responseType:"text",type:dt.AUDIO_TRACK,url:s,deliveryDirectives:a,levelOrTrack:u})}onSubtitleTrackLoading(e,t){const{id:r,groupId:n,url:s,deliveryDirectives:a,track:u}=t;this.load({id:r,groupId:n,level:null,responseType:"text",type:dt.SUBTITLE_TRACK,url:s,deliveryDirectives:a,levelOrTrack:u})}onLevelsUpdated(e,t){const r=this.loaders[dt.LEVEL];if(r){const n=r.context;n&&!t.levels.some(s=>s===n.levelOrTrack)&&(r.abort(),delete this.loaders[dt.LEVEL])}}load(e){var t;const r=this.hls.config;let n=this.getInternalLoader(e);if(n){const c=this.hls.logger,d=n.context;if(d&&d.levelOrTrack===e.levelOrTrack&&(d.url===e.url||d.deliveryDirectives&&!e.deliveryDirectives)){d.url===e.url?c.log(`[playlist-loader]: ignore ${e.url} ongoing request`):c.log(`[playlist-loader]: ignore ${e.url} in favor of ${d.url}`);return}c.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),n.abort()}let s;if(e.type===dt.MANIFEST?s=r.manifestLoadPolicy.default:s=Lt({},r.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),n=this.createInternalLoader(e),Ye((t=e.deliveryDirectives)==null?void 0:t.part)){let c;if(e.type===dt.LEVEL&&e.level!==null?c=this.hls.levels[e.level].details:e.type===dt.AUDIO_TRACK&&e.id!==null?c=this.hls.audioTracks[e.id].details:e.type===dt.SUBTITLE_TRACK&&e.id!==null&&(c=this.hls.subtitleTracks[e.id].details),c){const d=c.partTarget,p=c.targetduration;if(d&&p){const m=Math.max(d*3,p*.8)*1e3;s=Lt({},s,{maxTimeToFirstByteMs:Math.min(m,s.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(m,s.maxTimeToFirstByteMs)})}}}const a=s.errorRetry||s.timeoutRetry||{},u={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},f={onSuccess:(c,d,p,m)=>{const v=this.getInternalLoader(p);this.resetInternalLoader(p.type);const y=c.data;d.parsing.start=performance.now(),Bi.isMediaPlaylist(y)||p.type!==dt.MANIFEST?this.handleTrackOrLevelPlaylist(c,d,p,m||null,v):this.handleMasterPlaylist(c,d,p,m)},onError:(c,d,p,m)=>{this.handleNetworkError(d,p,!1,c,m)},onTimeout:(c,d,p)=>{this.handleNetworkError(d,p,!0,void 0,c)}};n.load(e,u,f)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:r}=this.hls;(e||r)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,r,n){const s=this.hls,a=e.data,u=jd(e,r),f=Bi.parseMasterPlaylist(a,u);if(f.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,r,f.playlistParsingError,n,t);return}const{contentSteering:c,levels:d,sessionData:p,sessionKeys:m,startTimeOffset:v,variableList:y}=f;this.variableList=y,d.forEach(T=>{const{unknownCodecs:A}=T;if(A){const{preferManagedMediaSource:L}=this.hls.config;let{audioCodec:w,videoCodec:C}=T;for(let I=A.length;I--;){const O=A[I];Jo(O,"audio",L)?(T.audioCodec=w=w?`${w},${O}`:O,ja.audio[w.substring(0,4)]=2,A.splice(I,1)):Jo(O,"video",L)&&(T.videoCodec=C=C?`${C},${O}`:O,ja.video[C.substring(0,4)]=2,A.splice(I,1))}}});const{AUDIO:b=[],SUBTITLES:E,"CLOSED-CAPTIONS":x}=Bi.parseMasterPlaylistMedia(a,u,f);b.length&&!b.some(A=>!A.url)&&d[0].audioCodec&&!d[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),b.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new $t({}),bitrate:0,url:""})),s.trigger(M.MANIFEST_LOADED,{levels:d,audioTracks:b,subtitles:E,captions:x,contentSteering:c,url:u,stats:t,networkDetails:n,sessionData:p,sessionKeys:m,startTimeOffset:v,variableList:y})}handleTrackOrLevelPlaylist(e,t,r,n,s){const a=this.hls,{id:u,level:f,type:c}=r,d=jd(e,r),p=Ye(f)?f:Ye(u)?u:0,m=LT(r),v=Bi.parseLevelPlaylist(e.data,d,p,m,0,this.variableList);if(c===dt.MANIFEST){const y={attrs:new $t({}),bitrate:0,details:v,name:"",url:d};v.requestScheduled=t.loading.start+aA(v,0),a.trigger(M.MANIFEST_LOADED,{levels:[y],audioTracks:[],url:d,stats:t,networkDetails:n,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=v,this.handlePlaylistLoaded(v,e,t,r,n,s)}handleManifestParsingError(e,t,r,n,s){this.hls.trigger(M.ERROR,{type:tt.NETWORK_ERROR,details:Se.MANIFEST_PARSING_ERROR,fatal:t.type===dt.MANIFEST,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:n,stats:s})}handleNetworkError(e,t,r=!1,n,s){let a=`A network ${r?"timeout":"error"+(n?" (status "+n.code+")":"")} occurred while loading ${e.type}`;e.type===dt.LEVEL?a+=`: ${e.level} id: ${e.id}`:(e.type===dt.AUDIO_TRACK||e.type===dt.SUBTITLE_TRACK)&&(a+=` id: ${e.id} group-id: "${e.groupId}"`);const u=new Error(a);this.hls.logger.warn(`[playlist-loader]: ${a}`);let f=Se.UNKNOWN,c=!1;const d=this.getInternalLoader(e);switch(e.type){case dt.MANIFEST:f=r?Se.MANIFEST_LOAD_TIMEOUT:Se.MANIFEST_LOAD_ERROR,c=!0;break;case dt.LEVEL:f=r?Se.LEVEL_LOAD_TIMEOUT:Se.LEVEL_LOAD_ERROR,c=!1;break;case dt.AUDIO_TRACK:f=r?Se.AUDIO_TRACK_LOAD_TIMEOUT:Se.AUDIO_TRACK_LOAD_ERROR,c=!1;break;case dt.SUBTITLE_TRACK:f=r?Se.SUBTITLE_TRACK_LOAD_TIMEOUT:Se.SUBTITLE_LOAD_ERROR,c=!1;break}d&&this.resetInternalLoader(e.type);const p={type:tt.NETWORK_ERROR,details:f,fatal:c,url:e.url,loader:d,context:e,error:u,networkDetails:t,stats:s};if(n){const m=t?.url||e.url;p.response=_t({url:m,data:void 0},n)}this.hls.trigger(M.ERROR,p)}handlePlaylistLoaded(e,t,r,n,s,a){const u=this.hls,{type:f,level:c,levelOrTrack:d,id:p,groupId:m,deliveryDirectives:v}=n,y=jd(t,n),b=LT(n);let E=typeof n.level=="number"&&b===Xe.MAIN?c:void 0;const x=e.playlistParsingError;if(x){if(this.hls.logger.warn(`${x} ${e.url}`),!u.config.ignorePlaylistParsingErrors){u.trigger(M.ERROR,{type:tt.NETWORK_ERROR,details:Se.LEVEL_PARSING_ERROR,fatal:!1,url:y,error:x,reason:x.message,response:t,context:n,level:E,parent:b,networkDetails:s,stats:r});return}e.playlistParsingError=null}if(!e.fragments.length){const T=e.playlistParsingError=new Error("No Segments found in Playlist");u.trigger(M.ERROR,{type:tt.NETWORK_ERROR,details:Se.LEVEL_EMPTY_ERROR,fatal:!1,url:y,error:T,reason:T.message,response:t,context:n,level:E,parent:b,networkDetails:s,stats:r});return}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),(!a.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),f){case dt.MANIFEST:case dt.LEVEL:if(E){if(!d)E=0;else if(d!==u.levels[E]){const T=u.levels.indexOf(d);T>-1&&(E=T)}}u.trigger(M.LEVEL_LOADED,{details:e,levelInfo:d||u.levels[0],level:E||0,id:p||0,stats:r,networkDetails:s,deliveryDirectives:v,withoutMultiVariant:f===dt.MANIFEST});break;case dt.AUDIO_TRACK:u.trigger(M.AUDIO_TRACK_LOADED,{details:e,track:d,id:p||0,groupId:m||"",stats:r,networkDetails:s,deliveryDirectives:v});break;case dt.SUBTITLE_TRACK:u.trigger(M.SUBTITLE_TRACK_LOADED,{details:e,track:d,id:p||0,groupId:m||"",stats:r,networkDetails:s,deliveryDirectives:v});break}}}class ni{static get version(){return rl}static isMSESupported(){return s1()}static isSupported(){return fN()}static getMediaSource(){return as()}static get Events(){return M}static get MetadataSchema(){return ii}static get ErrorTypes(){return tt}static get ErrorDetails(){return Se}static get DefaultConfig(){return ni.defaultConfig?ni.defaultConfig:JP}static set DefaultConfig(e){ni.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Fm,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=TD(e.debug||!1,"Hls instance",e.assetPlayerId),r=this.config=tN(ni.DefaultConfig,e,t);this.userConfig=e,r.progressive&&rN(r,t);const{abrController:n,bufferController:s,capLevelController:a,errorController:u,fpsController:f}=r,c=new u(this),d=this.abrController=new n(this),p=new yO(this),m=r.interstitialsController,v=m?this.interstitialsController=new m(this,ni):null,y=this.bufferController=new s(this,p),b=this.capLevelController=new a(this),E=new f(this),x=new mN(this),T=r.contentSteeringController,A=T?new T(this):null,L=this.levelController=new cN(this,A),w=new lN(this),C=new gN(this.config,this.logger),I=this.streamController=new pN(this,p,C),O=this.gapController=new aN(this,p);b.setStreamController(I),E.setStreamController(I);const B=[x,L,I];v&&B.splice(1,0,v),A&&B.splice(1,0,A),this.networkControllers=B;const P=[d,y,O,b,E,w,p];this.audioTrackController=this.createController(r.audioTrackController,B);const $=r.audioStreamController;$&&B.push(this.audioStreamController=new $(this,p,C)),this.subtitleTrackController=this.createController(r.subtitleTrackController,B);const F=r.subtitleStreamController;F&&B.push(this.subtititleStreamController=new F(this,p,C)),this.createController(r.timelineController,P),C.emeController=this.emeController=this.createController(r.emeController,P),this.cmcdController=this.createController(r.cmcdController,P),this.latencyController=this.createController(uN,P),this.coreComponents=P,B.push(c);const Z=c.onErrorOut;typeof Z=="function"&&this.on(M.ERROR,Z,c),this.on(M.MANIFEST_LOADED,x.onManifestLoaded,x)}createController(e,t){if(e){const r=new e(this);return t&&t.push(r),r}return null}on(e,t,r=this){this._emitter.on(e,t,r)}once(e,t,r=this){this._emitter.once(e,t,r)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,r=this,n){this._emitter.off(e,t,r,n)}listeners(e){return this._emitter.listeners(e)}emit(e,t,r){return this._emitter.emit(e,t,r)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(r){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+r.message+'". Here is a stacktrace:',r),!this.triggeringException){this.triggeringException=!0;const n=e===M.ERROR;this.trigger(M.ERROR,{type:tt.OTHER_ERROR,details:Se.INTERNAL_EXCEPTION,fatal:n,event:e,error:r}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(M.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const s=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(M.ERROR,{type:tt.OTHER_ERROR,details:Se.ATTACH_MEDIA_ERROR,fatal:!0,error:s});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,r=t?e.media:e,n=t?e:{media:r};this._media=r,this.trigger(M.MEDIA_ATTACHING,n)}detachMedia(){this.logger.log("detachMedia"),this.trigger(M.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(M.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,r=this._url,n=this._url=Im.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${n}`),t&&r&&(r!==n||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(M.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let r=0;r<this.networkControllers.length&&(this.networkControllers[r].startLoad(e,t),!(!this.started||!this.networkControllers));r++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[Xe.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[Xe.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[Xe.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e?.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=aP()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){tO(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const r=e.length;for(let n=0;n<r;n++)if(e[n].maxBitrate>=t)return n;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:r}=this;let n;if(t===-1&&e!=null&&e.length?n=e.length-1:n=t,r)for(let s=n;s--;){const a=e[s].attrs["HDCP-LEVEL"];if(a&&a<=r)return s}return n}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const r=V_(t);return H_(e,r,navigator.mediaCapabilities)}}ni.defaultConfig=void 0;function ns({cameraId:l,title:e}){const t=Le.useRef(null),r=Le.useRef(null),[n,s]=Le.useState(null),[a,u]=Le.useState(!0),c={1:"https://www.tansaeng.com/live/tapo1.m3u8",2:"https://www.tansaeng.com/live/tapo2.m3u8",3:"https://www.tansaeng.com/live/tapo3.m3u8",4:"https://www.tansaeng.com/live/tapo4.m3u8"}[l];return Le.useEffect(()=>{const d=t.current;if(!d||!c){s(" URL  ."),u(!1);return}if(s(null),u(!0),ni.isSupported()){const p=new ni({liveBackBufferLength:0,liveSyncDurationCount:3,liveMaxLatencyDurationCount:5,enableWorker:!0,lowLatencyMode:!0});return r.current=p,p.loadSource(c),p.attachMedia(d),p.on(ni.Events.MANIFEST_PARSED,()=>{u(!1),d.play().catch(m=>{console.warn("Auto-play failed:",m),s("  ")})}),p.on(ni.Events.ERROR,(m,v)=>{if(console.error("HLS error:",v),v.fatal)switch(v.type){case ni.ErrorTypes.NETWORK_ERROR:s(" :    "),setTimeout(()=>{p.startLoad()},3e3);break;case ni.ErrorTypes.MEDIA_ERROR:s(" :     "),p.recoverMediaError();break;default:s(" :    "),p.destroy();break}}),()=>{p.destroy(),r.current=null}}else{if(d.canPlayType("application/vnd.apple.mpegurl"))return d.src=c,d.addEventListener("loadedmetadata",()=>{u(!1),d.play().catch(p=>{console.warn("Auto-play failed:",p),s("  ")})}),d.addEventListener("error",()=>{s("  ")}),()=>{d.src=""};s("  HLS   "),u(!1)}},[c]),V.jsxs("div",{className:"bg-white rounded-lg shadow-card overflow-hidden",children:[e&&V.jsx("div",{className:"bg-farm-500 px-4 py-2",children:V.jsx("h3",{className:"text-base font-semibold text-gray-900 m-0",children:e})}),V.jsxs("div",{className:"relative bg-black aspect-video",children:[V.jsx("video",{ref:t,className:"w-full h-full",controls:!0,autoPlay:!0,muted:!0,playsInline:!0}),a&&V.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50",children:V.jsxs("div",{className:"text-white text-center",children:[V.jsx("div",{className:"text-2xl mb-2",children:""}),V.jsx("div",{className:"text-sm",children:"  ..."})]})}),n&&V.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-70",children:V.jsxs("div",{className:"text-white text-center p-4",children:[V.jsx("div",{className:"text-3xl mb-2",children:""}),V.jsx("div",{className:"text-sm",children:n})]})})]}),V.jsx("div",{className:"px-4 py-2 bg-gray-50 border-t border-gray-200",children:V.jsxs("div",{className:"text-xs text-gray-500 truncate",title:c,children:[" ",c]})})]})}const $u="tansaeng_rpi_ip";function yN(){const[l,e]=Le.useState(""),[t,r]=Le.useState(null),[n,s]=Le.useState("");Le.useEffect(()=>{const d=localStorage.getItem($u);d&&r(d)},[]);const a=d=>/^(\d{1,3}\.){3}\d{1,3}$/.test(d)?d.split(".").every(v=>{const y=parseInt(v,10);return y>=0&&y<=255}):!1,u=()=>{const d=l.trim();if(console.log("[RpiIpSettings]   , :",d),!d){console.log("[RpiIpSettings]  "),s(" IP  ");return}if(!a(d)){console.log("[RpiIpSettings] IP  :",d),s("  IP    (: 192.168.1.100)");return}localStorage.setItem($u,d),console.log("[RpiIpSettings] localStorage  :",d),console.log("[RpiIpSettings]  :",localStorage.getItem($u)),r(d),e(""),s("  IP "),setTimeout(()=>s(""),3e3)},f=()=>{t&&window.confirm("  IP ?")&&(localStorage.removeItem($u),r(null),s("  IP "),setTimeout(()=>s(""),3e3))},c=d=>{d.key==="Enter"&&u()};return V.jsxs("div",{className:"mb-6 rounded-lg border border-slate-600 bg-slate-800 p-4",children:[V.jsx("h2",{className:"mb-3 text-lg font-semibold text-slate-100",children:"  IP "}),V.jsxs("div",{className:"mb-3 flex gap-2",children:[V.jsx("input",{type:"text",value:l,onChange:d=>e(d.target.value),onKeyPress:c,placeholder:": 192.168.219.170",className:"flex-1 rounded border border-slate-600 bg-slate-700 px-3 py-2 text-slate-100 placeholder-slate-400 focus:border-blue-500 focus:outline-none"}),V.jsx("button",{onClick:u,className:"rounded bg-blue-600 px-4 py-2 font-medium text-white transition hover:bg-blue-700",children:""})]}),n&&V.jsx("div",{className:`mb-3 rounded p-2 text-sm ${n.includes("")?"bg-red-900/30 text-red-300":n.includes("")?"bg-yellow-900/30 text-yellow-300":"bg-green-900/30 text-green-300"}`,children:n}),t&&V.jsxs("div",{className:"rounded border border-slate-600 bg-slate-700 p-3",children:[V.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[V.jsx("span",{className:"text-sm text-slate-400",children:"  IP:"}),V.jsx("button",{onClick:f,className:"rounded bg-red-600 px-3 py-1 text-sm font-medium text-white transition hover:bg-red-700",children:""})]}),V.jsx("div",{className:"rounded bg-slate-800 p-2 font-mono text-green-400",children:t}),V.jsx("div",{className:"mt-2 text-xs text-slate-400",children:"  IP HLS   "})]}),!t&&V.jsx("div",{className:"rounded border border-yellow-600/30 bg-yellow-900/20 p-3 text-sm text-yellow-300",children:"  IP  .    IP ."})]})}function vN(l){return V.jsxs("div",{className:"p-4",children:[V.jsx("h1",{className:"mb-4 text-2xl font-bold text-slate-100",children:"   "}),V.jsx(yN,{}),V.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[V.jsx(ns,{cameraId:1,title:"  1"}),V.jsx(ns,{cameraId:2,title:"  2"}),V.jsx(ns,{cameraId:3,title:"  3"}),V.jsx(ns,{cameraId:4,title:" "})]})]})}function bN({farmSettings:l,setFarmSettings:e}){const t="22ada06fd6cf4059bd700ddbf6004d68.s1.eu.hivemq.cloud",r="8884",n="esp32-client-01",s=a=>a==="fan"?{bg:"#dbeafe",text:"#1e40af"}:a==="vent"?{bg:"#d1fae5",text:"#065f46"}:a==="pump"?{bg:"#f3e8ff",text:"#6b21a8"}:a==="camera"?{bg:"#fed7aa",text:"#c2410c"}:{bg:"#f3f4f6",text:"#4b5563"};return V.jsx("div",{className:"bg-gray-50",children:V.jsxs("div",{className:"max-w-7xl mx-auto px-4",children:[V.jsxs("div",{className:"bg-gradient-to-r from-farm-500 to-farm-600 rounded-2xl px-6 py-4 mb-6",children:[V.jsx("h1",{className:"text-gray-900 font-bold text-2xl m-0",children:" "}),V.jsx("p",{className:"text-white/80 text-sm mt-1 m-0",children:"MQTT ,  ,    "})]}),V.jsxs("div",{className:"bg-white rounded-2xl shadow-card p-6 mb-6",children:[V.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:"MQTT   ( )"}),V.jsxs("div",{className:"grid grid-cols-[repeat(auto-fit,minmax(250px,1fr))] gap-4",children:[V.jsxs("div",{children:[V.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"HiveMQ Cloud Host"}),V.jsx("div",{className:"px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg text-gray-700",children:t})]}),V.jsxs("div",{children:[V.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"WebSocket Port"}),V.jsx("div",{className:"px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg text-gray-700",children:r})]}),V.jsxs("div",{children:[V.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Username"}),V.jsx("div",{className:"px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg text-gray-700",children:n})]}),V.jsxs("div",{children:[V.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Password"}),V.jsx("div",{className:"px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg text-gray-700",children:""})]})]}),V.jsx("p",{className:"text-sm text-gray-500 mt-4 mb-0",children:"MQTT   .env  ."})]}),V.jsxs("div",{className:"bg-white rounded-2xl shadow-card p-6 mb-6",children:[V.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:" "}),V.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:[" ",Kd.length,"   ."]}),V.jsx("div",{className:"overflow-x-auto",children:V.jsxs("table",{className:"w-full text-sm border-collapse",children:[V.jsx("thead",{className:"bg-gray-50",children:V.jsxs("tr",{children:[V.jsx("th",{className:"px-4 py-2 text-left text-gray-600 font-medium",children:"ID"}),V.jsx("th",{className:"px-4 py-2 text-left text-gray-600 font-medium",children:""}),V.jsx("th",{className:"px-4 py-2 text-left text-gray-600 font-medium",children:""}),V.jsx("th",{className:"px-4 py-2 text-left text-gray-600 font-medium",children:"ESP32 "}),V.jsx("th",{className:"px-4 py-2 text-left text-gray-600 font-medium",children:"Command Topic"})]})}),V.jsx("tbody",{children:Kd.map((a,u)=>{const f=s(a.type);return V.jsxs("tr",{className:u%2===0?"bg-white":"bg-gray-50",children:[V.jsx("td",{className:"px-4 py-2 text-gray-700",children:a.id}),V.jsx("td",{className:"px-4 py-2 text-gray-700",children:a.name}),V.jsx("td",{className:"px-4 py-2",children:V.jsx("span",{className:"px-2 py-0.5 rounded text-xs font-medium",style:{background:f.bg,color:f.text},children:a.type})}),V.jsx("td",{className:"px-4 py-2 text-gray-600 text-xs",children:a.esp32Id}),V.jsx("td",{className:"px-4 py-2 text-gray-500 text-xs font-mono",children:a.commandTopic})]},a.id)})})]})}),V.jsx("p",{className:"text-sm text-gray-500 mt-4 mb-0",children:" / src/config/devices.ts  ."})]}),V.jsxs("div",{className:"bg-white rounded-2xl shadow-card p-6 mb-6",children:[V.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:"  "}),V.jsxs("div",{children:[V.jsxs("div",{className:"mb-4",children:[V.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:" "}),V.jsx("input",{type:"text",value:l.farmName,onChange:a=>e({...l,farmName:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-base"})]}),V.jsxs("div",{className:"mb-4",children:[V.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:" "}),V.jsx("input",{type:"text",value:l.adminName,onChange:a=>e({...l,adminName:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-base"})]}),V.jsxs("div",{className:"mb-4",children:[V.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""}),V.jsx("textarea",{value:l.notes,onChange:a=>e({...l,notes:a.target.value}),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-base resize-vertical"})]}),V.jsx("button",{className:"w-full bg-farm-500 hover:bg-farm-600 text-gray-900 font-medium px-4 py-2 rounded-lg border-none cursor-pointer transition-all duration-200 hover:-translate-y-0.5",children:""})]})]})]})})}const CT="tansaeng-smartfarm-device-state-v1",DT="tansaeng-smartfarm-mist-zones-v1",OT="tansaeng-smartfarm-cameras-v1",kT="tansaeng-smartfarm-farm-settings-v1";function EN(){const[l,e]=Le.useState({});return Le.useEffect(()=>{const t=localStorage.getItem(CT);if(t)try{e(JSON.parse(t))}catch(r){console.error("Failed to parse device state from localStorage:",r)}},[]),Le.useEffect(()=>{localStorage.setItem(CT,JSON.stringify(l))},[l]),[l,e]}const SN=[{id:"zone_a",name:"Zone A ()",mode:"OFF",intervalMinutes:null,spraySeconds:null,startTime:"",endTime:"",allowNightOperation:!1},{id:"zone_b",name:"Zone B ()",mode:"OFF",intervalMinutes:null,spraySeconds:null,startTime:"",endTime:"",allowNightOperation:!1},{id:"zone_c",name:"Zone C ()",mode:"OFF",intervalMinutes:null,spraySeconds:null,startTime:"",endTime:"",allowNightOperation:!1}];function TN(){const[l,e]=Le.useState(SN);return Le.useEffect(()=>{const t=localStorage.getItem(DT);if(t)try{e(JSON.parse(t))}catch(r){console.error("Failed to parse mist zones from localStorage:",r)}},[]),Le.useEffect(()=>{localStorage.setItem(DT,JSON.stringify(l))},[l]),[l,e]}function xN(){const[l,e]=Le.useState([]);return Le.useEffect(()=>{const t=localStorage.getItem(OT);if(t)try{e(JSON.parse(t))}catch(r){console.error("Failed to parse cameras from localStorage:",r)}},[]),Le.useEffect(()=>{localStorage.setItem(OT,JSON.stringify(l))},[l]),[l,e]}const _N={farmName:"",adminName:"",notes:""};function AN(){const[l,e]=Le.useState(_N);return Le.useEffect(()=>{const t=localStorage.getItem(kT);if(t)try{e(JSON.parse(t))}catch(r){console.error("Failed to parse farm settings from localStorage:",r)}},[]),Le.useEffect(()=>{localStorage.setItem(kT,JSON.stringify(l))},[l]),[l,e]}function wN(){const[l,e]=Le.useState("devices"),[t,r]=Le.useState("connecting"),[n,s]=EN(),[a,u]=TN(),[f,c]=xN(),[d,p]=AN();return Le.useEffect(()=>{const m=Rm();return m.on("connect",()=>{r("connected")}),m.on("error",()=>{r("error")}),m.on("reconnect",()=>{r("connecting")}),m.on("offline",()=>{r("disconnected")}),()=>{}},[]),V.jsxs("div",{className:"flex flex-col h-screen bg-gray-100",children:[V.jsx(WI,{connectionState:t}),V.jsx(XI,{activeTab:l,onTabChange:e}),V.jsxs("main",{className:"flex-1 overflow-y-auto overflow-x-hidden pb-5 min-h-0",children:[l==="devices"&&V.jsx(fD,{deviceState:n,setDeviceState:s}),l==="mist"&&V.jsx(hD,{zones:a,setZones:u}),l==="environment"&&V.jsx(dD,{}),l==="cameras"&&V.jsx(vN,{cameras:f,setCameras:c}),l==="settings"&&V.jsx(bN,{farmSettings:d,setFarmSettings:p})]}),V.jsx("footer",{className:"bg-white border-t border-gray-200 px-4 py-3 flex-shrink-0",children:V.jsxs("div",{className:"max-w-screen-2xl mx-auto text-center text-xs text-gray-500",children:[V.jsx("p",{className:"mb-1",children:"    v2.5"}),V.jsx("p",{className:"text-2xs text-gray-400",children:"Powered by React + TypeScript + HiveMQ Cloud"})]})})]})}const RN=()=>V.jsx("div",{className:"min-h-screen bg-gray-50 py-6",children:V.jsxs("div",{className:"max-w-screen-2xl mx-auto px-4",children:[V.jsxs("header",{className:"bg-farm-500 rounded-lg px-6 py-4 mb-6 shadow-md",children:[V.jsx("h1",{className:"text-gray-900 font-bold text-2xl m-0",children:" Tapo  "}),V.jsx("p",{className:"text-gray-800 text-sm mt-1 m-0",children:"TP-Link Tapo  4  HLS "})]}),V.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[V.jsx(ns,{cameraId:1,title:"  1"}),V.jsx(ns,{cameraId:2,title:"  2"}),V.jsx(ns,{cameraId:3,title:"  3"}),V.jsx(ns,{cameraId:4,title:" "})]}),V.jsxs("div",{className:"mt-6 bg-white rounded-lg shadow-sm p-4",children:[V.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-2",children:"  "}),V.jsxs("ul",{className:"text-xs text-gray-600 space-y-1",children:[V.jsx("li",{children:"    HLS  "}),V.jsx("li",{children:"       "}),V.jsx("li",{children:"      "}),V.jsx("li",{children:"  URL .env  VITE_TAPO_CAM*_HLS_URL  "})]})]})]})});_R.createRoot(document.getElementById("root")).render(V.jsx(Le.StrictMode,{children:V.jsx(FI,{basename:"/smartfarm-ui",children:V.jsxs(mI,{children:[V.jsx(Gd,{path:"/",element:V.jsx(wN,{})}),V.jsx(Gd,{path:"/camera",element:V.jsx(RN,{})})]})})}));
