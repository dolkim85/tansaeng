<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¥ë°”êµ¬ë‹ˆ ë²„íŠ¼ ë””ë²„ê¹…</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { border: 1px solid #ccc; padding: 20px; margin: 20px 0; border-radius: 5px; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        .error { color: red; }
        .success { color: green; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ğŸ›’ ì¥ë°”êµ¬ë‹ˆ ë²„íŠ¼ ë””ë²„ê¹…</h1>

    <div class="test-section">
        <h2>API ê²½ë¡œ í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testRelativePath()">ìƒëŒ€ ê²½ë¡œ í…ŒìŠ¤íŠ¸ (../../api/cart.php)</button>
        <button onclick="testAbsolutePath()">ì ˆëŒ€ ê²½ë¡œ í…ŒìŠ¤íŠ¸ (/api/cart.php)</button>
        <div id="pathResult"></div>
    </div>

    <div class="test-section">
        <h2>ë°ì´í„° ì „ì†¡ í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testValidData()">ì •ìƒ ë°ì´í„° í…ŒìŠ¤íŠ¸</button>
        <button onclick="testInvalidData()">ì˜ëª»ëœ ë°ì´í„° í…ŒìŠ¤íŠ¸</button>
        <div id="dataResult"></div>
    </div>

    <div class="test-section">
        <h2>ì‹¤ì œ ìƒí’ˆ í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testProductAdd(1)">ìƒí’ˆ 1 ì¶”ê°€</button>
        <button onclick="testProductAdd(2)">ìƒí’ˆ 2 ì¶”ê°€</button>
        <button onclick="testProductAdd(999)">ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ìƒí’ˆ</button>
        <div id="productResult"></div>
    </div>

    <script>
        function log(elementId, message, isError = false) {
            const element = document.getElementById(elementId);
            const className = isError ? 'error' : 'success';
            element.innerHTML += `<p class="${className}">${message}</p>`;
        }

        function clearLog(elementId) {
            document.getElementById(elementId).innerHTML = '';
        }

        async function testAPI(url, data, resultElementId) {
            try {
                console.log('Testing URL:', url);
                console.log('With data:', data);
                console.log('JSON body:', JSON.stringify(data));

                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const responseText = await response.text();
                console.log('Response status:', response.status);
                console.log('Response headers:', response.headers);
                console.log('Response text:', responseText);

                if (!response.ok) {
                    log(resultElementId, `âŒ HTTP ${response.status}: ${responseText}`, true);
                    return;
                }

                const result = JSON.parse(responseText);
                if (result.success) {
                    log(resultElementId, `âœ… ì„±ê³µ: ${result.message}`);
                } else {
                    log(resultElementId, `âŒ ì‹¤íŒ¨: ${result.message}`, true);
                }

            } catch (error) {
                console.error('Error:', error);
                log(resultElementId, `âŒ ì˜¤ë¥˜: ${error.message}`, true);
            }
        }

        function testRelativePath() {
            clearLog('pathResult');
            testAPI('../../api/cart.php?action=add', {
                product_id: 1,
                quantity: 1
            }, 'pathResult');
        }

        function testAbsolutePath() {
            clearLog('pathResult');
            testAPI('/api/cart.php?action=add', {
                product_id: 1,
                quantity: 1
            }, 'pathResult');
        }

        function testValidData() {
            clearLog('dataResult');
            // ë‘ ê°€ì§€ ë°©ë²•ìœ¼ë¡œ í…ŒìŠ¤íŠ¸
            testAPI('../../api/cart.php?action=add&product_id=1&quantity=2', {
                product_id: 1,
                quantity: 2
            }, 'dataResult');
        }

        function testInvalidData() {
            clearLog('dataResult');
            testAPI('../../api/cart.php?action=add', {
                // product_id ëˆ„ë½
                quantity: 1
            }, 'dataResult');
        }

        function testProductAdd(productId) {
            clearLog('productResult');
            testAPI('../../api/cart.php?action=add', {
                product_id: productId,
                quantity: 1
            }, 'productResult');
        }

        // í˜ì´ì§€ ë¡œë“œì‹œ í˜„ì¬ ìœ„ì¹˜ í‘œì‹œ
        window.onload = function() {
            console.log('Current URL:', window.location.href);
            console.log('Base URL:', window.location.origin);
        };
    </script>
</body>
</html>