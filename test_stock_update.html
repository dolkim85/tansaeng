<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì¬ê³  ì—…ë°ì´íŠ¸ í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: Arial; margin: 20px; background: #f5f5f5; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        .stock-status { padding: 10px; margin: 10px 0; border-radius: 5px; font-weight: bold; }
        .in-stock { background: #d4edda; color: #155724; }
        .low-stock { background: #fff3cd; color: #856404; }
        .out-of-stock { background: #f8d7da; color: #721c24; }
        .test-btn { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        .test-btn:hover { background: #0056b3; }
        .log { background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 10px 0; font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ›’ ì¬ê³  ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ í…ŒìŠ¤íŠ¸</h1>

        <div>
            <label>ìƒí’ˆ ID: <input type="number" id="productId" value="1" min="1"></label>
            <label>ìˆ˜ëŸ‰: <input type="number" id="quantity" value="1" min="1" max="10"></label>
        </div>

        <div id="stockStatus" class="stock-status">
            ë¡œë”© ì¤‘...
        </div>

        <button class="test-btn" onclick="getCurrentStock()">í˜„ì¬ ì¬ê³  ì¡°íšŒ</button>
        <button class="test-btn" onclick="addToCartTest()">ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€ í…ŒìŠ¤íŠ¸</button>
        <button class="test-btn" onclick="clearLog()">ë¡œê·¸ ì§€ìš°ê¸°</button>

        <div class="log" id="logOutput"></div>
    </div>

    <script>
        let logCount = 0;

        function log(message, type = 'info') {
            const logDiv = document.getElementById('logOutput');
            const timestamp = new Date().toLocaleTimeString();
            logCount++;

            const color = type === 'error' ? '#dc3545' : type === 'success' ? '#28a745' : '#333';
            logDiv.innerHTML += `<div style="color: ${color}">[${logCount}] ${timestamp} - ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('logOutput').innerHTML = '';
            logCount = 0;
        }

        // ì¬ê³  ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateStockDisplay(currentStock) {
            const stockStatus = document.getElementById('stockStatus');

            if (currentStock > 10) {
                stockStatus.className = 'stock-status in-stock';
                stockStatus.innerHTML = `âœ… ì¬ê³  ì¶©ë¶„ (${currentStock}ê°œ ë‚¨ìŒ)`;
            } else if (currentStock > 0) {
                stockStatus.className = 'stock-status low-stock';
                stockStatus.innerHTML = `âš ï¸ ì¬ê³  ë¶€ì¡± (${currentStock}ê°œ ë‚¨ìŒ)`;
            } else {
                stockStatus.className = 'stock-status out-of-stock';
                stockStatus.innerHTML = 'âŒ í’ˆì ˆ';
            }
        }

        // í˜„ì¬ ì¬ê³  ì¡°íšŒ
        async function getCurrentStock() {
            const productId = document.getElementById('productId').value;
            log(`ìƒí’ˆ ID ${productId}ì˜ í˜„ì¬ ì¬ê³  ì¡°íšŒ ì‹œì‘`);

            try {
                const response = await fetch(`/api/product_stock.php?id=${productId}`);
                const data = await response.json();

                log(`ì¬ê³  API ì‘ë‹µ: ${JSON.stringify(data)}`);

                if (data.success) {
                    updateStockDisplay(data.stock);
                    log(`âœ… í˜„ì¬ ì¬ê³ : ${data.stock}ê°œ`, 'success');
                } else {
                    log(`âŒ ì¬ê³  ì¡°íšŒ ì‹¤íŒ¨: ${data.message}`, 'error');
                }
            } catch (error) {
                log(`âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€ í…ŒìŠ¤íŠ¸
        async function addToCartTest() {
            const productId = document.getElementById('productId').value;
            const quantity = document.getElementById('quantity').value;

            log(`ìƒí’ˆ ID ${productId}, ìˆ˜ëŸ‰ ${quantity}ê°œ ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€ ì‹œì‘`);

            try {
                const response = await fetch('/api/cart.php?action=add', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        product_id: parseInt(productId),
                        quantity: parseInt(quantity)
                    })
                });

                const data = await response.json();
                log(`ì¥ë°”êµ¬ë‹ˆ API ì‘ë‹µ: ${JSON.stringify(data, null, 2)}`);

                if (data.success) {
                    log(`âœ… ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€ ì„±ê³µ`, 'success');
                    // ì¬ê³  ì •ë³´ ì¬ì¡°íšŒ
                    setTimeout(() => {
                        getCurrentStock();
                    }, 500);
                } else {
                    log(`âŒ ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€ ì‹¤íŒ¨: ${data.message}`, 'error');
                }
            } catch (error) {
                log(`âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // í˜ì´ì§€ ë¡œë“œì‹œ ì´ˆê¸° ì¬ê³  ì¡°íšŒ
        window.onload = function() {
            log('í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
            getCurrentStock();
        };
    </script>
</body>
</html>